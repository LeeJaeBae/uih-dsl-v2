<!-- Generated by SpecStory, Markdown v2.0.0 -->

<!-- cursor Session 09928ac9-15f7-4e8b-84f3-38e31babca3c (2025-11-18 13:33Z) -->

# Complete guide to UIH DSL (2025-11-18 13:33Z)

_**User (2025-11-20 07:46Z)**_

@uih-dsl-complete-guide.md (1-2877) 

---

_**Agent (model gpt-5.1-codex-high, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Clarifying ambiguous file reference**

I'm seeing the user referenced the entire file but didn't specify what they want—summary, commentary, restructuring, or something else. There are several possible interpretations, so I'll respond gently in Korean, pointing out the ambiguity and inviting clarification while respecting the user’s style and rules.</details></think>

---

오빠, `docs/uih-dsl-complete-guide.md` 전체(1–2877라인)를 지정하신 걸 확인했어요.  
이 범위를 어떻게 도와드리면 될지 두 가지 정도로 해석 가능해서 확인이 필요해요:

1. **Fact**: 파일 전체 범위가 요청에 포함되어 있음.  
   **Inference**: 전체 요약, 특정 섹션 정리, 혹은 규칙 추출 중 하나를 원하실 수 있음 (단정 불가).

원하시는 작업이 요약인지, 규칙 재정리인지, 아니면 다른 목적(예: 특정 섹션 비교, 업데이트 등)인지 알려 주시면 바로 진행할게요!

---

_**User (2025-11-20 07:46Z)**_

이거로 examples 더 만들어봐

---

_**Agent (model gpt-5.1-codex-high, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Planning to add more DSL examples**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Expanding Examples section**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;6e9034bf-b7be-4a6c-b31d-95de698ed5af&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;    onRefresh: \&quot;refreshData\&quot;\n  }\n+ &#96;&#96;&#96;\n+ \n+ ### 최소 구조 예시\n+ \n+ &#96;&#96;&#96;\n+ meta {\n+   title: \&quot;Minimal Page\&quot;\n+   route: \&quot;/minimal\&quot;\n+   theme: \&quot;light\&quot;\n+ }\n+ \n+ style {\n+   color.primary: \&quot;#0E5EF7\&quot;\n+   spacing.unit: 12\n+ }\n+ \n+ layout {\n+   Div(class:\&quot;min-h-screen flex items-center justify-center bg-gray-50\&quot;) {\n+     \&quot;Coming soon\&quot;\n+   }\n+ }\n+ &#96;&#96;&#96;\n+ \n+ ### Form 중심 예시\n+ \n+ &#96;&#96;&#96;\n+ meta {\n+   title: \&quot;Sign Up\&quot;\n+   route: \&quot;/signup\&quot;\n+   theme: \&quot;light\&quot;\n+   description: \&quot;Create a new account\&quot;\n+ }\n+ \n+ style {\n+   color.primary: \&quot;#2563EB\&quot;\n+   color.secondary: \&quot;#6B7280\&quot;\n+   font.family: \&quot;Inter\&quot;\n+   font.size.base: 16\n+ }\n+ \n+ components {\n+   Form\n+   Input\n+   Button\n+   Alert\n+ }\n+ \n+ layout {\n+   Section(class:\&quot;min-h-screen flex items-center justify-center bg-gray-100\&quot;) {\n+     Form(class:\&quot;w-full max-w-md space-y-6 bg-white p-8 rounded-xl shadow-lg\&quot;) {\n+       H2(class:\&quot;text-2xl font-semibold text-gray-900\&quot;) {\n+         \&quot;Create your account\&quot;\n+       }\n+       Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;email\&quot;, placeholder:\&quot;Enter email\&quot;)\n+       Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;password\&quot;, placeholder:\&quot;Enter password\&quot;)\n+       Button(class:\&quot;w-full bg-blue-600 text-white py-3 rounded-lg\&quot;) {\n+         \&quot;Sign up\&quot;\n+       }\n+       Alert(class:\&quot;text-sm text-gray-500 text-center\&quot;) {\n+         \&quot;By signing up you agree to our terms\&quot;\n+       }\n+     }\n+   }\n+ }\n+ \n+ script {\n+   onSubmit: \&quot;handleSignup\&quot;\n+   onLoad: \&quot;prefillFromInvite\&quot;\n+ }\n+ &#96;&#96;&#96;\n+ \n+ ### 콘텐츠 피드 예시\n+ \n+ &#96;&#96;&#96;\n+ meta {\n+   title: \&quot;Creator Feed\&quot;\n+   route: \&quot;/feed\&quot;\n+   theme: \&quot;dark\&quot;\n+   description: \&quot;Realtime creator activity feed\&quot;\n+ }\n+ \n+ style {\n+   color.primary: \&quot;#22D3EE\&quot;\n+   color.background: \&quot;#0F172A\&quot;\n+   font.family: \&quot;Space Grotesk\&quot;\n+   spacing.medium: 20\n+   radius.card: 12\n+ }\n+ \n+ components {\n+   Shell\n+   Sidebar\n+   Feed\n+   FeedItem\n+   Avatar\n+   Badge\n+ }\n+ \n+ layout {\n+   Shell(class:\&quot;min-h-screen bg-slate-950 text-slate-100\&quot;) {\n+     Sidebar(class:\&quot;w-64 border-r border-slate-800 p-6 space-y-6\&quot;) {\n+       H1(class:\&quot;text-xl font-semibold tracking-tight\&quot;) {\n+         \&quot;Creator Hub\&quot;\n+       }\n+       Badge(class:\&quot;inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 text-slate-200\&quot;) {\n+         \&quot;Live updates\&quot;\n+       }\n+     }\n+     Feed(class:\&quot;flex-1 p-8 space-y-6\&quot;) {\n+       FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n+         Avatar(class:\&quot;h-12 w-12 rounded-full bg-cyan-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n+         Div(class:\&quot;space-y-2 flex-1\&quot;) {\n+           Div(class:\&quot;flex items-center justify-between\&quot;) {\n+             P(class:\&quot;font-medium\&quot;) {\n+               \&quot;heymina.studio\&quot;\n+             }\n+             Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-300\&quot;) {\n+               \&quot;New drop\&quot;\n+             }\n+           }\n+           P(class:\&quot;text-sm text-slate-300\&quot;) {\n+             \&quot;Dropped a limited neon kit — 120 packs sold out in 3 minutes.\&quot;\n+           }\n+         }\n+       }\n+       FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n+         Avatar(class:\&quot;h-12 w-12 rounded-full bg-pink-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n+         Div(class:\&quot;space-y-2 flex-1\&quot;) {\n+           Div(class:\&quot;flex items-center justify-between\&quot;) {\n+             P(class:\&quot;font-medium\&quot;) {\n+               \&quot;luvv.wav\&quot;\n+             }\n+             Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-cyan-500/10 text-cyan-300\&quot;) {\n+               \&quot;Stream recap\&quot;\n+             }\n+           }\n+           P(class:\&quot;text-sm text-slate-300\&quot;) {\n+             \&quot;Hit 18,245 live viewers tonight — chat requested a synthwave encore.\&quot;\n+           }\n+         }\n+       }\n+     }\n+   }\n+ }\n+ \n+ script {\n+   onRefresh: \&quot;fetchLatestFeed\&quot;\n+   onClick: \&quot;openCreatorProfile\&quot;\n+ }\n  &#96;&#96;&#96;\n  &quot;,
        &quot;oldStart&quot;: 2860,
        &quot;newStart&quot;: 2860,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 153,
        &quot;linesAdded&quot;: 149
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;,
  &quot;contentsAfterEdit&quot;: &quot;# UIH DSL — Complete Guide (생략 없는 완전판)\n\n## Table of Contents\n\n1. [Overview](#overview)\n2. [Philosophy &amp; Design Principles](#philosophy--design-principles)\n3. [Foundation Layer](#foundation-layer)\n4. [Tokenizer Specification](#tokenizer-specification)\n5. [Grammar](#grammar)\n   - [Block Grammar](#block-grammar)\n   - [Property Grammar](#property-grammar)\n   - [Layout Tree Grammar](#layout-tree-grammar)\n   - [Parser BNF Grammar](#parser-bnf-grammar)\n6. [AST Schema Definition](#ast-schema-definition)\n7. [IR (Intermediate Representation) Specification](#ir-intermediate-representation-specification)\n8. [Codegen Rules](#codegen-rules)\n   - [React/Next.js 15 Codegen](#reactnextjs-15-codegen)\n   - [Vue &amp; Svelte Codegen](#vue--svelte-codegen)\n9. [Examples](#examples)\n10. [Version](#version)\n\n---\n\n## Overview\n\nUIH DSL (Universal Interface Hierarchy Domain Specific Language) v2는 **\&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;**를 목표로 하는 도메인 특화 언어입니다.\n\n### 핵심 목표\n- LLM이 UI 구조를 **정확하게** 선언할 수 있도록 설계\n- 모호성 제거 및 결정성(determinism) 보장\n- 사람보다 AI가 더 효과적으로 사용 가능한 DSL\n- UI 구조의 선언적 표현에 집중\n\n### 아키텍처 흐름\n&#96;&#96;&#96;\nDSL 문자열 → Tokenizer → Parser → AST → IR → Codegen → React/Vue/Svelte 코드\n&#96;&#96;&#96;\n\n### 주요 특징\n- 한 줄에 하나의 의미만 (One-intent-per-line)\n- 선택적 문법 금지 - 모든 것이 명시적\n- 쌍따옴표만 허용, 세미콜론 없음\n- 주석 지원 안 함 (모호성 제거)\n- 고정 블록 순서: meta → style → components → layout → script\n\n---\n\n## Philosophy &amp; Design Principles\n\nUIH DSL은 \&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;를 목표로 하는 도메인 특화 언어입니다. 사람보다 LLM이 더 효과적으로 사용할 수 있도록 설계되었으며, UI 구조의 선언적 표현에 집중합니다.\n\n### 1. LLM 친화적 설계 원칙\n\nLLM이 읽고 쓰기 편한 DSL을 지향합니다. 구조는 최대한 명확하고 모호성이 없으며, 선택적 문법을 금지합니다. LLM이 패턴을 쉽게 반복할 수 있는 형태로 자연어 번역 난이도를 낮췄습니다.\n\n### 2. 선언적 UI 설계\n\nUI는 로직 기반보다 구조 기반으로 설계합니다. \&quot;무엇을 만든다\&quot;에 집중하며 \&quot;어떻게 만든다\&quot;는 Codegen이 담당합니다. 상태, 이벤트, 애니메이션은 추상화 계층으로 밀어냅니다.\n\n### 3. 한 줄 한 의미 원칙 (One-intent-per-line)\n\n한 라인에 하나의 의미만 허용합니다. 한 줄에 두 개 의미를 섞으면 LLM이 실수할 가능성이 높아집니다.\n\n#### 좋은 예: 한 줄 한 의미\n&#96;&#96;&#96;dsl\nmeta:\n  title: \&quot;Home\&quot;\n\nmeta:\n  route: \&quot;/\&quot;\n&#96;&#96;&#96;\n\n#### 나쁜 예: 한 줄 다중 의미 (금지)\n&#96;&#96;&#96;dsl\nmeta: title: \&quot;Home\&quot;, route: \&quot;/\&quot;  # 잘못된 예\n&#96;&#96;&#96;\n\n### 4. 고정 블록 순서\n\n블록 구조는 **meta → style → components → layout → script** 순서를 유지합니다. 이 순서는 LLM이 외우기 쉽고 Codegen의 예측 가능성과 AST의 결정성을 보장합니다.\n\n### 5. 최소 표현, 최대 의미\n\nDSL은 짧고 규칙적이어야 합니다. CSS-like verbose, YAML 계층 증가, JSX 로직 섞임을 금지합니다. 의미 전달에 집중하는 최소 선언적 DSL입니다.\n\n### 6. 오류 제로 문법\n\n\&quot;AI가 틀릴 수 없는 언어\&quot;를 목표로 합니다. 쌍따옴표만 허용하고 세미콜론 없이 콜론만 사용합니다. 모든 키는 고정된 string literal이며 optional field를 최소화합니다.\n\n### 7. AST 1:1 매핑\n\n모든 UI 요소가 AST에 직접 매핑됩니다. meta 블록 → MetaNode, style 블록 → StyleNode, layout 블록 → LayoutTree로 변환됩니다.\n\n### 8. 기계 친화적 우선\n\n\&quot;사람이 읽으면 조금 불편할 것\&quot; 정도가 적정 수준입니다. 사람 UX보다 AI 정확성을 우선합니다.\n\n---\n\n## Foundation Layer\n\nUIH DSL의 가장 낮은 레벨 사양입니다. Character부터 Ordering까지의 기본 규칙을 정의하며, LLM이 실수할 수 없는 엄격한 문법을 제공합니다.\n\n### 1. Character Layer (문자 규칙)\n\n#### ALLOWED_CHARACTERS\n- a~z (lowercase alphabets)\n- 0~9 (digits)\n- hyphen (-)\n- underscore (_)\n- space ( )\n- newline (\\n)\n- braces: { }\n- colon (:)\n- double-quote (\&quot;)\n\n#### DISALLOWED_CHARACTERS\n- single-quote (&#39;)\n- semicolon (;)\n- parentheses ()\n- backtick (&#96;)\n- tab (\\t)\n- CRLF (\\r\\n)\n\n#### NEWLINE\n- always LF (\\n)\n- CRLF not supported\n\n### 2. Indentation Layer (들여쓰기 규칙)\n\n#### INDENTATION\n- exactly 2 spaces ONLY\n- tabs NOT allowed\n- indentation increases only inside a block\n- indentation does not imply hierarchy (not YAML)\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {           // ❌ 탭 사용 금지\n  title: \&quot;Home\&quot;  // ✅ 정확히 2 space\n}\n&#96;&#96;&#96;\n\n### 3. Token Layer (토큰 기본 규칙)\n\n#### TOKENS\n- IDENTIFIER = &#96;[a-z][a-z0-9.]*&#96;\n- STRING = &#96;\&quot;[^\&quot;\\\\]*(?:\\\\.[^\&quot;\\\\]*)*\&quot;&#96; (supports &#96;\\\&quot;&#96; escape)\n- NUMBER = &#96;\\d+(?:\\.\\d+)?&#96;\n- LBRACE = &#96;{&#96;\n- RBRACE = &#96;}&#96;\n- COLON = &#96;:&#96;\n- NEWLINE = &#96;\\n&#96;\n- WHITESPACE = single space\n\n#### IDENTIFIER_RULES\n- lowercase only\n- dot notation allowed (e.g. &#96;color.primary&#96;)\n- do NOT mix hyphens inside identifiers (LLM error-prone)\n\n#### STRING_RULES\n- must use double quotes only\n- escaping uses &#96;\\\&quot;&#96;\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {\n  color.primary: \&quot;#fff\&quot;    // ✅ dot notation 허용\n  label: \&quot;Click \\\&quot;here\\\&quot;\&quot;  // ✅ escape 허용\n  width: 100.5            // ✅ 소수 허용\n}\n&#96;&#96;&#96;\n\n### 4. Comment Layer (코멘트)\n\n#### COMMENTS\n- comments NOT supported\n- any attempt to use &#96;//&#96; or &#96;#&#96; is invalid\n- purpose: reduce ambiguity for LLM\n\n### 5. Statement Layer (기본 문장 구조)\n\n#### STATEMENT_TYPES\n- Block Declaration\n- Property Declaration\n\n#### BLOCK_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt; {\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n#### PROPERTY_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n#### SEMICOLON\n- NOT allowed (never used)\n\n### 6. Block Layer (블록 기본 규칙)\n\n#### BLOCK_STRUCTURE\n&#96;&#96;&#96;\nblockName {\n  property: \&quot;value\&quot;\n  property: 123\n  property: true\n}\n&#96;&#96;&#96;\n\n#### BLOCK_RULES\n- block cannot contain nested blocks\n- ONLY layout block may contain nested layout nodes\n\n### 7. Ordering Layer (순서 강제)\n\n#### BLOCK_ORDER\n1. meta\n2. style\n3. components (optional)\n4. layout\n5. script (optional)\n\n#### RULE\n- if a block appears, must follow this order\n- missing blocks are allowed except meta/style/layout\n\n### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  primary-color: \&quot;#111\&quot;\n}\n\ncomponents {\n  Button {\n    variant: \&quot;primary\&quot;\n  }\n}\n\nlayout {\n  Container {\n    children: \&quot;Button\&quot;\n  }\n}\n\nscript {\n  // optional script\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단\n- 잘못된 들여쓰기 발견 시 구문 오류\n- 코멘트 시도 시 즉시 무효 처리\n- 블록 순서 위반 시 파싱 실패\n- layout 외 중첩 블록 시도 시 오류\n\n---\n\n## Tokenizer Specification\n\nFoundation Layer + Grammar Layers 기반의 공식 토큰화 규칙입니다. DSL 문자열을 균일한 Token 리스트로 변환하며, 모든 파싱의 기반이 됩니다.\n\n### 1. Tokenizer Overview\n\n#### PURPOSE\n- DSL 문자열을 균일한 Token 리스트로 변환\n- 모호성 없는 deterministic token stream 생성\n- 모든 파싱은 이 토큰 리스트 기반으로 진행\n\n#### INPUT\n- LF 기반의 DSL 문자열\n\n#### OUTPUT\n- 순차적 Token 배열\n\n### 2. Token Types\n\n#### TOKENS\n- &#96;IDENTIFIER&#96; - meta, title, color.primary, class 등\n- &#96;STRING&#96; - \&quot;Hello\&quot;\n- &#96;NUMBER&#96; - 0, 12, 0.8\n- &#96;BOOLEAN&#96; - true, false\n- &#96;LBRACE&#96; - {\n- &#96;RBRACE&#96; - }\n- &#96;LPAREN&#96; - (\n- &#96;RPAREN&#96; - )\n- &#96;COLON&#96; - :\n- &#96;COMMA&#96; - ,\n- &#96;NEWLINE&#96; - \\n\n- &#96;WHITESPACE&#96; - space (only used between tokens)\n- &#96;TEXT_STRING&#96; - layout children string ONLY (disambiguation)\n- &#96;EOF&#96; - end of file marker\n\n### 3. Identifier Detection\n\n#### IDENTIFIER_RULES\n- regex: &#96;^[a-z][a-z0-9.]*$&#96;\n- lowercase only\n- dot notation allowed\n- hyphens, underscores 금지\n\n#### TAGNAME_RULES\n- starts with uppercase letter\n- subsequent chars: &#96;[a-zA-Z0-9]&#96;\n- TagName (e.g. Div, Header) 구분용\n\n#### TAGNAME_EXAMPLES\n&#96;&#96;&#96;\nDiv\nSection\nImage\nH1\n&#96;&#96;&#96;\n\n### 4. String Token Rules\n\n#### STRING\n- starts with &#96;\&quot;&#96;\n- ends with &#96;\&quot;&#96;\n- inside supports &#96;\\\&quot;&#96;\n- no multi-line\n\n#### TEXT_STRING\n- STRING과 동일한 문법\n- 단, layout children context에서만 등장\n- Parser에서 context-aware로 구분\n\n### 5. Number Token Rules\n\n#### NUMBER\n- regex: &#96;^[0-9]+(\\.[0-9]+)?$&#96;\n- no negative numbers\n- no units (px, rem 등)\n\n### 6. Boolean Token Rules\n\n#### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n- strictly lowercase\n\n### 7. Brace / Symbol Tokens\n\n#### SYMBOL_TOKENS\n- &#96;LBRACE&#96;: &#96;{&#96;\n- &#96;RBRACE&#96;: &#96;}&#96;\n- &#96;LPAREN&#96;: &#96;(&#96;\n- &#96;RPAREN&#96;: &#96;)&#96;\n- &#96;COLON&#96;: &#96;:&#96;\n- &#96;COMMA&#96;: &#96;,&#96;\n\n#### NOTES\n- semicolon NOT allowed\n- backtick NOT allowed\n\n### 8. Whitespace / Newline Rules\n\n#### WHITESPACE\n- single space &#96;&#39; &#39;&#96;\n- no tabs\n- no multi-space sequences except indentation (2 spaces)\n\n#### NEWLINE\n- LF only\n- CRLF invalid\n\n### 9. Layout Context Rules (Critical)\n\n#### LAYOUT_MODE\nTokenizer enters layout-mode when encountering:\n&#96;&#96;&#96;\nlayout { … }\n&#96;&#96;&#96;\n\n#### CONTEXT_SWITCH\n- after TagName(\n- before encountering next node or text\n\n#### INSIDE_LAYOUT_BLOCK\n- children detection required\n- plain strings must become TEXT_STRING token\n- siblings separated by NEWLINE\n\n#### EXAMPLE\n&#96;&#96;&#96;\n\&quot;Welcome\&quot; → TEXT_STRING inside layout\n&#96;&#96;&#96;\n\n### 10. Tokenization Algorithm (High-Level)\n\n1. iterate through chars\n2. skip whitespace unless meaningful (indent)\n3. detect IDENTIFIER or TAGNAME\n4. detect STRING (with escape)\n5. detect NUMBER\n6. detect BOOLEAN\n7. detect braces &#96;{ }&#96;\n8. detect parentheses &#96;( )&#96;\n9. detect colon &#96;:&#96; or comma &#96;,&#96;\n10. detect newline &#96;\\n&#96;\n11. maintain context stack:\n    - normal\n    - inside layout block\n    - inside attributes\n12. output final EOF token\n\n### 11. Example Token Stream\n\n#### INPUT\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### OUTPUT_TOKENS\n&#96;&#96;&#96;\nIDENTIFIER(layout)\nLBRACE\nNEWLINE\nTAGNAME(Div)\nLPAREN\nIDENTIFIER(class)\nCOLON\nSTRING(\&quot;p-4\&quot;)\nRPAREN\nLBRACE\nNEWLINE\nTEXT_STRING(\&quot;Hello\&quot;)\nNEWLINE\nRBRACE\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Token Stream Examples\n\n#### 기본 블록 토큰화\n&#96;&#96;&#96;dsl\nmeta {\n  title: \&quot;Home\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(meta)\nLBRACE\nNEWLINE\nIDENTIFIER(title)\nCOLON\nSTRING(\&quot;Home\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n#### 스타일 블록 토큰화\n&#96;&#96;&#96;dsl\nstyle {\n  color.primary: \&quot;#fff\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(style)\nLBRACE\nNEWLINE\nIDENTIFIER(color.primary)\nCOLON\nSTRING(\&quot;#fff\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단 및 오류 반환\n- CRLF 줄바꿈 발견 시 LF로 변환 또는 오류\n- 탭 문자 발견 시 공백 변환 또는 오류\n- STRING에서 미닫힘 따옴표 시 오류\n- NUMBER에 음수나 단위 포함 시 오류\n- layout 외 컨텍스트에서 TEXT_STRING 시도 시 오류\n- TAGNAME 규칙 위반 (소문자 시작) 시 IDENTIFIER로 처리\n\n---\n\n## Grammar\n\n### Block Grammar\n\nUIH DSL의 최상위 구조를 정의하는 Block Grammar Layer입니다. Foundation Layer 바로 위에 위치하며, 5개 블록의 선언, 순서, 내용 규칙을 명시합니다.\n\n#### 1. Block Definitions (5개 블록)\n\n##### BLOCKS\n- meta\n- style\n- components (optional)\n- layout\n- script (optional)\n\n##### RULES\n- 블록은 반드시 이 순서를 따라야 함: meta → style → components → layout → script\n- meta, style, layout은 필수\n- components, script는 선택\n- 각 블록은 정확히 한 번만 등장\n- 중복 블록 금지\n\n#### 2. Block Syntax (기본 문법)\n\n##### BLOCK_SYNTAX\n&#96;&#96;&#96;\n&lt;blockName&gt; {\n  &lt;property&gt;: &lt;value&gt;\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n&#96;&#96;&#96;\n\n##### SYNTAX_COMPONENTS\n- 블록 시작: IDENTIFIER + &#96; {&#96;\n- 블록 끝: &#96;}&#96; 단독 줄\n\n#### 3. Block Content Rules\n\n##### 공통 규칙\n- 블록 내부에는 property statements만 존재\n- block 내부에 block 중첩 금지\n- 단, layout 블록만 예외적으로 UI tree 구조 허용\n\n##### PROPERTY_RULE\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### VALUE_TYPES\n- string\n- number\n- boolean\n- enum-like literals (string 값)\n- list (향후 정의)\n\n#### 4. Block-Specific Rules\n\n##### (1) META BLOCK\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Page title\&quot;\n  route: \&quot;/path\&quot;\n  theme: \&quot;light\&quot;|\&quot;dark\&quot;\n}\n&#96;&#96;&#96;\n\n**META_RESTRICTIONS:**\n- meta는 UI 문서의 metadata만 포함\n- layout 정보나 스타일 정보 포함 금지\n\n##### (2) STYLE BLOCK\n&#96;&#96;&#96;\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n}\n&#96;&#96;&#96;\n\n**STYLE_RESTRICTIONS:**\n- key는 dot notation 사용 가능\n- 값은 string 또는 number\n- layout 관련 속성 금지\n- theme override 불가\n\n##### (3) COMPONENTS BLOCK (optional)\n&#96;&#96;&#96;\ncomponents {\n  Card\n  Button\n  Input\n}\n&#96;&#96;&#96;\n\n**COMPONENTS_RULES:**\n- 등록할 컴포넌트 이름만 줄 단위로 나열\n- 중첩 구조 없음\n- 속성 없음\n- 문자열 아님: &#96;\&quot;Card\&quot;&#96; 금지, &#96;Card&#96;만 허용\n\n##### (4) LAYOUT BLOCK\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n**LAYOUT_RULES:**\n- 유일하게 중첩 구조 허용\n- 노드 문법은 별도 Layer에서 정의\n- property는 inline attribute 형태 가능\n- block-like structure 유지\n\n##### (5) SCRIPT BLOCK (optional)\n&#96;&#96;&#96;\nscript {\n  onClick: \&quot;submitForm\&quot;\n  onLoad: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n**SCRIPT_RESTRICTIONS:**\n- event/behavior mapping만 정의\n- JS code 삽입 금지\n- inline function 금지\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n  spacing.unit: 8\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n}\n\nlayout {\n  Div(class:\&quot;container mx-auto p-4\&quot;) {\n    Card(class:\&quot;bg-white shadow-lg\&quot;) {\n      Button(onClick:\&quot;handleSubmit\&quot;) {\n        \&quot;Submit\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onLoad: \&quot;initDashboard\&quot;\n  onSubmit: \&quot;processForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 파싱 실패\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유효 (경고)\n- components/script 외 블록에서 중첩 시도 시 오류\n- layout 외 블록에서 attribute 사용 시 오류\n\n---\n\n### Property Grammar\n\nUIH DSL 안정성의 핵심인 Property Grammar Layer입니다. Block Grammar 위에 쌓이며, 속성 선언, 값 타입, 범위 규칙을 정의합니다.\n\n#### 1. Property Declaration Syntax\n\n##### PROPERTY_SYNTAX\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\nradius.default: 8\nenabled: true\n&#96;&#96;&#96;\n\n##### RULES\n- identifier는 반드시 lowercase\n- dot notation 허용 (&#96;color.primary&#96; 등)\n- colon(:) 뒤에는 반드시 space 1개\n- value는 줄 끝까지\n\n#### 2. Identifier Rules\n\n##### IDENTIFIER\n- 패턴: &#96;[a-z][a-z0-9.]*&#96;\n- 소문자만 허용\n- 숫자는 뒤쪽에만 허용\n- dot(.)은 중첩 속성 의미로만 사용\n- hyphen 금지 (LLM 오류 방지)\n- underscore 금지\n\n##### VALID\n&#96;&#96;&#96;\ncolor.primary\nfont.size\nborder.width\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nColor.Primary    // 대문자\nfont-size        // hyphen\nfont_size        // underscore\nprimary2.color   // 숫자 앞쪽\n&#96;&#96;&#96;\n\n#### 3. Value Types (5가지)\n\n##### VALUE_TYPES\n1. STRING\n2. NUMBER\n3. BOOLEAN\n4. ENUM-LIKE (string 기반)\n5. LIST (여러 값 나열, 줄 단위)\n\n#### 4. String Value Rules\n\n##### STRING\n- 무조건 double-quote 사용\n- 내부에 &#96;\&quot;&#96; 포함 시 &#96;\\\&quot;&#96;로 escape\n- single-quote 절대 금지\n\n##### VALID\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\ndescription: \&quot;He said \\\&quot;ok\\\&quot;\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\ntitle: &#39;Home&#39;      // single-quote\nname: \&quot;Home\&quot;       // curly quotes\n&#96;&#96;&#96;\n\n#### 5. Number Value Rules\n\n##### NUMBER\n- 정수 또는 소숫점 가능\n- 음수는 허용하지 않음\n- 단위(px 등) 금지 → unitless 구조\n\n##### VALID\n&#96;&#96;&#96;\nradius: 12\nopacity: 0.85\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nradius: -4     // 음수\nwidth: 10px    // 단위 포함\n&#96;&#96;&#96;\n\n#### 6. Boolean Value Rules\n\n##### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nenabled: true\nvisible: false\n&#96;&#96;&#96;\n\n#### 7. Enum-like String Rules\n\n##### ENUM_STRING\n- 문자열이지만 값이 고정된 타입처럼 쓰는 케이스\n- allowed values는 별도 block schema마다 정의\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntheme: \&quot;light\&quot; | \&quot;dark\&quot;\nsize: \&quot;sm\&quot; | \&quot;md\&quot; | \&quot;lg\&quot;\n&#96;&#96;&#96;\n\n#### 8. List Value (Block-like list)\n\n##### LIST\n- 각 항목은 줄 단위로 입력\n- 대괄호 &#96;[]&#96; 문법 없음 (LLM 오류 방지)\n- 문자열/식별자 혼용 가능\n\n##### SYNTAX\n&#96;&#96;&#96;\nitems {\n  \&quot;one\&quot;\n  \&quot;two\&quot;\n  \&quot;three\&quot;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- list block 내부에는 property 없음\n- indent 2 spaces 유지\n\n##### EXAMPLE\n&#96;&#96;&#96;\ntags {\n  \&quot;news\&quot;\n  \&quot;feature\&quot;\n  \&quot;announcement\&quot;\n}\n&#96;&#96;&#96;\n\n#### 9. Property Scope Rules (Block별 허용 속성 경계)\n\n##### META_SCOPE\n- meta는 UI metadata만 포함\n- route, title, theme, description 등\n\n##### STYLE_SCOPE\n- 색상, 폰트, radius 등 UI 스타일만\n- layout 속성 금지 (width, height 등은 layout block에서만)\n\n##### COMPONENTS_SCOPE\n- property 없음 (등록만)\n\n##### LAYOUT_SCOPE\n- inline attribute만 (class, id, ref 등)\n- 값은 무조건 string\n- boolean/number 사용 금지\n\n##### SCRIPT_SCOPE\n- event mapping 전용\n- 값은 무조건 string\n\n#### 10. Final Validation Rules\n\n1. 모든 property는 블록 내부에서만 존재\n2. 같은 identifier 중복 선언 금지\n3. meta/style/script는 property-only 구조\n4. components는 선언만 (property 없음)\n5. layout만 child nodes 보유 가능\n6. value의 타입은 block-specific rule을 반드시 준수\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main dashboard page\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  border.radius: 8\n  spacing.unit: 16\n}\n\ncomponents {\n  Card\n  Button\n  Input\n}\n\nlayout {\n  class: \&quot;container\&quot;\n  id: \&quot;main-content\&quot;\n}\n\nscript {\n  onLoad: \&quot;initDashboard\&quot;\n  onSubmit: \&quot;handleForm\&quot;\n  onRefresh: \&quot;reloadData\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 대문자 identifier 사용 시 토큰화 실패\n- hyphen/underscore 사용 시 구문 오류\n- single-quote나 curly quotes 사용 시 파싱 실패\n- 음수나 단위 포함 숫자 시 값 오류\n- 블록별 스코프 위반 시 validation 실패\n- 중복 property 선언 시 마지막 값만 유효 (경고)\n\n---\n\n### Layout Tree Grammar\n\nUIH DSL의 핵심 구조인 Layout Tree Grammar Layer입니다. Block Grammar와 Property Grammar 위에서 동작하며, UI 구성 요소의 트리 구조를 정의합니다.\n\n#### 1. Layout Block Overview\n\n##### LAYOUT_BLOCK\n&#96;&#96;&#96;\nlayout {\n  &lt;layout-node&gt;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- DSL에서 유일하게 중첩 구조를 가질 수 있는 블록\n- 모든 UI 구성 요소는 layout node로 표현\n- 노드는 \&quot;구조\&quot;만 표현, 스타일/로직은 표현하지 않음\n\n#### 2. Layout Node Syntax\n\n##### NODE_SYNTAX\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;) {\n  &lt;children&gt;\n}\n&#96;&#96;&#96;\n\n##### OR (children 없는 경우)\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;)\n&#96;&#96;&#96;\n\n##### NOTES\n- TagName은 PascalCase 컴포넌트 또는 HTML-like 사용 가능\n- attributes는 inline 형태 only\n- attributes는 옵션, 없어도 됨\n- children 블록은 중첩 가능\n\n##### VALID\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) {\n  \&quot;Hello\&quot;\n}\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nDiv {\n  class: \&quot;p-4\&quot;    // 속성은 block 기반이 아니라 inline only\n}\n&#96;&#96;&#96;\n\n#### 3. TagName Rules\n\n##### TAGNAME\n- 반드시 알파벳으로 시작\n- PascalCase 또는 UpperCamelCase 권장\n- HTML-like 소문자 태그는 사용 가능 (&#96;div&#96;, &#96;span&#96;) 단 내부적으로는 UpperCase 변환됨\n\n##### VALID\n&#96;&#96;&#96;\nDiv\nSection\nImage\nheader   // 허용하지만 변환 시 Header로 취급\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n3Div     // 숫자 시작\n_Box     // underscore 시작\n-Node    // hyphen 시작\n&#96;&#96;&#96;\n\n#### 4. Attribute Syntax\n\n##### ATTRIBUTES\n&#96;&#96;&#96;\n&lt;identifier&gt;:\&quot;&lt;string&gt;\&quot;\n&#96;&#96;&#96;\n\n##### RULES\n- value는 무조건 string only\n- boolean/number 금지\n- &#96;class:\&quot;p-4\&quot;&#96; 형태처럼 inline만 허용\n- 각 attribute는 콤마(&#96;,&#96;)로 구분\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;, id:\&quot;main\&quot;, ref:\&quot;root\&quot;)\n&#96;&#96;&#96;\n\n##### STRICT_RULES\n- 속성 순서는 의미 없음 (LLM 실수 방지로 자유 순서)\n- attribute key는 lower-case only\n- 속성 개수 0~5 정도 권장\n\n#### 5. Children Rules\n\n##### CHILD_TYPES\n- string literal\n- another layout node\n- list of siblings (node 여러 개 배치)\n\n##### STRING_CHILD\n&#96;&#96;&#96;\n\&quot;Hello world\&quot;\n&#96;&#96;&#96;\n\n##### NESTED_NODE\n&#96;&#96;&#96;\nDiv(class:\&quot;mt-4\&quot;) {\n  \&quot;content\&quot;\n}\n&#96;&#96;&#96;\n\n##### SIBLINGS\n&#96;&#96;&#96;\nDiv(...) { ... }\nP(...) { ... }\nImage(...)\n&#96;&#96;&#96;\n\n#### 6. Text Node Rules\n\n##### TEXT_NODE\n- 무조건 double-quote string\n- 줄바꿈 포함 금지\n- 텍스트 덩어리는 여러 줄로 쪼개면 안 됨\n\n##### VALID\n&#96;&#96;&#96;\n\&quot;Sign in to continue\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n\&quot;Hello\n World\&quot;    // 줄바꿈 포함\n&#96;&#96;&#96;\n\n#### 7. Node Termination Rules\n\n##### CLOSING_RULES\n- 블록 노드는 반드시 &#96;}&#96; 단독 줄로 닫는다\n- inline-only 노드는 종료 블록 없음\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;px-4\&quot;) {\n  P {\n    \&quot;Hello\&quot;\n  }\n  Image(src:\&quot;/logo.png\&quot;)\n}\n&#96;&#96;&#96;\n\n#### 8. Layout Grammar Formal Pattern\n\n##### LAYOUT_NODE_GRAMMAR\n&#96;&#96;&#96;\nNode:\n  Tag (Attributes?) (ChildrenBlock?)\n\nTag:\n  IDENTIFIER\n\nAttributes:\n  \&quot;(\&quot; AttributeList \&quot;)\&quot;\n\nAttributeList:\n  Attribute (\&quot;,\&quot; Attribute)*\n\nAttribute:\n  IDENTIFIER \&quot;:\&quot; STRING\n\nChildrenBlock:\n  \&quot;{\&quot; NewLine Indented(NodeOrText)+ \&quot;}\&quot;\n\nNodeOrText:\n  Node | STRING\n&#96;&#96;&#96;\n\n#### 9. Validation Rules\n\n1. layout은 트리 구조만 표현한다\n2. inline attributes만 허용\n3. 속성은 string-only\n4. children은 반드시 정해진 중첩 규칙을 따른다\n5. Node 이름은 PascalCase가 기본\n6. 문자열 children 외에는 모든 children은 Node여야 한다\n7. siblings 허용, 순서 보존\n\n#### 10. Example (Valid Layout Tree)\n\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;min-h-screen flex flex-col\&quot;) {\n    Header(class:\&quot;p-4 bg-gray-100\&quot;) {\n      H1 {\n        \&quot;Dashboard\&quot;\n      }\n    }\n\n    Main(class:\&quot;flex-1 p-6\&quot;) {\n      Card(class:\&quot;shadow\&quot;) {\n        P {\n          \&quot;Welcome back!\&quot;\n        }\n      }\n    }\n\n    Footer(class:\&quot;p-4 text-center\&quot;) {\n      \&quot;© 2025 The Bespoke\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto\&quot;) {\n    Navbar(class:\&quot;flex justify-between items-center p-4\&quot;) {\n      Logo(class:\&quot;text-xl font-bold\&quot;) {\n        \&quot;UIH\&quot;\n      }\n      Nav(class:\&quot;space-x-4\&quot;) {\n        Link(href:\&quot;/home\&quot;) {\n          \&quot;Home\&quot;\n        }\n        Link(href:\&quot;/about\&quot;) {\n          \&quot;About\&quot;\n        }\n      }\n    }\n\n    Content(class:\&quot;grid grid-cols-3 gap-6 p-6\&quot;) {\n      Sidebar(class:\&quot;col-span-1 bg-gray-50 p-4\&quot;) {\n        Menu {\n          \&quot;Dashboard\&quot;\n          \&quot;Settings\&quot;\n          \&quot;Profile\&quot;\n        }\n      }\n\n      Main(class:\&quot;col-span-2\&quot;) {\n        Article(class:\&quot;prose\&quot;) {\n          H2 {\n            \&quot;Getting Started\&quot;\n          }\n          P {\n            \&quot;Welcome to UIH DSL documentation.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- TagName에 숫자/특수문자 시작 시 토큰화 실패\n- 속성에 boolean/number 값 사용 시 파싱 오류\n- 텍스트 노드에 줄바꿈 포함 시 validation 실패\n- 노드 종료 &#96;}&#96; 누락 시 구문 오류\n- 중첩 깊이가 너무 깊을 경우 (권장 5레벨 초과) 경고\n- siblings 간 순서가 UI 의미에 영향 줄 경우 재검토\n\n---\n\n### Parser BNF Grammar\n\nTokenizer 위에서 동작하는 공식 문법 엔진 정의입니다. Token Stream을 Abstract Syntax Tree(AST)로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- Token Stream → Abstract Syntax Tree(AST)\n\n##### PARSER_MODE\n- strict non-ambiguous grammar\n- no recovery parsing (에러는 즉시 throw)\n- deterministic (LLM-friendly)\n- recursive descent parser 기반 구조\n\n#### 2. Entry Point\n\n##### Program\n&#96;&#96;&#96;\nProgram ::= MetaBlock StyleBlock ComponentsBlock? LayoutBlock ScriptBlock? EOF\n&#96;&#96;&#96;\n\n#### 3. Blocks\n\n##### Block_Definitions\n&#96;&#96;&#96;\nMetaBlock       ::= \&quot;meta\&quot; BlockBody(MetaProperty)\nStyleBlock      ::= \&quot;style\&quot; BlockBody(StyleProperty)\nComponentsBlock ::= \&quot;components\&quot; BlockBody(ComponentEntry)\nLayoutBlock     ::= \&quot;layout\&quot; LayoutBody\nScriptBlock     ::= \&quot;script\&quot; BlockBody(ScriptProperty)\n&#96;&#96;&#96;\n\n#### 4. Generic Block Body\n\n##### BlockBody\n&#96;&#96;&#96;\nBlockBody(&lt;T&gt;) ::= LBRACE NEWLINE (Indent &lt;T&gt; NEWLINE)* RBRACE\nIndent         ::= WHITESPACE WHITESPACE    # 2 spaces only\n&#96;&#96;&#96;\n\n#### 5. META Block Grammar\n\n##### MetaProperty\n&#96;&#96;&#96;\nMetaProperty ::= Identifier \&quot;:\&quot; MetaValue\nMetaValue    ::= STRING | NUMBER | BOOLEAN | EnumString\n&#96;&#96;&#96;\n\n##### Allowed_Meta_Keys\n- title, route, theme, description\n\n#### 6. STYLE Block Grammar\n\n##### StyleProperty\n&#96;&#96;&#96;\nStyleProperty ::= StyleKey \&quot;:\&quot; StyleValue\nStyleKey      ::= Identifier ( \&quot;.\&quot; Identifier )*\nStyleValue    ::= STRING | NUMBER | EnumString\n&#96;&#96;&#96;\n\n##### Notes\n- no nested blocks\n- no boolean\n- layout-like attributes 금지\n\n#### 7. COMPONENTS Block Grammar\n\n##### ComponentEntry\n&#96;&#96;&#96;\nComponentEntry ::= ComponentName\nComponentName  ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n##### NOTES\n- but no quotes, no values, one per line\n\n##### Examples\n&#96;&#96;&#96;\nCard\nButton\nInput\n&#96;&#96;&#96;\n\n#### 8. LAYOUT Block Grammar (Core)\n\n##### LayoutBody\n&#96;&#96;&#96;\nLayoutBody     ::= LBRACE NEWLINE Indent LayoutNodeList RBRACE\nLayoutNodeList ::= (LayoutNode NEWLINE)*\nLayoutNode     ::= Tag (Attributes)? (ChildrenBlock)?\nTag            ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n#### 9. Attributes Grammar\n\n##### Attributes\n&#96;&#96;&#96;\nAttributes    ::= LPAREN AttributeList RPAREN\nAttributeList ::= Attribute (COMMA Attribute)*\nAttribute     ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n#### 10. Children Block Grammar\n\n##### ChildrenBlock\n&#96;&#96;&#96;\nChildrenBlock ::= LBRACE NEWLINE Indent ChildrenList RBRACE\nChildrenList  ::= (Child NEWLINE)*\nChild         ::= LayoutNode | TEXT_STRING\n&#96;&#96;&#96;\n\n#### 11. SCRIPT Block Grammar\n\n##### ScriptProperty\n&#96;&#96;&#96;\nScriptProperty ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n##### Allowed_Script_Keys\n- onClick, onLoad, onSubmit, onMount, onChange\n\n#### 12. Value Grammars\n\n##### Value_Types\n&#96;&#96;&#96;\nSTRING     ::= \&quot;\\\&quot;\&quot; &lt;chars&gt; \&quot;\\\&quot;\&quot;\nNUMBER     ::= digits ( \&quot;.\&quot; digits )?\nBOOLEAN    ::= \&quot;true\&quot; | \&quot;false\&quot;\nEnumString ::= STRING   # validated in semantic phase\n&#96;&#96;&#96;\n\n#### 13. Identifier Grammars\n\n##### Identifiers\n&#96;&#96;&#96;\nIdentifier ::= [a-z][a-z0-9.]*\nTagName    ::= [A-Z][a-zA-Z0-9]*\n&#96;&#96;&#96;\n\n#### 14. Syntax Constraints (Formal)\n\n1. 모든 블록은 순서 고정\n2. 각 블록은 1회만 등장\n3. meta/style/layout은 필수\n4. components/script는 optional\n5. 들여쓰기 2 spaces only\n6. 속성(colon)은 반드시 &#96;&lt;id&gt;: &lt;value&gt;&#96;\n7. semicolon 금지\n8. layout만 nested structure 허용\n9. children 안에서는 TEXT_STRING 또는 LayoutNode만 허용\n10. parser는 ambiguous branch 금지 (LLM-safe)\n\n#### 15. Complete Example (BNF-valid)\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  radius.default: 8\n}\n\ncomponents {\n  Card\n  Button\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello world\&quot;\n    }\n  }\n}\n\nscript {\n  onClick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### BNF 구조 트리\n\n&#96;&#96;&#96;\nProgram\n├── MetaBlock\n│   ├── LBRACE\n│   ├── MetaProperty (title: \&quot;Home\&quot;)\n│   ├── MetaProperty (route: \&quot;/\&quot;)\n│   └── RBRACE\n├── StyleBlock\n│   ├── LBRACE\n│   ├── StyleProperty (color.primary: \&quot;#0E5EF7\&quot;)\n│   ├── StyleProperty (radius.default: 8)\n│   └── RBRACE\n├── ComponentsBlock\n│   ├── LBRACE\n│   ├── ComponentEntry (Card)\n│   ├── ComponentEntry (Button)\n│   └── RBRACE\n├── LayoutBlock\n│   ├── LBRACE\n│   ├── LayoutNode (Div)\n│   │   ├── Attributes (class:\&quot;p-4\&quot;)\n│   │   └── ChildrenBlock\n│   │       └── LayoutNode (P)\n│   │           └── ChildrenBlock\n│   │               └── TEXT_STRING (\&quot;Hello world\&quot;)\n│   └── RBRACE\n└── ScriptBlock\n    ├── LBRACE\n    ├── ScriptProperty (onClick: \&quot;submitForm\&quot;)\n    └── RBRACE\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 즉시 파싱 중단\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유지 (경고)\n- 들여쓰기 2 space 위반 시 구문 오류\n- layout 외 블록에서 중첩 시도 시 파싱 실패\n- 허용되지 않은 키 사용 시 semantic 오류 (parser 단계에서는 허용)\n- TEXT_STRING이 layout 외 컨텍스트에서 등장 시 오류\n\n---\n\n## AST Schema Definition\n\nParser BNF 위에서 생성되는 최종 AST 구조입니다. 모든 UIH DSL 요소가 이 스키마에 따라 구조화됩니다.\n\n### 1. AST Root\n\n#### ASTRoot\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Program\&quot;\n  meta: MetaNode\n  style: StyleNode\n  components: ComponentsNode | null\n  layout: LayoutNode\n  script: ScriptNode | null\n}\n&#96;&#96;&#96;\n\n### 2. Meta Node\n\n#### MetaNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Meta\&quot;\n  properties: MetaProperty[]\n}\n&#96;&#96;&#96;\n\n#### MetaProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;title\&quot;\n  value: string|number|boolean\n  location: Range     // from tokenizer\n}\n&#96;&#96;&#96;\n\n### 3. Style Node\n\n#### StyleNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Style\&quot;\n  properties: StyleProperty[]\n}\n&#96;&#96;&#96;\n\n#### StyleProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;color.primary\&quot;\n  value: string|number\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 4. Components Node\n\n#### ComponentsNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Components\&quot;\n  components: ComponentEntry[]\n}\n&#96;&#96;&#96;\n\n#### ComponentEntry\n&#96;&#96;&#96;typescript\n{\n  name: string        // e.g. \&quot;Card\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 5. Layout Node (Core Tree Structure)\n\n#### LayoutNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Layout\&quot;\n  children: LayoutElement[]     // top-level nodes inside layout block\n}\n&#96;&#96;&#96;\n\n#### LayoutElement\n&#96;&#96;&#96;typescript\nLayoutElement = LayoutComponent | LayoutText\n&#96;&#96;&#96;\n\n#### 5.1 Layout Component\n&#96;&#96;&#96;typescript\nLayoutComponent {\n  type: \&quot;Component\&quot;\n  tag: string                   // e.g. \&quot;Div\&quot;, \&quot;P\&quot;, \&quot;Header\&quot;\n  attributes: Attribute[]\n  children: LayoutElement[]     // nested structure\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### Attribute\n&#96;&#96;&#96;typescript\n{\n  key: string                   // lower-case only\n  value: string                 // inline string only\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### 5.2 Layout Text Node\n&#96;&#96;&#96;typescript\nLayoutText {\n  type: \&quot;Text\&quot;\n  value: string                 // raw text string\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 6. Script Node\n\n#### ScriptNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Script\&quot;\n  events: ScriptProperty[]\n}\n&#96;&#96;&#96;\n\n#### ScriptProperty\n&#96;&#96;&#96;typescript\n{\n  key: string                   // e.g. \&quot;onClick\&quot;\n  value: string                 // e.g. \&quot;submitForm\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 7. Range Object (Source Location)\n\n#### Range\n&#96;&#96;&#96;typescript\n{\n  start: Position\n  end: Position\n}\n&#96;&#96;&#96;\n\n#### Position\n&#96;&#96;&#96;typescript\n{\n  line: number\n  column: number\n}\n&#96;&#96;&#96;\n\n### 8. Semantics Rules (Validation Layer)\n\n1. Meta keys must be from allowlist:\n   - title, route, theme, description\n\n2. Style keys may use dot notation but MUST be lowercase.\n\n3. Components must be names only, no properties.\n\n4. Layout:\n   - tag must be a valid TagName or valid identifier\n   - attributes must be string-only\n   - children: array of LayoutElement (component or text)\n\n5. Script:\n   - keys must be known event names\n   - value must be string (function name)\n\n6. No null children arrays. Use &#96;[]&#96; if empty.\n\n7. All nodes must have location data.\n\n### 9. Example: Full AST for a Simple Page\n\n#### Example DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### Generated AST (simplified)\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Home\&quot; },\n      { \&quot;key\&quot;: \&quot;route\&quot;, \&quot;value\&quot;: \&quot;/\&quot; }\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;color.primary\&quot;, \&quot;value\&quot;: \&quot;#0E5EF7\&quot; }\n    ]\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: [\n          { \&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;p-4\&quot; }\n        ],\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n### AST 구조 트리\n\n&#96;&#96;&#96;\nASTRoot (Program)\n├── meta (MetaNode)\n│   └── properties[] (MetaProperty)\n├── style (StyleNode)\n│   └── properties[] (StyleProperty)\n├── components (ComponentsNode | null)\n│   └── components[] (ComponentEntry)\n├── layout (LayoutNode)\n│   └── children[] (LayoutElement)\n│       ├── LayoutComponent\n│       │   ├── attributes[] (Attribute)\n│       │   └── children[] (LayoutElement)\n│       └── LayoutText\n└── script (ScriptNode | null)\n    └── events[] (ScriptProperty)\n&#96;&#96;&#96;\n\n### AST Examples\n\n#### 최소 AST 구조\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      {\&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Minimal\&quot;}\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: []\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Text\&quot;,\n        \&quot;value\&quot;: \&quot;Content\&quot;\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n#### 복잡한 레이아웃 AST\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Layout\&quot;,\n  \&quot;children\&quot;: [\n    {\n      \&quot;type\&quot;: \&quot;Component\&quot;,\n      \&quot;tag\&quot;: \&quot;Div\&quot;,\n      \&quot;attributes\&quot;: [\n        {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;container\&quot;}\n      ],\n      \&quot;children\&quot;: [\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Header\&quot;,\n          \&quot;attributes\&quot;: [],\n          \&quot;children\&quot;: [\n            {\n              \&quot;type\&quot;: \&quot;Component\&quot;,\n              \&quot;tag\&quot;: \&quot;H1\&quot;,\n              \&quot;attributes\&quot;: [],\n              \&quot;children\&quot;: [\n                {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Title\&quot;}\n              ]\n            }\n          ]\n        },\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Main\&quot;,\n          \&quot;attributes\&quot;: [\n            {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;content\&quot;}\n          ],\n          \&quot;children\&quot;: [\n            {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Main content\&quot;}\n          ]\n        }\n      ]\n    }\n  ]\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- location 정보 누락 시 AST 생성 실패\n- 빈 children 배열 대신 null 사용 시 validation 오류\n- 허용되지 않은 meta/style/script 키 사용 시 semantic 오류\n- LayoutComponent의 tag가 유효하지 않은 경우 오류\n- LayoutText에 빈 문자열 사용 시 경고\n- 중첩 깊이가 너무 깊을 경우 (10레벨 초과) 경고 또는 오류\n\n---\n\n## IR (Intermediate Representation) Specification\n\nAST → IR 변환 규칙을 정의합니다. Codegen 단계 직전의 \&quot;정규화된 구조\&quot;로, 플랫폼불문의 공통 인터페이스를 제공합니다.\n\n### 1. Overview\n\n#### IR_GOAL\n- AST의 복잡한 구조를 코드 생성하기 좋게 단순화\n- UI 컴포넌트 트리와 메타데이터를 정규화\n- 플랫폼불문(React/Next/Svelte) 공통 인터페이스로 변환\n- 모든 값은 최종적이고 확정된 형태만 유지\n\n#### INPUT\n- ASTRoot\n\n#### OUTPUT\n- IRRoot\n\n### 2. IR Root\n\n#### IRRoot\n&#96;&#96;&#96;typescript\n{\n  meta: IRMeta\n  style: IRStyle\n  components: IRComponents\n  layout: IRLayoutTree\n  script: IRScript\n}\n&#96;&#96;&#96;\n\n### 3. IRMeta (Final Document Metadata)\n\n#### IRMeta\n&#96;&#96;&#96;typescript\n{\n  title: string\n  route: string\n  theme: \&quot;light\&quot; | \&quot;dark\&quot;\n  description: string | null\n}\n&#96;&#96;&#96;\n\n#### Rules\n- missing values become null\n- enforce route starts with \&quot;/\&quot;\n\n### 4. IRStyle (Flattened Style Tokens)\n\n#### IRStyle\n&#96;&#96;&#96;typescript\n{\n  tokens: Record&lt;string, string | number&gt;\n}\n&#96;&#96;&#96;\n\n#### Examples\n&#96;&#96;&#96;typescript\n{\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n  \&quot;radius.default\&quot;: 8\n}\n&#96;&#96;&#96;\n\n#### Rules\n- dot-notation keys preserved\n- all values converted to primitive string/number\n- no validation here (semantic pass already done)\n\n### 5. IRComponents (Registered Component Map)\n\n#### IRComponents\n&#96;&#96;&#96;typescript\n{\n  list: string[]   // e.g. [\&quot;Card\&quot;, \&quot;Button\&quot;]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- duplicates removed\n- sorted alphabetically for deterministic output\n\n### 6. IRLayoutTree (Normalized UI Tree)\n\n#### IRLayoutTree\n&#96;&#96;&#96;typescript\n{\n  root: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### IRNode\n&#96;&#96;&#96;typescript\nIRNode = IRComponentNode | IRTextNode\n&#96;&#96;&#96;\n\n#### 6.1 IRComponentNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;component\&quot;\n  tag: string\n  attributes: Record&lt;string, string&gt;   // key:string only\n  children: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- attribute keys lower-case enforced\n- children always array\n- empty children =&gt; []\n\n#### 6.2 IRTextNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;text\&quot;\n  value: string\n}\n&#96;&#96;&#96;\n\n#### Rules\n- trimmed text preserved exactly\n- no newline allowed inside text\n\n### 7. IRScript (Event Map)\n\n#### IRScript\n&#96;&#96;&#96;typescript\n{\n  events: Record&lt;string, string&gt;   // onClick → \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Rules\n- all keys normalized to lower-case event names\n- event value must be string only\n- duplicates override earlier definitions\n\n### 8. AST → IR Mapping Rules\n\n1. **MetaNode → IRMeta**\n   - convert property array → object map\n   - apply default values if missing\n   - route must start with \&quot;/\&quot;\n\n2. **StyleNode → IRStyle**\n   - flatten list into tokens object\n   - preserve ordering but output sorted keys for determinism\n\n3. **ComponentsNode → IRComponents**\n   - convert component list → array\n   - remove duplicates\n   - sort alphabetically\n\n4. **LayoutNode → IRLayoutTree**\n   - recursively convert LayoutComponent → IRComponentNode\n   - convert LayoutText → IRTextNode\n   - inline attributes converted to plain object\n\n5. **ScriptNode → IRScript**\n   - property list flattened to event map\n   - enforce lower-case event names\n\n### 9. Example: Full IR Output\n\n#### DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### IR\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Home\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: null,\n    \&quot;description\&quot;: null\n  },\n\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n    }\n  },\n\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: []\n  },\n\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: { \&quot;class\&quot;: \&quot;p-4\&quot; },\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {}\n  }\n}\n&#96;&#96;&#96;\n\n### IR 구조 트리\n\n&#96;&#96;&#96;\nIRRoot\n├── meta (IRMeta)\n│   ├── title: string\n│   ├── route: string\n│   ├── theme: \&quot;light\&quot;|\&quot;dark\&quot;|null\n│   └── description: string|null\n├── style (IRStyle)\n│   └── tokens: Record&lt;string, string|number&gt;\n├── components (IRComponents)\n│   └── list: string[]\n├── layout (IRLayoutTree)\n│   └── root: IRNode[]\n│       ├── IRComponentNode\n│       │   ├── type: \&quot;component\&quot;\n│       │   ├── tag: string\n│       │   ├── attributes: Record&lt;string, string&gt;\n│       │   └── children: IRNode[]\n│       └── IRTextNode\n│           ├── type: \&quot;text\&quot;\n│           └── value: string\n└── script (IRScript)\n    └── events: Record&lt;string, string&gt;\n&#96;&#96;&#96;\n\n### IR Examples\n\n#### 간단한 IR 변환\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Simple\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: \&quot;light\&quot;,\n    \&quot;description\&quot;: null\n  },\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#000\&quot;,\n      \&quot;font.size\&quot;: 14\n    }\n  },\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: [\&quot;Button\&quot;]\n  },\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: {},\n        \&quot;children\&quot;: [\n          {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Content\&quot;}\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {\n      \&quot;onclick\&quot;: \&quot;handleClick\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 복잡한 중첩 레이아웃 IR\n&#96;&#96;&#96;json\n{\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Container\&quot;,\n        \&quot;attributes\&quot;: {\n          \&quot;class\&quot;: \&quot;flex flex-col min-h-screen\&quot;\n        },\n        \&quot;children\&quot;: [\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Header\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;p-4 bg-blue-600\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;H1\&quot;,\n                \&quot;attributes\&quot;: {},\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Dashboard\&quot;}\n                ]\n              }\n            ]\n          },\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Main\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;flex-1 p-6\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;Card\&quot;,\n                \&quot;attributes\&quot;: {\n                  \&quot;class\&quot;: \&quot;bg-white shadow-lg rounded\&quot;\n                },\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Welcome!\&quot;}\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- AST에 location 정보 누락 시 IR 변환 실패\n- route가 \&quot;/\&quot;로 시작하지 않을 경우 변환 시 강제 추가\n- 중복 컴포넌트 등록 시 알파벳 순 정렬로 중복 제거\n- 빈 children 배열을 null로 잘못 설정 시 []로 강제 변환\n- 텍스트 노드에 줄바꿈 포함 시 변환 중 제거 또는 오류\n- 이벤트 키 대소문자 혼재 시 소문자로 통일\n- 스타일 토큰 키 순서가 다를 경우 sorted keys로 결정적 출력 보장\n\n---\n\n## Codegen Rules\n\n### React/Next.js 15 Codegen\n\nIR을 기반으로 안정적인 UI 코드 생성 규칙입니다. React/Next.js 15 (App Router + RSC) 기준으로 IR을 실제 코드로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- IR을 기반으로 안정적인 UI 코드 생성\n- React/Next.js 15 (App Router + RSC) 기준\n- \&quot;디자인 시스템 없는 순수 Layout Tree\&quot;를 코드로 변환\n- 가능한 한 deterministic 하게 출력\n- 로직/상태/이벤트는 최소 수준으로만 개입\n\n##### INPUT\n- IRRoot\n\n##### OUTPUT\n- React Component Source Code (string)\n\n#### 2. Output Structure\n\n파일 구조는 다음 형태로 생성합니다:\n\n&#96;&#96;&#96;\n/page.tsx\n  - metadata (title, description)\n  - default export function Page()\n  - return(...) 내부에 layout tree 삽입\n\n/style-tokens.ts\n  - style.tokens flatten export\n\n/components/index.ts\n  - components registry export\n\n/script-events.ts\n  - event name string mapping export\n&#96;&#96;&#96;\n\n#### 3. Metadata Codegen\n\n##### UIH meta → Next.js metadata\n&#96;&#96;&#96;typescript\nIRMeta {\n  title: string\n  description: string\n}\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;typescript\nexport const metadata = {\n  title: \&quot;&lt;title&gt;\&quot;,\n  description: \&quot;&lt;description&gt;\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- description 없으면 필드 제외\n- theme는 metadata에 직접 쓰지 않음 (스타일토큰 용)\n\n#### 4. Style Token Codegen\n\n##### IRStyle { tokens }\n&#96;&#96;&#96;typescript\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;radius.default\&quot;: 8,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 키는 string 리터럴 그대로\n- numeric/string 그대로 출력\n- sorted keys for deterministic output\n\n#### 5. Component Registry Codegen\n\n##### IRComponents.list → export list\n&#96;&#96;&#96;typescript\nexport const components = {\n  Card,\n  Button,\n  Input,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 자동 import 하지 않음 (상위 시스템이 resolve)\n- keys는 PascalCase 유지\n- duplicates 제거 후 정렬\n\n#### 6. Layout Tree → JSX Codegen\n\n##### IRLayoutTree → React element tree\n\n##### 6.1 Component Node\n&#96;&#96;&#96;typescript\nIRComponentNode {\n  tag: \&quot;Div\&quot;\n  attributes: { class: \&quot;p-4\&quot; }\n  children: [...]\n}\n&#96;&#96;&#96;\n\n##### OUTPUT JSX\n&#96;&#96;&#96;jsx\n&lt;Div className=\&quot;p-4\&quot;&gt;\n  {children...}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n##### RULES\n- attribute.key \&quot;class\&quot; → \&quot;className\&quot;\n- attribute key는 그대로 lower-case 유지\n- value는 string literal\n- children length 0 이면 self-closing 금지 (always explicit block)\n- tag name 그대로 JSX 컴포넌트로 사용\n\n##### 6.2 Text Node\n&#96;&#96;&#96;typescript\nIRTextNode { value: \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;jsx\n{\&quot;Hello\&quot;}\n&#96;&#96;&#96;\n\n##### RULES\n- 텍스트는 JSX children 표현\n- 특수문자는 자동 escape\n\n#### 7. Script Event Codegen\n\n##### IRScript.events → export mapping\n&#96;&#96;&#96;typescript\nexport const eventHandlers = {\n  onClick: \&quot;submitForm\&quot;,\n  onLoad: \&quot;init\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- event 이름은 lower-case normalized\n- 값은 string (함수명)\n- 실제 JS 함수 body는 생성하지 않음\n- 나중 시스템이 자동 wire-up 함\n\n#### 8. Full Page Generation\n\n최종 page.tsx는 다음 구조를 따릅니다:\n\n&#96;&#96;&#96;typescript\nexport const metadata = { ... };\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen p-4\&quot;&gt;\n      &lt;P&gt;{\&quot;Hello\&quot;}&lt;/P&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### RULES\n- 최상위는 항상 &#96;&lt;Div&gt;&#96; 같은 Wrapper로 시작하지 않아도 됨\n- layout.root가 배열이면 Fragment로 감싼다\n- 코드 스타일은 2-space indent\n- 세미콜론 붙이지 않음 (Prettier 옵션 따라감)\n\n#### 9. Determinism Rules\n\n1. 속성 순서는 key 알파벳순 정렬\n2. children 순서는 DSL 입력 순서 그대로\n3. components 목록은 알파벳순 정렬\n4. styleTokens도 key 정렬\n5. eventHandlers key 정렬\n6. output JSX는 항상 multiline\n\n#### 10. Full Example (DSL → IR → JSX)\n\n##### DSL\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n##### JSX OUT\n&#96;&#96;&#96;typescript\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;p-4\&quot;&gt;\n      {\&quot;Hello\&quot;}\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n#### 11. Notes for Engine Integrators\n\n1. Codegen은 \&quot;순수 구조\&quot;만 책임진다\n   - 상태(state), fetch, useEffect 등은 지원하지 않음\n2. 이벤트 핸들러는 단순 라벨링 시스템\n3. 스타일 토큰은 UI 프레임워크에서 직접 해석\n4. React, Vue, Svelte 등 플랫폼별 코드젠 가능\n   - 플랫폼별 레이어는 분리\n\n#### Output Files 구조\n\n&#96;&#96;&#96;\nOutput Files\n├── page.tsx\n│   ├── metadata export\n│   ├── imports (components, styleTokens, eventHandlers)\n│   ├── Page() function\n│   └── JSX return (layout tree)\n├── style-tokens.ts\n│   └── styleTokens export\n├── components/index.ts\n│   └── components export\n└── script-events.ts\n    └── eventHandlers export\n&#96;&#96;&#96;\n\n#### Codegen Examples\n\n##### 전체 페이지 코드 생성 예시\n&#96;&#96;&#96;typescript\n// page.tsx\nexport const metadata = {\n  title: \&quot;Dashboard\&quot;,\n  description: \&quot;Main dashboard page\&quot;\n};\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen flex flex-col\&quot;&gt;\n      &lt;Header className=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n        &lt;H1&gt;\n          {\&quot;Dashboard\&quot;}\n        &lt;/H1&gt;\n      &lt;/Header&gt;\n      &lt;Main className=\&quot;flex-1 p-6\&quot;&gt;\n        &lt;Card className=\&quot;bg-white shadow-lg rounded-lg p-6\&quot;&gt;\n          &lt;P&gt;\n            {\&quot;Welcome back!\&quot;}\n          &lt;/P&gt;\n        &lt;/Card&gt;\n      &lt;/Main&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### 스타일 토큰 파일 예시\n&#96;&#96;&#96;typescript\n// style-tokens.ts\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;color.secondary\&quot;: \&quot;#6B7280\&quot;,\n  \&quot;color.accent\&quot;: \&quot;#F59E0B\&quot;,\n  \&quot;spacing.small\&quot;: 8,\n  \&quot;spacing.medium\&quot;: 16,\n  \&quot;spacing.large\&quot;: 24,\n  \&quot;border.radius\&quot;: 6,\n  \&quot;font.family\&quot;: \&quot;Inter\&quot;,\n  \&quot;font.size.base\&quot;: 16,\n  \&quot;shadow.default\&quot;: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n};\n&#96;&#96;&#96;\n\n##### 컴포넌트 레지스트리 예시\n&#96;&#96;&#96;typescript\n// components/index.ts\nexport const components = {\n  Button,\n  Card,\n  Input,\n  Modal,\n  Sidebar\n};\n&#96;&#96;&#96;\n\n##### 이벤트 핸들러 파일 예시\n&#96;&#96;&#96;typescript\n// script-events.ts\nexport const eventHandlers = {\n  onclick: \&quot;handleClick\&quot;,\n  onload: \&quot;initDashboard\&quot;,\n  onsubmit: \&quot;processForm\&quot;\n};\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- layout.root가 빈 배열일 경우 빈 Fragment 생성\n- 컴포넌트 이름이 JavaScript 예약어와 충돌 시 escaping 필요\n- 텍스트에 JSX 특수문자 포함 시 자동 escape\n- 중첩 깊이가 깊을 경우 코드 포맷팅 유지\n- import 경로 resolve 실패 시 상위 시스템에서 처리\n- styleTokens에 특수문자 키 포함 시 유효한 JS 객체 키로 변환\n\n---\n\n### Vue &amp; Svelte Codegen\n\nReact Codegen과 동일한 IR 기반으로 Vue와 Svelte 코드를 생성하는 규칙입니다. 플랫폼별 렌더링 규칙만 다르게 적용합니다.\n\n## SECTION A — Vue Codegen (SFC 기준)\n\n### GOAL\n- IR → .vue 파일 형태로 변환\n- &#96;&lt;template&gt;&#96; + &#96;&lt;script setup&gt;&#96; + &#96;&lt;style&gt;&#96; 구조 유지\n- 모든 로직은 배제하고 구조만 생성\n\n### OUTPUT FILE STRUCTURE\n&#96;&#96;&#96;\nMyPage.vue\n&#96;&#96;&#96;\n\n### 1. Top-Level Structure\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;!-- layout tree --&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport components...\n\nconst events = {...}\nconst styleTokens = {...}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* optional if needed */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Vue Template 규칙\n\n#### IRComponentNode(tag:\&quot;Div\&quot;, attributes, children)\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  &lt;!-- children --&gt;\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;className&#96; → &#96;class&#96;\n- attribute values: string only\n- children: 그대로 template로 변환\n- Fragment는 &#96;&lt;template&gt;&#96; 안에서 그냥 siblings로 출력\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello (그대로 text node)\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\neventHandlers {\n  onClick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Vue OUTPUT\n&#96;&#96;&#96;vue\n@click=\&quot;submitForm\&quot;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;onClick&#96; → &#96;@click&#96;\n- &#96;onChange&#96; → &#96;@change&#96;\n- &#96;onInput&#96; → &#96;@input&#96;\n- &#96;onLoad&#96; → &#96;@load&#96;\n- value는 함수 이름 string\n- 함수 구현은 생성하지 않음\n\n### 4. Component Registry (imports)\n&#96;&#96;&#96;javascript\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules\n- 속성(sorted)\n- imports(sorted)\n- children 순서 그대로\n- no semicolons\n- template 들여쓰기 2 spaces\n\n## SECTION B — Svelte Codegen (.svelte)\n\n### GOAL\n- Svelte 컴포넌트 파일 하나로 완성\n- &#96;&lt;script&gt;&#96; + markup 구조\n\n### OUTPUT STRUCTURE\n&#96;&#96;&#96;\nMyPage.svelte\n&#96;&#96;&#96;\n\n### 1. File Layout\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import components...\n  export let events = {...}\n  export let styleTokens = {...}\n&lt;/script&gt;\n\n&lt;!-- layout markup --&gt;\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  Hello\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* optional */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Svelte Markup\n\n#### IRComponentNode(tag, attributes, children)\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  {#if ... ?} (없음)\n  {children}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- 클래스는 &#96;class&#96;\n- 속성 문자열만\n- Self-closing 금지\n- children 재귀적 삽입\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\nIRScript:\nonClick → function name\n&#96;&#96;&#96;\n\n#### Svelte OUTPUT\n&#96;&#96;&#96;svelte\non:click={submitForm}\n&#96;&#96;&#96;\n\n#### Mapping\n&#96;&#96;&#96;\nonClick   → on:click\nonChange  → on:change\nonInput   → on:input\nonLoad    → on:load\n&#96;&#96;&#96;\n\n### 4. Components Import\n&#96;&#96;&#96;javascript\nimport Card from \&quot;./Card.svelte\&quot;;\nimport Button from \&quot;./Button.svelte\&quot;;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules (필수)\n\n1. import 순서는 알파벳 정렬\n2. attributes sorted\n3. event names lower-case\n4. children 순서 보존\n5. markup 들여쓰기 2 spaces\n\n## SECTION C — Cross-Platform Notes\n\n1. React / Vue / Svelte 모두 IR만 참조\n2. layout tree는 그대로 세 렌더러에서 재활용\n3. event handler는 단순 label → framework alias로 변환\n4. styleTokens는 컴파일러 외부 시스템이 처리\n5. components는 registry 기반으로 import만 생성\n\n## SECTION D — Example Conversion (Same IR → Vue/Svelte)\n\n### IR\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) { \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n### Vue Template\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Svelte Markup\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte 구조\n\n&#96;&#96;&#96;\nVue Output (.vue)\n├── &lt;template&gt;\n│   └── layout tree (Vue template syntax)\n├── &lt;script setup&gt;\n│   ├── component imports\n│   ├── events object\n│   └── styleTokens object\n└── &lt;style scoped&gt;\n    └── optional styles\n\nSvelte Output (.svelte)\n├── &lt;script&gt;\n│   ├── component imports\n│   ├── export let events = {...}\n│   └── export let styleTokens = {...}\n├── layout markup (Svelte syntax)\n└── &lt;style&gt;\n    └── optional styles\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte Examples\n\n#### Vue SFC 전체 예시\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n    &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n      &lt;H1&gt;\n        Dashboard\n      &lt;/H1&gt;\n    &lt;/Header&gt;\n    &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n      &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; @click=\&quot;handleCardClick\&quot;&gt;\n        &lt;P&gt;\n          Welcome back!\n        &lt;/P&gt;\n      &lt;/Card&gt;\n    &lt;/Main&gt;\n  &lt;/Div&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n\nconst events = {\n  handleCardClick: \&quot;handleCardClick\&quot;\n}\n\nconst styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;spacing.medium\&quot;: 16\n}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### Svelte 컴포넌트 전체 예시\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import Card from \&quot;./Card.svelte\&quot;;\n  import Button from \&quot;./Button.svelte\&quot;;\n\n  export let events = {\n    handleCardClick: \&quot;handleCardClick\&quot;\n  };\n\n  export let styleTokens = {\n    \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n    \&quot;spacing.medium\&quot;: 16\n  };\n&lt;/script&gt;\n\n&lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n  &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n    &lt;H1&gt;\n      Dashboard\n    &lt;/H1&gt;\n  &lt;/Header&gt;\n  &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n    &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; on:click={handleCardClick}&gt;\n      &lt;P&gt;\n        Welcome back!\n      &lt;/P&gt;\n    &lt;/Card&gt;\n  &lt;/Main&gt;\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### 이벤트 매핑 비교\n&#96;&#96;&#96;javascript\n// 동일한 IR 이벤트\n{\n  onClick: \&quot;handleClick\&quot;,\n  onChange: \&quot;handleChange\&quot;,\n  onLoad: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;vue\n&lt;!-- Vue --&gt;\n&lt;Button @click=\&quot;handleClick\&quot; @change=\&quot;handleChange\&quot; @load=\&quot;init\&quot;&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;svelte\n&lt;!-- Svelte --&gt;\n&lt;Button on:click={handleClick} on:change={handleChange} on:load={init}&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;jsx\n&lt;!-- React --&gt;\n&lt;Button onClick={handleClick} onChange={handleChange} onLoad={init}&gt;\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- Vue에서 컴포넌트 이름이 kebab-case로 변환 필요 시 자동 처리\n- Svelte에서 export let 구문이 예약어와 충돌 시 renaming\n- 이벤트 핸들러가 정의되지 않은 경우 플랫폼별 기본 동작\n- 스타일 토큰에 CSS 변수나 함수 포함 시 escaping\n- 중첩 컴포넌트 깊이가 깊을 경우 플랫폼별 최적화 적용\n- 텍스트 콘텐츠에 플랫폼별 특수문자 포함 시 자동 escape\n\n---\n\n## Examples\n\n### 완전한 UIH DSL 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;User Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main user dashboard with analytics\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  color.accent: \&quot;#F59E0B\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n  font.size.h1: 32\n  spacing.small: 8\n  spacing.medium: 16\n  spacing.large: 24\n  border.radius: 6\n  shadow.default: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n  Sidebar\n  Chart\n}\n\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto p-6\&quot;) {\n    Header(class:\&quot;mb-8\&quot;) {\n      Div(class:\&quot;flex justify-between items-center\&quot;) {\n        H1(class:\&quot;text-3xl font-bold\&quot;) {\n          \&quot;Dashboard\&quot;\n        }\n        Button(class:\&quot;px-4 py-2 bg-blue-600 text-white rounded\&quot;) {\n          \&quot;New Report\&quot;\n        }\n      }\n    }\n\n    Div(class:\&quot;grid grid-cols-3 gap-6\&quot;) {\n      Card(class:\&quot;col-span-2\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Analytics Overview\&quot;\n        }\n        Chart(class:\&quot;w-full h-64\&quot;)\n      }\n\n      Card(class:\&quot;col-span-1\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Quick Stats\&quot;\n        }\n        Div(class:\&quot;space-y-4\&quot;) {\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Total Users\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;1,234\&quot;\n            }\n          }\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Active Sessions\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;89\&quot;\n            }\n          }\n        }\n      }\n    }\n\n    Sidebar(class:\&quot;mt-8\&quot;) {\n      H3(class:\&quot;text-lg mb-4\&quot;) {\n        \&quot;Recent Activity\&quot;\n      }\n      Div(class:\&quot;space-y-2\&quot;) {\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;User john@example.com logged in\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;New report generated\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;System backup completed\&quot;\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onLoad: \&quot;initDashboard\&quot;\n  onClick: \&quot;handleButtonClick\&quot;\n  onRefresh: \&quot;refreshData\&quot;\n}\n&#96;&#96;&#96;\n\n### 최소 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Minimal Page\&quot;\n  route: \&quot;/minimal\&quot;\n  theme: \&quot;light\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  spacing.unit: 12\n}\n\nlayout {\n  Div(class:\&quot;min-h-screen flex items-center justify-center bg-gray-50\&quot;) {\n    \&quot;Coming soon\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n### Form 중심 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Sign Up\&quot;\n  route: \&quot;/signup\&quot;\n  theme: \&quot;light\&quot;\n  description: \&quot;Create a new account\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#2563EB\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n}\n\ncomponents {\n  Form\n  Input\n  Button\n  Alert\n}\n\nlayout {\n  Section(class:\&quot;min-h-screen flex items-center justify-center bg-gray-100\&quot;) {\n    Form(class:\&quot;w-full max-w-md space-y-6 bg-white p-8 rounded-xl shadow-lg\&quot;) {\n      H2(class:\&quot;text-2xl font-semibold text-gray-900\&quot;) {\n        \&quot;Create your account\&quot;\n      }\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;email\&quot;, placeholder:\&quot;Enter email\&quot;)\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;password\&quot;, placeholder:\&quot;Enter password\&quot;)\n      Button(class:\&quot;w-full bg-blue-600 text-white py-3 rounded-lg\&quot;) {\n        \&quot;Sign up\&quot;\n      }\n      Alert(class:\&quot;text-sm text-gray-500 text-center\&quot;) {\n        \&quot;By signing up you agree to our terms\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onSubmit: \&quot;handleSignup\&quot;\n  onLoad: \&quot;prefillFromInvite\&quot;\n}\n&#96;&#96;&#96;\n\n### 콘텐츠 피드 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Creator Feed\&quot;\n  route: \&quot;/feed\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Realtime creator activity feed\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#22D3EE\&quot;\n  color.background: \&quot;#0F172A\&quot;\n  font.family: \&quot;Space Grotesk\&quot;\n  spacing.medium: 20\n  radius.card: 12\n}\n\ncomponents {\n  Shell\n  Sidebar\n  Feed\n  FeedItem\n  Avatar\n  Badge\n}\n\nlayout {\n  Shell(class:\&quot;min-h-screen bg-slate-950 text-slate-100\&quot;) {\n    Sidebar(class:\&quot;w-64 border-r border-slate-800 p-6 space-y-6\&quot;) {\n      H1(class:\&quot;text-xl font-semibold tracking-tight\&quot;) {\n        \&quot;Creator Hub\&quot;\n      }\n      Badge(class:\&quot;inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 text-slate-200\&quot;) {\n        \&quot;Live updates\&quot;\n      }\n    }\n    Feed(class:\&quot;flex-1 p-8 space-y-6\&quot;) {\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-cyan-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;heymina.studio\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-300\&quot;) {\n              \&quot;New drop\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Dropped a limited neon kit — 120 packs sold out in 3 minutes.\&quot;\n          }\n        }\n      }\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-pink-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;luvv.wav\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-cyan-500/10 text-cyan-300\&quot;) {\n              \&quot;Stream recap\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Hit 18,245 live viewers tonight — chat requested a synthwave encore.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onRefresh: \&quot;fetchLatestFeed\&quot;\n  onClick: \&quot;openCreatorProfile\&quot;\n}\n&#96;&#96;&#96;\n\n---\n\n## Version\n\n- **Version**: 1.0.0\n- **Last Update**: 2025-11-18\n- **Change Summary**: Complete guide consolidating all UIH DSL specifications\n\n---\n\n## 문서 끝\n\n이 문서는 UIH DSL의 모든 스펙을 \&quot;생략 없이\&quot; 하나의 파일로 통합한 완전판입니다. Foundation Layer부터 Codegen까지 전 과정을 포함하며, LLM이 UI를 정확하게 선언할 수 있도록 설계된 모든 규칙이 담겨 있습니다.\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Preparing to run lints**</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md`

Lint results


**No lint errors found**
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Preparing final detailed response**

I'm getting ready to craft the final message with a friendly tone as requested, referencing the updated docs/uih-dsl-complete-guide.md file and its new example sections. I plan to include at least one code block citing lines from that file to show the inserted content, approximating line numbers after the changes by reading the file. I’ll also note that no tests were run and keep the formatting guidelines in mind.</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Preparing final message details**

I’m gathering code snippet references and planning a friendly, clear summary with bullet points highlighting the new examples added, including minimal structure and feed content. I’ll also mention that testing isn’t needed since it’s just documentation changes, keeping the tone warm and respectful while following the user’s style preferences.</details></think>

---

## 추가된 예시
- 최소 블록만으로도 유효한 DSL 구조를 보여주는 `### 최소 구조 예시`를 넣어서 meta/style/layout 필수 구성을 빠르게 참고할 수 있게 했어.  
```2864:2897:docs/uih-dsl-complete-guide.md
### 최소 구조 예시
```
meta {
  title: "Minimal Page"
  route: "/minimal"
  theme: "light"
}

style {
  color.primary: "#0E5EF7"
  spacing.unit: 12
}

layout {
  Div(class:"min-h-screen flex items-center justify-center bg-gray-50") {
    "Coming soon"
  }
}
```
- 입력 컴포넌트와 스크립트 이벤트를 아우르는 `### Form 중심 예시`를 추가해서 components/script 블록 사용 패턴을 바로 복사해 쓸 수 있게 했어.  
- 실시간 피드 같은 복잡한 레이아웃을 담은 `### 콘텐츠 피드 예시`로 다중 siblings, 중첩, 배지/아바타 패턴을 한 번에 보여주도록 확장했어.  
```2933:3012:docs/uih-dsl-complete-guide.md
### 콘텐츠 피드 예시
```
meta {
  title: "Creator Feed"
  route: "/feed"
  theme: "dark"
  description: "Realtime creator activity feed"
}

style {
  color.primary: "#22D3EE"
  color.background: "#0F172A"
  font.family: "Space Grotesk"
  spacing.medium: 20
  radius.card: 12
}

components {
  Shell
  Sidebar
  Feed
  FeedItem
  Avatar
  Badge
}

layout {
  Shell(class:"min-h-screen bg-slate-950 text-slate-100") {
    Sidebar(class:"w-64 border-r border-slate-800 p-6 space-y-6") {
      H1(class:"text-xl font-semibold tracking-tight") {
        "Creator Hub"
      }
      Badge(class:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 text-slate-200") {
        "Live updates"
      }
    }
    Feed(class:"flex-1 p-8 space-y-6") {
      FeedItem(class:"bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4") {
        Avatar(class:"h-12 w-12 rounded-full bg-cyan-400/20", alt:"Avatar")
        Div(class:"space-y-2 flex-1") {
          Div(class:"flex items-center justify-between") {
            P(class:"font-medium") {
              "heymina.studio"
            }
            Badge(class:"text-xs px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-300") {
              "New drop"
            }
          }
          P(class:"text-sm text-slate-300") {
            "Dropped a limited neon kit — 120 packs sold out in 3 minutes."
          }
        }
      }
      FeedItem(class:"bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4") {
        Avatar(class:"h-12 w-12 rounded-full bg-pink-400/20", alt:"Avatar")
        Div(class:"space-y-2 flex-1") {
          Div(class:"flex items-center justify-between") {
            P(class:"font-medium") {
              "luvv.wav"
            }
            Badge(class:"text-xs px-2 py-1 rounded-full bg-cyan-500/10 text-cyan-300") {
              "Stream recap"
            }
          }
          P(class:"text-sm text-slate-300") {
            "Hit 18,245 live viewers tonight — chat requested a synthwave encore."
          }
        }
      }
    }
  }
}

script {
  onRefresh: "fetchLatestFeed"
  onClick: "openCreatorProfile"
}
```

## 테스트
- 문서 업데이트만 있어서 별도 테스트는 필요 없었어.

---

_**User (2025-11-20 07:46Z)**_

이벤트에 카멜케이스 적용이 되면 안된다는 규칙이 있어

---

_**Agent (model gpt-5.1-codex-high, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Clarifying event name casing rules**</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "onClick" in "/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md" • 16 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `docs/uih-dsl-complete-guide.md` | `onClick: "submitForm"` | L629 |
| `docs/uih-dsl-complete-guide.md` | `Button(onClick:"handleSubmit") \{` | L664 |
| `docs/uih-dsl-complete-guide.md` | `- onClick, onLoad, onSubmit, onMount, onChange` | L1306 |
| `docs/uih-dsl-complete-guide.md` | `onClick: "submitForm"` | L1366 |
| `docs/uih-dsl-complete-guide.md` | `├── ScriptProperty (onClick: "submitForm")` | L1400 |
| `docs/uih-dsl-complete-guide.md` | `key: string                   // e.g. "onClick"` | L1547 |
| `docs/uih-dsl-complete-guide.md` | `events: Record<string, string>   // onClick → "submitForm"` | L1882 |
| `docs/uih-dsl-complete-guide.md` | `onClick: "submitForm",` | L2249 |
| `docs/uih-dsl-complete-guide.md` | `onClick: "submitForm"` | L2484 |
| `docs/uih-dsl-complete-guide.md` | `- `onClick` → `@click`` | L2494 |
| `docs/uih-dsl-complete-guide.md` | `onClick → function name` | L2567 |
| `docs/uih-dsl-complete-guide.md` | `onClick   → on:click` | L2577 |
| `docs/uih-dsl-complete-guide.md` | `onClick: "handleClick",` | L2725 |
| `docs/uih-dsl-complete-guide.md` | `<Button onClick=\{handleClick\} onChange=\{handleChange\} onLoad=\{init\}>` | L2743 |
| `docs/uih-dsl-complete-guide.md` | `onClick: "handleButtonClick"` | L2859 |
| `docs/uih-dsl-complete-guide.md` | `onClick: "openCreatorProfile"` | L3009 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Reviewing event naming conventions**</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "event" in "/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md" • 35 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `docs/uih-dsl-complete-guide.md` | `- event/behavior mapping만 정의` | L635 |
| `docs/uih-dsl-complete-guide.md` | `- event mapping 전용` | L854 |
| `docs/uih-dsl-complete-guide.md` | `events: ScriptProperty[]` | L1540 |
| `docs/uih-dsl-complete-guide.md` | `- keys must be known event names` | L1586 |
| `docs/uih-dsl-complete-guide.md` | `└── events[] (ScriptProperty)` | L1667 |
| `docs/uih-dsl-complete-guide.md` | `events: Record<string, string>   // onClick → "submitForm"` | L1882 |
| `docs/uih-dsl-complete-guide.md` | `- all keys normalized to lower-case event names` | L1887 |
| `docs/uih-dsl-complete-guide.md` | `- event value must be string only` | L1888 |
| `docs/uih-dsl-complete-guide.md` | `- property list flattened to event map` | L1913 |
| `docs/uih-dsl-complete-guide.md` | `- enforce lower-case event names` | L1914 |
| `docs/uih-dsl-complete-guide.md` | `"events": \{}` | L1970 |
| `docs/uih-dsl-complete-guide.md` | `└── events: Record<string, string>` | L1999 |
| `docs/uih-dsl-complete-guide.md` | `"events": \{` | L2035 |
| `docs/uih-dsl-complete-guide.md` | `/script-events.ts` | L2146 |
| `docs/uih-dsl-complete-guide.md` | `- event name string mapping export` | L2147 |
| `docs/uih-dsl-complete-guide.md` | `##### IRScript.events → export mapping` | L2246 |
| `docs/uih-dsl-complete-guide.md` | `export const eventHandlers = \{` | L2248 |
| `docs/uih-dsl-complete-guide.md` | `- event 이름은 lower-case normalized` | L2255 |
| `docs/uih-dsl-complete-guide.md` | `import \{ eventHandlers \} from "./script-events";` | L2269 |
| `docs/uih-dsl-complete-guide.md` | `5. eventHandlers key 정렬` | L2292 |
| `docs/uih-dsl-complete-guide.md` | `│   ├── imports (components, styleTokens, eventHandlers)` | L2332 |
| `docs/uih-dsl-complete-guide.md` | `└── script-events.ts` | L2339 |
| `docs/uih-dsl-complete-guide.md` | `└── eventHandlers export` | L2340 |
| `docs/uih-dsl-complete-guide.md` | `import \{ eventHandlers \} from "./script-events";` | L2355 |
| `docs/uih-dsl-complete-guide.md` | `// script-events.ts` | L2408 |
| `docs/uih-dsl-complete-guide.md` | `export const eventHandlers = \{` | L2409 |
| `docs/uih-dsl-complete-guide.md` | `const events = \{...\}` | L2452 |
| `docs/uih-dsl-complete-guide.md` | `eventHandlers \{` | L2483 |
| `docs/uih-dsl-complete-guide.md` | `export let events = \{...\}` | L2529 |
| `docs/uih-dsl-complete-guide.md` | `3. event names lower-case` | L2593 |
| `docs/uih-dsl-complete-guide.md` | `3. event handler는 단순 label → framework alias로 변환` | L2601 |
| `docs/uih-dsl-complete-guide.md` | `│   ├── events object` | L2630 |
| `docs/uih-dsl-complete-guide.md` | `│   ├── export let events = \{...\}` | L2638 |
| `docs/uih-dsl-complete-guide.md` | `const events = \{` | L2670 |
| `docs/uih-dsl-complete-guide.md` | `export let events = \{` | L2691 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Planning event name normalization updates**

I’m focusing on making the documentation consistent by enforcing lowercase event names like `onclick` instead of camelCase such as `onClick`. This means updating multiple doc sections, examples, and the property grammar to reflect this rule, and I’ll verify all occurrences with searches to replace camelCase event names with lowercase versions.</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "onLoad" in "/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md" • 11 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `docs/uih-dsl-complete-guide.md` | `onLoad: "init"` | L630 |
| `docs/uih-dsl-complete-guide.md` | `onLoad: "initDashboard"` | L672 |
| `docs/uih-dsl-complete-guide.md` | `onLoad: "initDashboard"` | L896 |
| `docs/uih-dsl-complete-guide.md` | `- onClick, onLoad, onSubmit, onMount, onChange` | L1306 |
| `docs/uih-dsl-complete-guide.md` | `onLoad: "init",` | L2250 |
| `docs/uih-dsl-complete-guide.md` | `- `onLoad` → `@load`` | L2497 |
| `docs/uih-dsl-complete-guide.md` | `onLoad    → on:load` | L2580 |
| `docs/uih-dsl-complete-guide.md` | `onLoad: "init"` | L2727 |
| `docs/uih-dsl-complete-guide.md` | `<Button onClick=\{handleClick\} onChange=\{handleChange\} onLoad=\{init\}>` | L2743 |
| `docs/uih-dsl-complete-guide.md` | `onLoad: "initDashboard"` | L2858 |
| `docs/uih-dsl-complete-guide.md` | `onLoad: "prefillFromInvite"` | L2929 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Considering additional event handlers**</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "onSubmit" in "/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md" • 4 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `docs/uih-dsl-complete-guide.md` | `onSubmit: "processForm"` | L673 |
| `docs/uih-dsl-complete-guide.md` | `onSubmit: "handleForm"` | L897 |
| `docs/uih-dsl-complete-guide.md` | `- onClick, onLoad, onSubmit, onMount, onChange` | L1306 |
| `docs/uih-dsl-complete-guide.md` | `onSubmit: "handleSignup"` | L2928 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Identifying missing handlers**</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "onRefresh" in "/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md" • 3 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `docs/uih-dsl-complete-guide.md` | `onRefresh: "reloadData"` | L898 |
| `docs/uih-dsl-complete-guide.md` | `onRefresh: "refreshData"` | L2860 |
| `docs/uih-dsl-complete-guide.md` | `onRefresh: "fetchLatestFeed"` | L3008 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Considering adding onrefresh handler**</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "onChange" in "/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md" • 5 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `docs/uih-dsl-complete-guide.md` | `- onClick, onLoad, onSubmit, onMount, onChange` | L1306 |
| `docs/uih-dsl-complete-guide.md` | `- `onChange` → `@change`` | L2495 |
| `docs/uih-dsl-complete-guide.md` | `onChange  → on:change` | L2578 |
| `docs/uih-dsl-complete-guide.md` | `onChange: "handleChange",` | L2726 |
| `docs/uih-dsl-complete-guide.md` | `<Button onClick=\{handleClick\} onChange=\{handleChange\} onLoad=\{init\}>` | L2743 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Considering ignoring reminder and checking onMount**</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "onMount" in "/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md" • 1 match</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `docs/uih-dsl-complete-guide.md` | `- onClick, onLoad, onSubmit, onMount, onChange` | L1306 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating event naming conventions**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Preparing to update script and layout examples**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Revising event key casing and documentation**

I'm planning a thorough update to ensure event keys in scripts and code examples are consistently lowercase, reflecting this rule clearly in the grammar, property descriptions, and examples throughout the documentation and code snippets, including React, Vue, and Svelte integrations. I'll also update comments, type definitions, and add notes on restrictions to emphasize the lowercase-only event key policy.</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "script \{" in "/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md" • 8 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `docs/uih-dsl-complete-guide.md` | `script \{` | L254 |
| `docs/uih-dsl-complete-guide.md` | `script \{` | L628 |
| `docs/uih-dsl-complete-guide.md` | `script \{` | L671 |
| `docs/uih-dsl-complete-guide.md` | `script \{` | L895 |
| `docs/uih-dsl-complete-guide.md` | `script \{` | L1365 |
| `docs/uih-dsl-complete-guide.md` | `script \{` | L2857 |
| `docs/uih-dsl-complete-guide.md` | `script \{` | L2927 |
| `docs/uih-dsl-complete-guide.md` | `script \{` | L3007 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Inspecting specific code sections**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Locating relevant script blocks**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Checking for additional script updates**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating event handler naming conventions**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;19d904b8-35f2-4460-919a-e21575fb7961&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  &#96;&#96;&#96;\n  script {\n-   onClick: \&quot;submitForm\&quot;\n-   onLoad: \&quot;init\&quot;\n+   onclick: \&quot;submitForm\&quot;\n+   onload: \&quot;init\&quot;\n  }\n  &#96;&#96;&#96;&quot;,
        &quot;oldStart&quot;: 627,
        &quot;newStart&quot;: 627,
        &quot;oldLines&quot;: 6,
        &quot;newLines&quot;: 6,
        &quot;linesRemoved&quot;: 2,
        &quot;linesAdded&quot;: 2
      },
      {
        &quot;diffString&quot;: &quot;  - JS code 삽입 금지\n  - inline function 금지\n+ - event identifier는 반드시 lowercase (camelCase 금지)\n  \n  #### 전체 구조 예시&quot;,
        &quot;oldStart&quot;: 636,
        &quot;newStart&quot;: 636,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;    Div(class:\&quot;container mx-auto p-4\&quot;) {\n      Card(class:\&quot;bg-white shadow-lg\&quot;) {\n-       Button(onClick:\&quot;handleSubmit\&quot;) {\n+       Button(onclick:\&quot;handleSubmit\&quot;) {\n          \&quot;Submit\&quot;\n        }&quot;,
        &quot;oldStart&quot;: 662,
        &quot;newStart&quot;: 663,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;  \n  script {\n-   onLoad: \&quot;initDashboard\&quot;\n-   onSubmit: \&quot;processForm\&quot;\n+   onload: \&quot;initDashboard\&quot;\n+   onsubmit: \&quot;processForm\&quot;\n  }\n  &#96;&#96;&#96;&quot;,
        &quot;oldStart&quot;: 670,
        &quot;newStart&quot;: 671,
        &quot;oldLines&quot;: 6,
        &quot;newLines&quot;: 6,
        &quot;linesRemoved&quot;: 2,
        &quot;linesAdded&quot;: 2
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;,
  &quot;contentsAfterEdit&quot;: &quot;# UIH DSL — Complete Guide (생략 없는 완전판)\n\n## Table of Contents\n\n1. [Overview](#overview)\n2. [Philosophy &amp; Design Principles](#philosophy--design-principles)\n3. [Foundation Layer](#foundation-layer)\n4. [Tokenizer Specification](#tokenizer-specification)\n5. [Grammar](#grammar)\n   - [Block Grammar](#block-grammar)\n   - [Property Grammar](#property-grammar)\n   - [Layout Tree Grammar](#layout-tree-grammar)\n   - [Parser BNF Grammar](#parser-bnf-grammar)\n6. [AST Schema Definition](#ast-schema-definition)\n7. [IR (Intermediate Representation) Specification](#ir-intermediate-representation-specification)\n8. [Codegen Rules](#codegen-rules)\n   - [React/Next.js 15 Codegen](#reactnextjs-15-codegen)\n   - [Vue &amp; Svelte Codegen](#vue--svelte-codegen)\n9. [Examples](#examples)\n10. [Version](#version)\n\n---\n\n## Overview\n\nUIH DSL (Universal Interface Hierarchy Domain Specific Language) v2는 **\&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;**를 목표로 하는 도메인 특화 언어입니다.\n\n### 핵심 목표\n- LLM이 UI 구조를 **정확하게** 선언할 수 있도록 설계\n- 모호성 제거 및 결정성(determinism) 보장\n- 사람보다 AI가 더 효과적으로 사용 가능한 DSL\n- UI 구조의 선언적 표현에 집중\n\n### 아키텍처 흐름\n&#96;&#96;&#96;\nDSL 문자열 → Tokenizer → Parser → AST → IR → Codegen → React/Vue/Svelte 코드\n&#96;&#96;&#96;\n\n### 주요 특징\n- 한 줄에 하나의 의미만 (One-intent-per-line)\n- 선택적 문법 금지 - 모든 것이 명시적\n- 쌍따옴표만 허용, 세미콜론 없음\n- 주석 지원 안 함 (모호성 제거)\n- 고정 블록 순서: meta → style → components → layout → script\n\n---\n\n## Philosophy &amp; Design Principles\n\nUIH DSL은 \&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;를 목표로 하는 도메인 특화 언어입니다. 사람보다 LLM이 더 효과적으로 사용할 수 있도록 설계되었으며, UI 구조의 선언적 표현에 집중합니다.\n\n### 1. LLM 친화적 설계 원칙\n\nLLM이 읽고 쓰기 편한 DSL을 지향합니다. 구조는 최대한 명확하고 모호성이 없으며, 선택적 문법을 금지합니다. LLM이 패턴을 쉽게 반복할 수 있는 형태로 자연어 번역 난이도를 낮췄습니다.\n\n### 2. 선언적 UI 설계\n\nUI는 로직 기반보다 구조 기반으로 설계합니다. \&quot;무엇을 만든다\&quot;에 집중하며 \&quot;어떻게 만든다\&quot;는 Codegen이 담당합니다. 상태, 이벤트, 애니메이션은 추상화 계층으로 밀어냅니다.\n\n### 3. 한 줄 한 의미 원칙 (One-intent-per-line)\n\n한 라인에 하나의 의미만 허용합니다. 한 줄에 두 개 의미를 섞으면 LLM이 실수할 가능성이 높아집니다.\n\n#### 좋은 예: 한 줄 한 의미\n&#96;&#96;&#96;dsl\nmeta:\n  title: \&quot;Home\&quot;\n\nmeta:\n  route: \&quot;/\&quot;\n&#96;&#96;&#96;\n\n#### 나쁜 예: 한 줄 다중 의미 (금지)\n&#96;&#96;&#96;dsl\nmeta: title: \&quot;Home\&quot;, route: \&quot;/\&quot;  # 잘못된 예\n&#96;&#96;&#96;\n\n### 4. 고정 블록 순서\n\n블록 구조는 **meta → style → components → layout → script** 순서를 유지합니다. 이 순서는 LLM이 외우기 쉽고 Codegen의 예측 가능성과 AST의 결정성을 보장합니다.\n\n### 5. 최소 표현, 최대 의미\n\nDSL은 짧고 규칙적이어야 합니다. CSS-like verbose, YAML 계층 증가, JSX 로직 섞임을 금지합니다. 의미 전달에 집중하는 최소 선언적 DSL입니다.\n\n### 6. 오류 제로 문법\n\n\&quot;AI가 틀릴 수 없는 언어\&quot;를 목표로 합니다. 쌍따옴표만 허용하고 세미콜론 없이 콜론만 사용합니다. 모든 키는 고정된 string literal이며 optional field를 최소화합니다.\n\n### 7. AST 1:1 매핑\n\n모든 UI 요소가 AST에 직접 매핑됩니다. meta 블록 → MetaNode, style 블록 → StyleNode, layout 블록 → LayoutTree로 변환됩니다.\n\n### 8. 기계 친화적 우선\n\n\&quot;사람이 읽으면 조금 불편할 것\&quot; 정도가 적정 수준입니다. 사람 UX보다 AI 정확성을 우선합니다.\n\n---\n\n## Foundation Layer\n\nUIH DSL의 가장 낮은 레벨 사양입니다. Character부터 Ordering까지의 기본 규칙을 정의하며, LLM이 실수할 수 없는 엄격한 문법을 제공합니다.\n\n### 1. Character Layer (문자 규칙)\n\n#### ALLOWED_CHARACTERS\n- a~z (lowercase alphabets)\n- 0~9 (digits)\n- hyphen (-)\n- underscore (_)\n- space ( )\n- newline (\\n)\n- braces: { }\n- colon (:)\n- double-quote (\&quot;)\n\n#### DISALLOWED_CHARACTERS\n- single-quote (&#39;)\n- semicolon (;)\n- parentheses ()\n- backtick (&#96;)\n- tab (\\t)\n- CRLF (\\r\\n)\n\n#### NEWLINE\n- always LF (\\n)\n- CRLF not supported\n\n### 2. Indentation Layer (들여쓰기 규칙)\n\n#### INDENTATION\n- exactly 2 spaces ONLY\n- tabs NOT allowed\n- indentation increases only inside a block\n- indentation does not imply hierarchy (not YAML)\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {           // ❌ 탭 사용 금지\n  title: \&quot;Home\&quot;  // ✅ 정확히 2 space\n}\n&#96;&#96;&#96;\n\n### 3. Token Layer (토큰 기본 규칙)\n\n#### TOKENS\n- IDENTIFIER = &#96;[a-z][a-z0-9.]*&#96;\n- STRING = &#96;\&quot;[^\&quot;\\\\]*(?:\\\\.[^\&quot;\\\\]*)*\&quot;&#96; (supports &#96;\\\&quot;&#96; escape)\n- NUMBER = &#96;\\d+(?:\\.\\d+)?&#96;\n- LBRACE = &#96;{&#96;\n- RBRACE = &#96;}&#96;\n- COLON = &#96;:&#96;\n- NEWLINE = &#96;\\n&#96;\n- WHITESPACE = single space\n\n#### IDENTIFIER_RULES\n- lowercase only\n- dot notation allowed (e.g. &#96;color.primary&#96;)\n- do NOT mix hyphens inside identifiers (LLM error-prone)\n\n#### STRING_RULES\n- must use double quotes only\n- escaping uses &#96;\\\&quot;&#96;\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {\n  color.primary: \&quot;#fff\&quot;    // ✅ dot notation 허용\n  label: \&quot;Click \\\&quot;here\\\&quot;\&quot;  // ✅ escape 허용\n  width: 100.5            // ✅ 소수 허용\n}\n&#96;&#96;&#96;\n\n### 4. Comment Layer (코멘트)\n\n#### COMMENTS\n- comments NOT supported\n- any attempt to use &#96;//&#96; or &#96;#&#96; is invalid\n- purpose: reduce ambiguity for LLM\n\n### 5. Statement Layer (기본 문장 구조)\n\n#### STATEMENT_TYPES\n- Block Declaration\n- Property Declaration\n\n#### BLOCK_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt; {\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n#### PROPERTY_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n#### SEMICOLON\n- NOT allowed (never used)\n\n### 6. Block Layer (블록 기본 규칙)\n\n#### BLOCK_STRUCTURE\n&#96;&#96;&#96;\nblockName {\n  property: \&quot;value\&quot;\n  property: 123\n  property: true\n}\n&#96;&#96;&#96;\n\n#### BLOCK_RULES\n- block cannot contain nested blocks\n- ONLY layout block may contain nested layout nodes\n\n### 7. Ordering Layer (순서 강제)\n\n#### BLOCK_ORDER\n1. meta\n2. style\n3. components (optional)\n4. layout\n5. script (optional)\n\n#### RULE\n- if a block appears, must follow this order\n- missing blocks are allowed except meta/style/layout\n\n### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  primary-color: \&quot;#111\&quot;\n}\n\ncomponents {\n  Button {\n    variant: \&quot;primary\&quot;\n  }\n}\n\nlayout {\n  Container {\n    children: \&quot;Button\&quot;\n  }\n}\n\nscript {\n  // optional script\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단\n- 잘못된 들여쓰기 발견 시 구문 오류\n- 코멘트 시도 시 즉시 무효 처리\n- 블록 순서 위반 시 파싱 실패\n- layout 외 중첩 블록 시도 시 오류\n\n---\n\n## Tokenizer Specification\n\nFoundation Layer + Grammar Layers 기반의 공식 토큰화 규칙입니다. DSL 문자열을 균일한 Token 리스트로 변환하며, 모든 파싱의 기반이 됩니다.\n\n### 1. Tokenizer Overview\n\n#### PURPOSE\n- DSL 문자열을 균일한 Token 리스트로 변환\n- 모호성 없는 deterministic token stream 생성\n- 모든 파싱은 이 토큰 리스트 기반으로 진행\n\n#### INPUT\n- LF 기반의 DSL 문자열\n\n#### OUTPUT\n- 순차적 Token 배열\n\n### 2. Token Types\n\n#### TOKENS\n- &#96;IDENTIFIER&#96; - meta, title, color.primary, class 등\n- &#96;STRING&#96; - \&quot;Hello\&quot;\n- &#96;NUMBER&#96; - 0, 12, 0.8\n- &#96;BOOLEAN&#96; - true, false\n- &#96;LBRACE&#96; - {\n- &#96;RBRACE&#96; - }\n- &#96;LPAREN&#96; - (\n- &#96;RPAREN&#96; - )\n- &#96;COLON&#96; - :\n- &#96;COMMA&#96; - ,\n- &#96;NEWLINE&#96; - \\n\n- &#96;WHITESPACE&#96; - space (only used between tokens)\n- &#96;TEXT_STRING&#96; - layout children string ONLY (disambiguation)\n- &#96;EOF&#96; - end of file marker\n\n### 3. Identifier Detection\n\n#### IDENTIFIER_RULES\n- regex: &#96;^[a-z][a-z0-9.]*$&#96;\n- lowercase only\n- dot notation allowed\n- hyphens, underscores 금지\n\n#### TAGNAME_RULES\n- starts with uppercase letter\n- subsequent chars: &#96;[a-zA-Z0-9]&#96;\n- TagName (e.g. Div, Header) 구분용\n\n#### TAGNAME_EXAMPLES\n&#96;&#96;&#96;\nDiv\nSection\nImage\nH1\n&#96;&#96;&#96;\n\n### 4. String Token Rules\n\n#### STRING\n- starts with &#96;\&quot;&#96;\n- ends with &#96;\&quot;&#96;\n- inside supports &#96;\\\&quot;&#96;\n- no multi-line\n\n#### TEXT_STRING\n- STRING과 동일한 문법\n- 단, layout children context에서만 등장\n- Parser에서 context-aware로 구분\n\n### 5. Number Token Rules\n\n#### NUMBER\n- regex: &#96;^[0-9]+(\\.[0-9]+)?$&#96;\n- no negative numbers\n- no units (px, rem 등)\n\n### 6. Boolean Token Rules\n\n#### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n- strictly lowercase\n\n### 7. Brace / Symbol Tokens\n\n#### SYMBOL_TOKENS\n- &#96;LBRACE&#96;: &#96;{&#96;\n- &#96;RBRACE&#96;: &#96;}&#96;\n- &#96;LPAREN&#96;: &#96;(&#96;\n- &#96;RPAREN&#96;: &#96;)&#96;\n- &#96;COLON&#96;: &#96;:&#96;\n- &#96;COMMA&#96;: &#96;,&#96;\n\n#### NOTES\n- semicolon NOT allowed\n- backtick NOT allowed\n\n### 8. Whitespace / Newline Rules\n\n#### WHITESPACE\n- single space &#96;&#39; &#39;&#96;\n- no tabs\n- no multi-space sequences except indentation (2 spaces)\n\n#### NEWLINE\n- LF only\n- CRLF invalid\n\n### 9. Layout Context Rules (Critical)\n\n#### LAYOUT_MODE\nTokenizer enters layout-mode when encountering:\n&#96;&#96;&#96;\nlayout { … }\n&#96;&#96;&#96;\n\n#### CONTEXT_SWITCH\n- after TagName(\n- before encountering next node or text\n\n#### INSIDE_LAYOUT_BLOCK\n- children detection required\n- plain strings must become TEXT_STRING token\n- siblings separated by NEWLINE\n\n#### EXAMPLE\n&#96;&#96;&#96;\n\&quot;Welcome\&quot; → TEXT_STRING inside layout\n&#96;&#96;&#96;\n\n### 10. Tokenization Algorithm (High-Level)\n\n1. iterate through chars\n2. skip whitespace unless meaningful (indent)\n3. detect IDENTIFIER or TAGNAME\n4. detect STRING (with escape)\n5. detect NUMBER\n6. detect BOOLEAN\n7. detect braces &#96;{ }&#96;\n8. detect parentheses &#96;( )&#96;\n9. detect colon &#96;:&#96; or comma &#96;,&#96;\n10. detect newline &#96;\\n&#96;\n11. maintain context stack:\n    - normal\n    - inside layout block\n    - inside attributes\n12. output final EOF token\n\n### 11. Example Token Stream\n\n#### INPUT\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### OUTPUT_TOKENS\n&#96;&#96;&#96;\nIDENTIFIER(layout)\nLBRACE\nNEWLINE\nTAGNAME(Div)\nLPAREN\nIDENTIFIER(class)\nCOLON\nSTRING(\&quot;p-4\&quot;)\nRPAREN\nLBRACE\nNEWLINE\nTEXT_STRING(\&quot;Hello\&quot;)\nNEWLINE\nRBRACE\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Token Stream Examples\n\n#### 기본 블록 토큰화\n&#96;&#96;&#96;dsl\nmeta {\n  title: \&quot;Home\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(meta)\nLBRACE\nNEWLINE\nIDENTIFIER(title)\nCOLON\nSTRING(\&quot;Home\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n#### 스타일 블록 토큰화\n&#96;&#96;&#96;dsl\nstyle {\n  color.primary: \&quot;#fff\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(style)\nLBRACE\nNEWLINE\nIDENTIFIER(color.primary)\nCOLON\nSTRING(\&quot;#fff\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단 및 오류 반환\n- CRLF 줄바꿈 발견 시 LF로 변환 또는 오류\n- 탭 문자 발견 시 공백 변환 또는 오류\n- STRING에서 미닫힘 따옴표 시 오류\n- NUMBER에 음수나 단위 포함 시 오류\n- layout 외 컨텍스트에서 TEXT_STRING 시도 시 오류\n- TAGNAME 규칙 위반 (소문자 시작) 시 IDENTIFIER로 처리\n\n---\n\n## Grammar\n\n### Block Grammar\n\nUIH DSL의 최상위 구조를 정의하는 Block Grammar Layer입니다. Foundation Layer 바로 위에 위치하며, 5개 블록의 선언, 순서, 내용 규칙을 명시합니다.\n\n#### 1. Block Definitions (5개 블록)\n\n##### BLOCKS\n- meta\n- style\n- components (optional)\n- layout\n- script (optional)\n\n##### RULES\n- 블록은 반드시 이 순서를 따라야 함: meta → style → components → layout → script\n- meta, style, layout은 필수\n- components, script는 선택\n- 각 블록은 정확히 한 번만 등장\n- 중복 블록 금지\n\n#### 2. Block Syntax (기본 문법)\n\n##### BLOCK_SYNTAX\n&#96;&#96;&#96;\n&lt;blockName&gt; {\n  &lt;property&gt;: &lt;value&gt;\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n&#96;&#96;&#96;\n\n##### SYNTAX_COMPONENTS\n- 블록 시작: IDENTIFIER + &#96; {&#96;\n- 블록 끝: &#96;}&#96; 단독 줄\n\n#### 3. Block Content Rules\n\n##### 공통 규칙\n- 블록 내부에는 property statements만 존재\n- block 내부에 block 중첩 금지\n- 단, layout 블록만 예외적으로 UI tree 구조 허용\n\n##### PROPERTY_RULE\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### VALUE_TYPES\n- string\n- number\n- boolean\n- enum-like literals (string 값)\n- list (향후 정의)\n\n#### 4. Block-Specific Rules\n\n##### (1) META BLOCK\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Page title\&quot;\n  route: \&quot;/path\&quot;\n  theme: \&quot;light\&quot;|\&quot;dark\&quot;\n}\n&#96;&#96;&#96;\n\n**META_RESTRICTIONS:**\n- meta는 UI 문서의 metadata만 포함\n- layout 정보나 스타일 정보 포함 금지\n\n##### (2) STYLE BLOCK\n&#96;&#96;&#96;\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n}\n&#96;&#96;&#96;\n\n**STYLE_RESTRICTIONS:**\n- key는 dot notation 사용 가능\n- 값은 string 또는 number\n- layout 관련 속성 금지\n- theme override 불가\n\n##### (3) COMPONENTS BLOCK (optional)\n&#96;&#96;&#96;\ncomponents {\n  Card\n  Button\n  Input\n}\n&#96;&#96;&#96;\n\n**COMPONENTS_RULES:**\n- 등록할 컴포넌트 이름만 줄 단위로 나열\n- 중첩 구조 없음\n- 속성 없음\n- 문자열 아님: &#96;\&quot;Card\&quot;&#96; 금지, &#96;Card&#96;만 허용\n\n##### (4) LAYOUT BLOCK\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n**LAYOUT_RULES:**\n- 유일하게 중첩 구조 허용\n- 노드 문법은 별도 Layer에서 정의\n- property는 inline attribute 형태 가능\n- block-like structure 유지\n\n##### (5) SCRIPT BLOCK (optional)\n&#96;&#96;&#96;\nscript {\n  onclick: \&quot;submitForm\&quot;\n  onload: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n**SCRIPT_RESTRICTIONS:**\n- event/behavior mapping만 정의\n- JS code 삽입 금지\n- inline function 금지\n- event identifier는 반드시 lowercase (camelCase 금지)\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n  spacing.unit: 8\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n}\n\nlayout {\n  Div(class:\&quot;container mx-auto p-4\&quot;) {\n    Card(class:\&quot;bg-white shadow-lg\&quot;) {\n      Button(onclick:\&quot;handleSubmit\&quot;) {\n        \&quot;Submit\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;processForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 파싱 실패\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유효 (경고)\n- components/script 외 블록에서 중첩 시도 시 오류\n- layout 외 블록에서 attribute 사용 시 오류\n\n---\n\n### Property Grammar\n\nUIH DSL 안정성의 핵심인 Property Grammar Layer입니다. Block Grammar 위에 쌓이며, 속성 선언, 값 타입, 범위 규칙을 정의합니다.\n\n#### 1. Property Declaration Syntax\n\n##### PROPERTY_SYNTAX\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\nradius.default: 8\nenabled: true\n&#96;&#96;&#96;\n\n##### RULES\n- identifier는 반드시 lowercase\n- dot notation 허용 (&#96;color.primary&#96; 등)\n- colon(:) 뒤에는 반드시 space 1개\n- value는 줄 끝까지\n\n#### 2. Identifier Rules\n\n##### IDENTIFIER\n- 패턴: &#96;[a-z][a-z0-9.]*&#96;\n- 소문자만 허용\n- 숫자는 뒤쪽에만 허용\n- dot(.)은 중첩 속성 의미로만 사용\n- hyphen 금지 (LLM 오류 방지)\n- underscore 금지\n\n##### VALID\n&#96;&#96;&#96;\ncolor.primary\nfont.size\nborder.width\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nColor.Primary    // 대문자\nfont-size        // hyphen\nfont_size        // underscore\nprimary2.color   // 숫자 앞쪽\n&#96;&#96;&#96;\n\n#### 3. Value Types (5가지)\n\n##### VALUE_TYPES\n1. STRING\n2. NUMBER\n3. BOOLEAN\n4. ENUM-LIKE (string 기반)\n5. LIST (여러 값 나열, 줄 단위)\n\n#### 4. String Value Rules\n\n##### STRING\n- 무조건 double-quote 사용\n- 내부에 &#96;\&quot;&#96; 포함 시 &#96;\\\&quot;&#96;로 escape\n- single-quote 절대 금지\n\n##### VALID\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\ndescription: \&quot;He said \\\&quot;ok\\\&quot;\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\ntitle: &#39;Home&#39;      // single-quote\nname: \&quot;Home\&quot;       // curly quotes\n&#96;&#96;&#96;\n\n#### 5. Number Value Rules\n\n##### NUMBER\n- 정수 또는 소숫점 가능\n- 음수는 허용하지 않음\n- 단위(px 등) 금지 → unitless 구조\n\n##### VALID\n&#96;&#96;&#96;\nradius: 12\nopacity: 0.85\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nradius: -4     // 음수\nwidth: 10px    // 단위 포함\n&#96;&#96;&#96;\n\n#### 6. Boolean Value Rules\n\n##### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nenabled: true\nvisible: false\n&#96;&#96;&#96;\n\n#### 7. Enum-like String Rules\n\n##### ENUM_STRING\n- 문자열이지만 값이 고정된 타입처럼 쓰는 케이스\n- allowed values는 별도 block schema마다 정의\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntheme: \&quot;light\&quot; | \&quot;dark\&quot;\nsize: \&quot;sm\&quot; | \&quot;md\&quot; | \&quot;lg\&quot;\n&#96;&#96;&#96;\n\n#### 8. List Value (Block-like list)\n\n##### LIST\n- 각 항목은 줄 단위로 입력\n- 대괄호 &#96;[]&#96; 문법 없음 (LLM 오류 방지)\n- 문자열/식별자 혼용 가능\n\n##### SYNTAX\n&#96;&#96;&#96;\nitems {\n  \&quot;one\&quot;\n  \&quot;two\&quot;\n  \&quot;three\&quot;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- list block 내부에는 property 없음\n- indent 2 spaces 유지\n\n##### EXAMPLE\n&#96;&#96;&#96;\ntags {\n  \&quot;news\&quot;\n  \&quot;feature\&quot;\n  \&quot;announcement\&quot;\n}\n&#96;&#96;&#96;\n\n#### 9. Property Scope Rules (Block별 허용 속성 경계)\n\n##### META_SCOPE\n- meta는 UI metadata만 포함\n- route, title, theme, description 등\n\n##### STYLE_SCOPE\n- 색상, 폰트, radius 등 UI 스타일만\n- layout 속성 금지 (width, height 등은 layout block에서만)\n\n##### COMPONENTS_SCOPE\n- property 없음 (등록만)\n\n##### LAYOUT_SCOPE\n- inline attribute만 (class, id, ref 등)\n- 값은 무조건 string\n- boolean/number 사용 금지\n\n##### SCRIPT_SCOPE\n- event mapping 전용\n- 값은 무조건 string\n\n#### 10. Final Validation Rules\n\n1. 모든 property는 블록 내부에서만 존재\n2. 같은 identifier 중복 선언 금지\n3. meta/style/script는 property-only 구조\n4. components는 선언만 (property 없음)\n5. layout만 child nodes 보유 가능\n6. value의 타입은 block-specific rule을 반드시 준수\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main dashboard page\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  border.radius: 8\n  spacing.unit: 16\n}\n\ncomponents {\n  Card\n  Button\n  Input\n}\n\nlayout {\n  class: \&quot;container\&quot;\n  id: \&quot;main-content\&quot;\n}\n\nscript {\n  onLoad: \&quot;initDashboard\&quot;\n  onSubmit: \&quot;handleForm\&quot;\n  onRefresh: \&quot;reloadData\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 대문자 identifier 사용 시 토큰화 실패\n- hyphen/underscore 사용 시 구문 오류\n- single-quote나 curly quotes 사용 시 파싱 실패\n- 음수나 단위 포함 숫자 시 값 오류\n- 블록별 스코프 위반 시 validation 실패\n- 중복 property 선언 시 마지막 값만 유효 (경고)\n\n---\n\n### Layout Tree Grammar\n\nUIH DSL의 핵심 구조인 Layout Tree Grammar Layer입니다. Block Grammar와 Property Grammar 위에서 동작하며, UI 구성 요소의 트리 구조를 정의합니다.\n\n#### 1. Layout Block Overview\n\n##### LAYOUT_BLOCK\n&#96;&#96;&#96;\nlayout {\n  &lt;layout-node&gt;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- DSL에서 유일하게 중첩 구조를 가질 수 있는 블록\n- 모든 UI 구성 요소는 layout node로 표현\n- 노드는 \&quot;구조\&quot;만 표현, 스타일/로직은 표현하지 않음\n\n#### 2. Layout Node Syntax\n\n##### NODE_SYNTAX\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;) {\n  &lt;children&gt;\n}\n&#96;&#96;&#96;\n\n##### OR (children 없는 경우)\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;)\n&#96;&#96;&#96;\n\n##### NOTES\n- TagName은 PascalCase 컴포넌트 또는 HTML-like 사용 가능\n- attributes는 inline 형태 only\n- attributes는 옵션, 없어도 됨\n- children 블록은 중첩 가능\n\n##### VALID\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) {\n  \&quot;Hello\&quot;\n}\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nDiv {\n  class: \&quot;p-4\&quot;    // 속성은 block 기반이 아니라 inline only\n}\n&#96;&#96;&#96;\n\n#### 3. TagName Rules\n\n##### TAGNAME\n- 반드시 알파벳으로 시작\n- PascalCase 또는 UpperCamelCase 권장\n- HTML-like 소문자 태그는 사용 가능 (&#96;div&#96;, &#96;span&#96;) 단 내부적으로는 UpperCase 변환됨\n\n##### VALID\n&#96;&#96;&#96;\nDiv\nSection\nImage\nheader   // 허용하지만 변환 시 Header로 취급\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n3Div     // 숫자 시작\n_Box     // underscore 시작\n-Node    // hyphen 시작\n&#96;&#96;&#96;\n\n#### 4. Attribute Syntax\n\n##### ATTRIBUTES\n&#96;&#96;&#96;\n&lt;identifier&gt;:\&quot;&lt;string&gt;\&quot;\n&#96;&#96;&#96;\n\n##### RULES\n- value는 무조건 string only\n- boolean/number 금지\n- &#96;class:\&quot;p-4\&quot;&#96; 형태처럼 inline만 허용\n- 각 attribute는 콤마(&#96;,&#96;)로 구분\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;, id:\&quot;main\&quot;, ref:\&quot;root\&quot;)\n&#96;&#96;&#96;\n\n##### STRICT_RULES\n- 속성 순서는 의미 없음 (LLM 실수 방지로 자유 순서)\n- attribute key는 lower-case only\n- 속성 개수 0~5 정도 권장\n\n#### 5. Children Rules\n\n##### CHILD_TYPES\n- string literal\n- another layout node\n- list of siblings (node 여러 개 배치)\n\n##### STRING_CHILD\n&#96;&#96;&#96;\n\&quot;Hello world\&quot;\n&#96;&#96;&#96;\n\n##### NESTED_NODE\n&#96;&#96;&#96;\nDiv(class:\&quot;mt-4\&quot;) {\n  \&quot;content\&quot;\n}\n&#96;&#96;&#96;\n\n##### SIBLINGS\n&#96;&#96;&#96;\nDiv(...) { ... }\nP(...) { ... }\nImage(...)\n&#96;&#96;&#96;\n\n#### 6. Text Node Rules\n\n##### TEXT_NODE\n- 무조건 double-quote string\n- 줄바꿈 포함 금지\n- 텍스트 덩어리는 여러 줄로 쪼개면 안 됨\n\n##### VALID\n&#96;&#96;&#96;\n\&quot;Sign in to continue\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n\&quot;Hello\n World\&quot;    // 줄바꿈 포함\n&#96;&#96;&#96;\n\n#### 7. Node Termination Rules\n\n##### CLOSING_RULES\n- 블록 노드는 반드시 &#96;}&#96; 단독 줄로 닫는다\n- inline-only 노드는 종료 블록 없음\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;px-4\&quot;) {\n  P {\n    \&quot;Hello\&quot;\n  }\n  Image(src:\&quot;/logo.png\&quot;)\n}\n&#96;&#96;&#96;\n\n#### 8. Layout Grammar Formal Pattern\n\n##### LAYOUT_NODE_GRAMMAR\n&#96;&#96;&#96;\nNode:\n  Tag (Attributes?) (ChildrenBlock?)\n\nTag:\n  IDENTIFIER\n\nAttributes:\n  \&quot;(\&quot; AttributeList \&quot;)\&quot;\n\nAttributeList:\n  Attribute (\&quot;,\&quot; Attribute)*\n\nAttribute:\n  IDENTIFIER \&quot;:\&quot; STRING\n\nChildrenBlock:\n  \&quot;{\&quot; NewLine Indented(NodeOrText)+ \&quot;}\&quot;\n\nNodeOrText:\n  Node | STRING\n&#96;&#96;&#96;\n\n#### 9. Validation Rules\n\n1. layout은 트리 구조만 표현한다\n2. inline attributes만 허용\n3. 속성은 string-only\n4. children은 반드시 정해진 중첩 규칙을 따른다\n5. Node 이름은 PascalCase가 기본\n6. 문자열 children 외에는 모든 children은 Node여야 한다\n7. siblings 허용, 순서 보존\n\n#### 10. Example (Valid Layout Tree)\n\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;min-h-screen flex flex-col\&quot;) {\n    Header(class:\&quot;p-4 bg-gray-100\&quot;) {\n      H1 {\n        \&quot;Dashboard\&quot;\n      }\n    }\n\n    Main(class:\&quot;flex-1 p-6\&quot;) {\n      Card(class:\&quot;shadow\&quot;) {\n        P {\n          \&quot;Welcome back!\&quot;\n        }\n      }\n    }\n\n    Footer(class:\&quot;p-4 text-center\&quot;) {\n      \&quot;© 2025 The Bespoke\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto\&quot;) {\n    Navbar(class:\&quot;flex justify-between items-center p-4\&quot;) {\n      Logo(class:\&quot;text-xl font-bold\&quot;) {\n        \&quot;UIH\&quot;\n      }\n      Nav(class:\&quot;space-x-4\&quot;) {\n        Link(href:\&quot;/home\&quot;) {\n          \&quot;Home\&quot;\n        }\n        Link(href:\&quot;/about\&quot;) {\n          \&quot;About\&quot;\n        }\n      }\n    }\n\n    Content(class:\&quot;grid grid-cols-3 gap-6 p-6\&quot;) {\n      Sidebar(class:\&quot;col-span-1 bg-gray-50 p-4\&quot;) {\n        Menu {\n          \&quot;Dashboard\&quot;\n          \&quot;Settings\&quot;\n          \&quot;Profile\&quot;\n        }\n      }\n\n      Main(class:\&quot;col-span-2\&quot;) {\n        Article(class:\&quot;prose\&quot;) {\n          H2 {\n            \&quot;Getting Started\&quot;\n          }\n          P {\n            \&quot;Welcome to UIH DSL documentation.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- TagName에 숫자/특수문자 시작 시 토큰화 실패\n- 속성에 boolean/number 값 사용 시 파싱 오류\n- 텍스트 노드에 줄바꿈 포함 시 validation 실패\n- 노드 종료 &#96;}&#96; 누락 시 구문 오류\n- 중첩 깊이가 너무 깊을 경우 (권장 5레벨 초과) 경고\n- siblings 간 순서가 UI 의미에 영향 줄 경우 재검토\n\n---\n\n### Parser BNF Grammar\n\nTokenizer 위에서 동작하는 공식 문법 엔진 정의입니다. Token Stream을 Abstract Syntax Tree(AST)로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- Token Stream → Abstract Syntax Tree(AST)\n\n##### PARSER_MODE\n- strict non-ambiguous grammar\n- no recovery parsing (에러는 즉시 throw)\n- deterministic (LLM-friendly)\n- recursive descent parser 기반 구조\n\n#### 2. Entry Point\n\n##### Program\n&#96;&#96;&#96;\nProgram ::= MetaBlock StyleBlock ComponentsBlock? LayoutBlock ScriptBlock? EOF\n&#96;&#96;&#96;\n\n#### 3. Blocks\n\n##### Block_Definitions\n&#96;&#96;&#96;\nMetaBlock       ::= \&quot;meta\&quot; BlockBody(MetaProperty)\nStyleBlock      ::= \&quot;style\&quot; BlockBody(StyleProperty)\nComponentsBlock ::= \&quot;components\&quot; BlockBody(ComponentEntry)\nLayoutBlock     ::= \&quot;layout\&quot; LayoutBody\nScriptBlock     ::= \&quot;script\&quot; BlockBody(ScriptProperty)\n&#96;&#96;&#96;\n\n#### 4. Generic Block Body\n\n##### BlockBody\n&#96;&#96;&#96;\nBlockBody(&lt;T&gt;) ::= LBRACE NEWLINE (Indent &lt;T&gt; NEWLINE)* RBRACE\nIndent         ::= WHITESPACE WHITESPACE    # 2 spaces only\n&#96;&#96;&#96;\n\n#### 5. META Block Grammar\n\n##### MetaProperty\n&#96;&#96;&#96;\nMetaProperty ::= Identifier \&quot;:\&quot; MetaValue\nMetaValue    ::= STRING | NUMBER | BOOLEAN | EnumString\n&#96;&#96;&#96;\n\n##### Allowed_Meta_Keys\n- title, route, theme, description\n\n#### 6. STYLE Block Grammar\n\n##### StyleProperty\n&#96;&#96;&#96;\nStyleProperty ::= StyleKey \&quot;:\&quot; StyleValue\nStyleKey      ::= Identifier ( \&quot;.\&quot; Identifier )*\nStyleValue    ::= STRING | NUMBER | EnumString\n&#96;&#96;&#96;\n\n##### Notes\n- no nested blocks\n- no boolean\n- layout-like attributes 금지\n\n#### 7. COMPONENTS Block Grammar\n\n##### ComponentEntry\n&#96;&#96;&#96;\nComponentEntry ::= ComponentName\nComponentName  ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n##### NOTES\n- but no quotes, no values, one per line\n\n##### Examples\n&#96;&#96;&#96;\nCard\nButton\nInput\n&#96;&#96;&#96;\n\n#### 8. LAYOUT Block Grammar (Core)\n\n##### LayoutBody\n&#96;&#96;&#96;\nLayoutBody     ::= LBRACE NEWLINE Indent LayoutNodeList RBRACE\nLayoutNodeList ::= (LayoutNode NEWLINE)*\nLayoutNode     ::= Tag (Attributes)? (ChildrenBlock)?\nTag            ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n#### 9. Attributes Grammar\n\n##### Attributes\n&#96;&#96;&#96;\nAttributes    ::= LPAREN AttributeList RPAREN\nAttributeList ::= Attribute (COMMA Attribute)*\nAttribute     ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n#### 10. Children Block Grammar\n\n##### ChildrenBlock\n&#96;&#96;&#96;\nChildrenBlock ::= LBRACE NEWLINE Indent ChildrenList RBRACE\nChildrenList  ::= (Child NEWLINE)*\nChild         ::= LayoutNode | TEXT_STRING\n&#96;&#96;&#96;\n\n#### 11. SCRIPT Block Grammar\n\n##### ScriptProperty\n&#96;&#96;&#96;\nScriptProperty ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n##### Allowed_Script_Keys\n- onClick, onLoad, onSubmit, onMount, onChange\n\n#### 12. Value Grammars\n\n##### Value_Types\n&#96;&#96;&#96;\nSTRING     ::= \&quot;\\\&quot;\&quot; &lt;chars&gt; \&quot;\\\&quot;\&quot;\nNUMBER     ::= digits ( \&quot;.\&quot; digits )?\nBOOLEAN    ::= \&quot;true\&quot; | \&quot;false\&quot;\nEnumString ::= STRING   # validated in semantic phase\n&#96;&#96;&#96;\n\n#### 13. Identifier Grammars\n\n##### Identifiers\n&#96;&#96;&#96;\nIdentifier ::= [a-z][a-z0-9.]*\nTagName    ::= [A-Z][a-zA-Z0-9]*\n&#96;&#96;&#96;\n\n#### 14. Syntax Constraints (Formal)\n\n1. 모든 블록은 순서 고정\n2. 각 블록은 1회만 등장\n3. meta/style/layout은 필수\n4. components/script는 optional\n5. 들여쓰기 2 spaces only\n6. 속성(colon)은 반드시 &#96;&lt;id&gt;: &lt;value&gt;&#96;\n7. semicolon 금지\n8. layout만 nested structure 허용\n9. children 안에서는 TEXT_STRING 또는 LayoutNode만 허용\n10. parser는 ambiguous branch 금지 (LLM-safe)\n\n#### 15. Complete Example (BNF-valid)\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  radius.default: 8\n}\n\ncomponents {\n  Card\n  Button\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello world\&quot;\n    }\n  }\n}\n\nscript {\n  onClick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### BNF 구조 트리\n\n&#96;&#96;&#96;\nProgram\n├── MetaBlock\n│   ├── LBRACE\n│   ├── MetaProperty (title: \&quot;Home\&quot;)\n│   ├── MetaProperty (route: \&quot;/\&quot;)\n│   └── RBRACE\n├── StyleBlock\n│   ├── LBRACE\n│   ├── StyleProperty (color.primary: \&quot;#0E5EF7\&quot;)\n│   ├── StyleProperty (radius.default: 8)\n│   └── RBRACE\n├── ComponentsBlock\n│   ├── LBRACE\n│   ├── ComponentEntry (Card)\n│   ├── ComponentEntry (Button)\n│   └── RBRACE\n├── LayoutBlock\n│   ├── LBRACE\n│   ├── LayoutNode (Div)\n│   │   ├── Attributes (class:\&quot;p-4\&quot;)\n│   │   └── ChildrenBlock\n│   │       └── LayoutNode (P)\n│   │           └── ChildrenBlock\n│   │               └── TEXT_STRING (\&quot;Hello world\&quot;)\n│   └── RBRACE\n└── ScriptBlock\n    ├── LBRACE\n    ├── ScriptProperty (onClick: \&quot;submitForm\&quot;)\n    └── RBRACE\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 즉시 파싱 중단\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유지 (경고)\n- 들여쓰기 2 space 위반 시 구문 오류\n- layout 외 블록에서 중첩 시도 시 파싱 실패\n- 허용되지 않은 키 사용 시 semantic 오류 (parser 단계에서는 허용)\n- TEXT_STRING이 layout 외 컨텍스트에서 등장 시 오류\n\n---\n\n## AST Schema Definition\n\nParser BNF 위에서 생성되는 최종 AST 구조입니다. 모든 UIH DSL 요소가 이 스키마에 따라 구조화됩니다.\n\n### 1. AST Root\n\n#### ASTRoot\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Program\&quot;\n  meta: MetaNode\n  style: StyleNode\n  components: ComponentsNode | null\n  layout: LayoutNode\n  script: ScriptNode | null\n}\n&#96;&#96;&#96;\n\n### 2. Meta Node\n\n#### MetaNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Meta\&quot;\n  properties: MetaProperty[]\n}\n&#96;&#96;&#96;\n\n#### MetaProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;title\&quot;\n  value: string|number|boolean\n  location: Range     // from tokenizer\n}\n&#96;&#96;&#96;\n\n### 3. Style Node\n\n#### StyleNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Style\&quot;\n  properties: StyleProperty[]\n}\n&#96;&#96;&#96;\n\n#### StyleProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;color.primary\&quot;\n  value: string|number\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 4. Components Node\n\n#### ComponentsNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Components\&quot;\n  components: ComponentEntry[]\n}\n&#96;&#96;&#96;\n\n#### ComponentEntry\n&#96;&#96;&#96;typescript\n{\n  name: string        // e.g. \&quot;Card\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 5. Layout Node (Core Tree Structure)\n\n#### LayoutNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Layout\&quot;\n  children: LayoutElement[]     // top-level nodes inside layout block\n}\n&#96;&#96;&#96;\n\n#### LayoutElement\n&#96;&#96;&#96;typescript\nLayoutElement = LayoutComponent | LayoutText\n&#96;&#96;&#96;\n\n#### 5.1 Layout Component\n&#96;&#96;&#96;typescript\nLayoutComponent {\n  type: \&quot;Component\&quot;\n  tag: string                   // e.g. \&quot;Div\&quot;, \&quot;P\&quot;, \&quot;Header\&quot;\n  attributes: Attribute[]\n  children: LayoutElement[]     // nested structure\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### Attribute\n&#96;&#96;&#96;typescript\n{\n  key: string                   // lower-case only\n  value: string                 // inline string only\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### 5.2 Layout Text Node\n&#96;&#96;&#96;typescript\nLayoutText {\n  type: \&quot;Text\&quot;\n  value: string                 // raw text string\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 6. Script Node\n\n#### ScriptNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Script\&quot;\n  events: ScriptProperty[]\n}\n&#96;&#96;&#96;\n\n#### ScriptProperty\n&#96;&#96;&#96;typescript\n{\n  key: string                   // e.g. \&quot;onClick\&quot;\n  value: string                 // e.g. \&quot;submitForm\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 7. Range Object (Source Location)\n\n#### Range\n&#96;&#96;&#96;typescript\n{\n  start: Position\n  end: Position\n}\n&#96;&#96;&#96;\n\n#### Position\n&#96;&#96;&#96;typescript\n{\n  line: number\n  column: number\n}\n&#96;&#96;&#96;\n\n### 8. Semantics Rules (Validation Layer)\n\n1. Meta keys must be from allowlist:\n   - title, route, theme, description\n\n2. Style keys may use dot notation but MUST be lowercase.\n\n3. Components must be names only, no properties.\n\n4. Layout:\n   - tag must be a valid TagName or valid identifier\n   - attributes must be string-only\n   - children: array of LayoutElement (component or text)\n\n5. Script:\n   - keys must be known event names\n   - value must be string (function name)\n\n6. No null children arrays. Use &#96;[]&#96; if empty.\n\n7. All nodes must have location data.\n\n### 9. Example: Full AST for a Simple Page\n\n#### Example DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### Generated AST (simplified)\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Home\&quot; },\n      { \&quot;key\&quot;: \&quot;route\&quot;, \&quot;value\&quot;: \&quot;/\&quot; }\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;color.primary\&quot;, \&quot;value\&quot;: \&quot;#0E5EF7\&quot; }\n    ]\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: [\n          { \&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;p-4\&quot; }\n        ],\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n### AST 구조 트리\n\n&#96;&#96;&#96;\nASTRoot (Program)\n├── meta (MetaNode)\n│   └── properties[] (MetaProperty)\n├── style (StyleNode)\n│   └── properties[] (StyleProperty)\n├── components (ComponentsNode | null)\n│   └── components[] (ComponentEntry)\n├── layout (LayoutNode)\n│   └── children[] (LayoutElement)\n│       ├── LayoutComponent\n│       │   ├── attributes[] (Attribute)\n│       │   └── children[] (LayoutElement)\n│       └── LayoutText\n└── script (ScriptNode | null)\n    └── events[] (ScriptProperty)\n&#96;&#96;&#96;\n\n### AST Examples\n\n#### 최소 AST 구조\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      {\&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Minimal\&quot;}\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: []\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Text\&quot;,\n        \&quot;value\&quot;: \&quot;Content\&quot;\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n#### 복잡한 레이아웃 AST\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Layout\&quot;,\n  \&quot;children\&quot;: [\n    {\n      \&quot;type\&quot;: \&quot;Component\&quot;,\n      \&quot;tag\&quot;: \&quot;Div\&quot;,\n      \&quot;attributes\&quot;: [\n        {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;container\&quot;}\n      ],\n      \&quot;children\&quot;: [\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Header\&quot;,\n          \&quot;attributes\&quot;: [],\n          \&quot;children\&quot;: [\n            {\n              \&quot;type\&quot;: \&quot;Component\&quot;,\n              \&quot;tag\&quot;: \&quot;H1\&quot;,\n              \&quot;attributes\&quot;: [],\n              \&quot;children\&quot;: [\n                {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Title\&quot;}\n              ]\n            }\n          ]\n        },\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Main\&quot;,\n          \&quot;attributes\&quot;: [\n            {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;content\&quot;}\n          ],\n          \&quot;children\&quot;: [\n            {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Main content\&quot;}\n          ]\n        }\n      ]\n    }\n  ]\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- location 정보 누락 시 AST 생성 실패\n- 빈 children 배열 대신 null 사용 시 validation 오류\n- 허용되지 않은 meta/style/script 키 사용 시 semantic 오류\n- LayoutComponent의 tag가 유효하지 않은 경우 오류\n- LayoutText에 빈 문자열 사용 시 경고\n- 중첩 깊이가 너무 깊을 경우 (10레벨 초과) 경고 또는 오류\n\n---\n\n## IR (Intermediate Representation) Specification\n\nAST → IR 변환 규칙을 정의합니다. Codegen 단계 직전의 \&quot;정규화된 구조\&quot;로, 플랫폼불문의 공통 인터페이스를 제공합니다.\n\n### 1. Overview\n\n#### IR_GOAL\n- AST의 복잡한 구조를 코드 생성하기 좋게 단순화\n- UI 컴포넌트 트리와 메타데이터를 정규화\n- 플랫폼불문(React/Next/Svelte) 공통 인터페이스로 변환\n- 모든 값은 최종적이고 확정된 형태만 유지\n\n#### INPUT\n- ASTRoot\n\n#### OUTPUT\n- IRRoot\n\n### 2. IR Root\n\n#### IRRoot\n&#96;&#96;&#96;typescript\n{\n  meta: IRMeta\n  style: IRStyle\n  components: IRComponents\n  layout: IRLayoutTree\n  script: IRScript\n}\n&#96;&#96;&#96;\n\n### 3. IRMeta (Final Document Metadata)\n\n#### IRMeta\n&#96;&#96;&#96;typescript\n{\n  title: string\n  route: string\n  theme: \&quot;light\&quot; | \&quot;dark\&quot;\n  description: string | null\n}\n&#96;&#96;&#96;\n\n#### Rules\n- missing values become null\n- enforce route starts with \&quot;/\&quot;\n\n### 4. IRStyle (Flattened Style Tokens)\n\n#### IRStyle\n&#96;&#96;&#96;typescript\n{\n  tokens: Record&lt;string, string | number&gt;\n}\n&#96;&#96;&#96;\n\n#### Examples\n&#96;&#96;&#96;typescript\n{\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n  \&quot;radius.default\&quot;: 8\n}\n&#96;&#96;&#96;\n\n#### Rules\n- dot-notation keys preserved\n- all values converted to primitive string/number\n- no validation here (semantic pass already done)\n\n### 5. IRComponents (Registered Component Map)\n\n#### IRComponents\n&#96;&#96;&#96;typescript\n{\n  list: string[]   // e.g. [\&quot;Card\&quot;, \&quot;Button\&quot;]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- duplicates removed\n- sorted alphabetically for deterministic output\n\n### 6. IRLayoutTree (Normalized UI Tree)\n\n#### IRLayoutTree\n&#96;&#96;&#96;typescript\n{\n  root: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### IRNode\n&#96;&#96;&#96;typescript\nIRNode = IRComponentNode | IRTextNode\n&#96;&#96;&#96;\n\n#### 6.1 IRComponentNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;component\&quot;\n  tag: string\n  attributes: Record&lt;string, string&gt;   // key:string only\n  children: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- attribute keys lower-case enforced\n- children always array\n- empty children =&gt; []\n\n#### 6.2 IRTextNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;text\&quot;\n  value: string\n}\n&#96;&#96;&#96;\n\n#### Rules\n- trimmed text preserved exactly\n- no newline allowed inside text\n\n### 7. IRScript (Event Map)\n\n#### IRScript\n&#96;&#96;&#96;typescript\n{\n  events: Record&lt;string, string&gt;   // onClick → \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Rules\n- all keys normalized to lower-case event names\n- event value must be string only\n- duplicates override earlier definitions\n\n### 8. AST → IR Mapping Rules\n\n1. **MetaNode → IRMeta**\n   - convert property array → object map\n   - apply default values if missing\n   - route must start with \&quot;/\&quot;\n\n2. **StyleNode → IRStyle**\n   - flatten list into tokens object\n   - preserve ordering but output sorted keys for determinism\n\n3. **ComponentsNode → IRComponents**\n   - convert component list → array\n   - remove duplicates\n   - sort alphabetically\n\n4. **LayoutNode → IRLayoutTree**\n   - recursively convert LayoutComponent → IRComponentNode\n   - convert LayoutText → IRTextNode\n   - inline attributes converted to plain object\n\n5. **ScriptNode → IRScript**\n   - property list flattened to event map\n   - enforce lower-case event names\n\n### 9. Example: Full IR Output\n\n#### DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### IR\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Home\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: null,\n    \&quot;description\&quot;: null\n  },\n\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n    }\n  },\n\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: []\n  },\n\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: { \&quot;class\&quot;: \&quot;p-4\&quot; },\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {}\n  }\n}\n&#96;&#96;&#96;\n\n### IR 구조 트리\n\n&#96;&#96;&#96;\nIRRoot\n├── meta (IRMeta)\n│   ├── title: string\n│   ├── route: string\n│   ├── theme: \&quot;light\&quot;|\&quot;dark\&quot;|null\n│   └── description: string|null\n├── style (IRStyle)\n│   └── tokens: Record&lt;string, string|number&gt;\n├── components (IRComponents)\n│   └── list: string[]\n├── layout (IRLayoutTree)\n│   └── root: IRNode[]\n│       ├── IRComponentNode\n│       │   ├── type: \&quot;component\&quot;\n│       │   ├── tag: string\n│       │   ├── attributes: Record&lt;string, string&gt;\n│       │   └── children: IRNode[]\n│       └── IRTextNode\n│           ├── type: \&quot;text\&quot;\n│           └── value: string\n└── script (IRScript)\n    └── events: Record&lt;string, string&gt;\n&#96;&#96;&#96;\n\n### IR Examples\n\n#### 간단한 IR 변환\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Simple\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: \&quot;light\&quot;,\n    \&quot;description\&quot;: null\n  },\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#000\&quot;,\n      \&quot;font.size\&quot;: 14\n    }\n  },\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: [\&quot;Button\&quot;]\n  },\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: {},\n        \&quot;children\&quot;: [\n          {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Content\&quot;}\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {\n      \&quot;onclick\&quot;: \&quot;handleClick\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 복잡한 중첩 레이아웃 IR\n&#96;&#96;&#96;json\n{\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Container\&quot;,\n        \&quot;attributes\&quot;: {\n          \&quot;class\&quot;: \&quot;flex flex-col min-h-screen\&quot;\n        },\n        \&quot;children\&quot;: [\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Header\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;p-4 bg-blue-600\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;H1\&quot;,\n                \&quot;attributes\&quot;: {},\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Dashboard\&quot;}\n                ]\n              }\n            ]\n          },\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Main\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;flex-1 p-6\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;Card\&quot;,\n                \&quot;attributes\&quot;: {\n                  \&quot;class\&quot;: \&quot;bg-white shadow-lg rounded\&quot;\n                },\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Welcome!\&quot;}\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- AST에 location 정보 누락 시 IR 변환 실패\n- route가 \&quot;/\&quot;로 시작하지 않을 경우 변환 시 강제 추가\n- 중복 컴포넌트 등록 시 알파벳 순 정렬로 중복 제거\n- 빈 children 배열을 null로 잘못 설정 시 []로 강제 변환\n- 텍스트 노드에 줄바꿈 포함 시 변환 중 제거 또는 오류\n- 이벤트 키 대소문자 혼재 시 소문자로 통일\n- 스타일 토큰 키 순서가 다를 경우 sorted keys로 결정적 출력 보장\n\n---\n\n## Codegen Rules\n\n### React/Next.js 15 Codegen\n\nIR을 기반으로 안정적인 UI 코드 생성 규칙입니다. React/Next.js 15 (App Router + RSC) 기준으로 IR을 실제 코드로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- IR을 기반으로 안정적인 UI 코드 생성\n- React/Next.js 15 (App Router + RSC) 기준\n- \&quot;디자인 시스템 없는 순수 Layout Tree\&quot;를 코드로 변환\n- 가능한 한 deterministic 하게 출력\n- 로직/상태/이벤트는 최소 수준으로만 개입\n\n##### INPUT\n- IRRoot\n\n##### OUTPUT\n- React Component Source Code (string)\n\n#### 2. Output Structure\n\n파일 구조는 다음 형태로 생성합니다:\n\n&#96;&#96;&#96;\n/page.tsx\n  - metadata (title, description)\n  - default export function Page()\n  - return(...) 내부에 layout tree 삽입\n\n/style-tokens.ts\n  - style.tokens flatten export\n\n/components/index.ts\n  - components registry export\n\n/script-events.ts\n  - event name string mapping export\n&#96;&#96;&#96;\n\n#### 3. Metadata Codegen\n\n##### UIH meta → Next.js metadata\n&#96;&#96;&#96;typescript\nIRMeta {\n  title: string\n  description: string\n}\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;typescript\nexport const metadata = {\n  title: \&quot;&lt;title&gt;\&quot;,\n  description: \&quot;&lt;description&gt;\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- description 없으면 필드 제외\n- theme는 metadata에 직접 쓰지 않음 (스타일토큰 용)\n\n#### 4. Style Token Codegen\n\n##### IRStyle { tokens }\n&#96;&#96;&#96;typescript\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;radius.default\&quot;: 8,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 키는 string 리터럴 그대로\n- numeric/string 그대로 출력\n- sorted keys for deterministic output\n\n#### 5. Component Registry Codegen\n\n##### IRComponents.list → export list\n&#96;&#96;&#96;typescript\nexport const components = {\n  Card,\n  Button,\n  Input,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 자동 import 하지 않음 (상위 시스템이 resolve)\n- keys는 PascalCase 유지\n- duplicates 제거 후 정렬\n\n#### 6. Layout Tree → JSX Codegen\n\n##### IRLayoutTree → React element tree\n\n##### 6.1 Component Node\n&#96;&#96;&#96;typescript\nIRComponentNode {\n  tag: \&quot;Div\&quot;\n  attributes: { class: \&quot;p-4\&quot; }\n  children: [...]\n}\n&#96;&#96;&#96;\n\n##### OUTPUT JSX\n&#96;&#96;&#96;jsx\n&lt;Div className=\&quot;p-4\&quot;&gt;\n  {children...}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n##### RULES\n- attribute.key \&quot;class\&quot; → \&quot;className\&quot;\n- attribute key는 그대로 lower-case 유지\n- value는 string literal\n- children length 0 이면 self-closing 금지 (always explicit block)\n- tag name 그대로 JSX 컴포넌트로 사용\n\n##### 6.2 Text Node\n&#96;&#96;&#96;typescript\nIRTextNode { value: \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;jsx\n{\&quot;Hello\&quot;}\n&#96;&#96;&#96;\n\n##### RULES\n- 텍스트는 JSX children 표현\n- 특수문자는 자동 escape\n\n#### 7. Script Event Codegen\n\n##### IRScript.events → export mapping\n&#96;&#96;&#96;typescript\nexport const eventHandlers = {\n  onClick: \&quot;submitForm\&quot;,\n  onLoad: \&quot;init\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- event 이름은 lower-case normalized\n- 값은 string (함수명)\n- 실제 JS 함수 body는 생성하지 않음\n- 나중 시스템이 자동 wire-up 함\n\n#### 8. Full Page Generation\n\n최종 page.tsx는 다음 구조를 따릅니다:\n\n&#96;&#96;&#96;typescript\nexport const metadata = { ... };\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen p-4\&quot;&gt;\n      &lt;P&gt;{\&quot;Hello\&quot;}&lt;/P&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### RULES\n- 최상위는 항상 &#96;&lt;Div&gt;&#96; 같은 Wrapper로 시작하지 않아도 됨\n- layout.root가 배열이면 Fragment로 감싼다\n- 코드 스타일은 2-space indent\n- 세미콜론 붙이지 않음 (Prettier 옵션 따라감)\n\n#### 9. Determinism Rules\n\n1. 속성 순서는 key 알파벳순 정렬\n2. children 순서는 DSL 입력 순서 그대로\n3. components 목록은 알파벳순 정렬\n4. styleTokens도 key 정렬\n5. eventHandlers key 정렬\n6. output JSX는 항상 multiline\n\n#### 10. Full Example (DSL → IR → JSX)\n\n##### DSL\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n##### JSX OUT\n&#96;&#96;&#96;typescript\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;p-4\&quot;&gt;\n      {\&quot;Hello\&quot;}\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n#### 11. Notes for Engine Integrators\n\n1. Codegen은 \&quot;순수 구조\&quot;만 책임진다\n   - 상태(state), fetch, useEffect 등은 지원하지 않음\n2. 이벤트 핸들러는 단순 라벨링 시스템\n3. 스타일 토큰은 UI 프레임워크에서 직접 해석\n4. React, Vue, Svelte 등 플랫폼별 코드젠 가능\n   - 플랫폼별 레이어는 분리\n\n#### Output Files 구조\n\n&#96;&#96;&#96;\nOutput Files\n├── page.tsx\n│   ├── metadata export\n│   ├── imports (components, styleTokens, eventHandlers)\n│   ├── Page() function\n│   └── JSX return (layout tree)\n├── style-tokens.ts\n│   └── styleTokens export\n├── components/index.ts\n│   └── components export\n└── script-events.ts\n    └── eventHandlers export\n&#96;&#96;&#96;\n\n#### Codegen Examples\n\n##### 전체 페이지 코드 생성 예시\n&#96;&#96;&#96;typescript\n// page.tsx\nexport const metadata = {\n  title: \&quot;Dashboard\&quot;,\n  description: \&quot;Main dashboard page\&quot;\n};\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen flex flex-col\&quot;&gt;\n      &lt;Header className=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n        &lt;H1&gt;\n          {\&quot;Dashboard\&quot;}\n        &lt;/H1&gt;\n      &lt;/Header&gt;\n      &lt;Main className=\&quot;flex-1 p-6\&quot;&gt;\n        &lt;Card className=\&quot;bg-white shadow-lg rounded-lg p-6\&quot;&gt;\n          &lt;P&gt;\n            {\&quot;Welcome back!\&quot;}\n          &lt;/P&gt;\n        &lt;/Card&gt;\n      &lt;/Main&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### 스타일 토큰 파일 예시\n&#96;&#96;&#96;typescript\n// style-tokens.ts\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;color.secondary\&quot;: \&quot;#6B7280\&quot;,\n  \&quot;color.accent\&quot;: \&quot;#F59E0B\&quot;,\n  \&quot;spacing.small\&quot;: 8,\n  \&quot;spacing.medium\&quot;: 16,\n  \&quot;spacing.large\&quot;: 24,\n  \&quot;border.radius\&quot;: 6,\n  \&quot;font.family\&quot;: \&quot;Inter\&quot;,\n  \&quot;font.size.base\&quot;: 16,\n  \&quot;shadow.default\&quot;: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n};\n&#96;&#96;&#96;\n\n##### 컴포넌트 레지스트리 예시\n&#96;&#96;&#96;typescript\n// components/index.ts\nexport const components = {\n  Button,\n  Card,\n  Input,\n  Modal,\n  Sidebar\n};\n&#96;&#96;&#96;\n\n##### 이벤트 핸들러 파일 예시\n&#96;&#96;&#96;typescript\n// script-events.ts\nexport const eventHandlers = {\n  onclick: \&quot;handleClick\&quot;,\n  onload: \&quot;initDashboard\&quot;,\n  onsubmit: \&quot;processForm\&quot;\n};\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- layout.root가 빈 배열일 경우 빈 Fragment 생성\n- 컴포넌트 이름이 JavaScript 예약어와 충돌 시 escaping 필요\n- 텍스트에 JSX 특수문자 포함 시 자동 escape\n- 중첩 깊이가 깊을 경우 코드 포맷팅 유지\n- import 경로 resolve 실패 시 상위 시스템에서 처리\n- styleTokens에 특수문자 키 포함 시 유효한 JS 객체 키로 변환\n\n---\n\n### Vue &amp; Svelte Codegen\n\nReact Codegen과 동일한 IR 기반으로 Vue와 Svelte 코드를 생성하는 규칙입니다. 플랫폼별 렌더링 규칙만 다르게 적용합니다.\n\n## SECTION A — Vue Codegen (SFC 기준)\n\n### GOAL\n- IR → .vue 파일 형태로 변환\n- &#96;&lt;template&gt;&#96; + &#96;&lt;script setup&gt;&#96; + &#96;&lt;style&gt;&#96; 구조 유지\n- 모든 로직은 배제하고 구조만 생성\n\n### OUTPUT FILE STRUCTURE\n&#96;&#96;&#96;\nMyPage.vue\n&#96;&#96;&#96;\n\n### 1. Top-Level Structure\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;!-- layout tree --&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport components...\n\nconst events = {...}\nconst styleTokens = {...}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* optional if needed */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Vue Template 규칙\n\n#### IRComponentNode(tag:\&quot;Div\&quot;, attributes, children)\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  &lt;!-- children --&gt;\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;className&#96; → &#96;class&#96;\n- attribute values: string only\n- children: 그대로 template로 변환\n- Fragment는 &#96;&lt;template&gt;&#96; 안에서 그냥 siblings로 출력\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello (그대로 text node)\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\neventHandlers {\n  onClick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Vue OUTPUT\n&#96;&#96;&#96;vue\n@click=\&quot;submitForm\&quot;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;onClick&#96; → &#96;@click&#96;\n- &#96;onChange&#96; → &#96;@change&#96;\n- &#96;onInput&#96; → &#96;@input&#96;\n- &#96;onLoad&#96; → &#96;@load&#96;\n- value는 함수 이름 string\n- 함수 구현은 생성하지 않음\n\n### 4. Component Registry (imports)\n&#96;&#96;&#96;javascript\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules\n- 속성(sorted)\n- imports(sorted)\n- children 순서 그대로\n- no semicolons\n- template 들여쓰기 2 spaces\n\n## SECTION B — Svelte Codegen (.svelte)\n\n### GOAL\n- Svelte 컴포넌트 파일 하나로 완성\n- &#96;&lt;script&gt;&#96; + markup 구조\n\n### OUTPUT STRUCTURE\n&#96;&#96;&#96;\nMyPage.svelte\n&#96;&#96;&#96;\n\n### 1. File Layout\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import components...\n  export let events = {...}\n  export let styleTokens = {...}\n&lt;/script&gt;\n\n&lt;!-- layout markup --&gt;\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  Hello\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* optional */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Svelte Markup\n\n#### IRComponentNode(tag, attributes, children)\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  {#if ... ?} (없음)\n  {children}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- 클래스는 &#96;class&#96;\n- 속성 문자열만\n- Self-closing 금지\n- children 재귀적 삽입\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\nIRScript:\nonClick → function name\n&#96;&#96;&#96;\n\n#### Svelte OUTPUT\n&#96;&#96;&#96;svelte\non:click={submitForm}\n&#96;&#96;&#96;\n\n#### Mapping\n&#96;&#96;&#96;\nonClick   → on:click\nonChange  → on:change\nonInput   → on:input\nonLoad    → on:load\n&#96;&#96;&#96;\n\n### 4. Components Import\n&#96;&#96;&#96;javascript\nimport Card from \&quot;./Card.svelte\&quot;;\nimport Button from \&quot;./Button.svelte\&quot;;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules (필수)\n\n1. import 순서는 알파벳 정렬\n2. attributes sorted\n3. event names lower-case\n4. children 순서 보존\n5. markup 들여쓰기 2 spaces\n\n## SECTION C — Cross-Platform Notes\n\n1. React / Vue / Svelte 모두 IR만 참조\n2. layout tree는 그대로 세 렌더러에서 재활용\n3. event handler는 단순 label → framework alias로 변환\n4. styleTokens는 컴파일러 외부 시스템이 처리\n5. components는 registry 기반으로 import만 생성\n\n## SECTION D — Example Conversion (Same IR → Vue/Svelte)\n\n### IR\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) { \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n### Vue Template\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Svelte Markup\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte 구조\n\n&#96;&#96;&#96;\nVue Output (.vue)\n├── &lt;template&gt;\n│   └── layout tree (Vue template syntax)\n├── &lt;script setup&gt;\n│   ├── component imports\n│   ├── events object\n│   └── styleTokens object\n└── &lt;style scoped&gt;\n    └── optional styles\n\nSvelte Output (.svelte)\n├── &lt;script&gt;\n│   ├── component imports\n│   ├── export let events = {...}\n│   └── export let styleTokens = {...}\n├── layout markup (Svelte syntax)\n└── &lt;style&gt;\n    └── optional styles\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte Examples\n\n#### Vue SFC 전체 예시\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n    &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n      &lt;H1&gt;\n        Dashboard\n      &lt;/H1&gt;\n    &lt;/Header&gt;\n    &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n      &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; @click=\&quot;handleCardClick\&quot;&gt;\n        &lt;P&gt;\n          Welcome back!\n        &lt;/P&gt;\n      &lt;/Card&gt;\n    &lt;/Main&gt;\n  &lt;/Div&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n\nconst events = {\n  handleCardClick: \&quot;handleCardClick\&quot;\n}\n\nconst styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;spacing.medium\&quot;: 16\n}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### Svelte 컴포넌트 전체 예시\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import Card from \&quot;./Card.svelte\&quot;;\n  import Button from \&quot;./Button.svelte\&quot;;\n\n  export let events = {\n    handleCardClick: \&quot;handleCardClick\&quot;\n  };\n\n  export let styleTokens = {\n    \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n    \&quot;spacing.medium\&quot;: 16\n  };\n&lt;/script&gt;\n\n&lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n  &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n    &lt;H1&gt;\n      Dashboard\n    &lt;/H1&gt;\n  &lt;/Header&gt;\n  &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n    &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; on:click={handleCardClick}&gt;\n      &lt;P&gt;\n        Welcome back!\n      &lt;/P&gt;\n    &lt;/Card&gt;\n  &lt;/Main&gt;\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### 이벤트 매핑 비교\n&#96;&#96;&#96;javascript\n// 동일한 IR 이벤트\n{\n  onClick: \&quot;handleClick\&quot;,\n  onChange: \&quot;handleChange\&quot;,\n  onLoad: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;vue\n&lt;!-- Vue --&gt;\n&lt;Button @click=\&quot;handleClick\&quot; @change=\&quot;handleChange\&quot; @load=\&quot;init\&quot;&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;svelte\n&lt;!-- Svelte --&gt;\n&lt;Button on:click={handleClick} on:change={handleChange} on:load={init}&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;jsx\n&lt;!-- React --&gt;\n&lt;Button onClick={handleClick} onChange={handleChange} onLoad={init}&gt;\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- Vue에서 컴포넌트 이름이 kebab-case로 변환 필요 시 자동 처리\n- Svelte에서 export let 구문이 예약어와 충돌 시 renaming\n- 이벤트 핸들러가 정의되지 않은 경우 플랫폼별 기본 동작\n- 스타일 토큰에 CSS 변수나 함수 포함 시 escaping\n- 중첩 컴포넌트 깊이가 깊을 경우 플랫폼별 최적화 적용\n- 텍스트 콘텐츠에 플랫폼별 특수문자 포함 시 자동 escape\n\n---\n\n## Examples\n\n### 완전한 UIH DSL 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;User Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main user dashboard with analytics\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  color.accent: \&quot;#F59E0B\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n  font.size.h1: 32\n  spacing.small: 8\n  spacing.medium: 16\n  spacing.large: 24\n  border.radius: 6\n  shadow.default: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n  Sidebar\n  Chart\n}\n\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto p-6\&quot;) {\n    Header(class:\&quot;mb-8\&quot;) {\n      Div(class:\&quot;flex justify-between items-center\&quot;) {\n        H1(class:\&quot;text-3xl font-bold\&quot;) {\n          \&quot;Dashboard\&quot;\n        }\n        Button(class:\&quot;px-4 py-2 bg-blue-600 text-white rounded\&quot;) {\n          \&quot;New Report\&quot;\n        }\n      }\n    }\n\n    Div(class:\&quot;grid grid-cols-3 gap-6\&quot;) {\n      Card(class:\&quot;col-span-2\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Analytics Overview\&quot;\n        }\n        Chart(class:\&quot;w-full h-64\&quot;)\n      }\n\n      Card(class:\&quot;col-span-1\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Quick Stats\&quot;\n        }\n        Div(class:\&quot;space-y-4\&quot;) {\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Total Users\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;1,234\&quot;\n            }\n          }\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Active Sessions\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;89\&quot;\n            }\n          }\n        }\n      }\n    }\n\n    Sidebar(class:\&quot;mt-8\&quot;) {\n      H3(class:\&quot;text-lg mb-4\&quot;) {\n        \&quot;Recent Activity\&quot;\n      }\n      Div(class:\&quot;space-y-2\&quot;) {\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;User john@example.com logged in\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;New report generated\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;System backup completed\&quot;\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onLoad: \&quot;initDashboard\&quot;\n  onClick: \&quot;handleButtonClick\&quot;\n  onRefresh: \&quot;refreshData\&quot;\n}\n&#96;&#96;&#96;\n\n### 최소 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Minimal Page\&quot;\n  route: \&quot;/minimal\&quot;\n  theme: \&quot;light\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  spacing.unit: 12\n}\n\nlayout {\n  Div(class:\&quot;min-h-screen flex items-center justify-center bg-gray-50\&quot;) {\n    \&quot;Coming soon\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n### Form 중심 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Sign Up\&quot;\n  route: \&quot;/signup\&quot;\n  theme: \&quot;light\&quot;\n  description: \&quot;Create a new account\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#2563EB\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n}\n\ncomponents {\n  Form\n  Input\n  Button\n  Alert\n}\n\nlayout {\n  Section(class:\&quot;min-h-screen flex items-center justify-center bg-gray-100\&quot;) {\n    Form(class:\&quot;w-full max-w-md space-y-6 bg-white p-8 rounded-xl shadow-lg\&quot;) {\n      H2(class:\&quot;text-2xl font-semibold text-gray-900\&quot;) {\n        \&quot;Create your account\&quot;\n      }\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;email\&quot;, placeholder:\&quot;Enter email\&quot;)\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;password\&quot;, placeholder:\&quot;Enter password\&quot;)\n      Button(class:\&quot;w-full bg-blue-600 text-white py-3 rounded-lg\&quot;) {\n        \&quot;Sign up\&quot;\n      }\n      Alert(class:\&quot;text-sm text-gray-500 text-center\&quot;) {\n        \&quot;By signing up you agree to our terms\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onSubmit: \&quot;handleSignup\&quot;\n  onLoad: \&quot;prefillFromInvite\&quot;\n}\n&#96;&#96;&#96;\n\n### 콘텐츠 피드 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Creator Feed\&quot;\n  route: \&quot;/feed\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Realtime creator activity feed\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#22D3EE\&quot;\n  color.background: \&quot;#0F172A\&quot;\n  font.family: \&quot;Space Grotesk\&quot;\n  spacing.medium: 20\n  radius.card: 12\n}\n\ncomponents {\n  Shell\n  Sidebar\n  Feed\n  FeedItem\n  Avatar\n  Badge\n}\n\nlayout {\n  Shell(class:\&quot;min-h-screen bg-slate-950 text-slate-100\&quot;) {\n    Sidebar(class:\&quot;w-64 border-r border-slate-800 p-6 space-y-6\&quot;) {\n      H1(class:\&quot;text-xl font-semibold tracking-tight\&quot;) {\n        \&quot;Creator Hub\&quot;\n      }\n      Badge(class:\&quot;inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 text-slate-200\&quot;) {\n        \&quot;Live updates\&quot;\n      }\n    }\n    Feed(class:\&quot;flex-1 p-8 space-y-6\&quot;) {\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-cyan-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;heymina.studio\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-300\&quot;) {\n              \&quot;New drop\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Dropped a limited neon kit — 120 packs sold out in 3 minutes.\&quot;\n          }\n        }\n      }\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-pink-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;luvv.wav\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-cyan-500/10 text-cyan-300\&quot;) {\n              \&quot;Stream recap\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Hit 18,245 live viewers tonight — chat requested a synthwave encore.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onRefresh: \&quot;fetchLatestFeed\&quot;\n  onClick: \&quot;openCreatorProfile\&quot;\n}\n&#96;&#96;&#96;\n\n---\n\n## Version\n\n- **Version**: 1.0.0\n- **Last Update**: 2025-11-18\n- **Change Summary**: Complete guide consolidating all UIH DSL specifications\n\n---\n\n## 문서 끝\n\n이 문서는 UIH DSL의 모든 스펙을 \&quot;생략 없이\&quot; 하나의 파일로 통합한 완전판입니다. Foundation Layer부터 Codegen까지 전 과정을 포함하며, LLM이 UI를 정확하게 선언할 수 있도록 설계된 모든 규칙이 담겨 있습니다.\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating script block example case**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;99a4e116-5f79-44b8-8648-242bdbd11a43&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  \n  script {\n-   onLoad: \&quot;initDashboard\&quot;\n-   onSubmit: \&quot;handleForm\&quot;\n-   onRefresh: \&quot;reloadData\&quot;\n+   onload: \&quot;initDashboard\&quot;\n+   onsubmit: \&quot;handleForm\&quot;\n+   onrefresh: \&quot;reloadData\&quot;\n  }\n  &#96;&#96;&#96;&quot;,
        &quot;oldStart&quot;: 895,
        &quot;newStart&quot;: 895,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 7,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 3
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;,
  &quot;contentsAfterEdit&quot;: &quot;# UIH DSL — Complete Guide (생략 없는 완전판)\n\n## Table of Contents\n\n1. [Overview](#overview)\n2. [Philosophy &amp; Design Principles](#philosophy--design-principles)\n3. [Foundation Layer](#foundation-layer)\n4. [Tokenizer Specification](#tokenizer-specification)\n5. [Grammar](#grammar)\n   - [Block Grammar](#block-grammar)\n   - [Property Grammar](#property-grammar)\n   - [Layout Tree Grammar](#layout-tree-grammar)\n   - [Parser BNF Grammar](#parser-bnf-grammar)\n6. [AST Schema Definition](#ast-schema-definition)\n7. [IR (Intermediate Representation) Specification](#ir-intermediate-representation-specification)\n8. [Codegen Rules](#codegen-rules)\n   - [React/Next.js 15 Codegen](#reactnextjs-15-codegen)\n   - [Vue &amp; Svelte Codegen](#vue--svelte-codegen)\n9. [Examples](#examples)\n10. [Version](#version)\n\n---\n\n## Overview\n\nUIH DSL (Universal Interface Hierarchy Domain Specific Language) v2는 **\&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;**를 목표로 하는 도메인 특화 언어입니다.\n\n### 핵심 목표\n- LLM이 UI 구조를 **정확하게** 선언할 수 있도록 설계\n- 모호성 제거 및 결정성(determinism) 보장\n- 사람보다 AI가 더 효과적으로 사용 가능한 DSL\n- UI 구조의 선언적 표현에 집중\n\n### 아키텍처 흐름\n&#96;&#96;&#96;\nDSL 문자열 → Tokenizer → Parser → AST → IR → Codegen → React/Vue/Svelte 코드\n&#96;&#96;&#96;\n\n### 주요 특징\n- 한 줄에 하나의 의미만 (One-intent-per-line)\n- 선택적 문법 금지 - 모든 것이 명시적\n- 쌍따옴표만 허용, 세미콜론 없음\n- 주석 지원 안 함 (모호성 제거)\n- 고정 블록 순서: meta → style → components → layout → script\n\n---\n\n## Philosophy &amp; Design Principles\n\nUIH DSL은 \&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;를 목표로 하는 도메인 특화 언어입니다. 사람보다 LLM이 더 효과적으로 사용할 수 있도록 설계되었으며, UI 구조의 선언적 표현에 집중합니다.\n\n### 1. LLM 친화적 설계 원칙\n\nLLM이 읽고 쓰기 편한 DSL을 지향합니다. 구조는 최대한 명확하고 모호성이 없으며, 선택적 문법을 금지합니다. LLM이 패턴을 쉽게 반복할 수 있는 형태로 자연어 번역 난이도를 낮췄습니다.\n\n### 2. 선언적 UI 설계\n\nUI는 로직 기반보다 구조 기반으로 설계합니다. \&quot;무엇을 만든다\&quot;에 집중하며 \&quot;어떻게 만든다\&quot;는 Codegen이 담당합니다. 상태, 이벤트, 애니메이션은 추상화 계층으로 밀어냅니다.\n\n### 3. 한 줄 한 의미 원칙 (One-intent-per-line)\n\n한 라인에 하나의 의미만 허용합니다. 한 줄에 두 개 의미를 섞으면 LLM이 실수할 가능성이 높아집니다.\n\n#### 좋은 예: 한 줄 한 의미\n&#96;&#96;&#96;dsl\nmeta:\n  title: \&quot;Home\&quot;\n\nmeta:\n  route: \&quot;/\&quot;\n&#96;&#96;&#96;\n\n#### 나쁜 예: 한 줄 다중 의미 (금지)\n&#96;&#96;&#96;dsl\nmeta: title: \&quot;Home\&quot;, route: \&quot;/\&quot;  # 잘못된 예\n&#96;&#96;&#96;\n\n### 4. 고정 블록 순서\n\n블록 구조는 **meta → style → components → layout → script** 순서를 유지합니다. 이 순서는 LLM이 외우기 쉽고 Codegen의 예측 가능성과 AST의 결정성을 보장합니다.\n\n### 5. 최소 표현, 최대 의미\n\nDSL은 짧고 규칙적이어야 합니다. CSS-like verbose, YAML 계층 증가, JSX 로직 섞임을 금지합니다. 의미 전달에 집중하는 최소 선언적 DSL입니다.\n\n### 6. 오류 제로 문법\n\n\&quot;AI가 틀릴 수 없는 언어\&quot;를 목표로 합니다. 쌍따옴표만 허용하고 세미콜론 없이 콜론만 사용합니다. 모든 키는 고정된 string literal이며 optional field를 최소화합니다.\n\n### 7. AST 1:1 매핑\n\n모든 UI 요소가 AST에 직접 매핑됩니다. meta 블록 → MetaNode, style 블록 → StyleNode, layout 블록 → LayoutTree로 변환됩니다.\n\n### 8. 기계 친화적 우선\n\n\&quot;사람이 읽으면 조금 불편할 것\&quot; 정도가 적정 수준입니다. 사람 UX보다 AI 정확성을 우선합니다.\n\n---\n\n## Foundation Layer\n\nUIH DSL의 가장 낮은 레벨 사양입니다. Character부터 Ordering까지의 기본 규칙을 정의하며, LLM이 실수할 수 없는 엄격한 문법을 제공합니다.\n\n### 1. Character Layer (문자 규칙)\n\n#### ALLOWED_CHARACTERS\n- a~z (lowercase alphabets)\n- 0~9 (digits)\n- hyphen (-)\n- underscore (_)\n- space ( )\n- newline (\\n)\n- braces: { }\n- colon (:)\n- double-quote (\&quot;)\n\n#### DISALLOWED_CHARACTERS\n- single-quote (&#39;)\n- semicolon (;)\n- parentheses ()\n- backtick (&#96;)\n- tab (\\t)\n- CRLF (\\r\\n)\n\n#### NEWLINE\n- always LF (\\n)\n- CRLF not supported\n\n### 2. Indentation Layer (들여쓰기 규칙)\n\n#### INDENTATION\n- exactly 2 spaces ONLY\n- tabs NOT allowed\n- indentation increases only inside a block\n- indentation does not imply hierarchy (not YAML)\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {           // ❌ 탭 사용 금지\n  title: \&quot;Home\&quot;  // ✅ 정확히 2 space\n}\n&#96;&#96;&#96;\n\n### 3. Token Layer (토큰 기본 규칙)\n\n#### TOKENS\n- IDENTIFIER = &#96;[a-z][a-z0-9.]*&#96;\n- STRING = &#96;\&quot;[^\&quot;\\\\]*(?:\\\\.[^\&quot;\\\\]*)*\&quot;&#96; (supports &#96;\\\&quot;&#96; escape)\n- NUMBER = &#96;\\d+(?:\\.\\d+)?&#96;\n- LBRACE = &#96;{&#96;\n- RBRACE = &#96;}&#96;\n- COLON = &#96;:&#96;\n- NEWLINE = &#96;\\n&#96;\n- WHITESPACE = single space\n\n#### IDENTIFIER_RULES\n- lowercase only\n- dot notation allowed (e.g. &#96;color.primary&#96;)\n- do NOT mix hyphens inside identifiers (LLM error-prone)\n\n#### STRING_RULES\n- must use double quotes only\n- escaping uses &#96;\\\&quot;&#96;\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {\n  color.primary: \&quot;#fff\&quot;    // ✅ dot notation 허용\n  label: \&quot;Click \\\&quot;here\\\&quot;\&quot;  // ✅ escape 허용\n  width: 100.5            // ✅ 소수 허용\n}\n&#96;&#96;&#96;\n\n### 4. Comment Layer (코멘트)\n\n#### COMMENTS\n- comments NOT supported\n- any attempt to use &#96;//&#96; or &#96;#&#96; is invalid\n- purpose: reduce ambiguity for LLM\n\n### 5. Statement Layer (기본 문장 구조)\n\n#### STATEMENT_TYPES\n- Block Declaration\n- Property Declaration\n\n#### BLOCK_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt; {\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n#### PROPERTY_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n#### SEMICOLON\n- NOT allowed (never used)\n\n### 6. Block Layer (블록 기본 규칙)\n\n#### BLOCK_STRUCTURE\n&#96;&#96;&#96;\nblockName {\n  property: \&quot;value\&quot;\n  property: 123\n  property: true\n}\n&#96;&#96;&#96;\n\n#### BLOCK_RULES\n- block cannot contain nested blocks\n- ONLY layout block may contain nested layout nodes\n\n### 7. Ordering Layer (순서 강제)\n\n#### BLOCK_ORDER\n1. meta\n2. style\n3. components (optional)\n4. layout\n5. script (optional)\n\n#### RULE\n- if a block appears, must follow this order\n- missing blocks are allowed except meta/style/layout\n\n### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  primary-color: \&quot;#111\&quot;\n}\n\ncomponents {\n  Button {\n    variant: \&quot;primary\&quot;\n  }\n}\n\nlayout {\n  Container {\n    children: \&quot;Button\&quot;\n  }\n}\n\nscript {\n  // optional script\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단\n- 잘못된 들여쓰기 발견 시 구문 오류\n- 코멘트 시도 시 즉시 무효 처리\n- 블록 순서 위반 시 파싱 실패\n- layout 외 중첩 블록 시도 시 오류\n\n---\n\n## Tokenizer Specification\n\nFoundation Layer + Grammar Layers 기반의 공식 토큰화 규칙입니다. DSL 문자열을 균일한 Token 리스트로 변환하며, 모든 파싱의 기반이 됩니다.\n\n### 1. Tokenizer Overview\n\n#### PURPOSE\n- DSL 문자열을 균일한 Token 리스트로 변환\n- 모호성 없는 deterministic token stream 생성\n- 모든 파싱은 이 토큰 리스트 기반으로 진행\n\n#### INPUT\n- LF 기반의 DSL 문자열\n\n#### OUTPUT\n- 순차적 Token 배열\n\n### 2. Token Types\n\n#### TOKENS\n- &#96;IDENTIFIER&#96; - meta, title, color.primary, class 등\n- &#96;STRING&#96; - \&quot;Hello\&quot;\n- &#96;NUMBER&#96; - 0, 12, 0.8\n- &#96;BOOLEAN&#96; - true, false\n- &#96;LBRACE&#96; - {\n- &#96;RBRACE&#96; - }\n- &#96;LPAREN&#96; - (\n- &#96;RPAREN&#96; - )\n- &#96;COLON&#96; - :\n- &#96;COMMA&#96; - ,\n- &#96;NEWLINE&#96; - \\n\n- &#96;WHITESPACE&#96; - space (only used between tokens)\n- &#96;TEXT_STRING&#96; - layout children string ONLY (disambiguation)\n- &#96;EOF&#96; - end of file marker\n\n### 3. Identifier Detection\n\n#### IDENTIFIER_RULES\n- regex: &#96;^[a-z][a-z0-9.]*$&#96;\n- lowercase only\n- dot notation allowed\n- hyphens, underscores 금지\n\n#### TAGNAME_RULES\n- starts with uppercase letter\n- subsequent chars: &#96;[a-zA-Z0-9]&#96;\n- TagName (e.g. Div, Header) 구분용\n\n#### TAGNAME_EXAMPLES\n&#96;&#96;&#96;\nDiv\nSection\nImage\nH1\n&#96;&#96;&#96;\n\n### 4. String Token Rules\n\n#### STRING\n- starts with &#96;\&quot;&#96;\n- ends with &#96;\&quot;&#96;\n- inside supports &#96;\\\&quot;&#96;\n- no multi-line\n\n#### TEXT_STRING\n- STRING과 동일한 문법\n- 단, layout children context에서만 등장\n- Parser에서 context-aware로 구분\n\n### 5. Number Token Rules\n\n#### NUMBER\n- regex: &#96;^[0-9]+(\\.[0-9]+)?$&#96;\n- no negative numbers\n- no units (px, rem 등)\n\n### 6. Boolean Token Rules\n\n#### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n- strictly lowercase\n\n### 7. Brace / Symbol Tokens\n\n#### SYMBOL_TOKENS\n- &#96;LBRACE&#96;: &#96;{&#96;\n- &#96;RBRACE&#96;: &#96;}&#96;\n- &#96;LPAREN&#96;: &#96;(&#96;\n- &#96;RPAREN&#96;: &#96;)&#96;\n- &#96;COLON&#96;: &#96;:&#96;\n- &#96;COMMA&#96;: &#96;,&#96;\n\n#### NOTES\n- semicolon NOT allowed\n- backtick NOT allowed\n\n### 8. Whitespace / Newline Rules\n\n#### WHITESPACE\n- single space &#96;&#39; &#39;&#96;\n- no tabs\n- no multi-space sequences except indentation (2 spaces)\n\n#### NEWLINE\n- LF only\n- CRLF invalid\n\n### 9. Layout Context Rules (Critical)\n\n#### LAYOUT_MODE\nTokenizer enters layout-mode when encountering:\n&#96;&#96;&#96;\nlayout { … }\n&#96;&#96;&#96;\n\n#### CONTEXT_SWITCH\n- after TagName(\n- before encountering next node or text\n\n#### INSIDE_LAYOUT_BLOCK\n- children detection required\n- plain strings must become TEXT_STRING token\n- siblings separated by NEWLINE\n\n#### EXAMPLE\n&#96;&#96;&#96;\n\&quot;Welcome\&quot; → TEXT_STRING inside layout\n&#96;&#96;&#96;\n\n### 10. Tokenization Algorithm (High-Level)\n\n1. iterate through chars\n2. skip whitespace unless meaningful (indent)\n3. detect IDENTIFIER or TAGNAME\n4. detect STRING (with escape)\n5. detect NUMBER\n6. detect BOOLEAN\n7. detect braces &#96;{ }&#96;\n8. detect parentheses &#96;( )&#96;\n9. detect colon &#96;:&#96; or comma &#96;,&#96;\n10. detect newline &#96;\\n&#96;\n11. maintain context stack:\n    - normal\n    - inside layout block\n    - inside attributes\n12. output final EOF token\n\n### 11. Example Token Stream\n\n#### INPUT\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### OUTPUT_TOKENS\n&#96;&#96;&#96;\nIDENTIFIER(layout)\nLBRACE\nNEWLINE\nTAGNAME(Div)\nLPAREN\nIDENTIFIER(class)\nCOLON\nSTRING(\&quot;p-4\&quot;)\nRPAREN\nLBRACE\nNEWLINE\nTEXT_STRING(\&quot;Hello\&quot;)\nNEWLINE\nRBRACE\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Token Stream Examples\n\n#### 기본 블록 토큰화\n&#96;&#96;&#96;dsl\nmeta {\n  title: \&quot;Home\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(meta)\nLBRACE\nNEWLINE\nIDENTIFIER(title)\nCOLON\nSTRING(\&quot;Home\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n#### 스타일 블록 토큰화\n&#96;&#96;&#96;dsl\nstyle {\n  color.primary: \&quot;#fff\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(style)\nLBRACE\nNEWLINE\nIDENTIFIER(color.primary)\nCOLON\nSTRING(\&quot;#fff\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단 및 오류 반환\n- CRLF 줄바꿈 발견 시 LF로 변환 또는 오류\n- 탭 문자 발견 시 공백 변환 또는 오류\n- STRING에서 미닫힘 따옴표 시 오류\n- NUMBER에 음수나 단위 포함 시 오류\n- layout 외 컨텍스트에서 TEXT_STRING 시도 시 오류\n- TAGNAME 규칙 위반 (소문자 시작) 시 IDENTIFIER로 처리\n\n---\n\n## Grammar\n\n### Block Grammar\n\nUIH DSL의 최상위 구조를 정의하는 Block Grammar Layer입니다. Foundation Layer 바로 위에 위치하며, 5개 블록의 선언, 순서, 내용 규칙을 명시합니다.\n\n#### 1. Block Definitions (5개 블록)\n\n##### BLOCKS\n- meta\n- style\n- components (optional)\n- layout\n- script (optional)\n\n##### RULES\n- 블록은 반드시 이 순서를 따라야 함: meta → style → components → layout → script\n- meta, style, layout은 필수\n- components, script는 선택\n- 각 블록은 정확히 한 번만 등장\n- 중복 블록 금지\n\n#### 2. Block Syntax (기본 문법)\n\n##### BLOCK_SYNTAX\n&#96;&#96;&#96;\n&lt;blockName&gt; {\n  &lt;property&gt;: &lt;value&gt;\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n&#96;&#96;&#96;\n\n##### SYNTAX_COMPONENTS\n- 블록 시작: IDENTIFIER + &#96; {&#96;\n- 블록 끝: &#96;}&#96; 단독 줄\n\n#### 3. Block Content Rules\n\n##### 공통 규칙\n- 블록 내부에는 property statements만 존재\n- block 내부에 block 중첩 금지\n- 단, layout 블록만 예외적으로 UI tree 구조 허용\n\n##### PROPERTY_RULE\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### VALUE_TYPES\n- string\n- number\n- boolean\n- enum-like literals (string 값)\n- list (향후 정의)\n\n#### 4. Block-Specific Rules\n\n##### (1) META BLOCK\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Page title\&quot;\n  route: \&quot;/path\&quot;\n  theme: \&quot;light\&quot;|\&quot;dark\&quot;\n}\n&#96;&#96;&#96;\n\n**META_RESTRICTIONS:**\n- meta는 UI 문서의 metadata만 포함\n- layout 정보나 스타일 정보 포함 금지\n\n##### (2) STYLE BLOCK\n&#96;&#96;&#96;\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n}\n&#96;&#96;&#96;\n\n**STYLE_RESTRICTIONS:**\n- key는 dot notation 사용 가능\n- 값은 string 또는 number\n- layout 관련 속성 금지\n- theme override 불가\n\n##### (3) COMPONENTS BLOCK (optional)\n&#96;&#96;&#96;\ncomponents {\n  Card\n  Button\n  Input\n}\n&#96;&#96;&#96;\n\n**COMPONENTS_RULES:**\n- 등록할 컴포넌트 이름만 줄 단위로 나열\n- 중첩 구조 없음\n- 속성 없음\n- 문자열 아님: &#96;\&quot;Card\&quot;&#96; 금지, &#96;Card&#96;만 허용\n\n##### (4) LAYOUT BLOCK\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n**LAYOUT_RULES:**\n- 유일하게 중첩 구조 허용\n- 노드 문법은 별도 Layer에서 정의\n- property는 inline attribute 형태 가능\n- block-like structure 유지\n\n##### (5) SCRIPT BLOCK (optional)\n&#96;&#96;&#96;\nscript {\n  onclick: \&quot;submitForm\&quot;\n  onload: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n**SCRIPT_RESTRICTIONS:**\n- event/behavior mapping만 정의\n- JS code 삽입 금지\n- inline function 금지\n- event identifier는 반드시 lowercase (camelCase 금지)\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n  spacing.unit: 8\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n}\n\nlayout {\n  Div(class:\&quot;container mx-auto p-4\&quot;) {\n    Card(class:\&quot;bg-white shadow-lg\&quot;) {\n      Button(onclick:\&quot;handleSubmit\&quot;) {\n        \&quot;Submit\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;processForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 파싱 실패\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유효 (경고)\n- components/script 외 블록에서 중첩 시도 시 오류\n- layout 외 블록에서 attribute 사용 시 오류\n\n---\n\n### Property Grammar\n\nUIH DSL 안정성의 핵심인 Property Grammar Layer입니다. Block Grammar 위에 쌓이며, 속성 선언, 값 타입, 범위 규칙을 정의합니다.\n\n#### 1. Property Declaration Syntax\n\n##### PROPERTY_SYNTAX\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\nradius.default: 8\nenabled: true\n&#96;&#96;&#96;\n\n##### RULES\n- identifier는 반드시 lowercase\n- dot notation 허용 (&#96;color.primary&#96; 등)\n- colon(:) 뒤에는 반드시 space 1개\n- value는 줄 끝까지\n\n#### 2. Identifier Rules\n\n##### IDENTIFIER\n- 패턴: &#96;[a-z][a-z0-9.]*&#96;\n- 소문자만 허용\n- 숫자는 뒤쪽에만 허용\n- dot(.)은 중첩 속성 의미로만 사용\n- hyphen 금지 (LLM 오류 방지)\n- underscore 금지\n\n##### VALID\n&#96;&#96;&#96;\ncolor.primary\nfont.size\nborder.width\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nColor.Primary    // 대문자\nfont-size        // hyphen\nfont_size        // underscore\nprimary2.color   // 숫자 앞쪽\n&#96;&#96;&#96;\n\n#### 3. Value Types (5가지)\n\n##### VALUE_TYPES\n1. STRING\n2. NUMBER\n3. BOOLEAN\n4. ENUM-LIKE (string 기반)\n5. LIST (여러 값 나열, 줄 단위)\n\n#### 4. String Value Rules\n\n##### STRING\n- 무조건 double-quote 사용\n- 내부에 &#96;\&quot;&#96; 포함 시 &#96;\\\&quot;&#96;로 escape\n- single-quote 절대 금지\n\n##### VALID\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\ndescription: \&quot;He said \\\&quot;ok\\\&quot;\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\ntitle: &#39;Home&#39;      // single-quote\nname: \&quot;Home\&quot;       // curly quotes\n&#96;&#96;&#96;\n\n#### 5. Number Value Rules\n\n##### NUMBER\n- 정수 또는 소숫점 가능\n- 음수는 허용하지 않음\n- 단위(px 등) 금지 → unitless 구조\n\n##### VALID\n&#96;&#96;&#96;\nradius: 12\nopacity: 0.85\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nradius: -4     // 음수\nwidth: 10px    // 단위 포함\n&#96;&#96;&#96;\n\n#### 6. Boolean Value Rules\n\n##### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nenabled: true\nvisible: false\n&#96;&#96;&#96;\n\n#### 7. Enum-like String Rules\n\n##### ENUM_STRING\n- 문자열이지만 값이 고정된 타입처럼 쓰는 케이스\n- allowed values는 별도 block schema마다 정의\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntheme: \&quot;light\&quot; | \&quot;dark\&quot;\nsize: \&quot;sm\&quot; | \&quot;md\&quot; | \&quot;lg\&quot;\n&#96;&#96;&#96;\n\n#### 8. List Value (Block-like list)\n\n##### LIST\n- 각 항목은 줄 단위로 입력\n- 대괄호 &#96;[]&#96; 문법 없음 (LLM 오류 방지)\n- 문자열/식별자 혼용 가능\n\n##### SYNTAX\n&#96;&#96;&#96;\nitems {\n  \&quot;one\&quot;\n  \&quot;two\&quot;\n  \&quot;three\&quot;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- list block 내부에는 property 없음\n- indent 2 spaces 유지\n\n##### EXAMPLE\n&#96;&#96;&#96;\ntags {\n  \&quot;news\&quot;\n  \&quot;feature\&quot;\n  \&quot;announcement\&quot;\n}\n&#96;&#96;&#96;\n\n#### 9. Property Scope Rules (Block별 허용 속성 경계)\n\n##### META_SCOPE\n- meta는 UI metadata만 포함\n- route, title, theme, description 등\n\n##### STYLE_SCOPE\n- 색상, 폰트, radius 등 UI 스타일만\n- layout 속성 금지 (width, height 등은 layout block에서만)\n\n##### COMPONENTS_SCOPE\n- property 없음 (등록만)\n\n##### LAYOUT_SCOPE\n- inline attribute만 (class, id, ref 등)\n- 값은 무조건 string\n- boolean/number 사용 금지\n\n##### SCRIPT_SCOPE\n- event mapping 전용\n- 값은 무조건 string\n\n#### 10. Final Validation Rules\n\n1. 모든 property는 블록 내부에서만 존재\n2. 같은 identifier 중복 선언 금지\n3. meta/style/script는 property-only 구조\n4. components는 선언만 (property 없음)\n5. layout만 child nodes 보유 가능\n6. value의 타입은 block-specific rule을 반드시 준수\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main dashboard page\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  border.radius: 8\n  spacing.unit: 16\n}\n\ncomponents {\n  Card\n  Button\n  Input\n}\n\nlayout {\n  class: \&quot;container\&quot;\n  id: \&quot;main-content\&quot;\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;handleForm\&quot;\n  onrefresh: \&quot;reloadData\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 대문자 identifier 사용 시 토큰화 실패\n- hyphen/underscore 사용 시 구문 오류\n- single-quote나 curly quotes 사용 시 파싱 실패\n- 음수나 단위 포함 숫자 시 값 오류\n- 블록별 스코프 위반 시 validation 실패\n- 중복 property 선언 시 마지막 값만 유효 (경고)\n\n---\n\n### Layout Tree Grammar\n\nUIH DSL의 핵심 구조인 Layout Tree Grammar Layer입니다. Block Grammar와 Property Grammar 위에서 동작하며, UI 구성 요소의 트리 구조를 정의합니다.\n\n#### 1. Layout Block Overview\n\n##### LAYOUT_BLOCK\n&#96;&#96;&#96;\nlayout {\n  &lt;layout-node&gt;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- DSL에서 유일하게 중첩 구조를 가질 수 있는 블록\n- 모든 UI 구성 요소는 layout node로 표현\n- 노드는 \&quot;구조\&quot;만 표현, 스타일/로직은 표현하지 않음\n\n#### 2. Layout Node Syntax\n\n##### NODE_SYNTAX\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;) {\n  &lt;children&gt;\n}\n&#96;&#96;&#96;\n\n##### OR (children 없는 경우)\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;)\n&#96;&#96;&#96;\n\n##### NOTES\n- TagName은 PascalCase 컴포넌트 또는 HTML-like 사용 가능\n- attributes는 inline 형태 only\n- attributes는 옵션, 없어도 됨\n- children 블록은 중첩 가능\n\n##### VALID\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) {\n  \&quot;Hello\&quot;\n}\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nDiv {\n  class: \&quot;p-4\&quot;    // 속성은 block 기반이 아니라 inline only\n}\n&#96;&#96;&#96;\n\n#### 3. TagName Rules\n\n##### TAGNAME\n- 반드시 알파벳으로 시작\n- PascalCase 또는 UpperCamelCase 권장\n- HTML-like 소문자 태그는 사용 가능 (&#96;div&#96;, &#96;span&#96;) 단 내부적으로는 UpperCase 변환됨\n\n##### VALID\n&#96;&#96;&#96;\nDiv\nSection\nImage\nheader   // 허용하지만 변환 시 Header로 취급\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n3Div     // 숫자 시작\n_Box     // underscore 시작\n-Node    // hyphen 시작\n&#96;&#96;&#96;\n\n#### 4. Attribute Syntax\n\n##### ATTRIBUTES\n&#96;&#96;&#96;\n&lt;identifier&gt;:\&quot;&lt;string&gt;\&quot;\n&#96;&#96;&#96;\n\n##### RULES\n- value는 무조건 string only\n- boolean/number 금지\n- &#96;class:\&quot;p-4\&quot;&#96; 형태처럼 inline만 허용\n- 각 attribute는 콤마(&#96;,&#96;)로 구분\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;, id:\&quot;main\&quot;, ref:\&quot;root\&quot;)\n&#96;&#96;&#96;\n\n##### STRICT_RULES\n- 속성 순서는 의미 없음 (LLM 실수 방지로 자유 순서)\n- attribute key는 lower-case only\n- 속성 개수 0~5 정도 권장\n\n#### 5. Children Rules\n\n##### CHILD_TYPES\n- string literal\n- another layout node\n- list of siblings (node 여러 개 배치)\n\n##### STRING_CHILD\n&#96;&#96;&#96;\n\&quot;Hello world\&quot;\n&#96;&#96;&#96;\n\n##### NESTED_NODE\n&#96;&#96;&#96;\nDiv(class:\&quot;mt-4\&quot;) {\n  \&quot;content\&quot;\n}\n&#96;&#96;&#96;\n\n##### SIBLINGS\n&#96;&#96;&#96;\nDiv(...) { ... }\nP(...) { ... }\nImage(...)\n&#96;&#96;&#96;\n\n#### 6. Text Node Rules\n\n##### TEXT_NODE\n- 무조건 double-quote string\n- 줄바꿈 포함 금지\n- 텍스트 덩어리는 여러 줄로 쪼개면 안 됨\n\n##### VALID\n&#96;&#96;&#96;\n\&quot;Sign in to continue\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n\&quot;Hello\n World\&quot;    // 줄바꿈 포함\n&#96;&#96;&#96;\n\n#### 7. Node Termination Rules\n\n##### CLOSING_RULES\n- 블록 노드는 반드시 &#96;}&#96; 단독 줄로 닫는다\n- inline-only 노드는 종료 블록 없음\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;px-4\&quot;) {\n  P {\n    \&quot;Hello\&quot;\n  }\n  Image(src:\&quot;/logo.png\&quot;)\n}\n&#96;&#96;&#96;\n\n#### 8. Layout Grammar Formal Pattern\n\n##### LAYOUT_NODE_GRAMMAR\n&#96;&#96;&#96;\nNode:\n  Tag (Attributes?) (ChildrenBlock?)\n\nTag:\n  IDENTIFIER\n\nAttributes:\n  \&quot;(\&quot; AttributeList \&quot;)\&quot;\n\nAttributeList:\n  Attribute (\&quot;,\&quot; Attribute)*\n\nAttribute:\n  IDENTIFIER \&quot;:\&quot; STRING\n\nChildrenBlock:\n  \&quot;{\&quot; NewLine Indented(NodeOrText)+ \&quot;}\&quot;\n\nNodeOrText:\n  Node | STRING\n&#96;&#96;&#96;\n\n#### 9. Validation Rules\n\n1. layout은 트리 구조만 표현한다\n2. inline attributes만 허용\n3. 속성은 string-only\n4. children은 반드시 정해진 중첩 규칙을 따른다\n5. Node 이름은 PascalCase가 기본\n6. 문자열 children 외에는 모든 children은 Node여야 한다\n7. siblings 허용, 순서 보존\n\n#### 10. Example (Valid Layout Tree)\n\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;min-h-screen flex flex-col\&quot;) {\n    Header(class:\&quot;p-4 bg-gray-100\&quot;) {\n      H1 {\n        \&quot;Dashboard\&quot;\n      }\n    }\n\n    Main(class:\&quot;flex-1 p-6\&quot;) {\n      Card(class:\&quot;shadow\&quot;) {\n        P {\n          \&quot;Welcome back!\&quot;\n        }\n      }\n    }\n\n    Footer(class:\&quot;p-4 text-center\&quot;) {\n      \&quot;© 2025 The Bespoke\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto\&quot;) {\n    Navbar(class:\&quot;flex justify-between items-center p-4\&quot;) {\n      Logo(class:\&quot;text-xl font-bold\&quot;) {\n        \&quot;UIH\&quot;\n      }\n      Nav(class:\&quot;space-x-4\&quot;) {\n        Link(href:\&quot;/home\&quot;) {\n          \&quot;Home\&quot;\n        }\n        Link(href:\&quot;/about\&quot;) {\n          \&quot;About\&quot;\n        }\n      }\n    }\n\n    Content(class:\&quot;grid grid-cols-3 gap-6 p-6\&quot;) {\n      Sidebar(class:\&quot;col-span-1 bg-gray-50 p-4\&quot;) {\n        Menu {\n          \&quot;Dashboard\&quot;\n          \&quot;Settings\&quot;\n          \&quot;Profile\&quot;\n        }\n      }\n\n      Main(class:\&quot;col-span-2\&quot;) {\n        Article(class:\&quot;prose\&quot;) {\n          H2 {\n            \&quot;Getting Started\&quot;\n          }\n          P {\n            \&quot;Welcome to UIH DSL documentation.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- TagName에 숫자/특수문자 시작 시 토큰화 실패\n- 속성에 boolean/number 값 사용 시 파싱 오류\n- 텍스트 노드에 줄바꿈 포함 시 validation 실패\n- 노드 종료 &#96;}&#96; 누락 시 구문 오류\n- 중첩 깊이가 너무 깊을 경우 (권장 5레벨 초과) 경고\n- siblings 간 순서가 UI 의미에 영향 줄 경우 재검토\n\n---\n\n### Parser BNF Grammar\n\nTokenizer 위에서 동작하는 공식 문법 엔진 정의입니다. Token Stream을 Abstract Syntax Tree(AST)로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- Token Stream → Abstract Syntax Tree(AST)\n\n##### PARSER_MODE\n- strict non-ambiguous grammar\n- no recovery parsing (에러는 즉시 throw)\n- deterministic (LLM-friendly)\n- recursive descent parser 기반 구조\n\n#### 2. Entry Point\n\n##### Program\n&#96;&#96;&#96;\nProgram ::= MetaBlock StyleBlock ComponentsBlock? LayoutBlock ScriptBlock? EOF\n&#96;&#96;&#96;\n\n#### 3. Blocks\n\n##### Block_Definitions\n&#96;&#96;&#96;\nMetaBlock       ::= \&quot;meta\&quot; BlockBody(MetaProperty)\nStyleBlock      ::= \&quot;style\&quot; BlockBody(StyleProperty)\nComponentsBlock ::= \&quot;components\&quot; BlockBody(ComponentEntry)\nLayoutBlock     ::= \&quot;layout\&quot; LayoutBody\nScriptBlock     ::= \&quot;script\&quot; BlockBody(ScriptProperty)\n&#96;&#96;&#96;\n\n#### 4. Generic Block Body\n\n##### BlockBody\n&#96;&#96;&#96;\nBlockBody(&lt;T&gt;) ::= LBRACE NEWLINE (Indent &lt;T&gt; NEWLINE)* RBRACE\nIndent         ::= WHITESPACE WHITESPACE    # 2 spaces only\n&#96;&#96;&#96;\n\n#### 5. META Block Grammar\n\n##### MetaProperty\n&#96;&#96;&#96;\nMetaProperty ::= Identifier \&quot;:\&quot; MetaValue\nMetaValue    ::= STRING | NUMBER | BOOLEAN | EnumString\n&#96;&#96;&#96;\n\n##### Allowed_Meta_Keys\n- title, route, theme, description\n\n#### 6. STYLE Block Grammar\n\n##### StyleProperty\n&#96;&#96;&#96;\nStyleProperty ::= StyleKey \&quot;:\&quot; StyleValue\nStyleKey      ::= Identifier ( \&quot;.\&quot; Identifier )*\nStyleValue    ::= STRING | NUMBER | EnumString\n&#96;&#96;&#96;\n\n##### Notes\n- no nested blocks\n- no boolean\n- layout-like attributes 금지\n\n#### 7. COMPONENTS Block Grammar\n\n##### ComponentEntry\n&#96;&#96;&#96;\nComponentEntry ::= ComponentName\nComponentName  ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n##### NOTES\n- but no quotes, no values, one per line\n\n##### Examples\n&#96;&#96;&#96;\nCard\nButton\nInput\n&#96;&#96;&#96;\n\n#### 8. LAYOUT Block Grammar (Core)\n\n##### LayoutBody\n&#96;&#96;&#96;\nLayoutBody     ::= LBRACE NEWLINE Indent LayoutNodeList RBRACE\nLayoutNodeList ::= (LayoutNode NEWLINE)*\nLayoutNode     ::= Tag (Attributes)? (ChildrenBlock)?\nTag            ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n#### 9. Attributes Grammar\n\n##### Attributes\n&#96;&#96;&#96;\nAttributes    ::= LPAREN AttributeList RPAREN\nAttributeList ::= Attribute (COMMA Attribute)*\nAttribute     ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n#### 10. Children Block Grammar\n\n##### ChildrenBlock\n&#96;&#96;&#96;\nChildrenBlock ::= LBRACE NEWLINE Indent ChildrenList RBRACE\nChildrenList  ::= (Child NEWLINE)*\nChild         ::= LayoutNode | TEXT_STRING\n&#96;&#96;&#96;\n\n#### 11. SCRIPT Block Grammar\n\n##### ScriptProperty\n&#96;&#96;&#96;\nScriptProperty ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n##### Allowed_Script_Keys\n- onClick, onLoad, onSubmit, onMount, onChange\n\n#### 12. Value Grammars\n\n##### Value_Types\n&#96;&#96;&#96;\nSTRING     ::= \&quot;\\\&quot;\&quot; &lt;chars&gt; \&quot;\\\&quot;\&quot;\nNUMBER     ::= digits ( \&quot;.\&quot; digits )?\nBOOLEAN    ::= \&quot;true\&quot; | \&quot;false\&quot;\nEnumString ::= STRING   # validated in semantic phase\n&#96;&#96;&#96;\n\n#### 13. Identifier Grammars\n\n##### Identifiers\n&#96;&#96;&#96;\nIdentifier ::= [a-z][a-z0-9.]*\nTagName    ::= [A-Z][a-zA-Z0-9]*\n&#96;&#96;&#96;\n\n#### 14. Syntax Constraints (Formal)\n\n1. 모든 블록은 순서 고정\n2. 각 블록은 1회만 등장\n3. meta/style/layout은 필수\n4. components/script는 optional\n5. 들여쓰기 2 spaces only\n6. 속성(colon)은 반드시 &#96;&lt;id&gt;: &lt;value&gt;&#96;\n7. semicolon 금지\n8. layout만 nested structure 허용\n9. children 안에서는 TEXT_STRING 또는 LayoutNode만 허용\n10. parser는 ambiguous branch 금지 (LLM-safe)\n\n#### 15. Complete Example (BNF-valid)\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  radius.default: 8\n}\n\ncomponents {\n  Card\n  Button\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello world\&quot;\n    }\n  }\n}\n\nscript {\n  onClick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### BNF 구조 트리\n\n&#96;&#96;&#96;\nProgram\n├── MetaBlock\n│   ├── LBRACE\n│   ├── MetaProperty (title: \&quot;Home\&quot;)\n│   ├── MetaProperty (route: \&quot;/\&quot;)\n│   └── RBRACE\n├── StyleBlock\n│   ├── LBRACE\n│   ├── StyleProperty (color.primary: \&quot;#0E5EF7\&quot;)\n│   ├── StyleProperty (radius.default: 8)\n│   └── RBRACE\n├── ComponentsBlock\n│   ├── LBRACE\n│   ├── ComponentEntry (Card)\n│   ├── ComponentEntry (Button)\n│   └── RBRACE\n├── LayoutBlock\n│   ├── LBRACE\n│   ├── LayoutNode (Div)\n│   │   ├── Attributes (class:\&quot;p-4\&quot;)\n│   │   └── ChildrenBlock\n│   │       └── LayoutNode (P)\n│   │           └── ChildrenBlock\n│   │               └── TEXT_STRING (\&quot;Hello world\&quot;)\n│   └── RBRACE\n└── ScriptBlock\n    ├── LBRACE\n    ├── ScriptProperty (onClick: \&quot;submitForm\&quot;)\n    └── RBRACE\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 즉시 파싱 중단\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유지 (경고)\n- 들여쓰기 2 space 위반 시 구문 오류\n- layout 외 블록에서 중첩 시도 시 파싱 실패\n- 허용되지 않은 키 사용 시 semantic 오류 (parser 단계에서는 허용)\n- TEXT_STRING이 layout 외 컨텍스트에서 등장 시 오류\n\n---\n\n## AST Schema Definition\n\nParser BNF 위에서 생성되는 최종 AST 구조입니다. 모든 UIH DSL 요소가 이 스키마에 따라 구조화됩니다.\n\n### 1. AST Root\n\n#### ASTRoot\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Program\&quot;\n  meta: MetaNode\n  style: StyleNode\n  components: ComponentsNode | null\n  layout: LayoutNode\n  script: ScriptNode | null\n}\n&#96;&#96;&#96;\n\n### 2. Meta Node\n\n#### MetaNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Meta\&quot;\n  properties: MetaProperty[]\n}\n&#96;&#96;&#96;\n\n#### MetaProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;title\&quot;\n  value: string|number|boolean\n  location: Range     // from tokenizer\n}\n&#96;&#96;&#96;\n\n### 3. Style Node\n\n#### StyleNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Style\&quot;\n  properties: StyleProperty[]\n}\n&#96;&#96;&#96;\n\n#### StyleProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;color.primary\&quot;\n  value: string|number\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 4. Components Node\n\n#### ComponentsNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Components\&quot;\n  components: ComponentEntry[]\n}\n&#96;&#96;&#96;\n\n#### ComponentEntry\n&#96;&#96;&#96;typescript\n{\n  name: string        // e.g. \&quot;Card\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 5. Layout Node (Core Tree Structure)\n\n#### LayoutNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Layout\&quot;\n  children: LayoutElement[]     // top-level nodes inside layout block\n}\n&#96;&#96;&#96;\n\n#### LayoutElement\n&#96;&#96;&#96;typescript\nLayoutElement = LayoutComponent | LayoutText\n&#96;&#96;&#96;\n\n#### 5.1 Layout Component\n&#96;&#96;&#96;typescript\nLayoutComponent {\n  type: \&quot;Component\&quot;\n  tag: string                   // e.g. \&quot;Div\&quot;, \&quot;P\&quot;, \&quot;Header\&quot;\n  attributes: Attribute[]\n  children: LayoutElement[]     // nested structure\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### Attribute\n&#96;&#96;&#96;typescript\n{\n  key: string                   // lower-case only\n  value: string                 // inline string only\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### 5.2 Layout Text Node\n&#96;&#96;&#96;typescript\nLayoutText {\n  type: \&quot;Text\&quot;\n  value: string                 // raw text string\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 6. Script Node\n\n#### ScriptNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Script\&quot;\n  events: ScriptProperty[]\n}\n&#96;&#96;&#96;\n\n#### ScriptProperty\n&#96;&#96;&#96;typescript\n{\n  key: string                   // e.g. \&quot;onClick\&quot;\n  value: string                 // e.g. \&quot;submitForm\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 7. Range Object (Source Location)\n\n#### Range\n&#96;&#96;&#96;typescript\n{\n  start: Position\n  end: Position\n}\n&#96;&#96;&#96;\n\n#### Position\n&#96;&#96;&#96;typescript\n{\n  line: number\n  column: number\n}\n&#96;&#96;&#96;\n\n### 8. Semantics Rules (Validation Layer)\n\n1. Meta keys must be from allowlist:\n   - title, route, theme, description\n\n2. Style keys may use dot notation but MUST be lowercase.\n\n3. Components must be names only, no properties.\n\n4. Layout:\n   - tag must be a valid TagName or valid identifier\n   - attributes must be string-only\n   - children: array of LayoutElement (component or text)\n\n5. Script:\n   - keys must be known event names\n   - value must be string (function name)\n\n6. No null children arrays. Use &#96;[]&#96; if empty.\n\n7. All nodes must have location data.\n\n### 9. Example: Full AST for a Simple Page\n\n#### Example DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### Generated AST (simplified)\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Home\&quot; },\n      { \&quot;key\&quot;: \&quot;route\&quot;, \&quot;value\&quot;: \&quot;/\&quot; }\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;color.primary\&quot;, \&quot;value\&quot;: \&quot;#0E5EF7\&quot; }\n    ]\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: [\n          { \&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;p-4\&quot; }\n        ],\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n### AST 구조 트리\n\n&#96;&#96;&#96;\nASTRoot (Program)\n├── meta (MetaNode)\n│   └── properties[] (MetaProperty)\n├── style (StyleNode)\n│   └── properties[] (StyleProperty)\n├── components (ComponentsNode | null)\n│   └── components[] (ComponentEntry)\n├── layout (LayoutNode)\n│   └── children[] (LayoutElement)\n│       ├── LayoutComponent\n│       │   ├── attributes[] (Attribute)\n│       │   └── children[] (LayoutElement)\n│       └── LayoutText\n└── script (ScriptNode | null)\n    └── events[] (ScriptProperty)\n&#96;&#96;&#96;\n\n### AST Examples\n\n#### 최소 AST 구조\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      {\&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Minimal\&quot;}\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: []\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Text\&quot;,\n        \&quot;value\&quot;: \&quot;Content\&quot;\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n#### 복잡한 레이아웃 AST\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Layout\&quot;,\n  \&quot;children\&quot;: [\n    {\n      \&quot;type\&quot;: \&quot;Component\&quot;,\n      \&quot;tag\&quot;: \&quot;Div\&quot;,\n      \&quot;attributes\&quot;: [\n        {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;container\&quot;}\n      ],\n      \&quot;children\&quot;: [\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Header\&quot;,\n          \&quot;attributes\&quot;: [],\n          \&quot;children\&quot;: [\n            {\n              \&quot;type\&quot;: \&quot;Component\&quot;,\n              \&quot;tag\&quot;: \&quot;H1\&quot;,\n              \&quot;attributes\&quot;: [],\n              \&quot;children\&quot;: [\n                {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Title\&quot;}\n              ]\n            }\n          ]\n        },\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Main\&quot;,\n          \&quot;attributes\&quot;: [\n            {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;content\&quot;}\n          ],\n          \&quot;children\&quot;: [\n            {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Main content\&quot;}\n          ]\n        }\n      ]\n    }\n  ]\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- location 정보 누락 시 AST 생성 실패\n- 빈 children 배열 대신 null 사용 시 validation 오류\n- 허용되지 않은 meta/style/script 키 사용 시 semantic 오류\n- LayoutComponent의 tag가 유효하지 않은 경우 오류\n- LayoutText에 빈 문자열 사용 시 경고\n- 중첩 깊이가 너무 깊을 경우 (10레벨 초과) 경고 또는 오류\n\n---\n\n## IR (Intermediate Representation) Specification\n\nAST → IR 변환 규칙을 정의합니다. Codegen 단계 직전의 \&quot;정규화된 구조\&quot;로, 플랫폼불문의 공통 인터페이스를 제공합니다.\n\n### 1. Overview\n\n#### IR_GOAL\n- AST의 복잡한 구조를 코드 생성하기 좋게 단순화\n- UI 컴포넌트 트리와 메타데이터를 정규화\n- 플랫폼불문(React/Next/Svelte) 공통 인터페이스로 변환\n- 모든 값은 최종적이고 확정된 형태만 유지\n\n#### INPUT\n- ASTRoot\n\n#### OUTPUT\n- IRRoot\n\n### 2. IR Root\n\n#### IRRoot\n&#96;&#96;&#96;typescript\n{\n  meta: IRMeta\n  style: IRStyle\n  components: IRComponents\n  layout: IRLayoutTree\n  script: IRScript\n}\n&#96;&#96;&#96;\n\n### 3. IRMeta (Final Document Metadata)\n\n#### IRMeta\n&#96;&#96;&#96;typescript\n{\n  title: string\n  route: string\n  theme: \&quot;light\&quot; | \&quot;dark\&quot;\n  description: string | null\n}\n&#96;&#96;&#96;\n\n#### Rules\n- missing values become null\n- enforce route starts with \&quot;/\&quot;\n\n### 4. IRStyle (Flattened Style Tokens)\n\n#### IRStyle\n&#96;&#96;&#96;typescript\n{\n  tokens: Record&lt;string, string | number&gt;\n}\n&#96;&#96;&#96;\n\n#### Examples\n&#96;&#96;&#96;typescript\n{\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n  \&quot;radius.default\&quot;: 8\n}\n&#96;&#96;&#96;\n\n#### Rules\n- dot-notation keys preserved\n- all values converted to primitive string/number\n- no validation here (semantic pass already done)\n\n### 5. IRComponents (Registered Component Map)\n\n#### IRComponents\n&#96;&#96;&#96;typescript\n{\n  list: string[]   // e.g. [\&quot;Card\&quot;, \&quot;Button\&quot;]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- duplicates removed\n- sorted alphabetically for deterministic output\n\n### 6. IRLayoutTree (Normalized UI Tree)\n\n#### IRLayoutTree\n&#96;&#96;&#96;typescript\n{\n  root: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### IRNode\n&#96;&#96;&#96;typescript\nIRNode = IRComponentNode | IRTextNode\n&#96;&#96;&#96;\n\n#### 6.1 IRComponentNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;component\&quot;\n  tag: string\n  attributes: Record&lt;string, string&gt;   // key:string only\n  children: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- attribute keys lower-case enforced\n- children always array\n- empty children =&gt; []\n\n#### 6.2 IRTextNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;text\&quot;\n  value: string\n}\n&#96;&#96;&#96;\n\n#### Rules\n- trimmed text preserved exactly\n- no newline allowed inside text\n\n### 7. IRScript (Event Map)\n\n#### IRScript\n&#96;&#96;&#96;typescript\n{\n  events: Record&lt;string, string&gt;   // onClick → \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Rules\n- all keys normalized to lower-case event names\n- event value must be string only\n- duplicates override earlier definitions\n\n### 8. AST → IR Mapping Rules\n\n1. **MetaNode → IRMeta**\n   - convert property array → object map\n   - apply default values if missing\n   - route must start with \&quot;/\&quot;\n\n2. **StyleNode → IRStyle**\n   - flatten list into tokens object\n   - preserve ordering but output sorted keys for determinism\n\n3. **ComponentsNode → IRComponents**\n   - convert component list → array\n   - remove duplicates\n   - sort alphabetically\n\n4. **LayoutNode → IRLayoutTree**\n   - recursively convert LayoutComponent → IRComponentNode\n   - convert LayoutText → IRTextNode\n   - inline attributes converted to plain object\n\n5. **ScriptNode → IRScript**\n   - property list flattened to event map\n   - enforce lower-case event names\n\n### 9. Example: Full IR Output\n\n#### DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### IR\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Home\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: null,\n    \&quot;description\&quot;: null\n  },\n\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n    }\n  },\n\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: []\n  },\n\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: { \&quot;class\&quot;: \&quot;p-4\&quot; },\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {}\n  }\n}\n&#96;&#96;&#96;\n\n### IR 구조 트리\n\n&#96;&#96;&#96;\nIRRoot\n├── meta (IRMeta)\n│   ├── title: string\n│   ├── route: string\n│   ├── theme: \&quot;light\&quot;|\&quot;dark\&quot;|null\n│   └── description: string|null\n├── style (IRStyle)\n│   └── tokens: Record&lt;string, string|number&gt;\n├── components (IRComponents)\n│   └── list: string[]\n├── layout (IRLayoutTree)\n│   └── root: IRNode[]\n│       ├── IRComponentNode\n│       │   ├── type: \&quot;component\&quot;\n│       │   ├── tag: string\n│       │   ├── attributes: Record&lt;string, string&gt;\n│       │   └── children: IRNode[]\n│       └── IRTextNode\n│           ├── type: \&quot;text\&quot;\n│           └── value: string\n└── script (IRScript)\n    └── events: Record&lt;string, string&gt;\n&#96;&#96;&#96;\n\n### IR Examples\n\n#### 간단한 IR 변환\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Simple\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: \&quot;light\&quot;,\n    \&quot;description\&quot;: null\n  },\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#000\&quot;,\n      \&quot;font.size\&quot;: 14\n    }\n  },\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: [\&quot;Button\&quot;]\n  },\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: {},\n        \&quot;children\&quot;: [\n          {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Content\&quot;}\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {\n      \&quot;onclick\&quot;: \&quot;handleClick\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 복잡한 중첩 레이아웃 IR\n&#96;&#96;&#96;json\n{\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Container\&quot;,\n        \&quot;attributes\&quot;: {\n          \&quot;class\&quot;: \&quot;flex flex-col min-h-screen\&quot;\n        },\n        \&quot;children\&quot;: [\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Header\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;p-4 bg-blue-600\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;H1\&quot;,\n                \&quot;attributes\&quot;: {},\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Dashboard\&quot;}\n                ]\n              }\n            ]\n          },\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Main\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;flex-1 p-6\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;Card\&quot;,\n                \&quot;attributes\&quot;: {\n                  \&quot;class\&quot;: \&quot;bg-white shadow-lg rounded\&quot;\n                },\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Welcome!\&quot;}\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- AST에 location 정보 누락 시 IR 변환 실패\n- route가 \&quot;/\&quot;로 시작하지 않을 경우 변환 시 강제 추가\n- 중복 컴포넌트 등록 시 알파벳 순 정렬로 중복 제거\n- 빈 children 배열을 null로 잘못 설정 시 []로 강제 변환\n- 텍스트 노드에 줄바꿈 포함 시 변환 중 제거 또는 오류\n- 이벤트 키 대소문자 혼재 시 소문자로 통일\n- 스타일 토큰 키 순서가 다를 경우 sorted keys로 결정적 출력 보장\n\n---\n\n## Codegen Rules\n\n### React/Next.js 15 Codegen\n\nIR을 기반으로 안정적인 UI 코드 생성 규칙입니다. React/Next.js 15 (App Router + RSC) 기준으로 IR을 실제 코드로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- IR을 기반으로 안정적인 UI 코드 생성\n- React/Next.js 15 (App Router + RSC) 기준\n- \&quot;디자인 시스템 없는 순수 Layout Tree\&quot;를 코드로 변환\n- 가능한 한 deterministic 하게 출력\n- 로직/상태/이벤트는 최소 수준으로만 개입\n\n##### INPUT\n- IRRoot\n\n##### OUTPUT\n- React Component Source Code (string)\n\n#### 2. Output Structure\n\n파일 구조는 다음 형태로 생성합니다:\n\n&#96;&#96;&#96;\n/page.tsx\n  - metadata (title, description)\n  - default export function Page()\n  - return(...) 내부에 layout tree 삽입\n\n/style-tokens.ts\n  - style.tokens flatten export\n\n/components/index.ts\n  - components registry export\n\n/script-events.ts\n  - event name string mapping export\n&#96;&#96;&#96;\n\n#### 3. Metadata Codegen\n\n##### UIH meta → Next.js metadata\n&#96;&#96;&#96;typescript\nIRMeta {\n  title: string\n  description: string\n}\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;typescript\nexport const metadata = {\n  title: \&quot;&lt;title&gt;\&quot;,\n  description: \&quot;&lt;description&gt;\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- description 없으면 필드 제외\n- theme는 metadata에 직접 쓰지 않음 (스타일토큰 용)\n\n#### 4. Style Token Codegen\n\n##### IRStyle { tokens }\n&#96;&#96;&#96;typescript\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;radius.default\&quot;: 8,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 키는 string 리터럴 그대로\n- numeric/string 그대로 출력\n- sorted keys for deterministic output\n\n#### 5. Component Registry Codegen\n\n##### IRComponents.list → export list\n&#96;&#96;&#96;typescript\nexport const components = {\n  Card,\n  Button,\n  Input,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 자동 import 하지 않음 (상위 시스템이 resolve)\n- keys는 PascalCase 유지\n- duplicates 제거 후 정렬\n\n#### 6. Layout Tree → JSX Codegen\n\n##### IRLayoutTree → React element tree\n\n##### 6.1 Component Node\n&#96;&#96;&#96;typescript\nIRComponentNode {\n  tag: \&quot;Div\&quot;\n  attributes: { class: \&quot;p-4\&quot; }\n  children: [...]\n}\n&#96;&#96;&#96;\n\n##### OUTPUT JSX\n&#96;&#96;&#96;jsx\n&lt;Div className=\&quot;p-4\&quot;&gt;\n  {children...}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n##### RULES\n- attribute.key \&quot;class\&quot; → \&quot;className\&quot;\n- attribute key는 그대로 lower-case 유지\n- value는 string literal\n- children length 0 이면 self-closing 금지 (always explicit block)\n- tag name 그대로 JSX 컴포넌트로 사용\n\n##### 6.2 Text Node\n&#96;&#96;&#96;typescript\nIRTextNode { value: \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;jsx\n{\&quot;Hello\&quot;}\n&#96;&#96;&#96;\n\n##### RULES\n- 텍스트는 JSX children 표현\n- 특수문자는 자동 escape\n\n#### 7. Script Event Codegen\n\n##### IRScript.events → export mapping\n&#96;&#96;&#96;typescript\nexport const eventHandlers = {\n  onClick: \&quot;submitForm\&quot;,\n  onLoad: \&quot;init\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- event 이름은 lower-case normalized\n- 값은 string (함수명)\n- 실제 JS 함수 body는 생성하지 않음\n- 나중 시스템이 자동 wire-up 함\n\n#### 8. Full Page Generation\n\n최종 page.tsx는 다음 구조를 따릅니다:\n\n&#96;&#96;&#96;typescript\nexport const metadata = { ... };\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen p-4\&quot;&gt;\n      &lt;P&gt;{\&quot;Hello\&quot;}&lt;/P&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### RULES\n- 최상위는 항상 &#96;&lt;Div&gt;&#96; 같은 Wrapper로 시작하지 않아도 됨\n- layout.root가 배열이면 Fragment로 감싼다\n- 코드 스타일은 2-space indent\n- 세미콜론 붙이지 않음 (Prettier 옵션 따라감)\n\n#### 9. Determinism Rules\n\n1. 속성 순서는 key 알파벳순 정렬\n2. children 순서는 DSL 입력 순서 그대로\n3. components 목록은 알파벳순 정렬\n4. styleTokens도 key 정렬\n5. eventHandlers key 정렬\n6. output JSX는 항상 multiline\n\n#### 10. Full Example (DSL → IR → JSX)\n\n##### DSL\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n##### JSX OUT\n&#96;&#96;&#96;typescript\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;p-4\&quot;&gt;\n      {\&quot;Hello\&quot;}\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n#### 11. Notes for Engine Integrators\n\n1. Codegen은 \&quot;순수 구조\&quot;만 책임진다\n   - 상태(state), fetch, useEffect 등은 지원하지 않음\n2. 이벤트 핸들러는 단순 라벨링 시스템\n3. 스타일 토큰은 UI 프레임워크에서 직접 해석\n4. React, Vue, Svelte 등 플랫폼별 코드젠 가능\n   - 플랫폼별 레이어는 분리\n\n#### Output Files 구조\n\n&#96;&#96;&#96;\nOutput Files\n├── page.tsx\n│   ├── metadata export\n│   ├── imports (components, styleTokens, eventHandlers)\n│   ├── Page() function\n│   └── JSX return (layout tree)\n├── style-tokens.ts\n│   └── styleTokens export\n├── components/index.ts\n│   └── components export\n└── script-events.ts\n    └── eventHandlers export\n&#96;&#96;&#96;\n\n#### Codegen Examples\n\n##### 전체 페이지 코드 생성 예시\n&#96;&#96;&#96;typescript\n// page.tsx\nexport const metadata = {\n  title: \&quot;Dashboard\&quot;,\n  description: \&quot;Main dashboard page\&quot;\n};\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen flex flex-col\&quot;&gt;\n      &lt;Header className=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n        &lt;H1&gt;\n          {\&quot;Dashboard\&quot;}\n        &lt;/H1&gt;\n      &lt;/Header&gt;\n      &lt;Main className=\&quot;flex-1 p-6\&quot;&gt;\n        &lt;Card className=\&quot;bg-white shadow-lg rounded-lg p-6\&quot;&gt;\n          &lt;P&gt;\n            {\&quot;Welcome back!\&quot;}\n          &lt;/P&gt;\n        &lt;/Card&gt;\n      &lt;/Main&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### 스타일 토큰 파일 예시\n&#96;&#96;&#96;typescript\n// style-tokens.ts\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;color.secondary\&quot;: \&quot;#6B7280\&quot;,\n  \&quot;color.accent\&quot;: \&quot;#F59E0B\&quot;,\n  \&quot;spacing.small\&quot;: 8,\n  \&quot;spacing.medium\&quot;: 16,\n  \&quot;spacing.large\&quot;: 24,\n  \&quot;border.radius\&quot;: 6,\n  \&quot;font.family\&quot;: \&quot;Inter\&quot;,\n  \&quot;font.size.base\&quot;: 16,\n  \&quot;shadow.default\&quot;: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n};\n&#96;&#96;&#96;\n\n##### 컴포넌트 레지스트리 예시\n&#96;&#96;&#96;typescript\n// components/index.ts\nexport const components = {\n  Button,\n  Card,\n  Input,\n  Modal,\n  Sidebar\n};\n&#96;&#96;&#96;\n\n##### 이벤트 핸들러 파일 예시\n&#96;&#96;&#96;typescript\n// script-events.ts\nexport const eventHandlers = {\n  onclick: \&quot;handleClick\&quot;,\n  onload: \&quot;initDashboard\&quot;,\n  onsubmit: \&quot;processForm\&quot;\n};\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- layout.root가 빈 배열일 경우 빈 Fragment 생성\n- 컴포넌트 이름이 JavaScript 예약어와 충돌 시 escaping 필요\n- 텍스트에 JSX 특수문자 포함 시 자동 escape\n- 중첩 깊이가 깊을 경우 코드 포맷팅 유지\n- import 경로 resolve 실패 시 상위 시스템에서 처리\n- styleTokens에 특수문자 키 포함 시 유효한 JS 객체 키로 변환\n\n---\n\n### Vue &amp; Svelte Codegen\n\nReact Codegen과 동일한 IR 기반으로 Vue와 Svelte 코드를 생성하는 규칙입니다. 플랫폼별 렌더링 규칙만 다르게 적용합니다.\n\n## SECTION A — Vue Codegen (SFC 기준)\n\n### GOAL\n- IR → .vue 파일 형태로 변환\n- &#96;&lt;template&gt;&#96; + &#96;&lt;script setup&gt;&#96; + &#96;&lt;style&gt;&#96; 구조 유지\n- 모든 로직은 배제하고 구조만 생성\n\n### OUTPUT FILE STRUCTURE\n&#96;&#96;&#96;\nMyPage.vue\n&#96;&#96;&#96;\n\n### 1. Top-Level Structure\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;!-- layout tree --&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport components...\n\nconst events = {...}\nconst styleTokens = {...}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* optional if needed */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Vue Template 규칙\n\n#### IRComponentNode(tag:\&quot;Div\&quot;, attributes, children)\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  &lt;!-- children --&gt;\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;className&#96; → &#96;class&#96;\n- attribute values: string only\n- children: 그대로 template로 변환\n- Fragment는 &#96;&lt;template&gt;&#96; 안에서 그냥 siblings로 출력\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello (그대로 text node)\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\neventHandlers {\n  onClick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Vue OUTPUT\n&#96;&#96;&#96;vue\n@click=\&quot;submitForm\&quot;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;onClick&#96; → &#96;@click&#96;\n- &#96;onChange&#96; → &#96;@change&#96;\n- &#96;onInput&#96; → &#96;@input&#96;\n- &#96;onLoad&#96; → &#96;@load&#96;\n- value는 함수 이름 string\n- 함수 구현은 생성하지 않음\n\n### 4. Component Registry (imports)\n&#96;&#96;&#96;javascript\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules\n- 속성(sorted)\n- imports(sorted)\n- children 순서 그대로\n- no semicolons\n- template 들여쓰기 2 spaces\n\n## SECTION B — Svelte Codegen (.svelte)\n\n### GOAL\n- Svelte 컴포넌트 파일 하나로 완성\n- &#96;&lt;script&gt;&#96; + markup 구조\n\n### OUTPUT STRUCTURE\n&#96;&#96;&#96;\nMyPage.svelte\n&#96;&#96;&#96;\n\n### 1. File Layout\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import components...\n  export let events = {...}\n  export let styleTokens = {...}\n&lt;/script&gt;\n\n&lt;!-- layout markup --&gt;\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  Hello\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* optional */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Svelte Markup\n\n#### IRComponentNode(tag, attributes, children)\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  {#if ... ?} (없음)\n  {children}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- 클래스는 &#96;class&#96;\n- 속성 문자열만\n- Self-closing 금지\n- children 재귀적 삽입\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\nIRScript:\nonClick → function name\n&#96;&#96;&#96;\n\n#### Svelte OUTPUT\n&#96;&#96;&#96;svelte\non:click={submitForm}\n&#96;&#96;&#96;\n\n#### Mapping\n&#96;&#96;&#96;\nonClick   → on:click\nonChange  → on:change\nonInput   → on:input\nonLoad    → on:load\n&#96;&#96;&#96;\n\n### 4. Components Import\n&#96;&#96;&#96;javascript\nimport Card from \&quot;./Card.svelte\&quot;;\nimport Button from \&quot;./Button.svelte\&quot;;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules (필수)\n\n1. import 순서는 알파벳 정렬\n2. attributes sorted\n3. event names lower-case\n4. children 순서 보존\n5. markup 들여쓰기 2 spaces\n\n## SECTION C — Cross-Platform Notes\n\n1. React / Vue / Svelte 모두 IR만 참조\n2. layout tree는 그대로 세 렌더러에서 재활용\n3. event handler는 단순 label → framework alias로 변환\n4. styleTokens는 컴파일러 외부 시스템이 처리\n5. components는 registry 기반으로 import만 생성\n\n## SECTION D — Example Conversion (Same IR → Vue/Svelte)\n\n### IR\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) { \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n### Vue Template\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Svelte Markup\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte 구조\n\n&#96;&#96;&#96;\nVue Output (.vue)\n├── &lt;template&gt;\n│   └── layout tree (Vue template syntax)\n├── &lt;script setup&gt;\n│   ├── component imports\n│   ├── events object\n│   └── styleTokens object\n└── &lt;style scoped&gt;\n    └── optional styles\n\nSvelte Output (.svelte)\n├── &lt;script&gt;\n│   ├── component imports\n│   ├── export let events = {...}\n│   └── export let styleTokens = {...}\n├── layout markup (Svelte syntax)\n└── &lt;style&gt;\n    └── optional styles\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte Examples\n\n#### Vue SFC 전체 예시\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n    &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n      &lt;H1&gt;\n        Dashboard\n      &lt;/H1&gt;\n    &lt;/Header&gt;\n    &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n      &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; @click=\&quot;handleCardClick\&quot;&gt;\n        &lt;P&gt;\n          Welcome back!\n        &lt;/P&gt;\n      &lt;/Card&gt;\n    &lt;/Main&gt;\n  &lt;/Div&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n\nconst events = {\n  handleCardClick: \&quot;handleCardClick\&quot;\n}\n\nconst styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;spacing.medium\&quot;: 16\n}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### Svelte 컴포넌트 전체 예시\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import Card from \&quot;./Card.svelte\&quot;;\n  import Button from \&quot;./Button.svelte\&quot;;\n\n  export let events = {\n    handleCardClick: \&quot;handleCardClick\&quot;\n  };\n\n  export let styleTokens = {\n    \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n    \&quot;spacing.medium\&quot;: 16\n  };\n&lt;/script&gt;\n\n&lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n  &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n    &lt;H1&gt;\n      Dashboard\n    &lt;/H1&gt;\n  &lt;/Header&gt;\n  &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n    &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; on:click={handleCardClick}&gt;\n      &lt;P&gt;\n        Welcome back!\n      &lt;/P&gt;\n    &lt;/Card&gt;\n  &lt;/Main&gt;\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### 이벤트 매핑 비교\n&#96;&#96;&#96;javascript\n// 동일한 IR 이벤트\n{\n  onClick: \&quot;handleClick\&quot;,\n  onChange: \&quot;handleChange\&quot;,\n  onLoad: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;vue\n&lt;!-- Vue --&gt;\n&lt;Button @click=\&quot;handleClick\&quot; @change=\&quot;handleChange\&quot; @load=\&quot;init\&quot;&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;svelte\n&lt;!-- Svelte --&gt;\n&lt;Button on:click={handleClick} on:change={handleChange} on:load={init}&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;jsx\n&lt;!-- React --&gt;\n&lt;Button onClick={handleClick} onChange={handleChange} onLoad={init}&gt;\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- Vue에서 컴포넌트 이름이 kebab-case로 변환 필요 시 자동 처리\n- Svelte에서 export let 구문이 예약어와 충돌 시 renaming\n- 이벤트 핸들러가 정의되지 않은 경우 플랫폼별 기본 동작\n- 스타일 토큰에 CSS 변수나 함수 포함 시 escaping\n- 중첩 컴포넌트 깊이가 깊을 경우 플랫폼별 최적화 적용\n- 텍스트 콘텐츠에 플랫폼별 특수문자 포함 시 자동 escape\n\n---\n\n## Examples\n\n### 완전한 UIH DSL 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;User Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main user dashboard with analytics\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  color.accent: \&quot;#F59E0B\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n  font.size.h1: 32\n  spacing.small: 8\n  spacing.medium: 16\n  spacing.large: 24\n  border.radius: 6\n  shadow.default: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n  Sidebar\n  Chart\n}\n\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto p-6\&quot;) {\n    Header(class:\&quot;mb-8\&quot;) {\n      Div(class:\&quot;flex justify-between items-center\&quot;) {\n        H1(class:\&quot;text-3xl font-bold\&quot;) {\n          \&quot;Dashboard\&quot;\n        }\n        Button(class:\&quot;px-4 py-2 bg-blue-600 text-white rounded\&quot;) {\n          \&quot;New Report\&quot;\n        }\n      }\n    }\n\n    Div(class:\&quot;grid grid-cols-3 gap-6\&quot;) {\n      Card(class:\&quot;col-span-2\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Analytics Overview\&quot;\n        }\n        Chart(class:\&quot;w-full h-64\&quot;)\n      }\n\n      Card(class:\&quot;col-span-1\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Quick Stats\&quot;\n        }\n        Div(class:\&quot;space-y-4\&quot;) {\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Total Users\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;1,234\&quot;\n            }\n          }\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Active Sessions\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;89\&quot;\n            }\n          }\n        }\n      }\n    }\n\n    Sidebar(class:\&quot;mt-8\&quot;) {\n      H3(class:\&quot;text-lg mb-4\&quot;) {\n        \&quot;Recent Activity\&quot;\n      }\n      Div(class:\&quot;space-y-2\&quot;) {\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;User john@example.com logged in\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;New report generated\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;System backup completed\&quot;\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onLoad: \&quot;initDashboard\&quot;\n  onClick: \&quot;handleButtonClick\&quot;\n  onRefresh: \&quot;refreshData\&quot;\n}\n&#96;&#96;&#96;\n\n### 최소 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Minimal Page\&quot;\n  route: \&quot;/minimal\&quot;\n  theme: \&quot;light\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  spacing.unit: 12\n}\n\nlayout {\n  Div(class:\&quot;min-h-screen flex items-center justify-center bg-gray-50\&quot;) {\n    \&quot;Coming soon\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n### Form 중심 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Sign Up\&quot;\n  route: \&quot;/signup\&quot;\n  theme: \&quot;light\&quot;\n  description: \&quot;Create a new account\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#2563EB\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n}\n\ncomponents {\n  Form\n  Input\n  Button\n  Alert\n}\n\nlayout {\n  Section(class:\&quot;min-h-screen flex items-center justify-center bg-gray-100\&quot;) {\n    Form(class:\&quot;w-full max-w-md space-y-6 bg-white p-8 rounded-xl shadow-lg\&quot;) {\n      H2(class:\&quot;text-2xl font-semibold text-gray-900\&quot;) {\n        \&quot;Create your account\&quot;\n      }\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;email\&quot;, placeholder:\&quot;Enter email\&quot;)\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;password\&quot;, placeholder:\&quot;Enter password\&quot;)\n      Button(class:\&quot;w-full bg-blue-600 text-white py-3 rounded-lg\&quot;) {\n        \&quot;Sign up\&quot;\n      }\n      Alert(class:\&quot;text-sm text-gray-500 text-center\&quot;) {\n        \&quot;By signing up you agree to our terms\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onSubmit: \&quot;handleSignup\&quot;\n  onLoad: \&quot;prefillFromInvite\&quot;\n}\n&#96;&#96;&#96;\n\n### 콘텐츠 피드 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Creator Feed\&quot;\n  route: \&quot;/feed\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Realtime creator activity feed\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#22D3EE\&quot;\n  color.background: \&quot;#0F172A\&quot;\n  font.family: \&quot;Space Grotesk\&quot;\n  spacing.medium: 20\n  radius.card: 12\n}\n\ncomponents {\n  Shell\n  Sidebar\n  Feed\n  FeedItem\n  Avatar\n  Badge\n}\n\nlayout {\n  Shell(class:\&quot;min-h-screen bg-slate-950 text-slate-100\&quot;) {\n    Sidebar(class:\&quot;w-64 border-r border-slate-800 p-6 space-y-6\&quot;) {\n      H1(class:\&quot;text-xl font-semibold tracking-tight\&quot;) {\n        \&quot;Creator Hub\&quot;\n      }\n      Badge(class:\&quot;inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 text-slate-200\&quot;) {\n        \&quot;Live updates\&quot;\n      }\n    }\n    Feed(class:\&quot;flex-1 p-8 space-y-6\&quot;) {\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-cyan-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;heymina.studio\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-300\&quot;) {\n              \&quot;New drop\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Dropped a limited neon kit — 120 packs sold out in 3 minutes.\&quot;\n          }\n        }\n      }\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-pink-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;luvv.wav\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-cyan-500/10 text-cyan-300\&quot;) {\n              \&quot;Stream recap\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Hit 18,245 live viewers tonight — chat requested a synthwave encore.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onRefresh: \&quot;fetchLatestFeed\&quot;\n  onClick: \&quot;openCreatorProfile\&quot;\n}\n&#96;&#96;&#96;\n\n---\n\n## Version\n\n- **Version**: 1.0.0\n- **Last Update**: 2025-11-18\n- **Change Summary**: Complete guide consolidating all UIH DSL specifications\n\n---\n\n## 문서 끝\n\n이 문서는 UIH DSL의 모든 스펙을 \&quot;생략 없이\&quot; 하나의 파일로 통합한 완전판입니다. Foundation Layer부터 Codegen까지 전 과정을 포함하며, LLM이 UI를 정확하게 선언할 수 있도록 설계된 모든 규칙이 담겨 있습니다.\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Clarifying event identifier rules**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;1634fe46-7d08-429e-bf00-636c6d691a04&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  \n  ##### Allowed_Script_Keys\n- - onClick, onLoad, onSubmit, onMount, onChange\n+ - onclick, onload, onsubmit, onmount, onchange\n+ \n+ &gt; 모든 script event identifier는 전부 소문자여야 하며 camelCase를 사용하지 않는다.\n  \n  #### 12. Value Grammars&quot;,
        &quot;oldStart&quot;: 1305,
        &quot;newStart&quot;: 1305,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 7,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 3
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;,
  &quot;contentsAfterEdit&quot;: &quot;# UIH DSL — Complete Guide (생략 없는 완전판)\n\n## Table of Contents\n\n1. [Overview](#overview)\n2. [Philosophy &amp; Design Principles](#philosophy--design-principles)\n3. [Foundation Layer](#foundation-layer)\n4. [Tokenizer Specification](#tokenizer-specification)\n5. [Grammar](#grammar)\n   - [Block Grammar](#block-grammar)\n   - [Property Grammar](#property-grammar)\n   - [Layout Tree Grammar](#layout-tree-grammar)\n   - [Parser BNF Grammar](#parser-bnf-grammar)\n6. [AST Schema Definition](#ast-schema-definition)\n7. [IR (Intermediate Representation) Specification](#ir-intermediate-representation-specification)\n8. [Codegen Rules](#codegen-rules)\n   - [React/Next.js 15 Codegen](#reactnextjs-15-codegen)\n   - [Vue &amp; Svelte Codegen](#vue--svelte-codegen)\n9. [Examples](#examples)\n10. [Version](#version)\n\n---\n\n## Overview\n\nUIH DSL (Universal Interface Hierarchy Domain Specific Language) v2는 **\&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;**를 목표로 하는 도메인 특화 언어입니다.\n\n### 핵심 목표\n- LLM이 UI 구조를 **정확하게** 선언할 수 있도록 설계\n- 모호성 제거 및 결정성(determinism) 보장\n- 사람보다 AI가 더 효과적으로 사용 가능한 DSL\n- UI 구조의 선언적 표현에 집중\n\n### 아키텍처 흐름\n&#96;&#96;&#96;\nDSL 문자열 → Tokenizer → Parser → AST → IR → Codegen → React/Vue/Svelte 코드\n&#96;&#96;&#96;\n\n### 주요 특징\n- 한 줄에 하나의 의미만 (One-intent-per-line)\n- 선택적 문법 금지 - 모든 것이 명시적\n- 쌍따옴표만 허용, 세미콜론 없음\n- 주석 지원 안 함 (모호성 제거)\n- 고정 블록 순서: meta → style → components → layout → script\n\n---\n\n## Philosophy &amp; Design Principles\n\nUIH DSL은 \&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;를 목표로 하는 도메인 특화 언어입니다. 사람보다 LLM이 더 효과적으로 사용할 수 있도록 설계되었으며, UI 구조의 선언적 표현에 집중합니다.\n\n### 1. LLM 친화적 설계 원칙\n\nLLM이 읽고 쓰기 편한 DSL을 지향합니다. 구조는 최대한 명확하고 모호성이 없으며, 선택적 문법을 금지합니다. LLM이 패턴을 쉽게 반복할 수 있는 형태로 자연어 번역 난이도를 낮췄습니다.\n\n### 2. 선언적 UI 설계\n\nUI는 로직 기반보다 구조 기반으로 설계합니다. \&quot;무엇을 만든다\&quot;에 집중하며 \&quot;어떻게 만든다\&quot;는 Codegen이 담당합니다. 상태, 이벤트, 애니메이션은 추상화 계층으로 밀어냅니다.\n\n### 3. 한 줄 한 의미 원칙 (One-intent-per-line)\n\n한 라인에 하나의 의미만 허용합니다. 한 줄에 두 개 의미를 섞으면 LLM이 실수할 가능성이 높아집니다.\n\n#### 좋은 예: 한 줄 한 의미\n&#96;&#96;&#96;dsl\nmeta:\n  title: \&quot;Home\&quot;\n\nmeta:\n  route: \&quot;/\&quot;\n&#96;&#96;&#96;\n\n#### 나쁜 예: 한 줄 다중 의미 (금지)\n&#96;&#96;&#96;dsl\nmeta: title: \&quot;Home\&quot;, route: \&quot;/\&quot;  # 잘못된 예\n&#96;&#96;&#96;\n\n### 4. 고정 블록 순서\n\n블록 구조는 **meta → style → components → layout → script** 순서를 유지합니다. 이 순서는 LLM이 외우기 쉽고 Codegen의 예측 가능성과 AST의 결정성을 보장합니다.\n\n### 5. 최소 표현, 최대 의미\n\nDSL은 짧고 규칙적이어야 합니다. CSS-like verbose, YAML 계층 증가, JSX 로직 섞임을 금지합니다. 의미 전달에 집중하는 최소 선언적 DSL입니다.\n\n### 6. 오류 제로 문법\n\n\&quot;AI가 틀릴 수 없는 언어\&quot;를 목표로 합니다. 쌍따옴표만 허용하고 세미콜론 없이 콜론만 사용합니다. 모든 키는 고정된 string literal이며 optional field를 최소화합니다.\n\n### 7. AST 1:1 매핑\n\n모든 UI 요소가 AST에 직접 매핑됩니다. meta 블록 → MetaNode, style 블록 → StyleNode, layout 블록 → LayoutTree로 변환됩니다.\n\n### 8. 기계 친화적 우선\n\n\&quot;사람이 읽으면 조금 불편할 것\&quot; 정도가 적정 수준입니다. 사람 UX보다 AI 정확성을 우선합니다.\n\n---\n\n## Foundation Layer\n\nUIH DSL의 가장 낮은 레벨 사양입니다. Character부터 Ordering까지의 기본 규칙을 정의하며, LLM이 실수할 수 없는 엄격한 문법을 제공합니다.\n\n### 1. Character Layer (문자 규칙)\n\n#### ALLOWED_CHARACTERS\n- a~z (lowercase alphabets)\n- 0~9 (digits)\n- hyphen (-)\n- underscore (_)\n- space ( )\n- newline (\\n)\n- braces: { }\n- colon (:)\n- double-quote (\&quot;)\n\n#### DISALLOWED_CHARACTERS\n- single-quote (&#39;)\n- semicolon (;)\n- parentheses ()\n- backtick (&#96;)\n- tab (\\t)\n- CRLF (\\r\\n)\n\n#### NEWLINE\n- always LF (\\n)\n- CRLF not supported\n\n### 2. Indentation Layer (들여쓰기 규칙)\n\n#### INDENTATION\n- exactly 2 spaces ONLY\n- tabs NOT allowed\n- indentation increases only inside a block\n- indentation does not imply hierarchy (not YAML)\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {           // ❌ 탭 사용 금지\n  title: \&quot;Home\&quot;  // ✅ 정확히 2 space\n}\n&#96;&#96;&#96;\n\n### 3. Token Layer (토큰 기본 규칙)\n\n#### TOKENS\n- IDENTIFIER = &#96;[a-z][a-z0-9.]*&#96;\n- STRING = &#96;\&quot;[^\&quot;\\\\]*(?:\\\\.[^\&quot;\\\\]*)*\&quot;&#96; (supports &#96;\\\&quot;&#96; escape)\n- NUMBER = &#96;\\d+(?:\\.\\d+)?&#96;\n- LBRACE = &#96;{&#96;\n- RBRACE = &#96;}&#96;\n- COLON = &#96;:&#96;\n- NEWLINE = &#96;\\n&#96;\n- WHITESPACE = single space\n\n#### IDENTIFIER_RULES\n- lowercase only\n- dot notation allowed (e.g. &#96;color.primary&#96;)\n- do NOT mix hyphens inside identifiers (LLM error-prone)\n\n#### STRING_RULES\n- must use double quotes only\n- escaping uses &#96;\\\&quot;&#96;\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {\n  color.primary: \&quot;#fff\&quot;    // ✅ dot notation 허용\n  label: \&quot;Click \\\&quot;here\\\&quot;\&quot;  // ✅ escape 허용\n  width: 100.5            // ✅ 소수 허용\n}\n&#96;&#96;&#96;\n\n### 4. Comment Layer (코멘트)\n\n#### COMMENTS\n- comments NOT supported\n- any attempt to use &#96;//&#96; or &#96;#&#96; is invalid\n- purpose: reduce ambiguity for LLM\n\n### 5. Statement Layer (기본 문장 구조)\n\n#### STATEMENT_TYPES\n- Block Declaration\n- Property Declaration\n\n#### BLOCK_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt; {\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n#### PROPERTY_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n#### SEMICOLON\n- NOT allowed (never used)\n\n### 6. Block Layer (블록 기본 규칙)\n\n#### BLOCK_STRUCTURE\n&#96;&#96;&#96;\nblockName {\n  property: \&quot;value\&quot;\n  property: 123\n  property: true\n}\n&#96;&#96;&#96;\n\n#### BLOCK_RULES\n- block cannot contain nested blocks\n- ONLY layout block may contain nested layout nodes\n\n### 7. Ordering Layer (순서 강제)\n\n#### BLOCK_ORDER\n1. meta\n2. style\n3. components (optional)\n4. layout\n5. script (optional)\n\n#### RULE\n- if a block appears, must follow this order\n- missing blocks are allowed except meta/style/layout\n\n### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  primary-color: \&quot;#111\&quot;\n}\n\ncomponents {\n  Button {\n    variant: \&quot;primary\&quot;\n  }\n}\n\nlayout {\n  Container {\n    children: \&quot;Button\&quot;\n  }\n}\n\nscript {\n  // optional script\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단\n- 잘못된 들여쓰기 발견 시 구문 오류\n- 코멘트 시도 시 즉시 무효 처리\n- 블록 순서 위반 시 파싱 실패\n- layout 외 중첩 블록 시도 시 오류\n\n---\n\n## Tokenizer Specification\n\nFoundation Layer + Grammar Layers 기반의 공식 토큰화 규칙입니다. DSL 문자열을 균일한 Token 리스트로 변환하며, 모든 파싱의 기반이 됩니다.\n\n### 1. Tokenizer Overview\n\n#### PURPOSE\n- DSL 문자열을 균일한 Token 리스트로 변환\n- 모호성 없는 deterministic token stream 생성\n- 모든 파싱은 이 토큰 리스트 기반으로 진행\n\n#### INPUT\n- LF 기반의 DSL 문자열\n\n#### OUTPUT\n- 순차적 Token 배열\n\n### 2. Token Types\n\n#### TOKENS\n- &#96;IDENTIFIER&#96; - meta, title, color.primary, class 등\n- &#96;STRING&#96; - \&quot;Hello\&quot;\n- &#96;NUMBER&#96; - 0, 12, 0.8\n- &#96;BOOLEAN&#96; - true, false\n- &#96;LBRACE&#96; - {\n- &#96;RBRACE&#96; - }\n- &#96;LPAREN&#96; - (\n- &#96;RPAREN&#96; - )\n- &#96;COLON&#96; - :\n- &#96;COMMA&#96; - ,\n- &#96;NEWLINE&#96; - \\n\n- &#96;WHITESPACE&#96; - space (only used between tokens)\n- &#96;TEXT_STRING&#96; - layout children string ONLY (disambiguation)\n- &#96;EOF&#96; - end of file marker\n\n### 3. Identifier Detection\n\n#### IDENTIFIER_RULES\n- regex: &#96;^[a-z][a-z0-9.]*$&#96;\n- lowercase only\n- dot notation allowed\n- hyphens, underscores 금지\n\n#### TAGNAME_RULES\n- starts with uppercase letter\n- subsequent chars: &#96;[a-zA-Z0-9]&#96;\n- TagName (e.g. Div, Header) 구분용\n\n#### TAGNAME_EXAMPLES\n&#96;&#96;&#96;\nDiv\nSection\nImage\nH1\n&#96;&#96;&#96;\n\n### 4. String Token Rules\n\n#### STRING\n- starts with &#96;\&quot;&#96;\n- ends with &#96;\&quot;&#96;\n- inside supports &#96;\\\&quot;&#96;\n- no multi-line\n\n#### TEXT_STRING\n- STRING과 동일한 문법\n- 단, layout children context에서만 등장\n- Parser에서 context-aware로 구분\n\n### 5. Number Token Rules\n\n#### NUMBER\n- regex: &#96;^[0-9]+(\\.[0-9]+)?$&#96;\n- no negative numbers\n- no units (px, rem 등)\n\n### 6. Boolean Token Rules\n\n#### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n- strictly lowercase\n\n### 7. Brace / Symbol Tokens\n\n#### SYMBOL_TOKENS\n- &#96;LBRACE&#96;: &#96;{&#96;\n- &#96;RBRACE&#96;: &#96;}&#96;\n- &#96;LPAREN&#96;: &#96;(&#96;\n- &#96;RPAREN&#96;: &#96;)&#96;\n- &#96;COLON&#96;: &#96;:&#96;\n- &#96;COMMA&#96;: &#96;,&#96;\n\n#### NOTES\n- semicolon NOT allowed\n- backtick NOT allowed\n\n### 8. Whitespace / Newline Rules\n\n#### WHITESPACE\n- single space &#96;&#39; &#39;&#96;\n- no tabs\n- no multi-space sequences except indentation (2 spaces)\n\n#### NEWLINE\n- LF only\n- CRLF invalid\n\n### 9. Layout Context Rules (Critical)\n\n#### LAYOUT_MODE\nTokenizer enters layout-mode when encountering:\n&#96;&#96;&#96;\nlayout { … }\n&#96;&#96;&#96;\n\n#### CONTEXT_SWITCH\n- after TagName(\n- before encountering next node or text\n\n#### INSIDE_LAYOUT_BLOCK\n- children detection required\n- plain strings must become TEXT_STRING token\n- siblings separated by NEWLINE\n\n#### EXAMPLE\n&#96;&#96;&#96;\n\&quot;Welcome\&quot; → TEXT_STRING inside layout\n&#96;&#96;&#96;\n\n### 10. Tokenization Algorithm (High-Level)\n\n1. iterate through chars\n2. skip whitespace unless meaningful (indent)\n3. detect IDENTIFIER or TAGNAME\n4. detect STRING (with escape)\n5. detect NUMBER\n6. detect BOOLEAN\n7. detect braces &#96;{ }&#96;\n8. detect parentheses &#96;( )&#96;\n9. detect colon &#96;:&#96; or comma &#96;,&#96;\n10. detect newline &#96;\\n&#96;\n11. maintain context stack:\n    - normal\n    - inside layout block\n    - inside attributes\n12. output final EOF token\n\n### 11. Example Token Stream\n\n#### INPUT\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### OUTPUT_TOKENS\n&#96;&#96;&#96;\nIDENTIFIER(layout)\nLBRACE\nNEWLINE\nTAGNAME(Div)\nLPAREN\nIDENTIFIER(class)\nCOLON\nSTRING(\&quot;p-4\&quot;)\nRPAREN\nLBRACE\nNEWLINE\nTEXT_STRING(\&quot;Hello\&quot;)\nNEWLINE\nRBRACE\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Token Stream Examples\n\n#### 기본 블록 토큰화\n&#96;&#96;&#96;dsl\nmeta {\n  title: \&quot;Home\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(meta)\nLBRACE\nNEWLINE\nIDENTIFIER(title)\nCOLON\nSTRING(\&quot;Home\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n#### 스타일 블록 토큰화\n&#96;&#96;&#96;dsl\nstyle {\n  color.primary: \&quot;#fff\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(style)\nLBRACE\nNEWLINE\nIDENTIFIER(color.primary)\nCOLON\nSTRING(\&quot;#fff\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단 및 오류 반환\n- CRLF 줄바꿈 발견 시 LF로 변환 또는 오류\n- 탭 문자 발견 시 공백 변환 또는 오류\n- STRING에서 미닫힘 따옴표 시 오류\n- NUMBER에 음수나 단위 포함 시 오류\n- layout 외 컨텍스트에서 TEXT_STRING 시도 시 오류\n- TAGNAME 규칙 위반 (소문자 시작) 시 IDENTIFIER로 처리\n\n---\n\n## Grammar\n\n### Block Grammar\n\nUIH DSL의 최상위 구조를 정의하는 Block Grammar Layer입니다. Foundation Layer 바로 위에 위치하며, 5개 블록의 선언, 순서, 내용 규칙을 명시합니다.\n\n#### 1. Block Definitions (5개 블록)\n\n##### BLOCKS\n- meta\n- style\n- components (optional)\n- layout\n- script (optional)\n\n##### RULES\n- 블록은 반드시 이 순서를 따라야 함: meta → style → components → layout → script\n- meta, style, layout은 필수\n- components, script는 선택\n- 각 블록은 정확히 한 번만 등장\n- 중복 블록 금지\n\n#### 2. Block Syntax (기본 문법)\n\n##### BLOCK_SYNTAX\n&#96;&#96;&#96;\n&lt;blockName&gt; {\n  &lt;property&gt;: &lt;value&gt;\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n&#96;&#96;&#96;\n\n##### SYNTAX_COMPONENTS\n- 블록 시작: IDENTIFIER + &#96; {&#96;\n- 블록 끝: &#96;}&#96; 단독 줄\n\n#### 3. Block Content Rules\n\n##### 공통 규칙\n- 블록 내부에는 property statements만 존재\n- block 내부에 block 중첩 금지\n- 단, layout 블록만 예외적으로 UI tree 구조 허용\n\n##### PROPERTY_RULE\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### VALUE_TYPES\n- string\n- number\n- boolean\n- enum-like literals (string 값)\n- list (향후 정의)\n\n#### 4. Block-Specific Rules\n\n##### (1) META BLOCK\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Page title\&quot;\n  route: \&quot;/path\&quot;\n  theme: \&quot;light\&quot;|\&quot;dark\&quot;\n}\n&#96;&#96;&#96;\n\n**META_RESTRICTIONS:**\n- meta는 UI 문서의 metadata만 포함\n- layout 정보나 스타일 정보 포함 금지\n\n##### (2) STYLE BLOCK\n&#96;&#96;&#96;\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n}\n&#96;&#96;&#96;\n\n**STYLE_RESTRICTIONS:**\n- key는 dot notation 사용 가능\n- 값은 string 또는 number\n- layout 관련 속성 금지\n- theme override 불가\n\n##### (3) COMPONENTS BLOCK (optional)\n&#96;&#96;&#96;\ncomponents {\n  Card\n  Button\n  Input\n}\n&#96;&#96;&#96;\n\n**COMPONENTS_RULES:**\n- 등록할 컴포넌트 이름만 줄 단위로 나열\n- 중첩 구조 없음\n- 속성 없음\n- 문자열 아님: &#96;\&quot;Card\&quot;&#96; 금지, &#96;Card&#96;만 허용\n\n##### (4) LAYOUT BLOCK\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n**LAYOUT_RULES:**\n- 유일하게 중첩 구조 허용\n- 노드 문법은 별도 Layer에서 정의\n- property는 inline attribute 형태 가능\n- block-like structure 유지\n\n##### (5) SCRIPT BLOCK (optional)\n&#96;&#96;&#96;\nscript {\n  onclick: \&quot;submitForm\&quot;\n  onload: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n**SCRIPT_RESTRICTIONS:**\n- event/behavior mapping만 정의\n- JS code 삽입 금지\n- inline function 금지\n- event identifier는 반드시 lowercase (camelCase 금지)\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n  spacing.unit: 8\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n}\n\nlayout {\n  Div(class:\&quot;container mx-auto p-4\&quot;) {\n    Card(class:\&quot;bg-white shadow-lg\&quot;) {\n      Button(onclick:\&quot;handleSubmit\&quot;) {\n        \&quot;Submit\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;processForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 파싱 실패\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유효 (경고)\n- components/script 외 블록에서 중첩 시도 시 오류\n- layout 외 블록에서 attribute 사용 시 오류\n\n---\n\n### Property Grammar\n\nUIH DSL 안정성의 핵심인 Property Grammar Layer입니다. Block Grammar 위에 쌓이며, 속성 선언, 값 타입, 범위 규칙을 정의합니다.\n\n#### 1. Property Declaration Syntax\n\n##### PROPERTY_SYNTAX\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\nradius.default: 8\nenabled: true\n&#96;&#96;&#96;\n\n##### RULES\n- identifier는 반드시 lowercase\n- dot notation 허용 (&#96;color.primary&#96; 등)\n- colon(:) 뒤에는 반드시 space 1개\n- value는 줄 끝까지\n\n#### 2. Identifier Rules\n\n##### IDENTIFIER\n- 패턴: &#96;[a-z][a-z0-9.]*&#96;\n- 소문자만 허용\n- 숫자는 뒤쪽에만 허용\n- dot(.)은 중첩 속성 의미로만 사용\n- hyphen 금지 (LLM 오류 방지)\n- underscore 금지\n\n##### VALID\n&#96;&#96;&#96;\ncolor.primary\nfont.size\nborder.width\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nColor.Primary    // 대문자\nfont-size        // hyphen\nfont_size        // underscore\nprimary2.color   // 숫자 앞쪽\n&#96;&#96;&#96;\n\n#### 3. Value Types (5가지)\n\n##### VALUE_TYPES\n1. STRING\n2. NUMBER\n3. BOOLEAN\n4. ENUM-LIKE (string 기반)\n5. LIST (여러 값 나열, 줄 단위)\n\n#### 4. String Value Rules\n\n##### STRING\n- 무조건 double-quote 사용\n- 내부에 &#96;\&quot;&#96; 포함 시 &#96;\\\&quot;&#96;로 escape\n- single-quote 절대 금지\n\n##### VALID\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\ndescription: \&quot;He said \\\&quot;ok\\\&quot;\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\ntitle: &#39;Home&#39;      // single-quote\nname: \&quot;Home\&quot;       // curly quotes\n&#96;&#96;&#96;\n\n#### 5. Number Value Rules\n\n##### NUMBER\n- 정수 또는 소숫점 가능\n- 음수는 허용하지 않음\n- 단위(px 등) 금지 → unitless 구조\n\n##### VALID\n&#96;&#96;&#96;\nradius: 12\nopacity: 0.85\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nradius: -4     // 음수\nwidth: 10px    // 단위 포함\n&#96;&#96;&#96;\n\n#### 6. Boolean Value Rules\n\n##### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nenabled: true\nvisible: false\n&#96;&#96;&#96;\n\n#### 7. Enum-like String Rules\n\n##### ENUM_STRING\n- 문자열이지만 값이 고정된 타입처럼 쓰는 케이스\n- allowed values는 별도 block schema마다 정의\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntheme: \&quot;light\&quot; | \&quot;dark\&quot;\nsize: \&quot;sm\&quot; | \&quot;md\&quot; | \&quot;lg\&quot;\n&#96;&#96;&#96;\n\n#### 8. List Value (Block-like list)\n\n##### LIST\n- 각 항목은 줄 단위로 입력\n- 대괄호 &#96;[]&#96; 문법 없음 (LLM 오류 방지)\n- 문자열/식별자 혼용 가능\n\n##### SYNTAX\n&#96;&#96;&#96;\nitems {\n  \&quot;one\&quot;\n  \&quot;two\&quot;\n  \&quot;three\&quot;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- list block 내부에는 property 없음\n- indent 2 spaces 유지\n\n##### EXAMPLE\n&#96;&#96;&#96;\ntags {\n  \&quot;news\&quot;\n  \&quot;feature\&quot;\n  \&quot;announcement\&quot;\n}\n&#96;&#96;&#96;\n\n#### 9. Property Scope Rules (Block별 허용 속성 경계)\n\n##### META_SCOPE\n- meta는 UI metadata만 포함\n- route, title, theme, description 등\n\n##### STYLE_SCOPE\n- 색상, 폰트, radius 등 UI 스타일만\n- layout 속성 금지 (width, height 등은 layout block에서만)\n\n##### COMPONENTS_SCOPE\n- property 없음 (등록만)\n\n##### LAYOUT_SCOPE\n- inline attribute만 (class, id, ref 등)\n- 값은 무조건 string\n- boolean/number 사용 금지\n\n##### SCRIPT_SCOPE\n- event mapping 전용\n- 값은 무조건 string\n\n#### 10. Final Validation Rules\n\n1. 모든 property는 블록 내부에서만 존재\n2. 같은 identifier 중복 선언 금지\n3. meta/style/script는 property-only 구조\n4. components는 선언만 (property 없음)\n5. layout만 child nodes 보유 가능\n6. value의 타입은 block-specific rule을 반드시 준수\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main dashboard page\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  border.radius: 8\n  spacing.unit: 16\n}\n\ncomponents {\n  Card\n  Button\n  Input\n}\n\nlayout {\n  class: \&quot;container\&quot;\n  id: \&quot;main-content\&quot;\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;handleForm\&quot;\n  onrefresh: \&quot;reloadData\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 대문자 identifier 사용 시 토큰화 실패\n- hyphen/underscore 사용 시 구문 오류\n- single-quote나 curly quotes 사용 시 파싱 실패\n- 음수나 단위 포함 숫자 시 값 오류\n- 블록별 스코프 위반 시 validation 실패\n- 중복 property 선언 시 마지막 값만 유효 (경고)\n\n---\n\n### Layout Tree Grammar\n\nUIH DSL의 핵심 구조인 Layout Tree Grammar Layer입니다. Block Grammar와 Property Grammar 위에서 동작하며, UI 구성 요소의 트리 구조를 정의합니다.\n\n#### 1. Layout Block Overview\n\n##### LAYOUT_BLOCK\n&#96;&#96;&#96;\nlayout {\n  &lt;layout-node&gt;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- DSL에서 유일하게 중첩 구조를 가질 수 있는 블록\n- 모든 UI 구성 요소는 layout node로 표현\n- 노드는 \&quot;구조\&quot;만 표현, 스타일/로직은 표현하지 않음\n\n#### 2. Layout Node Syntax\n\n##### NODE_SYNTAX\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;) {\n  &lt;children&gt;\n}\n&#96;&#96;&#96;\n\n##### OR (children 없는 경우)\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;)\n&#96;&#96;&#96;\n\n##### NOTES\n- TagName은 PascalCase 컴포넌트 또는 HTML-like 사용 가능\n- attributes는 inline 형태 only\n- attributes는 옵션, 없어도 됨\n- children 블록은 중첩 가능\n\n##### VALID\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) {\n  \&quot;Hello\&quot;\n}\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nDiv {\n  class: \&quot;p-4\&quot;    // 속성은 block 기반이 아니라 inline only\n}\n&#96;&#96;&#96;\n\n#### 3. TagName Rules\n\n##### TAGNAME\n- 반드시 알파벳으로 시작\n- PascalCase 또는 UpperCamelCase 권장\n- HTML-like 소문자 태그는 사용 가능 (&#96;div&#96;, &#96;span&#96;) 단 내부적으로는 UpperCase 변환됨\n\n##### VALID\n&#96;&#96;&#96;\nDiv\nSection\nImage\nheader   // 허용하지만 변환 시 Header로 취급\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n3Div     // 숫자 시작\n_Box     // underscore 시작\n-Node    // hyphen 시작\n&#96;&#96;&#96;\n\n#### 4. Attribute Syntax\n\n##### ATTRIBUTES\n&#96;&#96;&#96;\n&lt;identifier&gt;:\&quot;&lt;string&gt;\&quot;\n&#96;&#96;&#96;\n\n##### RULES\n- value는 무조건 string only\n- boolean/number 금지\n- &#96;class:\&quot;p-4\&quot;&#96; 형태처럼 inline만 허용\n- 각 attribute는 콤마(&#96;,&#96;)로 구분\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;, id:\&quot;main\&quot;, ref:\&quot;root\&quot;)\n&#96;&#96;&#96;\n\n##### STRICT_RULES\n- 속성 순서는 의미 없음 (LLM 실수 방지로 자유 순서)\n- attribute key는 lower-case only\n- 속성 개수 0~5 정도 권장\n\n#### 5. Children Rules\n\n##### CHILD_TYPES\n- string literal\n- another layout node\n- list of siblings (node 여러 개 배치)\n\n##### STRING_CHILD\n&#96;&#96;&#96;\n\&quot;Hello world\&quot;\n&#96;&#96;&#96;\n\n##### NESTED_NODE\n&#96;&#96;&#96;\nDiv(class:\&quot;mt-4\&quot;) {\n  \&quot;content\&quot;\n}\n&#96;&#96;&#96;\n\n##### SIBLINGS\n&#96;&#96;&#96;\nDiv(...) { ... }\nP(...) { ... }\nImage(...)\n&#96;&#96;&#96;\n\n#### 6. Text Node Rules\n\n##### TEXT_NODE\n- 무조건 double-quote string\n- 줄바꿈 포함 금지\n- 텍스트 덩어리는 여러 줄로 쪼개면 안 됨\n\n##### VALID\n&#96;&#96;&#96;\n\&quot;Sign in to continue\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n\&quot;Hello\n World\&quot;    // 줄바꿈 포함\n&#96;&#96;&#96;\n\n#### 7. Node Termination Rules\n\n##### CLOSING_RULES\n- 블록 노드는 반드시 &#96;}&#96; 단독 줄로 닫는다\n- inline-only 노드는 종료 블록 없음\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;px-4\&quot;) {\n  P {\n    \&quot;Hello\&quot;\n  }\n  Image(src:\&quot;/logo.png\&quot;)\n}\n&#96;&#96;&#96;\n\n#### 8. Layout Grammar Formal Pattern\n\n##### LAYOUT_NODE_GRAMMAR\n&#96;&#96;&#96;\nNode:\n  Tag (Attributes?) (ChildrenBlock?)\n\nTag:\n  IDENTIFIER\n\nAttributes:\n  \&quot;(\&quot; AttributeList \&quot;)\&quot;\n\nAttributeList:\n  Attribute (\&quot;,\&quot; Attribute)*\n\nAttribute:\n  IDENTIFIER \&quot;:\&quot; STRING\n\nChildrenBlock:\n  \&quot;{\&quot; NewLine Indented(NodeOrText)+ \&quot;}\&quot;\n\nNodeOrText:\n  Node | STRING\n&#96;&#96;&#96;\n\n#### 9. Validation Rules\n\n1. layout은 트리 구조만 표현한다\n2. inline attributes만 허용\n3. 속성은 string-only\n4. children은 반드시 정해진 중첩 규칙을 따른다\n5. Node 이름은 PascalCase가 기본\n6. 문자열 children 외에는 모든 children은 Node여야 한다\n7. siblings 허용, 순서 보존\n\n#### 10. Example (Valid Layout Tree)\n\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;min-h-screen flex flex-col\&quot;) {\n    Header(class:\&quot;p-4 bg-gray-100\&quot;) {\n      H1 {\n        \&quot;Dashboard\&quot;\n      }\n    }\n\n    Main(class:\&quot;flex-1 p-6\&quot;) {\n      Card(class:\&quot;shadow\&quot;) {\n        P {\n          \&quot;Welcome back!\&quot;\n        }\n      }\n    }\n\n    Footer(class:\&quot;p-4 text-center\&quot;) {\n      \&quot;© 2025 The Bespoke\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto\&quot;) {\n    Navbar(class:\&quot;flex justify-between items-center p-4\&quot;) {\n      Logo(class:\&quot;text-xl font-bold\&quot;) {\n        \&quot;UIH\&quot;\n      }\n      Nav(class:\&quot;space-x-4\&quot;) {\n        Link(href:\&quot;/home\&quot;) {\n          \&quot;Home\&quot;\n        }\n        Link(href:\&quot;/about\&quot;) {\n          \&quot;About\&quot;\n        }\n      }\n    }\n\n    Content(class:\&quot;grid grid-cols-3 gap-6 p-6\&quot;) {\n      Sidebar(class:\&quot;col-span-1 bg-gray-50 p-4\&quot;) {\n        Menu {\n          \&quot;Dashboard\&quot;\n          \&quot;Settings\&quot;\n          \&quot;Profile\&quot;\n        }\n      }\n\n      Main(class:\&quot;col-span-2\&quot;) {\n        Article(class:\&quot;prose\&quot;) {\n          H2 {\n            \&quot;Getting Started\&quot;\n          }\n          P {\n            \&quot;Welcome to UIH DSL documentation.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- TagName에 숫자/특수문자 시작 시 토큰화 실패\n- 속성에 boolean/number 값 사용 시 파싱 오류\n- 텍스트 노드에 줄바꿈 포함 시 validation 실패\n- 노드 종료 &#96;}&#96; 누락 시 구문 오류\n- 중첩 깊이가 너무 깊을 경우 (권장 5레벨 초과) 경고\n- siblings 간 순서가 UI 의미에 영향 줄 경우 재검토\n\n---\n\n### Parser BNF Grammar\n\nTokenizer 위에서 동작하는 공식 문법 엔진 정의입니다. Token Stream을 Abstract Syntax Tree(AST)로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- Token Stream → Abstract Syntax Tree(AST)\n\n##### PARSER_MODE\n- strict non-ambiguous grammar\n- no recovery parsing (에러는 즉시 throw)\n- deterministic (LLM-friendly)\n- recursive descent parser 기반 구조\n\n#### 2. Entry Point\n\n##### Program\n&#96;&#96;&#96;\nProgram ::= MetaBlock StyleBlock ComponentsBlock? LayoutBlock ScriptBlock? EOF\n&#96;&#96;&#96;\n\n#### 3. Blocks\n\n##### Block_Definitions\n&#96;&#96;&#96;\nMetaBlock       ::= \&quot;meta\&quot; BlockBody(MetaProperty)\nStyleBlock      ::= \&quot;style\&quot; BlockBody(StyleProperty)\nComponentsBlock ::= \&quot;components\&quot; BlockBody(ComponentEntry)\nLayoutBlock     ::= \&quot;layout\&quot; LayoutBody\nScriptBlock     ::= \&quot;script\&quot; BlockBody(ScriptProperty)\n&#96;&#96;&#96;\n\n#### 4. Generic Block Body\n\n##### BlockBody\n&#96;&#96;&#96;\nBlockBody(&lt;T&gt;) ::= LBRACE NEWLINE (Indent &lt;T&gt; NEWLINE)* RBRACE\nIndent         ::= WHITESPACE WHITESPACE    # 2 spaces only\n&#96;&#96;&#96;\n\n#### 5. META Block Grammar\n\n##### MetaProperty\n&#96;&#96;&#96;\nMetaProperty ::= Identifier \&quot;:\&quot; MetaValue\nMetaValue    ::= STRING | NUMBER | BOOLEAN | EnumString\n&#96;&#96;&#96;\n\n##### Allowed_Meta_Keys\n- title, route, theme, description\n\n#### 6. STYLE Block Grammar\n\n##### StyleProperty\n&#96;&#96;&#96;\nStyleProperty ::= StyleKey \&quot;:\&quot; StyleValue\nStyleKey      ::= Identifier ( \&quot;.\&quot; Identifier )*\nStyleValue    ::= STRING | NUMBER | EnumString\n&#96;&#96;&#96;\n\n##### Notes\n- no nested blocks\n- no boolean\n- layout-like attributes 금지\n\n#### 7. COMPONENTS Block Grammar\n\n##### ComponentEntry\n&#96;&#96;&#96;\nComponentEntry ::= ComponentName\nComponentName  ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n##### NOTES\n- but no quotes, no values, one per line\n\n##### Examples\n&#96;&#96;&#96;\nCard\nButton\nInput\n&#96;&#96;&#96;\n\n#### 8. LAYOUT Block Grammar (Core)\n\n##### LayoutBody\n&#96;&#96;&#96;\nLayoutBody     ::= LBRACE NEWLINE Indent LayoutNodeList RBRACE\nLayoutNodeList ::= (LayoutNode NEWLINE)*\nLayoutNode     ::= Tag (Attributes)? (ChildrenBlock)?\nTag            ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n#### 9. Attributes Grammar\n\n##### Attributes\n&#96;&#96;&#96;\nAttributes    ::= LPAREN AttributeList RPAREN\nAttributeList ::= Attribute (COMMA Attribute)*\nAttribute     ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n#### 10. Children Block Grammar\n\n##### ChildrenBlock\n&#96;&#96;&#96;\nChildrenBlock ::= LBRACE NEWLINE Indent ChildrenList RBRACE\nChildrenList  ::= (Child NEWLINE)*\nChild         ::= LayoutNode | TEXT_STRING\n&#96;&#96;&#96;\n\n#### 11. SCRIPT Block Grammar\n\n##### ScriptProperty\n&#96;&#96;&#96;\nScriptProperty ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n##### Allowed_Script_Keys\n- onclick, onload, onsubmit, onmount, onchange\n\n&gt; 모든 script event identifier는 전부 소문자여야 하며 camelCase를 사용하지 않는다.\n\n#### 12. Value Grammars\n\n##### Value_Types\n&#96;&#96;&#96;\nSTRING     ::= \&quot;\\\&quot;\&quot; &lt;chars&gt; \&quot;\\\&quot;\&quot;\nNUMBER     ::= digits ( \&quot;.\&quot; digits )?\nBOOLEAN    ::= \&quot;true\&quot; | \&quot;false\&quot;\nEnumString ::= STRING   # validated in semantic phase\n&#96;&#96;&#96;\n\n#### 13. Identifier Grammars\n\n##### Identifiers\n&#96;&#96;&#96;\nIdentifier ::= [a-z][a-z0-9.]*\nTagName    ::= [A-Z][a-zA-Z0-9]*\n&#96;&#96;&#96;\n\n#### 14. Syntax Constraints (Formal)\n\n1. 모든 블록은 순서 고정\n2. 각 블록은 1회만 등장\n3. meta/style/layout은 필수\n4. components/script는 optional\n5. 들여쓰기 2 spaces only\n6. 속성(colon)은 반드시 &#96;&lt;id&gt;: &lt;value&gt;&#96;\n7. semicolon 금지\n8. layout만 nested structure 허용\n9. children 안에서는 TEXT_STRING 또는 LayoutNode만 허용\n10. parser는 ambiguous branch 금지 (LLM-safe)\n\n#### 15. Complete Example (BNF-valid)\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  radius.default: 8\n}\n\ncomponents {\n  Card\n  Button\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello world\&quot;\n    }\n  }\n}\n\nscript {\n  onClick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### BNF 구조 트리\n\n&#96;&#96;&#96;\nProgram\n├── MetaBlock\n│   ├── LBRACE\n│   ├── MetaProperty (title: \&quot;Home\&quot;)\n│   ├── MetaProperty (route: \&quot;/\&quot;)\n│   └── RBRACE\n├── StyleBlock\n│   ├── LBRACE\n│   ├── StyleProperty (color.primary: \&quot;#0E5EF7\&quot;)\n│   ├── StyleProperty (radius.default: 8)\n│   └── RBRACE\n├── ComponentsBlock\n│   ├── LBRACE\n│   ├── ComponentEntry (Card)\n│   ├── ComponentEntry (Button)\n│   └── RBRACE\n├── LayoutBlock\n│   ├── LBRACE\n│   ├── LayoutNode (Div)\n│   │   ├── Attributes (class:\&quot;p-4\&quot;)\n│   │   └── ChildrenBlock\n│   │       └── LayoutNode (P)\n│   │           └── ChildrenBlock\n│   │               └── TEXT_STRING (\&quot;Hello world\&quot;)\n│   └── RBRACE\n└── ScriptBlock\n    ├── LBRACE\n    ├── ScriptProperty (onClick: \&quot;submitForm\&quot;)\n    └── RBRACE\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 즉시 파싱 중단\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유지 (경고)\n- 들여쓰기 2 space 위반 시 구문 오류\n- layout 외 블록에서 중첩 시도 시 파싱 실패\n- 허용되지 않은 키 사용 시 semantic 오류 (parser 단계에서는 허용)\n- TEXT_STRING이 layout 외 컨텍스트에서 등장 시 오류\n\n---\n\n## AST Schema Definition\n\nParser BNF 위에서 생성되는 최종 AST 구조입니다. 모든 UIH DSL 요소가 이 스키마에 따라 구조화됩니다.\n\n### 1. AST Root\n\n#### ASTRoot\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Program\&quot;\n  meta: MetaNode\n  style: StyleNode\n  components: ComponentsNode | null\n  layout: LayoutNode\n  script: ScriptNode | null\n}\n&#96;&#96;&#96;\n\n### 2. Meta Node\n\n#### MetaNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Meta\&quot;\n  properties: MetaProperty[]\n}\n&#96;&#96;&#96;\n\n#### MetaProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;title\&quot;\n  value: string|number|boolean\n  location: Range     // from tokenizer\n}\n&#96;&#96;&#96;\n\n### 3. Style Node\n\n#### StyleNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Style\&quot;\n  properties: StyleProperty[]\n}\n&#96;&#96;&#96;\n\n#### StyleProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;color.primary\&quot;\n  value: string|number\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 4. Components Node\n\n#### ComponentsNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Components\&quot;\n  components: ComponentEntry[]\n}\n&#96;&#96;&#96;\n\n#### ComponentEntry\n&#96;&#96;&#96;typescript\n{\n  name: string        // e.g. \&quot;Card\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 5. Layout Node (Core Tree Structure)\n\n#### LayoutNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Layout\&quot;\n  children: LayoutElement[]     // top-level nodes inside layout block\n}\n&#96;&#96;&#96;\n\n#### LayoutElement\n&#96;&#96;&#96;typescript\nLayoutElement = LayoutComponent | LayoutText\n&#96;&#96;&#96;\n\n#### 5.1 Layout Component\n&#96;&#96;&#96;typescript\nLayoutComponent {\n  type: \&quot;Component\&quot;\n  tag: string                   // e.g. \&quot;Div\&quot;, \&quot;P\&quot;, \&quot;Header\&quot;\n  attributes: Attribute[]\n  children: LayoutElement[]     // nested structure\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### Attribute\n&#96;&#96;&#96;typescript\n{\n  key: string                   // lower-case only\n  value: string                 // inline string only\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### 5.2 Layout Text Node\n&#96;&#96;&#96;typescript\nLayoutText {\n  type: \&quot;Text\&quot;\n  value: string                 // raw text string\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 6. Script Node\n\n#### ScriptNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Script\&quot;\n  events: ScriptProperty[]\n}\n&#96;&#96;&#96;\n\n#### ScriptProperty\n&#96;&#96;&#96;typescript\n{\n  key: string                   // e.g. \&quot;onClick\&quot;\n  value: string                 // e.g. \&quot;submitForm\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 7. Range Object (Source Location)\n\n#### Range\n&#96;&#96;&#96;typescript\n{\n  start: Position\n  end: Position\n}\n&#96;&#96;&#96;\n\n#### Position\n&#96;&#96;&#96;typescript\n{\n  line: number\n  column: number\n}\n&#96;&#96;&#96;\n\n### 8. Semantics Rules (Validation Layer)\n\n1. Meta keys must be from allowlist:\n   - title, route, theme, description\n\n2. Style keys may use dot notation but MUST be lowercase.\n\n3. Components must be names only, no properties.\n\n4. Layout:\n   - tag must be a valid TagName or valid identifier\n   - attributes must be string-only\n   - children: array of LayoutElement (component or text)\n\n5. Script:\n   - keys must be known event names\n   - value must be string (function name)\n\n6. No null children arrays. Use &#96;[]&#96; if empty.\n\n7. All nodes must have location data.\n\n### 9. Example: Full AST for a Simple Page\n\n#### Example DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### Generated AST (simplified)\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Home\&quot; },\n      { \&quot;key\&quot;: \&quot;route\&quot;, \&quot;value\&quot;: \&quot;/\&quot; }\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;color.primary\&quot;, \&quot;value\&quot;: \&quot;#0E5EF7\&quot; }\n    ]\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: [\n          { \&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;p-4\&quot; }\n        ],\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n### AST 구조 트리\n\n&#96;&#96;&#96;\nASTRoot (Program)\n├── meta (MetaNode)\n│   └── properties[] (MetaProperty)\n├── style (StyleNode)\n│   └── properties[] (StyleProperty)\n├── components (ComponentsNode | null)\n│   └── components[] (ComponentEntry)\n├── layout (LayoutNode)\n│   └── children[] (LayoutElement)\n│       ├── LayoutComponent\n│       │   ├── attributes[] (Attribute)\n│       │   └── children[] (LayoutElement)\n│       └── LayoutText\n└── script (ScriptNode | null)\n    └── events[] (ScriptProperty)\n&#96;&#96;&#96;\n\n### AST Examples\n\n#### 최소 AST 구조\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      {\&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Minimal\&quot;}\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: []\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Text\&quot;,\n        \&quot;value\&quot;: \&quot;Content\&quot;\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n#### 복잡한 레이아웃 AST\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Layout\&quot;,\n  \&quot;children\&quot;: [\n    {\n      \&quot;type\&quot;: \&quot;Component\&quot;,\n      \&quot;tag\&quot;: \&quot;Div\&quot;,\n      \&quot;attributes\&quot;: [\n        {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;container\&quot;}\n      ],\n      \&quot;children\&quot;: [\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Header\&quot;,\n          \&quot;attributes\&quot;: [],\n          \&quot;children\&quot;: [\n            {\n              \&quot;type\&quot;: \&quot;Component\&quot;,\n              \&quot;tag\&quot;: \&quot;H1\&quot;,\n              \&quot;attributes\&quot;: [],\n              \&quot;children\&quot;: [\n                {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Title\&quot;}\n              ]\n            }\n          ]\n        },\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Main\&quot;,\n          \&quot;attributes\&quot;: [\n            {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;content\&quot;}\n          ],\n          \&quot;children\&quot;: [\n            {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Main content\&quot;}\n          ]\n        }\n      ]\n    }\n  ]\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- location 정보 누락 시 AST 생성 실패\n- 빈 children 배열 대신 null 사용 시 validation 오류\n- 허용되지 않은 meta/style/script 키 사용 시 semantic 오류\n- LayoutComponent의 tag가 유효하지 않은 경우 오류\n- LayoutText에 빈 문자열 사용 시 경고\n- 중첩 깊이가 너무 깊을 경우 (10레벨 초과) 경고 또는 오류\n\n---\n\n## IR (Intermediate Representation) Specification\n\nAST → IR 변환 규칙을 정의합니다. Codegen 단계 직전의 \&quot;정규화된 구조\&quot;로, 플랫폼불문의 공통 인터페이스를 제공합니다.\n\n### 1. Overview\n\n#### IR_GOAL\n- AST의 복잡한 구조를 코드 생성하기 좋게 단순화\n- UI 컴포넌트 트리와 메타데이터를 정규화\n- 플랫폼불문(React/Next/Svelte) 공통 인터페이스로 변환\n- 모든 값은 최종적이고 확정된 형태만 유지\n\n#### INPUT\n- ASTRoot\n\n#### OUTPUT\n- IRRoot\n\n### 2. IR Root\n\n#### IRRoot\n&#96;&#96;&#96;typescript\n{\n  meta: IRMeta\n  style: IRStyle\n  components: IRComponents\n  layout: IRLayoutTree\n  script: IRScript\n}\n&#96;&#96;&#96;\n\n### 3. IRMeta (Final Document Metadata)\n\n#### IRMeta\n&#96;&#96;&#96;typescript\n{\n  title: string\n  route: string\n  theme: \&quot;light\&quot; | \&quot;dark\&quot;\n  description: string | null\n}\n&#96;&#96;&#96;\n\n#### Rules\n- missing values become null\n- enforce route starts with \&quot;/\&quot;\n\n### 4. IRStyle (Flattened Style Tokens)\n\n#### IRStyle\n&#96;&#96;&#96;typescript\n{\n  tokens: Record&lt;string, string | number&gt;\n}\n&#96;&#96;&#96;\n\n#### Examples\n&#96;&#96;&#96;typescript\n{\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n  \&quot;radius.default\&quot;: 8\n}\n&#96;&#96;&#96;\n\n#### Rules\n- dot-notation keys preserved\n- all values converted to primitive string/number\n- no validation here (semantic pass already done)\n\n### 5. IRComponents (Registered Component Map)\n\n#### IRComponents\n&#96;&#96;&#96;typescript\n{\n  list: string[]   // e.g. [\&quot;Card\&quot;, \&quot;Button\&quot;]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- duplicates removed\n- sorted alphabetically for deterministic output\n\n### 6. IRLayoutTree (Normalized UI Tree)\n\n#### IRLayoutTree\n&#96;&#96;&#96;typescript\n{\n  root: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### IRNode\n&#96;&#96;&#96;typescript\nIRNode = IRComponentNode | IRTextNode\n&#96;&#96;&#96;\n\n#### 6.1 IRComponentNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;component\&quot;\n  tag: string\n  attributes: Record&lt;string, string&gt;   // key:string only\n  children: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- attribute keys lower-case enforced\n- children always array\n- empty children =&gt; []\n\n#### 6.2 IRTextNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;text\&quot;\n  value: string\n}\n&#96;&#96;&#96;\n\n#### Rules\n- trimmed text preserved exactly\n- no newline allowed inside text\n\n### 7. IRScript (Event Map)\n\n#### IRScript\n&#96;&#96;&#96;typescript\n{\n  events: Record&lt;string, string&gt;   // onClick → \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Rules\n- all keys normalized to lower-case event names\n- event value must be string only\n- duplicates override earlier definitions\n\n### 8. AST → IR Mapping Rules\n\n1. **MetaNode → IRMeta**\n   - convert property array → object map\n   - apply default values if missing\n   - route must start with \&quot;/\&quot;\n\n2. **StyleNode → IRStyle**\n   - flatten list into tokens object\n   - preserve ordering but output sorted keys for determinism\n\n3. **ComponentsNode → IRComponents**\n   - convert component list → array\n   - remove duplicates\n   - sort alphabetically\n\n4. **LayoutNode → IRLayoutTree**\n   - recursively convert LayoutComponent → IRComponentNode\n   - convert LayoutText → IRTextNode\n   - inline attributes converted to plain object\n\n5. **ScriptNode → IRScript**\n   - property list flattened to event map\n   - enforce lower-case event names\n\n### 9. Example: Full IR Output\n\n#### DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### IR\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Home\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: null,\n    \&quot;description\&quot;: null\n  },\n\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n    }\n  },\n\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: []\n  },\n\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: { \&quot;class\&quot;: \&quot;p-4\&quot; },\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {}\n  }\n}\n&#96;&#96;&#96;\n\n### IR 구조 트리\n\n&#96;&#96;&#96;\nIRRoot\n├── meta (IRMeta)\n│   ├── title: string\n│   ├── route: string\n│   ├── theme: \&quot;light\&quot;|\&quot;dark\&quot;|null\n│   └── description: string|null\n├── style (IRStyle)\n│   └── tokens: Record&lt;string, string|number&gt;\n├── components (IRComponents)\n│   └── list: string[]\n├── layout (IRLayoutTree)\n│   └── root: IRNode[]\n│       ├── IRComponentNode\n│       │   ├── type: \&quot;component\&quot;\n│       │   ├── tag: string\n│       │   ├── attributes: Record&lt;string, string&gt;\n│       │   └── children: IRNode[]\n│       └── IRTextNode\n│           ├── type: \&quot;text\&quot;\n│           └── value: string\n└── script (IRScript)\n    └── events: Record&lt;string, string&gt;\n&#96;&#96;&#96;\n\n### IR Examples\n\n#### 간단한 IR 변환\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Simple\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: \&quot;light\&quot;,\n    \&quot;description\&quot;: null\n  },\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#000\&quot;,\n      \&quot;font.size\&quot;: 14\n    }\n  },\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: [\&quot;Button\&quot;]\n  },\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: {},\n        \&quot;children\&quot;: [\n          {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Content\&quot;}\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {\n      \&quot;onclick\&quot;: \&quot;handleClick\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 복잡한 중첩 레이아웃 IR\n&#96;&#96;&#96;json\n{\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Container\&quot;,\n        \&quot;attributes\&quot;: {\n          \&quot;class\&quot;: \&quot;flex flex-col min-h-screen\&quot;\n        },\n        \&quot;children\&quot;: [\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Header\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;p-4 bg-blue-600\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;H1\&quot;,\n                \&quot;attributes\&quot;: {},\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Dashboard\&quot;}\n                ]\n              }\n            ]\n          },\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Main\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;flex-1 p-6\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;Card\&quot;,\n                \&quot;attributes\&quot;: {\n                  \&quot;class\&quot;: \&quot;bg-white shadow-lg rounded\&quot;\n                },\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Welcome!\&quot;}\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- AST에 location 정보 누락 시 IR 변환 실패\n- route가 \&quot;/\&quot;로 시작하지 않을 경우 변환 시 강제 추가\n- 중복 컴포넌트 등록 시 알파벳 순 정렬로 중복 제거\n- 빈 children 배열을 null로 잘못 설정 시 []로 강제 변환\n- 텍스트 노드에 줄바꿈 포함 시 변환 중 제거 또는 오류\n- 이벤트 키 대소문자 혼재 시 소문자로 통일\n- 스타일 토큰 키 순서가 다를 경우 sorted keys로 결정적 출력 보장\n\n---\n\n## Codegen Rules\n\n### React/Next.js 15 Codegen\n\nIR을 기반으로 안정적인 UI 코드 생성 규칙입니다. React/Next.js 15 (App Router + RSC) 기준으로 IR을 실제 코드로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- IR을 기반으로 안정적인 UI 코드 생성\n- React/Next.js 15 (App Router + RSC) 기준\n- \&quot;디자인 시스템 없는 순수 Layout Tree\&quot;를 코드로 변환\n- 가능한 한 deterministic 하게 출력\n- 로직/상태/이벤트는 최소 수준으로만 개입\n\n##### INPUT\n- IRRoot\n\n##### OUTPUT\n- React Component Source Code (string)\n\n#### 2. Output Structure\n\n파일 구조는 다음 형태로 생성합니다:\n\n&#96;&#96;&#96;\n/page.tsx\n  - metadata (title, description)\n  - default export function Page()\n  - return(...) 내부에 layout tree 삽입\n\n/style-tokens.ts\n  - style.tokens flatten export\n\n/components/index.ts\n  - components registry export\n\n/script-events.ts\n  - event name string mapping export\n&#96;&#96;&#96;\n\n#### 3. Metadata Codegen\n\n##### UIH meta → Next.js metadata\n&#96;&#96;&#96;typescript\nIRMeta {\n  title: string\n  description: string\n}\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;typescript\nexport const metadata = {\n  title: \&quot;&lt;title&gt;\&quot;,\n  description: \&quot;&lt;description&gt;\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- description 없으면 필드 제외\n- theme는 metadata에 직접 쓰지 않음 (스타일토큰 용)\n\n#### 4. Style Token Codegen\n\n##### IRStyle { tokens }\n&#96;&#96;&#96;typescript\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;radius.default\&quot;: 8,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 키는 string 리터럴 그대로\n- numeric/string 그대로 출력\n- sorted keys for deterministic output\n\n#### 5. Component Registry Codegen\n\n##### IRComponents.list → export list\n&#96;&#96;&#96;typescript\nexport const components = {\n  Card,\n  Button,\n  Input,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 자동 import 하지 않음 (상위 시스템이 resolve)\n- keys는 PascalCase 유지\n- duplicates 제거 후 정렬\n\n#### 6. Layout Tree → JSX Codegen\n\n##### IRLayoutTree → React element tree\n\n##### 6.1 Component Node\n&#96;&#96;&#96;typescript\nIRComponentNode {\n  tag: \&quot;Div\&quot;\n  attributes: { class: \&quot;p-4\&quot; }\n  children: [...]\n}\n&#96;&#96;&#96;\n\n##### OUTPUT JSX\n&#96;&#96;&#96;jsx\n&lt;Div className=\&quot;p-4\&quot;&gt;\n  {children...}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n##### RULES\n- attribute.key \&quot;class\&quot; → \&quot;className\&quot;\n- attribute key는 그대로 lower-case 유지\n- value는 string literal\n- children length 0 이면 self-closing 금지 (always explicit block)\n- tag name 그대로 JSX 컴포넌트로 사용\n\n##### 6.2 Text Node\n&#96;&#96;&#96;typescript\nIRTextNode { value: \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;jsx\n{\&quot;Hello\&quot;}\n&#96;&#96;&#96;\n\n##### RULES\n- 텍스트는 JSX children 표현\n- 특수문자는 자동 escape\n\n#### 7. Script Event Codegen\n\n##### IRScript.events → export mapping\n&#96;&#96;&#96;typescript\nexport const eventHandlers = {\n  onClick: \&quot;submitForm\&quot;,\n  onLoad: \&quot;init\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- event 이름은 lower-case normalized\n- 값은 string (함수명)\n- 실제 JS 함수 body는 생성하지 않음\n- 나중 시스템이 자동 wire-up 함\n\n#### 8. Full Page Generation\n\n최종 page.tsx는 다음 구조를 따릅니다:\n\n&#96;&#96;&#96;typescript\nexport const metadata = { ... };\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen p-4\&quot;&gt;\n      &lt;P&gt;{\&quot;Hello\&quot;}&lt;/P&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### RULES\n- 최상위는 항상 &#96;&lt;Div&gt;&#96; 같은 Wrapper로 시작하지 않아도 됨\n- layout.root가 배열이면 Fragment로 감싼다\n- 코드 스타일은 2-space indent\n- 세미콜론 붙이지 않음 (Prettier 옵션 따라감)\n\n#### 9. Determinism Rules\n\n1. 속성 순서는 key 알파벳순 정렬\n2. children 순서는 DSL 입력 순서 그대로\n3. components 목록은 알파벳순 정렬\n4. styleTokens도 key 정렬\n5. eventHandlers key 정렬\n6. output JSX는 항상 multiline\n\n#### 10. Full Example (DSL → IR → JSX)\n\n##### DSL\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n##### JSX OUT\n&#96;&#96;&#96;typescript\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;p-4\&quot;&gt;\n      {\&quot;Hello\&quot;}\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n#### 11. Notes for Engine Integrators\n\n1. Codegen은 \&quot;순수 구조\&quot;만 책임진다\n   - 상태(state), fetch, useEffect 등은 지원하지 않음\n2. 이벤트 핸들러는 단순 라벨링 시스템\n3. 스타일 토큰은 UI 프레임워크에서 직접 해석\n4. React, Vue, Svelte 등 플랫폼별 코드젠 가능\n   - 플랫폼별 레이어는 분리\n\n#### Output Files 구조\n\n&#96;&#96;&#96;\nOutput Files\n├── page.tsx\n│   ├── metadata export\n│   ├── imports (components, styleTokens, eventHandlers)\n│   ├── Page() function\n│   └── JSX return (layout tree)\n├── style-tokens.ts\n│   └── styleTokens export\n├── components/index.ts\n│   └── components export\n└── script-events.ts\n    └── eventHandlers export\n&#96;&#96;&#96;\n\n#### Codegen Examples\n\n##### 전체 페이지 코드 생성 예시\n&#96;&#96;&#96;typescript\n// page.tsx\nexport const metadata = {\n  title: \&quot;Dashboard\&quot;,\n  description: \&quot;Main dashboard page\&quot;\n};\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen flex flex-col\&quot;&gt;\n      &lt;Header className=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n        &lt;H1&gt;\n          {\&quot;Dashboard\&quot;}\n        &lt;/H1&gt;\n      &lt;/Header&gt;\n      &lt;Main className=\&quot;flex-1 p-6\&quot;&gt;\n        &lt;Card className=\&quot;bg-white shadow-lg rounded-lg p-6\&quot;&gt;\n          &lt;P&gt;\n            {\&quot;Welcome back!\&quot;}\n          &lt;/P&gt;\n        &lt;/Card&gt;\n      &lt;/Main&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### 스타일 토큰 파일 예시\n&#96;&#96;&#96;typescript\n// style-tokens.ts\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;color.secondary\&quot;: \&quot;#6B7280\&quot;,\n  \&quot;color.accent\&quot;: \&quot;#F59E0B\&quot;,\n  \&quot;spacing.small\&quot;: 8,\n  \&quot;spacing.medium\&quot;: 16,\n  \&quot;spacing.large\&quot;: 24,\n  \&quot;border.radius\&quot;: 6,\n  \&quot;font.family\&quot;: \&quot;Inter\&quot;,\n  \&quot;font.size.base\&quot;: 16,\n  \&quot;shadow.default\&quot;: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n};\n&#96;&#96;&#96;\n\n##### 컴포넌트 레지스트리 예시\n&#96;&#96;&#96;typescript\n// components/index.ts\nexport const components = {\n  Button,\n  Card,\n  Input,\n  Modal,\n  Sidebar\n};\n&#96;&#96;&#96;\n\n##### 이벤트 핸들러 파일 예시\n&#96;&#96;&#96;typescript\n// script-events.ts\nexport const eventHandlers = {\n  onclick: \&quot;handleClick\&quot;,\n  onload: \&quot;initDashboard\&quot;,\n  onsubmit: \&quot;processForm\&quot;\n};\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- layout.root가 빈 배열일 경우 빈 Fragment 생성\n- 컴포넌트 이름이 JavaScript 예약어와 충돌 시 escaping 필요\n- 텍스트에 JSX 특수문자 포함 시 자동 escape\n- 중첩 깊이가 깊을 경우 코드 포맷팅 유지\n- import 경로 resolve 실패 시 상위 시스템에서 처리\n- styleTokens에 특수문자 키 포함 시 유효한 JS 객체 키로 변환\n\n---\n\n### Vue &amp; Svelte Codegen\n\nReact Codegen과 동일한 IR 기반으로 Vue와 Svelte 코드를 생성하는 규칙입니다. 플랫폼별 렌더링 규칙만 다르게 적용합니다.\n\n## SECTION A — Vue Codegen (SFC 기준)\n\n### GOAL\n- IR → .vue 파일 형태로 변환\n- &#96;&lt;template&gt;&#96; + &#96;&lt;script setup&gt;&#96; + &#96;&lt;style&gt;&#96; 구조 유지\n- 모든 로직은 배제하고 구조만 생성\n\n### OUTPUT FILE STRUCTURE\n&#96;&#96;&#96;\nMyPage.vue\n&#96;&#96;&#96;\n\n### 1. Top-Level Structure\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;!-- layout tree --&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport components...\n\nconst events = {...}\nconst styleTokens = {...}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* optional if needed */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Vue Template 규칙\n\n#### IRComponentNode(tag:\&quot;Div\&quot;, attributes, children)\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  &lt;!-- children --&gt;\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;className&#96; → &#96;class&#96;\n- attribute values: string only\n- children: 그대로 template로 변환\n- Fragment는 &#96;&lt;template&gt;&#96; 안에서 그냥 siblings로 출력\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello (그대로 text node)\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\neventHandlers {\n  onClick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Vue OUTPUT\n&#96;&#96;&#96;vue\n@click=\&quot;submitForm\&quot;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;onClick&#96; → &#96;@click&#96;\n- &#96;onChange&#96; → &#96;@change&#96;\n- &#96;onInput&#96; → &#96;@input&#96;\n- &#96;onLoad&#96; → &#96;@load&#96;\n- value는 함수 이름 string\n- 함수 구현은 생성하지 않음\n\n### 4. Component Registry (imports)\n&#96;&#96;&#96;javascript\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules\n- 속성(sorted)\n- imports(sorted)\n- children 순서 그대로\n- no semicolons\n- template 들여쓰기 2 spaces\n\n## SECTION B — Svelte Codegen (.svelte)\n\n### GOAL\n- Svelte 컴포넌트 파일 하나로 완성\n- &#96;&lt;script&gt;&#96; + markup 구조\n\n### OUTPUT STRUCTURE\n&#96;&#96;&#96;\nMyPage.svelte\n&#96;&#96;&#96;\n\n### 1. File Layout\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import components...\n  export let events = {...}\n  export let styleTokens = {...}\n&lt;/script&gt;\n\n&lt;!-- layout markup --&gt;\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  Hello\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* optional */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Svelte Markup\n\n#### IRComponentNode(tag, attributes, children)\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  {#if ... ?} (없음)\n  {children}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- 클래스는 &#96;class&#96;\n- 속성 문자열만\n- Self-closing 금지\n- children 재귀적 삽입\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\nIRScript:\nonClick → function name\n&#96;&#96;&#96;\n\n#### Svelte OUTPUT\n&#96;&#96;&#96;svelte\non:click={submitForm}\n&#96;&#96;&#96;\n\n#### Mapping\n&#96;&#96;&#96;\nonClick   → on:click\nonChange  → on:change\nonInput   → on:input\nonLoad    → on:load\n&#96;&#96;&#96;\n\n### 4. Components Import\n&#96;&#96;&#96;javascript\nimport Card from \&quot;./Card.svelte\&quot;;\nimport Button from \&quot;./Button.svelte\&quot;;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules (필수)\n\n1. import 순서는 알파벳 정렬\n2. attributes sorted\n3. event names lower-case\n4. children 순서 보존\n5. markup 들여쓰기 2 spaces\n\n## SECTION C — Cross-Platform Notes\n\n1. React / Vue / Svelte 모두 IR만 참조\n2. layout tree는 그대로 세 렌더러에서 재활용\n3. event handler는 단순 label → framework alias로 변환\n4. styleTokens는 컴파일러 외부 시스템이 처리\n5. components는 registry 기반으로 import만 생성\n\n## SECTION D — Example Conversion (Same IR → Vue/Svelte)\n\n### IR\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) { \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n### Vue Template\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Svelte Markup\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte 구조\n\n&#96;&#96;&#96;\nVue Output (.vue)\n├── &lt;template&gt;\n│   └── layout tree (Vue template syntax)\n├── &lt;script setup&gt;\n│   ├── component imports\n│   ├── events object\n│   └── styleTokens object\n└── &lt;style scoped&gt;\n    └── optional styles\n\nSvelte Output (.svelte)\n├── &lt;script&gt;\n│   ├── component imports\n│   ├── export let events = {...}\n│   └── export let styleTokens = {...}\n├── layout markup (Svelte syntax)\n└── &lt;style&gt;\n    └── optional styles\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte Examples\n\n#### Vue SFC 전체 예시\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n    &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n      &lt;H1&gt;\n        Dashboard\n      &lt;/H1&gt;\n    &lt;/Header&gt;\n    &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n      &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; @click=\&quot;handleCardClick\&quot;&gt;\n        &lt;P&gt;\n          Welcome back!\n        &lt;/P&gt;\n      &lt;/Card&gt;\n    &lt;/Main&gt;\n  &lt;/Div&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n\nconst events = {\n  handleCardClick: \&quot;handleCardClick\&quot;\n}\n\nconst styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;spacing.medium\&quot;: 16\n}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### Svelte 컴포넌트 전체 예시\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import Card from \&quot;./Card.svelte\&quot;;\n  import Button from \&quot;./Button.svelte\&quot;;\n\n  export let events = {\n    handleCardClick: \&quot;handleCardClick\&quot;\n  };\n\n  export let styleTokens = {\n    \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n    \&quot;spacing.medium\&quot;: 16\n  };\n&lt;/script&gt;\n\n&lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n  &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n    &lt;H1&gt;\n      Dashboard\n    &lt;/H1&gt;\n  &lt;/Header&gt;\n  &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n    &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; on:click={handleCardClick}&gt;\n      &lt;P&gt;\n        Welcome back!\n      &lt;/P&gt;\n    &lt;/Card&gt;\n  &lt;/Main&gt;\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### 이벤트 매핑 비교\n&#96;&#96;&#96;javascript\n// 동일한 IR 이벤트\n{\n  onClick: \&quot;handleClick\&quot;,\n  onChange: \&quot;handleChange\&quot;,\n  onLoad: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;vue\n&lt;!-- Vue --&gt;\n&lt;Button @click=\&quot;handleClick\&quot; @change=\&quot;handleChange\&quot; @load=\&quot;init\&quot;&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;svelte\n&lt;!-- Svelte --&gt;\n&lt;Button on:click={handleClick} on:change={handleChange} on:load={init}&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;jsx\n&lt;!-- React --&gt;\n&lt;Button onClick={handleClick} onChange={handleChange} onLoad={init}&gt;\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- Vue에서 컴포넌트 이름이 kebab-case로 변환 필요 시 자동 처리\n- Svelte에서 export let 구문이 예약어와 충돌 시 renaming\n- 이벤트 핸들러가 정의되지 않은 경우 플랫폼별 기본 동작\n- 스타일 토큰에 CSS 변수나 함수 포함 시 escaping\n- 중첩 컴포넌트 깊이가 깊을 경우 플랫폼별 최적화 적용\n- 텍스트 콘텐츠에 플랫폼별 특수문자 포함 시 자동 escape\n\n---\n\n## Examples\n\n### 완전한 UIH DSL 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;User Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main user dashboard with analytics\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  color.accent: \&quot;#F59E0B\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n  font.size.h1: 32\n  spacing.small: 8\n  spacing.medium: 16\n  spacing.large: 24\n  border.radius: 6\n  shadow.default: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n  Sidebar\n  Chart\n}\n\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto p-6\&quot;) {\n    Header(class:\&quot;mb-8\&quot;) {\n      Div(class:\&quot;flex justify-between items-center\&quot;) {\n        H1(class:\&quot;text-3xl font-bold\&quot;) {\n          \&quot;Dashboard\&quot;\n        }\n        Button(class:\&quot;px-4 py-2 bg-blue-600 text-white rounded\&quot;) {\n          \&quot;New Report\&quot;\n        }\n      }\n    }\n\n    Div(class:\&quot;grid grid-cols-3 gap-6\&quot;) {\n      Card(class:\&quot;col-span-2\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Analytics Overview\&quot;\n        }\n        Chart(class:\&quot;w-full h-64\&quot;)\n      }\n\n      Card(class:\&quot;col-span-1\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Quick Stats\&quot;\n        }\n        Div(class:\&quot;space-y-4\&quot;) {\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Total Users\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;1,234\&quot;\n            }\n          }\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Active Sessions\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;89\&quot;\n            }\n          }\n        }\n      }\n    }\n\n    Sidebar(class:\&quot;mt-8\&quot;) {\n      H3(class:\&quot;text-lg mb-4\&quot;) {\n        \&quot;Recent Activity\&quot;\n      }\n      Div(class:\&quot;space-y-2\&quot;) {\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;User john@example.com logged in\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;New report generated\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;System backup completed\&quot;\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onLoad: \&quot;initDashboard\&quot;\n  onClick: \&quot;handleButtonClick\&quot;\n  onRefresh: \&quot;refreshData\&quot;\n}\n&#96;&#96;&#96;\n\n### 최소 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Minimal Page\&quot;\n  route: \&quot;/minimal\&quot;\n  theme: \&quot;light\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  spacing.unit: 12\n}\n\nlayout {\n  Div(class:\&quot;min-h-screen flex items-center justify-center bg-gray-50\&quot;) {\n    \&quot;Coming soon\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n### Form 중심 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Sign Up\&quot;\n  route: \&quot;/signup\&quot;\n  theme: \&quot;light\&quot;\n  description: \&quot;Create a new account\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#2563EB\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n}\n\ncomponents {\n  Form\n  Input\n  Button\n  Alert\n}\n\nlayout {\n  Section(class:\&quot;min-h-screen flex items-center justify-center bg-gray-100\&quot;) {\n    Form(class:\&quot;w-full max-w-md space-y-6 bg-white p-8 rounded-xl shadow-lg\&quot;) {\n      H2(class:\&quot;text-2xl font-semibold text-gray-900\&quot;) {\n        \&quot;Create your account\&quot;\n      }\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;email\&quot;, placeholder:\&quot;Enter email\&quot;)\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;password\&quot;, placeholder:\&quot;Enter password\&quot;)\n      Button(class:\&quot;w-full bg-blue-600 text-white py-3 rounded-lg\&quot;) {\n        \&quot;Sign up\&quot;\n      }\n      Alert(class:\&quot;text-sm text-gray-500 text-center\&quot;) {\n        \&quot;By signing up you agree to our terms\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onSubmit: \&quot;handleSignup\&quot;\n  onLoad: \&quot;prefillFromInvite\&quot;\n}\n&#96;&#96;&#96;\n\n### 콘텐츠 피드 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Creator Feed\&quot;\n  route: \&quot;/feed\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Realtime creator activity feed\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#22D3EE\&quot;\n  color.background: \&quot;#0F172A\&quot;\n  font.family: \&quot;Space Grotesk\&quot;\n  spacing.medium: 20\n  radius.card: 12\n}\n\ncomponents {\n  Shell\n  Sidebar\n  Feed\n  FeedItem\n  Avatar\n  Badge\n}\n\nlayout {\n  Shell(class:\&quot;min-h-screen bg-slate-950 text-slate-100\&quot;) {\n    Sidebar(class:\&quot;w-64 border-r border-slate-800 p-6 space-y-6\&quot;) {\n      H1(class:\&quot;text-xl font-semibold tracking-tight\&quot;) {\n        \&quot;Creator Hub\&quot;\n      }\n      Badge(class:\&quot;inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 text-slate-200\&quot;) {\n        \&quot;Live updates\&quot;\n      }\n    }\n    Feed(class:\&quot;flex-1 p-8 space-y-6\&quot;) {\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-cyan-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;heymina.studio\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-300\&quot;) {\n              \&quot;New drop\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Dropped a limited neon kit — 120 packs sold out in 3 minutes.\&quot;\n          }\n        }\n      }\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-pink-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;luvv.wav\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-cyan-500/10 text-cyan-300\&quot;) {\n              \&quot;Stream recap\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Hit 18,245 live viewers tonight — chat requested a synthwave encore.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onRefresh: \&quot;fetchLatestFeed\&quot;\n  onClick: \&quot;openCreatorProfile\&quot;\n}\n&#96;&#96;&#96;\n\n---\n\n## Version\n\n- **Version**: 1.0.0\n- **Last Update**: 2025-11-18\n- **Change Summary**: Complete guide consolidating all UIH DSL specifications\n\n---\n\n## 문서 끝\n\n이 문서는 UIH DSL의 모든 스펙을 \&quot;생략 없이\&quot; 하나의 파일로 통합한 완전판입니다. Foundation Layer부터 Codegen까지 전 과정을 포함하며, LLM이 UI를 정확하게 선언할 수 있도록 설계된 모든 규칙이 담겨 있습니다.\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating BNF example script block**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;cace265c-26fa-4eda-a426-564f8f1e5408&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  \n  script {\n-   onClick: \&quot;submitForm\&quot;\n+   onclick: \&quot;submitForm\&quot;\n  }\n  &#96;&#96;&#96;&quot;,
        &quot;oldStart&quot;: 1367,
        &quot;newStart&quot;: 1367,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;,
  &quot;contentsAfterEdit&quot;: &quot;# UIH DSL — Complete Guide (생략 없는 완전판)\n\n## Table of Contents\n\n1. [Overview](#overview)\n2. [Philosophy &amp; Design Principles](#philosophy--design-principles)\n3. [Foundation Layer](#foundation-layer)\n4. [Tokenizer Specification](#tokenizer-specification)\n5. [Grammar](#grammar)\n   - [Block Grammar](#block-grammar)\n   - [Property Grammar](#property-grammar)\n   - [Layout Tree Grammar](#layout-tree-grammar)\n   - [Parser BNF Grammar](#parser-bnf-grammar)\n6. [AST Schema Definition](#ast-schema-definition)\n7. [IR (Intermediate Representation) Specification](#ir-intermediate-representation-specification)\n8. [Codegen Rules](#codegen-rules)\n   - [React/Next.js 15 Codegen](#reactnextjs-15-codegen)\n   - [Vue &amp; Svelte Codegen](#vue--svelte-codegen)\n9. [Examples](#examples)\n10. [Version](#version)\n\n---\n\n## Overview\n\nUIH DSL (Universal Interface Hierarchy Domain Specific Language) v2는 **\&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;**를 목표로 하는 도메인 특화 언어입니다.\n\n### 핵심 목표\n- LLM이 UI 구조를 **정확하게** 선언할 수 있도록 설계\n- 모호성 제거 및 결정성(determinism) 보장\n- 사람보다 AI가 더 효과적으로 사용 가능한 DSL\n- UI 구조의 선언적 표현에 집중\n\n### 아키텍처 흐름\n&#96;&#96;&#96;\nDSL 문자열 → Tokenizer → Parser → AST → IR → Codegen → React/Vue/Svelte 코드\n&#96;&#96;&#96;\n\n### 주요 특징\n- 한 줄에 하나의 의미만 (One-intent-per-line)\n- 선택적 문법 금지 - 모든 것이 명시적\n- 쌍따옴표만 허용, 세미콜론 없음\n- 주석 지원 안 함 (모호성 제거)\n- 고정 블록 순서: meta → style → components → layout → script\n\n---\n\n## Philosophy &amp; Design Principles\n\nUIH DSL은 \&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;를 목표로 하는 도메인 특화 언어입니다. 사람보다 LLM이 더 효과적으로 사용할 수 있도록 설계되었으며, UI 구조의 선언적 표현에 집중합니다.\n\n### 1. LLM 친화적 설계 원칙\n\nLLM이 읽고 쓰기 편한 DSL을 지향합니다. 구조는 최대한 명확하고 모호성이 없으며, 선택적 문법을 금지합니다. LLM이 패턴을 쉽게 반복할 수 있는 형태로 자연어 번역 난이도를 낮췄습니다.\n\n### 2. 선언적 UI 설계\n\nUI는 로직 기반보다 구조 기반으로 설계합니다. \&quot;무엇을 만든다\&quot;에 집중하며 \&quot;어떻게 만든다\&quot;는 Codegen이 담당합니다. 상태, 이벤트, 애니메이션은 추상화 계층으로 밀어냅니다.\n\n### 3. 한 줄 한 의미 원칙 (One-intent-per-line)\n\n한 라인에 하나의 의미만 허용합니다. 한 줄에 두 개 의미를 섞으면 LLM이 실수할 가능성이 높아집니다.\n\n#### 좋은 예: 한 줄 한 의미\n&#96;&#96;&#96;dsl\nmeta:\n  title: \&quot;Home\&quot;\n\nmeta:\n  route: \&quot;/\&quot;\n&#96;&#96;&#96;\n\n#### 나쁜 예: 한 줄 다중 의미 (금지)\n&#96;&#96;&#96;dsl\nmeta: title: \&quot;Home\&quot;, route: \&quot;/\&quot;  # 잘못된 예\n&#96;&#96;&#96;\n\n### 4. 고정 블록 순서\n\n블록 구조는 **meta → style → components → layout → script** 순서를 유지합니다. 이 순서는 LLM이 외우기 쉽고 Codegen의 예측 가능성과 AST의 결정성을 보장합니다.\n\n### 5. 최소 표현, 최대 의미\n\nDSL은 짧고 규칙적이어야 합니다. CSS-like verbose, YAML 계층 증가, JSX 로직 섞임을 금지합니다. 의미 전달에 집중하는 최소 선언적 DSL입니다.\n\n### 6. 오류 제로 문법\n\n\&quot;AI가 틀릴 수 없는 언어\&quot;를 목표로 합니다. 쌍따옴표만 허용하고 세미콜론 없이 콜론만 사용합니다. 모든 키는 고정된 string literal이며 optional field를 최소화합니다.\n\n### 7. AST 1:1 매핑\n\n모든 UI 요소가 AST에 직접 매핑됩니다. meta 블록 → MetaNode, style 블록 → StyleNode, layout 블록 → LayoutTree로 변환됩니다.\n\n### 8. 기계 친화적 우선\n\n\&quot;사람이 읽으면 조금 불편할 것\&quot; 정도가 적정 수준입니다. 사람 UX보다 AI 정확성을 우선합니다.\n\n---\n\n## Foundation Layer\n\nUIH DSL의 가장 낮은 레벨 사양입니다. Character부터 Ordering까지의 기본 규칙을 정의하며, LLM이 실수할 수 없는 엄격한 문법을 제공합니다.\n\n### 1. Character Layer (문자 규칙)\n\n#### ALLOWED_CHARACTERS\n- a~z (lowercase alphabets)\n- 0~9 (digits)\n- hyphen (-)\n- underscore (_)\n- space ( )\n- newline (\\n)\n- braces: { }\n- colon (:)\n- double-quote (\&quot;)\n\n#### DISALLOWED_CHARACTERS\n- single-quote (&#39;)\n- semicolon (;)\n- parentheses ()\n- backtick (&#96;)\n- tab (\\t)\n- CRLF (\\r\\n)\n\n#### NEWLINE\n- always LF (\\n)\n- CRLF not supported\n\n### 2. Indentation Layer (들여쓰기 규칙)\n\n#### INDENTATION\n- exactly 2 spaces ONLY\n- tabs NOT allowed\n- indentation increases only inside a block\n- indentation does not imply hierarchy (not YAML)\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {           // ❌ 탭 사용 금지\n  title: \&quot;Home\&quot;  // ✅ 정확히 2 space\n}\n&#96;&#96;&#96;\n\n### 3. Token Layer (토큰 기본 규칙)\n\n#### TOKENS\n- IDENTIFIER = &#96;[a-z][a-z0-9.]*&#96;\n- STRING = &#96;\&quot;[^\&quot;\\\\]*(?:\\\\.[^\&quot;\\\\]*)*\&quot;&#96; (supports &#96;\\\&quot;&#96; escape)\n- NUMBER = &#96;\\d+(?:\\.\\d+)?&#96;\n- LBRACE = &#96;{&#96;\n- RBRACE = &#96;}&#96;\n- COLON = &#96;:&#96;\n- NEWLINE = &#96;\\n&#96;\n- WHITESPACE = single space\n\n#### IDENTIFIER_RULES\n- lowercase only\n- dot notation allowed (e.g. &#96;color.primary&#96;)\n- do NOT mix hyphens inside identifiers (LLM error-prone)\n\n#### STRING_RULES\n- must use double quotes only\n- escaping uses &#96;\\\&quot;&#96;\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {\n  color.primary: \&quot;#fff\&quot;    // ✅ dot notation 허용\n  label: \&quot;Click \\\&quot;here\\\&quot;\&quot;  // ✅ escape 허용\n  width: 100.5            // ✅ 소수 허용\n}\n&#96;&#96;&#96;\n\n### 4. Comment Layer (코멘트)\n\n#### COMMENTS\n- comments NOT supported\n- any attempt to use &#96;//&#96; or &#96;#&#96; is invalid\n- purpose: reduce ambiguity for LLM\n\n### 5. Statement Layer (기본 문장 구조)\n\n#### STATEMENT_TYPES\n- Block Declaration\n- Property Declaration\n\n#### BLOCK_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt; {\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n#### PROPERTY_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n#### SEMICOLON\n- NOT allowed (never used)\n\n### 6. Block Layer (블록 기본 규칙)\n\n#### BLOCK_STRUCTURE\n&#96;&#96;&#96;\nblockName {\n  property: \&quot;value\&quot;\n  property: 123\n  property: true\n}\n&#96;&#96;&#96;\n\n#### BLOCK_RULES\n- block cannot contain nested blocks\n- ONLY layout block may contain nested layout nodes\n\n### 7. Ordering Layer (순서 강제)\n\n#### BLOCK_ORDER\n1. meta\n2. style\n3. components (optional)\n4. layout\n5. script (optional)\n\n#### RULE\n- if a block appears, must follow this order\n- missing blocks are allowed except meta/style/layout\n\n### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  primary-color: \&quot;#111\&quot;\n}\n\ncomponents {\n  Button {\n    variant: \&quot;primary\&quot;\n  }\n}\n\nlayout {\n  Container {\n    children: \&quot;Button\&quot;\n  }\n}\n\nscript {\n  // optional script\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단\n- 잘못된 들여쓰기 발견 시 구문 오류\n- 코멘트 시도 시 즉시 무효 처리\n- 블록 순서 위반 시 파싱 실패\n- layout 외 중첩 블록 시도 시 오류\n\n---\n\n## Tokenizer Specification\n\nFoundation Layer + Grammar Layers 기반의 공식 토큰화 규칙입니다. DSL 문자열을 균일한 Token 리스트로 변환하며, 모든 파싱의 기반이 됩니다.\n\n### 1. Tokenizer Overview\n\n#### PURPOSE\n- DSL 문자열을 균일한 Token 리스트로 변환\n- 모호성 없는 deterministic token stream 생성\n- 모든 파싱은 이 토큰 리스트 기반으로 진행\n\n#### INPUT\n- LF 기반의 DSL 문자열\n\n#### OUTPUT\n- 순차적 Token 배열\n\n### 2. Token Types\n\n#### TOKENS\n- &#96;IDENTIFIER&#96; - meta, title, color.primary, class 등\n- &#96;STRING&#96; - \&quot;Hello\&quot;\n- &#96;NUMBER&#96; - 0, 12, 0.8\n- &#96;BOOLEAN&#96; - true, false\n- &#96;LBRACE&#96; - {\n- &#96;RBRACE&#96; - }\n- &#96;LPAREN&#96; - (\n- &#96;RPAREN&#96; - )\n- &#96;COLON&#96; - :\n- &#96;COMMA&#96; - ,\n- &#96;NEWLINE&#96; - \\n\n- &#96;WHITESPACE&#96; - space (only used between tokens)\n- &#96;TEXT_STRING&#96; - layout children string ONLY (disambiguation)\n- &#96;EOF&#96; - end of file marker\n\n### 3. Identifier Detection\n\n#### IDENTIFIER_RULES\n- regex: &#96;^[a-z][a-z0-9.]*$&#96;\n- lowercase only\n- dot notation allowed\n- hyphens, underscores 금지\n\n#### TAGNAME_RULES\n- starts with uppercase letter\n- subsequent chars: &#96;[a-zA-Z0-9]&#96;\n- TagName (e.g. Div, Header) 구분용\n\n#### TAGNAME_EXAMPLES\n&#96;&#96;&#96;\nDiv\nSection\nImage\nH1\n&#96;&#96;&#96;\n\n### 4. String Token Rules\n\n#### STRING\n- starts with &#96;\&quot;&#96;\n- ends with &#96;\&quot;&#96;\n- inside supports &#96;\\\&quot;&#96;\n- no multi-line\n\n#### TEXT_STRING\n- STRING과 동일한 문법\n- 단, layout children context에서만 등장\n- Parser에서 context-aware로 구분\n\n### 5. Number Token Rules\n\n#### NUMBER\n- regex: &#96;^[0-9]+(\\.[0-9]+)?$&#96;\n- no negative numbers\n- no units (px, rem 등)\n\n### 6. Boolean Token Rules\n\n#### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n- strictly lowercase\n\n### 7. Brace / Symbol Tokens\n\n#### SYMBOL_TOKENS\n- &#96;LBRACE&#96;: &#96;{&#96;\n- &#96;RBRACE&#96;: &#96;}&#96;\n- &#96;LPAREN&#96;: &#96;(&#96;\n- &#96;RPAREN&#96;: &#96;)&#96;\n- &#96;COLON&#96;: &#96;:&#96;\n- &#96;COMMA&#96;: &#96;,&#96;\n\n#### NOTES\n- semicolon NOT allowed\n- backtick NOT allowed\n\n### 8. Whitespace / Newline Rules\n\n#### WHITESPACE\n- single space &#96;&#39; &#39;&#96;\n- no tabs\n- no multi-space sequences except indentation (2 spaces)\n\n#### NEWLINE\n- LF only\n- CRLF invalid\n\n### 9. Layout Context Rules (Critical)\n\n#### LAYOUT_MODE\nTokenizer enters layout-mode when encountering:\n&#96;&#96;&#96;\nlayout { … }\n&#96;&#96;&#96;\n\n#### CONTEXT_SWITCH\n- after TagName(\n- before encountering next node or text\n\n#### INSIDE_LAYOUT_BLOCK\n- children detection required\n- plain strings must become TEXT_STRING token\n- siblings separated by NEWLINE\n\n#### EXAMPLE\n&#96;&#96;&#96;\n\&quot;Welcome\&quot; → TEXT_STRING inside layout\n&#96;&#96;&#96;\n\n### 10. Tokenization Algorithm (High-Level)\n\n1. iterate through chars\n2. skip whitespace unless meaningful (indent)\n3. detect IDENTIFIER or TAGNAME\n4. detect STRING (with escape)\n5. detect NUMBER\n6. detect BOOLEAN\n7. detect braces &#96;{ }&#96;\n8. detect parentheses &#96;( )&#96;\n9. detect colon &#96;:&#96; or comma &#96;,&#96;\n10. detect newline &#96;\\n&#96;\n11. maintain context stack:\n    - normal\n    - inside layout block\n    - inside attributes\n12. output final EOF token\n\n### 11. Example Token Stream\n\n#### INPUT\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### OUTPUT_TOKENS\n&#96;&#96;&#96;\nIDENTIFIER(layout)\nLBRACE\nNEWLINE\nTAGNAME(Div)\nLPAREN\nIDENTIFIER(class)\nCOLON\nSTRING(\&quot;p-4\&quot;)\nRPAREN\nLBRACE\nNEWLINE\nTEXT_STRING(\&quot;Hello\&quot;)\nNEWLINE\nRBRACE\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Token Stream Examples\n\n#### 기본 블록 토큰화\n&#96;&#96;&#96;dsl\nmeta {\n  title: \&quot;Home\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(meta)\nLBRACE\nNEWLINE\nIDENTIFIER(title)\nCOLON\nSTRING(\&quot;Home\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n#### 스타일 블록 토큰화\n&#96;&#96;&#96;dsl\nstyle {\n  color.primary: \&quot;#fff\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(style)\nLBRACE\nNEWLINE\nIDENTIFIER(color.primary)\nCOLON\nSTRING(\&quot;#fff\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단 및 오류 반환\n- CRLF 줄바꿈 발견 시 LF로 변환 또는 오류\n- 탭 문자 발견 시 공백 변환 또는 오류\n- STRING에서 미닫힘 따옴표 시 오류\n- NUMBER에 음수나 단위 포함 시 오류\n- layout 외 컨텍스트에서 TEXT_STRING 시도 시 오류\n- TAGNAME 규칙 위반 (소문자 시작) 시 IDENTIFIER로 처리\n\n---\n\n## Grammar\n\n### Block Grammar\n\nUIH DSL의 최상위 구조를 정의하는 Block Grammar Layer입니다. Foundation Layer 바로 위에 위치하며, 5개 블록의 선언, 순서, 내용 규칙을 명시합니다.\n\n#### 1. Block Definitions (5개 블록)\n\n##### BLOCKS\n- meta\n- style\n- components (optional)\n- layout\n- script (optional)\n\n##### RULES\n- 블록은 반드시 이 순서를 따라야 함: meta → style → components → layout → script\n- meta, style, layout은 필수\n- components, script는 선택\n- 각 블록은 정확히 한 번만 등장\n- 중복 블록 금지\n\n#### 2. Block Syntax (기본 문법)\n\n##### BLOCK_SYNTAX\n&#96;&#96;&#96;\n&lt;blockName&gt; {\n  &lt;property&gt;: &lt;value&gt;\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n&#96;&#96;&#96;\n\n##### SYNTAX_COMPONENTS\n- 블록 시작: IDENTIFIER + &#96; {&#96;\n- 블록 끝: &#96;}&#96; 단독 줄\n\n#### 3. Block Content Rules\n\n##### 공통 규칙\n- 블록 내부에는 property statements만 존재\n- block 내부에 block 중첩 금지\n- 단, layout 블록만 예외적으로 UI tree 구조 허용\n\n##### PROPERTY_RULE\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### VALUE_TYPES\n- string\n- number\n- boolean\n- enum-like literals (string 값)\n- list (향후 정의)\n\n#### 4. Block-Specific Rules\n\n##### (1) META BLOCK\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Page title\&quot;\n  route: \&quot;/path\&quot;\n  theme: \&quot;light\&quot;|\&quot;dark\&quot;\n}\n&#96;&#96;&#96;\n\n**META_RESTRICTIONS:**\n- meta는 UI 문서의 metadata만 포함\n- layout 정보나 스타일 정보 포함 금지\n\n##### (2) STYLE BLOCK\n&#96;&#96;&#96;\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n}\n&#96;&#96;&#96;\n\n**STYLE_RESTRICTIONS:**\n- key는 dot notation 사용 가능\n- 값은 string 또는 number\n- layout 관련 속성 금지\n- theme override 불가\n\n##### (3) COMPONENTS BLOCK (optional)\n&#96;&#96;&#96;\ncomponents {\n  Card\n  Button\n  Input\n}\n&#96;&#96;&#96;\n\n**COMPONENTS_RULES:**\n- 등록할 컴포넌트 이름만 줄 단위로 나열\n- 중첩 구조 없음\n- 속성 없음\n- 문자열 아님: &#96;\&quot;Card\&quot;&#96; 금지, &#96;Card&#96;만 허용\n\n##### (4) LAYOUT BLOCK\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n**LAYOUT_RULES:**\n- 유일하게 중첩 구조 허용\n- 노드 문법은 별도 Layer에서 정의\n- property는 inline attribute 형태 가능\n- block-like structure 유지\n\n##### (5) SCRIPT BLOCK (optional)\n&#96;&#96;&#96;\nscript {\n  onclick: \&quot;submitForm\&quot;\n  onload: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n**SCRIPT_RESTRICTIONS:**\n- event/behavior mapping만 정의\n- JS code 삽입 금지\n- inline function 금지\n- event identifier는 반드시 lowercase (camelCase 금지)\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n  spacing.unit: 8\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n}\n\nlayout {\n  Div(class:\&quot;container mx-auto p-4\&quot;) {\n    Card(class:\&quot;bg-white shadow-lg\&quot;) {\n      Button(onclick:\&quot;handleSubmit\&quot;) {\n        \&quot;Submit\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;processForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 파싱 실패\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유효 (경고)\n- components/script 외 블록에서 중첩 시도 시 오류\n- layout 외 블록에서 attribute 사용 시 오류\n\n---\n\n### Property Grammar\n\nUIH DSL 안정성의 핵심인 Property Grammar Layer입니다. Block Grammar 위에 쌓이며, 속성 선언, 값 타입, 범위 규칙을 정의합니다.\n\n#### 1. Property Declaration Syntax\n\n##### PROPERTY_SYNTAX\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\nradius.default: 8\nenabled: true\n&#96;&#96;&#96;\n\n##### RULES\n- identifier는 반드시 lowercase\n- dot notation 허용 (&#96;color.primary&#96; 등)\n- colon(:) 뒤에는 반드시 space 1개\n- value는 줄 끝까지\n\n#### 2. Identifier Rules\n\n##### IDENTIFIER\n- 패턴: &#96;[a-z][a-z0-9.]*&#96;\n- 소문자만 허용\n- 숫자는 뒤쪽에만 허용\n- dot(.)은 중첩 속성 의미로만 사용\n- hyphen 금지 (LLM 오류 방지)\n- underscore 금지\n\n##### VALID\n&#96;&#96;&#96;\ncolor.primary\nfont.size\nborder.width\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nColor.Primary    // 대문자\nfont-size        // hyphen\nfont_size        // underscore\nprimary2.color   // 숫자 앞쪽\n&#96;&#96;&#96;\n\n#### 3. Value Types (5가지)\n\n##### VALUE_TYPES\n1. STRING\n2. NUMBER\n3. BOOLEAN\n4. ENUM-LIKE (string 기반)\n5. LIST (여러 값 나열, 줄 단위)\n\n#### 4. String Value Rules\n\n##### STRING\n- 무조건 double-quote 사용\n- 내부에 &#96;\&quot;&#96; 포함 시 &#96;\\\&quot;&#96;로 escape\n- single-quote 절대 금지\n\n##### VALID\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\ndescription: \&quot;He said \\\&quot;ok\\\&quot;\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\ntitle: &#39;Home&#39;      // single-quote\nname: \&quot;Home\&quot;       // curly quotes\n&#96;&#96;&#96;\n\n#### 5. Number Value Rules\n\n##### NUMBER\n- 정수 또는 소숫점 가능\n- 음수는 허용하지 않음\n- 단위(px 등) 금지 → unitless 구조\n\n##### VALID\n&#96;&#96;&#96;\nradius: 12\nopacity: 0.85\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nradius: -4     // 음수\nwidth: 10px    // 단위 포함\n&#96;&#96;&#96;\n\n#### 6. Boolean Value Rules\n\n##### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nenabled: true\nvisible: false\n&#96;&#96;&#96;\n\n#### 7. Enum-like String Rules\n\n##### ENUM_STRING\n- 문자열이지만 값이 고정된 타입처럼 쓰는 케이스\n- allowed values는 별도 block schema마다 정의\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntheme: \&quot;light\&quot; | \&quot;dark\&quot;\nsize: \&quot;sm\&quot; | \&quot;md\&quot; | \&quot;lg\&quot;\n&#96;&#96;&#96;\n\n#### 8. List Value (Block-like list)\n\n##### LIST\n- 각 항목은 줄 단위로 입력\n- 대괄호 &#96;[]&#96; 문법 없음 (LLM 오류 방지)\n- 문자열/식별자 혼용 가능\n\n##### SYNTAX\n&#96;&#96;&#96;\nitems {\n  \&quot;one\&quot;\n  \&quot;two\&quot;\n  \&quot;three\&quot;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- list block 내부에는 property 없음\n- indent 2 spaces 유지\n\n##### EXAMPLE\n&#96;&#96;&#96;\ntags {\n  \&quot;news\&quot;\n  \&quot;feature\&quot;\n  \&quot;announcement\&quot;\n}\n&#96;&#96;&#96;\n\n#### 9. Property Scope Rules (Block별 허용 속성 경계)\n\n##### META_SCOPE\n- meta는 UI metadata만 포함\n- route, title, theme, description 등\n\n##### STYLE_SCOPE\n- 색상, 폰트, radius 등 UI 스타일만\n- layout 속성 금지 (width, height 등은 layout block에서만)\n\n##### COMPONENTS_SCOPE\n- property 없음 (등록만)\n\n##### LAYOUT_SCOPE\n- inline attribute만 (class, id, ref 등)\n- 값은 무조건 string\n- boolean/number 사용 금지\n\n##### SCRIPT_SCOPE\n- event mapping 전용\n- 값은 무조건 string\n\n#### 10. Final Validation Rules\n\n1. 모든 property는 블록 내부에서만 존재\n2. 같은 identifier 중복 선언 금지\n3. meta/style/script는 property-only 구조\n4. components는 선언만 (property 없음)\n5. layout만 child nodes 보유 가능\n6. value의 타입은 block-specific rule을 반드시 준수\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main dashboard page\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  border.radius: 8\n  spacing.unit: 16\n}\n\ncomponents {\n  Card\n  Button\n  Input\n}\n\nlayout {\n  class: \&quot;container\&quot;\n  id: \&quot;main-content\&quot;\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;handleForm\&quot;\n  onrefresh: \&quot;reloadData\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 대문자 identifier 사용 시 토큰화 실패\n- hyphen/underscore 사용 시 구문 오류\n- single-quote나 curly quotes 사용 시 파싱 실패\n- 음수나 단위 포함 숫자 시 값 오류\n- 블록별 스코프 위반 시 validation 실패\n- 중복 property 선언 시 마지막 값만 유효 (경고)\n\n---\n\n### Layout Tree Grammar\n\nUIH DSL의 핵심 구조인 Layout Tree Grammar Layer입니다. Block Grammar와 Property Grammar 위에서 동작하며, UI 구성 요소의 트리 구조를 정의합니다.\n\n#### 1. Layout Block Overview\n\n##### LAYOUT_BLOCK\n&#96;&#96;&#96;\nlayout {\n  &lt;layout-node&gt;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- DSL에서 유일하게 중첩 구조를 가질 수 있는 블록\n- 모든 UI 구성 요소는 layout node로 표현\n- 노드는 \&quot;구조\&quot;만 표현, 스타일/로직은 표현하지 않음\n\n#### 2. Layout Node Syntax\n\n##### NODE_SYNTAX\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;) {\n  &lt;children&gt;\n}\n&#96;&#96;&#96;\n\n##### OR (children 없는 경우)\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;)\n&#96;&#96;&#96;\n\n##### NOTES\n- TagName은 PascalCase 컴포넌트 또는 HTML-like 사용 가능\n- attributes는 inline 형태 only\n- attributes는 옵션, 없어도 됨\n- children 블록은 중첩 가능\n\n##### VALID\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) {\n  \&quot;Hello\&quot;\n}\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nDiv {\n  class: \&quot;p-4\&quot;    // 속성은 block 기반이 아니라 inline only\n}\n&#96;&#96;&#96;\n\n#### 3. TagName Rules\n\n##### TAGNAME\n- 반드시 알파벳으로 시작\n- PascalCase 또는 UpperCamelCase 권장\n- HTML-like 소문자 태그는 사용 가능 (&#96;div&#96;, &#96;span&#96;) 단 내부적으로는 UpperCase 변환됨\n\n##### VALID\n&#96;&#96;&#96;\nDiv\nSection\nImage\nheader   // 허용하지만 변환 시 Header로 취급\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n3Div     // 숫자 시작\n_Box     // underscore 시작\n-Node    // hyphen 시작\n&#96;&#96;&#96;\n\n#### 4. Attribute Syntax\n\n##### ATTRIBUTES\n&#96;&#96;&#96;\n&lt;identifier&gt;:\&quot;&lt;string&gt;\&quot;\n&#96;&#96;&#96;\n\n##### RULES\n- value는 무조건 string only\n- boolean/number 금지\n- &#96;class:\&quot;p-4\&quot;&#96; 형태처럼 inline만 허용\n- 각 attribute는 콤마(&#96;,&#96;)로 구분\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;, id:\&quot;main\&quot;, ref:\&quot;root\&quot;)\n&#96;&#96;&#96;\n\n##### STRICT_RULES\n- 속성 순서는 의미 없음 (LLM 실수 방지로 자유 순서)\n- attribute key는 lower-case only\n- 속성 개수 0~5 정도 권장\n\n#### 5. Children Rules\n\n##### CHILD_TYPES\n- string literal\n- another layout node\n- list of siblings (node 여러 개 배치)\n\n##### STRING_CHILD\n&#96;&#96;&#96;\n\&quot;Hello world\&quot;\n&#96;&#96;&#96;\n\n##### NESTED_NODE\n&#96;&#96;&#96;\nDiv(class:\&quot;mt-4\&quot;) {\n  \&quot;content\&quot;\n}\n&#96;&#96;&#96;\n\n##### SIBLINGS\n&#96;&#96;&#96;\nDiv(...) { ... }\nP(...) { ... }\nImage(...)\n&#96;&#96;&#96;\n\n#### 6. Text Node Rules\n\n##### TEXT_NODE\n- 무조건 double-quote string\n- 줄바꿈 포함 금지\n- 텍스트 덩어리는 여러 줄로 쪼개면 안 됨\n\n##### VALID\n&#96;&#96;&#96;\n\&quot;Sign in to continue\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n\&quot;Hello\n World\&quot;    // 줄바꿈 포함\n&#96;&#96;&#96;\n\n#### 7. Node Termination Rules\n\n##### CLOSING_RULES\n- 블록 노드는 반드시 &#96;}&#96; 단독 줄로 닫는다\n- inline-only 노드는 종료 블록 없음\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;px-4\&quot;) {\n  P {\n    \&quot;Hello\&quot;\n  }\n  Image(src:\&quot;/logo.png\&quot;)\n}\n&#96;&#96;&#96;\n\n#### 8. Layout Grammar Formal Pattern\n\n##### LAYOUT_NODE_GRAMMAR\n&#96;&#96;&#96;\nNode:\n  Tag (Attributes?) (ChildrenBlock?)\n\nTag:\n  IDENTIFIER\n\nAttributes:\n  \&quot;(\&quot; AttributeList \&quot;)\&quot;\n\nAttributeList:\n  Attribute (\&quot;,\&quot; Attribute)*\n\nAttribute:\n  IDENTIFIER \&quot;:\&quot; STRING\n\nChildrenBlock:\n  \&quot;{\&quot; NewLine Indented(NodeOrText)+ \&quot;}\&quot;\n\nNodeOrText:\n  Node | STRING\n&#96;&#96;&#96;\n\n#### 9. Validation Rules\n\n1. layout은 트리 구조만 표현한다\n2. inline attributes만 허용\n3. 속성은 string-only\n4. children은 반드시 정해진 중첩 규칙을 따른다\n5. Node 이름은 PascalCase가 기본\n6. 문자열 children 외에는 모든 children은 Node여야 한다\n7. siblings 허용, 순서 보존\n\n#### 10. Example (Valid Layout Tree)\n\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;min-h-screen flex flex-col\&quot;) {\n    Header(class:\&quot;p-4 bg-gray-100\&quot;) {\n      H1 {\n        \&quot;Dashboard\&quot;\n      }\n    }\n\n    Main(class:\&quot;flex-1 p-6\&quot;) {\n      Card(class:\&quot;shadow\&quot;) {\n        P {\n          \&quot;Welcome back!\&quot;\n        }\n      }\n    }\n\n    Footer(class:\&quot;p-4 text-center\&quot;) {\n      \&quot;© 2025 The Bespoke\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto\&quot;) {\n    Navbar(class:\&quot;flex justify-between items-center p-4\&quot;) {\n      Logo(class:\&quot;text-xl font-bold\&quot;) {\n        \&quot;UIH\&quot;\n      }\n      Nav(class:\&quot;space-x-4\&quot;) {\n        Link(href:\&quot;/home\&quot;) {\n          \&quot;Home\&quot;\n        }\n        Link(href:\&quot;/about\&quot;) {\n          \&quot;About\&quot;\n        }\n      }\n    }\n\n    Content(class:\&quot;grid grid-cols-3 gap-6 p-6\&quot;) {\n      Sidebar(class:\&quot;col-span-1 bg-gray-50 p-4\&quot;) {\n        Menu {\n          \&quot;Dashboard\&quot;\n          \&quot;Settings\&quot;\n          \&quot;Profile\&quot;\n        }\n      }\n\n      Main(class:\&quot;col-span-2\&quot;) {\n        Article(class:\&quot;prose\&quot;) {\n          H2 {\n            \&quot;Getting Started\&quot;\n          }\n          P {\n            \&quot;Welcome to UIH DSL documentation.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- TagName에 숫자/특수문자 시작 시 토큰화 실패\n- 속성에 boolean/number 값 사용 시 파싱 오류\n- 텍스트 노드에 줄바꿈 포함 시 validation 실패\n- 노드 종료 &#96;}&#96; 누락 시 구문 오류\n- 중첩 깊이가 너무 깊을 경우 (권장 5레벨 초과) 경고\n- siblings 간 순서가 UI 의미에 영향 줄 경우 재검토\n\n---\n\n### Parser BNF Grammar\n\nTokenizer 위에서 동작하는 공식 문법 엔진 정의입니다. Token Stream을 Abstract Syntax Tree(AST)로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- Token Stream → Abstract Syntax Tree(AST)\n\n##### PARSER_MODE\n- strict non-ambiguous grammar\n- no recovery parsing (에러는 즉시 throw)\n- deterministic (LLM-friendly)\n- recursive descent parser 기반 구조\n\n#### 2. Entry Point\n\n##### Program\n&#96;&#96;&#96;\nProgram ::= MetaBlock StyleBlock ComponentsBlock? LayoutBlock ScriptBlock? EOF\n&#96;&#96;&#96;\n\n#### 3. Blocks\n\n##### Block_Definitions\n&#96;&#96;&#96;\nMetaBlock       ::= \&quot;meta\&quot; BlockBody(MetaProperty)\nStyleBlock      ::= \&quot;style\&quot; BlockBody(StyleProperty)\nComponentsBlock ::= \&quot;components\&quot; BlockBody(ComponentEntry)\nLayoutBlock     ::= \&quot;layout\&quot; LayoutBody\nScriptBlock     ::= \&quot;script\&quot; BlockBody(ScriptProperty)\n&#96;&#96;&#96;\n\n#### 4. Generic Block Body\n\n##### BlockBody\n&#96;&#96;&#96;\nBlockBody(&lt;T&gt;) ::= LBRACE NEWLINE (Indent &lt;T&gt; NEWLINE)* RBRACE\nIndent         ::= WHITESPACE WHITESPACE    # 2 spaces only\n&#96;&#96;&#96;\n\n#### 5. META Block Grammar\n\n##### MetaProperty\n&#96;&#96;&#96;\nMetaProperty ::= Identifier \&quot;:\&quot; MetaValue\nMetaValue    ::= STRING | NUMBER | BOOLEAN | EnumString\n&#96;&#96;&#96;\n\n##### Allowed_Meta_Keys\n- title, route, theme, description\n\n#### 6. STYLE Block Grammar\n\n##### StyleProperty\n&#96;&#96;&#96;\nStyleProperty ::= StyleKey \&quot;:\&quot; StyleValue\nStyleKey      ::= Identifier ( \&quot;.\&quot; Identifier )*\nStyleValue    ::= STRING | NUMBER | EnumString\n&#96;&#96;&#96;\n\n##### Notes\n- no nested blocks\n- no boolean\n- layout-like attributes 금지\n\n#### 7. COMPONENTS Block Grammar\n\n##### ComponentEntry\n&#96;&#96;&#96;\nComponentEntry ::= ComponentName\nComponentName  ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n##### NOTES\n- but no quotes, no values, one per line\n\n##### Examples\n&#96;&#96;&#96;\nCard\nButton\nInput\n&#96;&#96;&#96;\n\n#### 8. LAYOUT Block Grammar (Core)\n\n##### LayoutBody\n&#96;&#96;&#96;\nLayoutBody     ::= LBRACE NEWLINE Indent LayoutNodeList RBRACE\nLayoutNodeList ::= (LayoutNode NEWLINE)*\nLayoutNode     ::= Tag (Attributes)? (ChildrenBlock)?\nTag            ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n#### 9. Attributes Grammar\n\n##### Attributes\n&#96;&#96;&#96;\nAttributes    ::= LPAREN AttributeList RPAREN\nAttributeList ::= Attribute (COMMA Attribute)*\nAttribute     ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n#### 10. Children Block Grammar\n\n##### ChildrenBlock\n&#96;&#96;&#96;\nChildrenBlock ::= LBRACE NEWLINE Indent ChildrenList RBRACE\nChildrenList  ::= (Child NEWLINE)*\nChild         ::= LayoutNode | TEXT_STRING\n&#96;&#96;&#96;\n\n#### 11. SCRIPT Block Grammar\n\n##### ScriptProperty\n&#96;&#96;&#96;\nScriptProperty ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n##### Allowed_Script_Keys\n- onclick, onload, onsubmit, onmount, onchange\n\n&gt; 모든 script event identifier는 전부 소문자여야 하며 camelCase를 사용하지 않는다.\n\n#### 12. Value Grammars\n\n##### Value_Types\n&#96;&#96;&#96;\nSTRING     ::= \&quot;\\\&quot;\&quot; &lt;chars&gt; \&quot;\\\&quot;\&quot;\nNUMBER     ::= digits ( \&quot;.\&quot; digits )?\nBOOLEAN    ::= \&quot;true\&quot; | \&quot;false\&quot;\nEnumString ::= STRING   # validated in semantic phase\n&#96;&#96;&#96;\n\n#### 13. Identifier Grammars\n\n##### Identifiers\n&#96;&#96;&#96;\nIdentifier ::= [a-z][a-z0-9.]*\nTagName    ::= [A-Z][a-zA-Z0-9]*\n&#96;&#96;&#96;\n\n#### 14. Syntax Constraints (Formal)\n\n1. 모든 블록은 순서 고정\n2. 각 블록은 1회만 등장\n3. meta/style/layout은 필수\n4. components/script는 optional\n5. 들여쓰기 2 spaces only\n6. 속성(colon)은 반드시 &#96;&lt;id&gt;: &lt;value&gt;&#96;\n7. semicolon 금지\n8. layout만 nested structure 허용\n9. children 안에서는 TEXT_STRING 또는 LayoutNode만 허용\n10. parser는 ambiguous branch 금지 (LLM-safe)\n\n#### 15. Complete Example (BNF-valid)\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  radius.default: 8\n}\n\ncomponents {\n  Card\n  Button\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello world\&quot;\n    }\n  }\n}\n\nscript {\n  onclick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### BNF 구조 트리\n\n&#96;&#96;&#96;\nProgram\n├── MetaBlock\n│   ├── LBRACE\n│   ├── MetaProperty (title: \&quot;Home\&quot;)\n│   ├── MetaProperty (route: \&quot;/\&quot;)\n│   └── RBRACE\n├── StyleBlock\n│   ├── LBRACE\n│   ├── StyleProperty (color.primary: \&quot;#0E5EF7\&quot;)\n│   ├── StyleProperty (radius.default: 8)\n│   └── RBRACE\n├── ComponentsBlock\n│   ├── LBRACE\n│   ├── ComponentEntry (Card)\n│   ├── ComponentEntry (Button)\n│   └── RBRACE\n├── LayoutBlock\n│   ├── LBRACE\n│   ├── LayoutNode (Div)\n│   │   ├── Attributes (class:\&quot;p-4\&quot;)\n│   │   └── ChildrenBlock\n│   │       └── LayoutNode (P)\n│   │           └── ChildrenBlock\n│   │               └── TEXT_STRING (\&quot;Hello world\&quot;)\n│   └── RBRACE\n└── ScriptBlock\n    ├── LBRACE\n    ├── ScriptProperty (onClick: \&quot;submitForm\&quot;)\n    └── RBRACE\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 즉시 파싱 중단\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유지 (경고)\n- 들여쓰기 2 space 위반 시 구문 오류\n- layout 외 블록에서 중첩 시도 시 파싱 실패\n- 허용되지 않은 키 사용 시 semantic 오류 (parser 단계에서는 허용)\n- TEXT_STRING이 layout 외 컨텍스트에서 등장 시 오류\n\n---\n\n## AST Schema Definition\n\nParser BNF 위에서 생성되는 최종 AST 구조입니다. 모든 UIH DSL 요소가 이 스키마에 따라 구조화됩니다.\n\n### 1. AST Root\n\n#### ASTRoot\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Program\&quot;\n  meta: MetaNode\n  style: StyleNode\n  components: ComponentsNode | null\n  layout: LayoutNode\n  script: ScriptNode | null\n}\n&#96;&#96;&#96;\n\n### 2. Meta Node\n\n#### MetaNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Meta\&quot;\n  properties: MetaProperty[]\n}\n&#96;&#96;&#96;\n\n#### MetaProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;title\&quot;\n  value: string|number|boolean\n  location: Range     // from tokenizer\n}\n&#96;&#96;&#96;\n\n### 3. Style Node\n\n#### StyleNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Style\&quot;\n  properties: StyleProperty[]\n}\n&#96;&#96;&#96;\n\n#### StyleProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;color.primary\&quot;\n  value: string|number\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 4. Components Node\n\n#### ComponentsNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Components\&quot;\n  components: ComponentEntry[]\n}\n&#96;&#96;&#96;\n\n#### ComponentEntry\n&#96;&#96;&#96;typescript\n{\n  name: string        // e.g. \&quot;Card\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 5. Layout Node (Core Tree Structure)\n\n#### LayoutNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Layout\&quot;\n  children: LayoutElement[]     // top-level nodes inside layout block\n}\n&#96;&#96;&#96;\n\n#### LayoutElement\n&#96;&#96;&#96;typescript\nLayoutElement = LayoutComponent | LayoutText\n&#96;&#96;&#96;\n\n#### 5.1 Layout Component\n&#96;&#96;&#96;typescript\nLayoutComponent {\n  type: \&quot;Component\&quot;\n  tag: string                   // e.g. \&quot;Div\&quot;, \&quot;P\&quot;, \&quot;Header\&quot;\n  attributes: Attribute[]\n  children: LayoutElement[]     // nested structure\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### Attribute\n&#96;&#96;&#96;typescript\n{\n  key: string                   // lower-case only\n  value: string                 // inline string only\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### 5.2 Layout Text Node\n&#96;&#96;&#96;typescript\nLayoutText {\n  type: \&quot;Text\&quot;\n  value: string                 // raw text string\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 6. Script Node\n\n#### ScriptNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Script\&quot;\n  events: ScriptProperty[]\n}\n&#96;&#96;&#96;\n\n#### ScriptProperty\n&#96;&#96;&#96;typescript\n{\n  key: string                   // e.g. \&quot;onClick\&quot;\n  value: string                 // e.g. \&quot;submitForm\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 7. Range Object (Source Location)\n\n#### Range\n&#96;&#96;&#96;typescript\n{\n  start: Position\n  end: Position\n}\n&#96;&#96;&#96;\n\n#### Position\n&#96;&#96;&#96;typescript\n{\n  line: number\n  column: number\n}\n&#96;&#96;&#96;\n\n### 8. Semantics Rules (Validation Layer)\n\n1. Meta keys must be from allowlist:\n   - title, route, theme, description\n\n2. Style keys may use dot notation but MUST be lowercase.\n\n3. Components must be names only, no properties.\n\n4. Layout:\n   - tag must be a valid TagName or valid identifier\n   - attributes must be string-only\n   - children: array of LayoutElement (component or text)\n\n5. Script:\n   - keys must be known event names\n   - value must be string (function name)\n\n6. No null children arrays. Use &#96;[]&#96; if empty.\n\n7. All nodes must have location data.\n\n### 9. Example: Full AST for a Simple Page\n\n#### Example DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### Generated AST (simplified)\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Home\&quot; },\n      { \&quot;key\&quot;: \&quot;route\&quot;, \&quot;value\&quot;: \&quot;/\&quot; }\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;color.primary\&quot;, \&quot;value\&quot;: \&quot;#0E5EF7\&quot; }\n    ]\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: [\n          { \&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;p-4\&quot; }\n        ],\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n### AST 구조 트리\n\n&#96;&#96;&#96;\nASTRoot (Program)\n├── meta (MetaNode)\n│   └── properties[] (MetaProperty)\n├── style (StyleNode)\n│   └── properties[] (StyleProperty)\n├── components (ComponentsNode | null)\n│   └── components[] (ComponentEntry)\n├── layout (LayoutNode)\n│   └── children[] (LayoutElement)\n│       ├── LayoutComponent\n│       │   ├── attributes[] (Attribute)\n│       │   └── children[] (LayoutElement)\n│       └── LayoutText\n└── script (ScriptNode | null)\n    └── events[] (ScriptProperty)\n&#96;&#96;&#96;\n\n### AST Examples\n\n#### 최소 AST 구조\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      {\&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Minimal\&quot;}\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: []\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Text\&quot;,\n        \&quot;value\&quot;: \&quot;Content\&quot;\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n#### 복잡한 레이아웃 AST\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Layout\&quot;,\n  \&quot;children\&quot;: [\n    {\n      \&quot;type\&quot;: \&quot;Component\&quot;,\n      \&quot;tag\&quot;: \&quot;Div\&quot;,\n      \&quot;attributes\&quot;: [\n        {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;container\&quot;}\n      ],\n      \&quot;children\&quot;: [\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Header\&quot;,\n          \&quot;attributes\&quot;: [],\n          \&quot;children\&quot;: [\n            {\n              \&quot;type\&quot;: \&quot;Component\&quot;,\n              \&quot;tag\&quot;: \&quot;H1\&quot;,\n              \&quot;attributes\&quot;: [],\n              \&quot;children\&quot;: [\n                {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Title\&quot;}\n              ]\n            }\n          ]\n        },\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Main\&quot;,\n          \&quot;attributes\&quot;: [\n            {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;content\&quot;}\n          ],\n          \&quot;children\&quot;: [\n            {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Main content\&quot;}\n          ]\n        }\n      ]\n    }\n  ]\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- location 정보 누락 시 AST 생성 실패\n- 빈 children 배열 대신 null 사용 시 validation 오류\n- 허용되지 않은 meta/style/script 키 사용 시 semantic 오류\n- LayoutComponent의 tag가 유효하지 않은 경우 오류\n- LayoutText에 빈 문자열 사용 시 경고\n- 중첩 깊이가 너무 깊을 경우 (10레벨 초과) 경고 또는 오류\n\n---\n\n## IR (Intermediate Representation) Specification\n\nAST → IR 변환 규칙을 정의합니다. Codegen 단계 직전의 \&quot;정규화된 구조\&quot;로, 플랫폼불문의 공통 인터페이스를 제공합니다.\n\n### 1. Overview\n\n#### IR_GOAL\n- AST의 복잡한 구조를 코드 생성하기 좋게 단순화\n- UI 컴포넌트 트리와 메타데이터를 정규화\n- 플랫폼불문(React/Next/Svelte) 공통 인터페이스로 변환\n- 모든 값은 최종적이고 확정된 형태만 유지\n\n#### INPUT\n- ASTRoot\n\n#### OUTPUT\n- IRRoot\n\n### 2. IR Root\n\n#### IRRoot\n&#96;&#96;&#96;typescript\n{\n  meta: IRMeta\n  style: IRStyle\n  components: IRComponents\n  layout: IRLayoutTree\n  script: IRScript\n}\n&#96;&#96;&#96;\n\n### 3. IRMeta (Final Document Metadata)\n\n#### IRMeta\n&#96;&#96;&#96;typescript\n{\n  title: string\n  route: string\n  theme: \&quot;light\&quot; | \&quot;dark\&quot;\n  description: string | null\n}\n&#96;&#96;&#96;\n\n#### Rules\n- missing values become null\n- enforce route starts with \&quot;/\&quot;\n\n### 4. IRStyle (Flattened Style Tokens)\n\n#### IRStyle\n&#96;&#96;&#96;typescript\n{\n  tokens: Record&lt;string, string | number&gt;\n}\n&#96;&#96;&#96;\n\n#### Examples\n&#96;&#96;&#96;typescript\n{\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n  \&quot;radius.default\&quot;: 8\n}\n&#96;&#96;&#96;\n\n#### Rules\n- dot-notation keys preserved\n- all values converted to primitive string/number\n- no validation here (semantic pass already done)\n\n### 5. IRComponents (Registered Component Map)\n\n#### IRComponents\n&#96;&#96;&#96;typescript\n{\n  list: string[]   // e.g. [\&quot;Card\&quot;, \&quot;Button\&quot;]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- duplicates removed\n- sorted alphabetically for deterministic output\n\n### 6. IRLayoutTree (Normalized UI Tree)\n\n#### IRLayoutTree\n&#96;&#96;&#96;typescript\n{\n  root: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### IRNode\n&#96;&#96;&#96;typescript\nIRNode = IRComponentNode | IRTextNode\n&#96;&#96;&#96;\n\n#### 6.1 IRComponentNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;component\&quot;\n  tag: string\n  attributes: Record&lt;string, string&gt;   // key:string only\n  children: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- attribute keys lower-case enforced\n- children always array\n- empty children =&gt; []\n\n#### 6.2 IRTextNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;text\&quot;\n  value: string\n}\n&#96;&#96;&#96;\n\n#### Rules\n- trimmed text preserved exactly\n- no newline allowed inside text\n\n### 7. IRScript (Event Map)\n\n#### IRScript\n&#96;&#96;&#96;typescript\n{\n  events: Record&lt;string, string&gt;   // onClick → \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Rules\n- all keys normalized to lower-case event names\n- event value must be string only\n- duplicates override earlier definitions\n\n### 8. AST → IR Mapping Rules\n\n1. **MetaNode → IRMeta**\n   - convert property array → object map\n   - apply default values if missing\n   - route must start with \&quot;/\&quot;\n\n2. **StyleNode → IRStyle**\n   - flatten list into tokens object\n   - preserve ordering but output sorted keys for determinism\n\n3. **ComponentsNode → IRComponents**\n   - convert component list → array\n   - remove duplicates\n   - sort alphabetically\n\n4. **LayoutNode → IRLayoutTree**\n   - recursively convert LayoutComponent → IRComponentNode\n   - convert LayoutText → IRTextNode\n   - inline attributes converted to plain object\n\n5. **ScriptNode → IRScript**\n   - property list flattened to event map\n   - enforce lower-case event names\n\n### 9. Example: Full IR Output\n\n#### DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### IR\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Home\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: null,\n    \&quot;description\&quot;: null\n  },\n\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n    }\n  },\n\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: []\n  },\n\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: { \&quot;class\&quot;: \&quot;p-4\&quot; },\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {}\n  }\n}\n&#96;&#96;&#96;\n\n### IR 구조 트리\n\n&#96;&#96;&#96;\nIRRoot\n├── meta (IRMeta)\n│   ├── title: string\n│   ├── route: string\n│   ├── theme: \&quot;light\&quot;|\&quot;dark\&quot;|null\n│   └── description: string|null\n├── style (IRStyle)\n│   └── tokens: Record&lt;string, string|number&gt;\n├── components (IRComponents)\n│   └── list: string[]\n├── layout (IRLayoutTree)\n│   └── root: IRNode[]\n│       ├── IRComponentNode\n│       │   ├── type: \&quot;component\&quot;\n│       │   ├── tag: string\n│       │   ├── attributes: Record&lt;string, string&gt;\n│       │   └── children: IRNode[]\n│       └── IRTextNode\n│           ├── type: \&quot;text\&quot;\n│           └── value: string\n└── script (IRScript)\n    └── events: Record&lt;string, string&gt;\n&#96;&#96;&#96;\n\n### IR Examples\n\n#### 간단한 IR 변환\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Simple\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: \&quot;light\&quot;,\n    \&quot;description\&quot;: null\n  },\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#000\&quot;,\n      \&quot;font.size\&quot;: 14\n    }\n  },\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: [\&quot;Button\&quot;]\n  },\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: {},\n        \&quot;children\&quot;: [\n          {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Content\&quot;}\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {\n      \&quot;onclick\&quot;: \&quot;handleClick\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 복잡한 중첩 레이아웃 IR\n&#96;&#96;&#96;json\n{\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Container\&quot;,\n        \&quot;attributes\&quot;: {\n          \&quot;class\&quot;: \&quot;flex flex-col min-h-screen\&quot;\n        },\n        \&quot;children\&quot;: [\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Header\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;p-4 bg-blue-600\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;H1\&quot;,\n                \&quot;attributes\&quot;: {},\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Dashboard\&quot;}\n                ]\n              }\n            ]\n          },\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Main\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;flex-1 p-6\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;Card\&quot;,\n                \&quot;attributes\&quot;: {\n                  \&quot;class\&quot;: \&quot;bg-white shadow-lg rounded\&quot;\n                },\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Welcome!\&quot;}\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- AST에 location 정보 누락 시 IR 변환 실패\n- route가 \&quot;/\&quot;로 시작하지 않을 경우 변환 시 강제 추가\n- 중복 컴포넌트 등록 시 알파벳 순 정렬로 중복 제거\n- 빈 children 배열을 null로 잘못 설정 시 []로 강제 변환\n- 텍스트 노드에 줄바꿈 포함 시 변환 중 제거 또는 오류\n- 이벤트 키 대소문자 혼재 시 소문자로 통일\n- 스타일 토큰 키 순서가 다를 경우 sorted keys로 결정적 출력 보장\n\n---\n\n## Codegen Rules\n\n### React/Next.js 15 Codegen\n\nIR을 기반으로 안정적인 UI 코드 생성 규칙입니다. React/Next.js 15 (App Router + RSC) 기준으로 IR을 실제 코드로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- IR을 기반으로 안정적인 UI 코드 생성\n- React/Next.js 15 (App Router + RSC) 기준\n- \&quot;디자인 시스템 없는 순수 Layout Tree\&quot;를 코드로 변환\n- 가능한 한 deterministic 하게 출력\n- 로직/상태/이벤트는 최소 수준으로만 개입\n\n##### INPUT\n- IRRoot\n\n##### OUTPUT\n- React Component Source Code (string)\n\n#### 2. Output Structure\n\n파일 구조는 다음 형태로 생성합니다:\n\n&#96;&#96;&#96;\n/page.tsx\n  - metadata (title, description)\n  - default export function Page()\n  - return(...) 내부에 layout tree 삽입\n\n/style-tokens.ts\n  - style.tokens flatten export\n\n/components/index.ts\n  - components registry export\n\n/script-events.ts\n  - event name string mapping export\n&#96;&#96;&#96;\n\n#### 3. Metadata Codegen\n\n##### UIH meta → Next.js metadata\n&#96;&#96;&#96;typescript\nIRMeta {\n  title: string\n  description: string\n}\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;typescript\nexport const metadata = {\n  title: \&quot;&lt;title&gt;\&quot;,\n  description: \&quot;&lt;description&gt;\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- description 없으면 필드 제외\n- theme는 metadata에 직접 쓰지 않음 (스타일토큰 용)\n\n#### 4. Style Token Codegen\n\n##### IRStyle { tokens }\n&#96;&#96;&#96;typescript\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;radius.default\&quot;: 8,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 키는 string 리터럴 그대로\n- numeric/string 그대로 출력\n- sorted keys for deterministic output\n\n#### 5. Component Registry Codegen\n\n##### IRComponents.list → export list\n&#96;&#96;&#96;typescript\nexport const components = {\n  Card,\n  Button,\n  Input,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 자동 import 하지 않음 (상위 시스템이 resolve)\n- keys는 PascalCase 유지\n- duplicates 제거 후 정렬\n\n#### 6. Layout Tree → JSX Codegen\n\n##### IRLayoutTree → React element tree\n\n##### 6.1 Component Node\n&#96;&#96;&#96;typescript\nIRComponentNode {\n  tag: \&quot;Div\&quot;\n  attributes: { class: \&quot;p-4\&quot; }\n  children: [...]\n}\n&#96;&#96;&#96;\n\n##### OUTPUT JSX\n&#96;&#96;&#96;jsx\n&lt;Div className=\&quot;p-4\&quot;&gt;\n  {children...}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n##### RULES\n- attribute.key \&quot;class\&quot; → \&quot;className\&quot;\n- attribute key는 그대로 lower-case 유지\n- value는 string literal\n- children length 0 이면 self-closing 금지 (always explicit block)\n- tag name 그대로 JSX 컴포넌트로 사용\n\n##### 6.2 Text Node\n&#96;&#96;&#96;typescript\nIRTextNode { value: \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;jsx\n{\&quot;Hello\&quot;}\n&#96;&#96;&#96;\n\n##### RULES\n- 텍스트는 JSX children 표현\n- 특수문자는 자동 escape\n\n#### 7. Script Event Codegen\n\n##### IRScript.events → export mapping\n&#96;&#96;&#96;typescript\nexport const eventHandlers = {\n  onClick: \&quot;submitForm\&quot;,\n  onLoad: \&quot;init\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- event 이름은 lower-case normalized\n- 값은 string (함수명)\n- 실제 JS 함수 body는 생성하지 않음\n- 나중 시스템이 자동 wire-up 함\n\n#### 8. Full Page Generation\n\n최종 page.tsx는 다음 구조를 따릅니다:\n\n&#96;&#96;&#96;typescript\nexport const metadata = { ... };\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen p-4\&quot;&gt;\n      &lt;P&gt;{\&quot;Hello\&quot;}&lt;/P&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### RULES\n- 최상위는 항상 &#96;&lt;Div&gt;&#96; 같은 Wrapper로 시작하지 않아도 됨\n- layout.root가 배열이면 Fragment로 감싼다\n- 코드 스타일은 2-space indent\n- 세미콜론 붙이지 않음 (Prettier 옵션 따라감)\n\n#### 9. Determinism Rules\n\n1. 속성 순서는 key 알파벳순 정렬\n2. children 순서는 DSL 입력 순서 그대로\n3. components 목록은 알파벳순 정렬\n4. styleTokens도 key 정렬\n5. eventHandlers key 정렬\n6. output JSX는 항상 multiline\n\n#### 10. Full Example (DSL → IR → JSX)\n\n##### DSL\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n##### JSX OUT\n&#96;&#96;&#96;typescript\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;p-4\&quot;&gt;\n      {\&quot;Hello\&quot;}\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n#### 11. Notes for Engine Integrators\n\n1. Codegen은 \&quot;순수 구조\&quot;만 책임진다\n   - 상태(state), fetch, useEffect 등은 지원하지 않음\n2. 이벤트 핸들러는 단순 라벨링 시스템\n3. 스타일 토큰은 UI 프레임워크에서 직접 해석\n4. React, Vue, Svelte 등 플랫폼별 코드젠 가능\n   - 플랫폼별 레이어는 분리\n\n#### Output Files 구조\n\n&#96;&#96;&#96;\nOutput Files\n├── page.tsx\n│   ├── metadata export\n│   ├── imports (components, styleTokens, eventHandlers)\n│   ├── Page() function\n│   └── JSX return (layout tree)\n├── style-tokens.ts\n│   └── styleTokens export\n├── components/index.ts\n│   └── components export\n└── script-events.ts\n    └── eventHandlers export\n&#96;&#96;&#96;\n\n#### Codegen Examples\n\n##### 전체 페이지 코드 생성 예시\n&#96;&#96;&#96;typescript\n// page.tsx\nexport const metadata = {\n  title: \&quot;Dashboard\&quot;,\n  description: \&quot;Main dashboard page\&quot;\n};\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen flex flex-col\&quot;&gt;\n      &lt;Header className=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n        &lt;H1&gt;\n          {\&quot;Dashboard\&quot;}\n        &lt;/H1&gt;\n      &lt;/Header&gt;\n      &lt;Main className=\&quot;flex-1 p-6\&quot;&gt;\n        &lt;Card className=\&quot;bg-white shadow-lg rounded-lg p-6\&quot;&gt;\n          &lt;P&gt;\n            {\&quot;Welcome back!\&quot;}\n          &lt;/P&gt;\n        &lt;/Card&gt;\n      &lt;/Main&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### 스타일 토큰 파일 예시\n&#96;&#96;&#96;typescript\n// style-tokens.ts\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;color.secondary\&quot;: \&quot;#6B7280\&quot;,\n  \&quot;color.accent\&quot;: \&quot;#F59E0B\&quot;,\n  \&quot;spacing.small\&quot;: 8,\n  \&quot;spacing.medium\&quot;: 16,\n  \&quot;spacing.large\&quot;: 24,\n  \&quot;border.radius\&quot;: 6,\n  \&quot;font.family\&quot;: \&quot;Inter\&quot;,\n  \&quot;font.size.base\&quot;: 16,\n  \&quot;shadow.default\&quot;: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n};\n&#96;&#96;&#96;\n\n##### 컴포넌트 레지스트리 예시\n&#96;&#96;&#96;typescript\n// components/index.ts\nexport const components = {\n  Button,\n  Card,\n  Input,\n  Modal,\n  Sidebar\n};\n&#96;&#96;&#96;\n\n##### 이벤트 핸들러 파일 예시\n&#96;&#96;&#96;typescript\n// script-events.ts\nexport const eventHandlers = {\n  onclick: \&quot;handleClick\&quot;,\n  onload: \&quot;initDashboard\&quot;,\n  onsubmit: \&quot;processForm\&quot;\n};\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- layout.root가 빈 배열일 경우 빈 Fragment 생성\n- 컴포넌트 이름이 JavaScript 예약어와 충돌 시 escaping 필요\n- 텍스트에 JSX 특수문자 포함 시 자동 escape\n- 중첩 깊이가 깊을 경우 코드 포맷팅 유지\n- import 경로 resolve 실패 시 상위 시스템에서 처리\n- styleTokens에 특수문자 키 포함 시 유효한 JS 객체 키로 변환\n\n---\n\n### Vue &amp; Svelte Codegen\n\nReact Codegen과 동일한 IR 기반으로 Vue와 Svelte 코드를 생성하는 규칙입니다. 플랫폼별 렌더링 규칙만 다르게 적용합니다.\n\n## SECTION A — Vue Codegen (SFC 기준)\n\n### GOAL\n- IR → .vue 파일 형태로 변환\n- &#96;&lt;template&gt;&#96; + &#96;&lt;script setup&gt;&#96; + &#96;&lt;style&gt;&#96; 구조 유지\n- 모든 로직은 배제하고 구조만 생성\n\n### OUTPUT FILE STRUCTURE\n&#96;&#96;&#96;\nMyPage.vue\n&#96;&#96;&#96;\n\n### 1. Top-Level Structure\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;!-- layout tree --&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport components...\n\nconst events = {...}\nconst styleTokens = {...}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* optional if needed */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Vue Template 규칙\n\n#### IRComponentNode(tag:\&quot;Div\&quot;, attributes, children)\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  &lt;!-- children --&gt;\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;className&#96; → &#96;class&#96;\n- attribute values: string only\n- children: 그대로 template로 변환\n- Fragment는 &#96;&lt;template&gt;&#96; 안에서 그냥 siblings로 출력\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello (그대로 text node)\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\neventHandlers {\n  onClick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Vue OUTPUT\n&#96;&#96;&#96;vue\n@click=\&quot;submitForm\&quot;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;onClick&#96; → &#96;@click&#96;\n- &#96;onChange&#96; → &#96;@change&#96;\n- &#96;onInput&#96; → &#96;@input&#96;\n- &#96;onLoad&#96; → &#96;@load&#96;\n- value는 함수 이름 string\n- 함수 구현은 생성하지 않음\n\n### 4. Component Registry (imports)\n&#96;&#96;&#96;javascript\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules\n- 속성(sorted)\n- imports(sorted)\n- children 순서 그대로\n- no semicolons\n- template 들여쓰기 2 spaces\n\n## SECTION B — Svelte Codegen (.svelte)\n\n### GOAL\n- Svelte 컴포넌트 파일 하나로 완성\n- &#96;&lt;script&gt;&#96; + markup 구조\n\n### OUTPUT STRUCTURE\n&#96;&#96;&#96;\nMyPage.svelte\n&#96;&#96;&#96;\n\n### 1. File Layout\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import components...\n  export let events = {...}\n  export let styleTokens = {...}\n&lt;/script&gt;\n\n&lt;!-- layout markup --&gt;\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  Hello\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* optional */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Svelte Markup\n\n#### IRComponentNode(tag, attributes, children)\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  {#if ... ?} (없음)\n  {children}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- 클래스는 &#96;class&#96;\n- 속성 문자열만\n- Self-closing 금지\n- children 재귀적 삽입\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\nIRScript:\nonClick → function name\n&#96;&#96;&#96;\n\n#### Svelte OUTPUT\n&#96;&#96;&#96;svelte\non:click={submitForm}\n&#96;&#96;&#96;\n\n#### Mapping\n&#96;&#96;&#96;\nonClick   → on:click\nonChange  → on:change\nonInput   → on:input\nonLoad    → on:load\n&#96;&#96;&#96;\n\n### 4. Components Import\n&#96;&#96;&#96;javascript\nimport Card from \&quot;./Card.svelte\&quot;;\nimport Button from \&quot;./Button.svelte\&quot;;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules (필수)\n\n1. import 순서는 알파벳 정렬\n2. attributes sorted\n3. event names lower-case\n4. children 순서 보존\n5. markup 들여쓰기 2 spaces\n\n## SECTION C — Cross-Platform Notes\n\n1. React / Vue / Svelte 모두 IR만 참조\n2. layout tree는 그대로 세 렌더러에서 재활용\n3. event handler는 단순 label → framework alias로 변환\n4. styleTokens는 컴파일러 외부 시스템이 처리\n5. components는 registry 기반으로 import만 생성\n\n## SECTION D — Example Conversion (Same IR → Vue/Svelte)\n\n### IR\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) { \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n### Vue Template\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Svelte Markup\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte 구조\n\n&#96;&#96;&#96;\nVue Output (.vue)\n├── &lt;template&gt;\n│   └── layout tree (Vue template syntax)\n├── &lt;script setup&gt;\n│   ├── component imports\n│   ├── events object\n│   └── styleTokens object\n└── &lt;style scoped&gt;\n    └── optional styles\n\nSvelte Output (.svelte)\n├── &lt;script&gt;\n│   ├── component imports\n│   ├── export let events = {...}\n│   └── export let styleTokens = {...}\n├── layout markup (Svelte syntax)\n└── &lt;style&gt;\n    └── optional styles\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte Examples\n\n#### Vue SFC 전체 예시\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n    &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n      &lt;H1&gt;\n        Dashboard\n      &lt;/H1&gt;\n    &lt;/Header&gt;\n    &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n      &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; @click=\&quot;handleCardClick\&quot;&gt;\n        &lt;P&gt;\n          Welcome back!\n        &lt;/P&gt;\n      &lt;/Card&gt;\n    &lt;/Main&gt;\n  &lt;/Div&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n\nconst events = {\n  handleCardClick: \&quot;handleCardClick\&quot;\n}\n\nconst styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;spacing.medium\&quot;: 16\n}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### Svelte 컴포넌트 전체 예시\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import Card from \&quot;./Card.svelte\&quot;;\n  import Button from \&quot;./Button.svelte\&quot;;\n\n  export let events = {\n    handleCardClick: \&quot;handleCardClick\&quot;\n  };\n\n  export let styleTokens = {\n    \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n    \&quot;spacing.medium\&quot;: 16\n  };\n&lt;/script&gt;\n\n&lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n  &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n    &lt;H1&gt;\n      Dashboard\n    &lt;/H1&gt;\n  &lt;/Header&gt;\n  &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n    &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; on:click={handleCardClick}&gt;\n      &lt;P&gt;\n        Welcome back!\n      &lt;/P&gt;\n    &lt;/Card&gt;\n  &lt;/Main&gt;\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### 이벤트 매핑 비교\n&#96;&#96;&#96;javascript\n// 동일한 IR 이벤트\n{\n  onClick: \&quot;handleClick\&quot;,\n  onChange: \&quot;handleChange\&quot;,\n  onLoad: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;vue\n&lt;!-- Vue --&gt;\n&lt;Button @click=\&quot;handleClick\&quot; @change=\&quot;handleChange\&quot; @load=\&quot;init\&quot;&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;svelte\n&lt;!-- Svelte --&gt;\n&lt;Button on:click={handleClick} on:change={handleChange} on:load={init}&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;jsx\n&lt;!-- React --&gt;\n&lt;Button onClick={handleClick} onChange={handleChange} onLoad={init}&gt;\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- Vue에서 컴포넌트 이름이 kebab-case로 변환 필요 시 자동 처리\n- Svelte에서 export let 구문이 예약어와 충돌 시 renaming\n- 이벤트 핸들러가 정의되지 않은 경우 플랫폼별 기본 동작\n- 스타일 토큰에 CSS 변수나 함수 포함 시 escaping\n- 중첩 컴포넌트 깊이가 깊을 경우 플랫폼별 최적화 적용\n- 텍스트 콘텐츠에 플랫폼별 특수문자 포함 시 자동 escape\n\n---\n\n## Examples\n\n### 완전한 UIH DSL 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;User Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main user dashboard with analytics\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  color.accent: \&quot;#F59E0B\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n  font.size.h1: 32\n  spacing.small: 8\n  spacing.medium: 16\n  spacing.large: 24\n  border.radius: 6\n  shadow.default: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n  Sidebar\n  Chart\n}\n\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto p-6\&quot;) {\n    Header(class:\&quot;mb-8\&quot;) {\n      Div(class:\&quot;flex justify-between items-center\&quot;) {\n        H1(class:\&quot;text-3xl font-bold\&quot;) {\n          \&quot;Dashboard\&quot;\n        }\n        Button(class:\&quot;px-4 py-2 bg-blue-600 text-white rounded\&quot;) {\n          \&quot;New Report\&quot;\n        }\n      }\n    }\n\n    Div(class:\&quot;grid grid-cols-3 gap-6\&quot;) {\n      Card(class:\&quot;col-span-2\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Analytics Overview\&quot;\n        }\n        Chart(class:\&quot;w-full h-64\&quot;)\n      }\n\n      Card(class:\&quot;col-span-1\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Quick Stats\&quot;\n        }\n        Div(class:\&quot;space-y-4\&quot;) {\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Total Users\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;1,234\&quot;\n            }\n          }\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Active Sessions\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;89\&quot;\n            }\n          }\n        }\n      }\n    }\n\n    Sidebar(class:\&quot;mt-8\&quot;) {\n      H3(class:\&quot;text-lg mb-4\&quot;) {\n        \&quot;Recent Activity\&quot;\n      }\n      Div(class:\&quot;space-y-2\&quot;) {\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;User john@example.com logged in\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;New report generated\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;System backup completed\&quot;\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onLoad: \&quot;initDashboard\&quot;\n  onClick: \&quot;handleButtonClick\&quot;\n  onRefresh: \&quot;refreshData\&quot;\n}\n&#96;&#96;&#96;\n\n### 최소 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Minimal Page\&quot;\n  route: \&quot;/minimal\&quot;\n  theme: \&quot;light\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  spacing.unit: 12\n}\n\nlayout {\n  Div(class:\&quot;min-h-screen flex items-center justify-center bg-gray-50\&quot;) {\n    \&quot;Coming soon\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n### Form 중심 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Sign Up\&quot;\n  route: \&quot;/signup\&quot;\n  theme: \&quot;light\&quot;\n  description: \&quot;Create a new account\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#2563EB\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n}\n\ncomponents {\n  Form\n  Input\n  Button\n  Alert\n}\n\nlayout {\n  Section(class:\&quot;min-h-screen flex items-center justify-center bg-gray-100\&quot;) {\n    Form(class:\&quot;w-full max-w-md space-y-6 bg-white p-8 rounded-xl shadow-lg\&quot;) {\n      H2(class:\&quot;text-2xl font-semibold text-gray-900\&quot;) {\n        \&quot;Create your account\&quot;\n      }\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;email\&quot;, placeholder:\&quot;Enter email\&quot;)\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;password\&quot;, placeholder:\&quot;Enter password\&quot;)\n      Button(class:\&quot;w-full bg-blue-600 text-white py-3 rounded-lg\&quot;) {\n        \&quot;Sign up\&quot;\n      }\n      Alert(class:\&quot;text-sm text-gray-500 text-center\&quot;) {\n        \&quot;By signing up you agree to our terms\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onSubmit: \&quot;handleSignup\&quot;\n  onLoad: \&quot;prefillFromInvite\&quot;\n}\n&#96;&#96;&#96;\n\n### 콘텐츠 피드 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Creator Feed\&quot;\n  route: \&quot;/feed\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Realtime creator activity feed\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#22D3EE\&quot;\n  color.background: \&quot;#0F172A\&quot;\n  font.family: \&quot;Space Grotesk\&quot;\n  spacing.medium: 20\n  radius.card: 12\n}\n\ncomponents {\n  Shell\n  Sidebar\n  Feed\n  FeedItem\n  Avatar\n  Badge\n}\n\nlayout {\n  Shell(class:\&quot;min-h-screen bg-slate-950 text-slate-100\&quot;) {\n    Sidebar(class:\&quot;w-64 border-r border-slate-800 p-6 space-y-6\&quot;) {\n      H1(class:\&quot;text-xl font-semibold tracking-tight\&quot;) {\n        \&quot;Creator Hub\&quot;\n      }\n      Badge(class:\&quot;inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 text-slate-200\&quot;) {\n        \&quot;Live updates\&quot;\n      }\n    }\n    Feed(class:\&quot;flex-1 p-8 space-y-6\&quot;) {\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-cyan-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;heymina.studio\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-300\&quot;) {\n              \&quot;New drop\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Dropped a limited neon kit — 120 packs sold out in 3 minutes.\&quot;\n          }\n        }\n      }\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-pink-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;luvv.wav\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-cyan-500/10 text-cyan-300\&quot;) {\n              \&quot;Stream recap\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Hit 18,245 live viewers tonight — chat requested a synthwave encore.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onRefresh: \&quot;fetchLatestFeed\&quot;\n  onClick: \&quot;openCreatorProfile\&quot;\n}\n&#96;&#96;&#96;\n\n---\n\n## Version\n\n- **Version**: 1.0.0\n- **Last Update**: 2025-11-18\n- **Change Summary**: Complete guide consolidating all UIH DSL specifications\n\n---\n\n## 문서 끝\n\n이 문서는 UIH DSL의 모든 스펙을 \&quot;생략 없이\&quot; 하나의 파일로 통합한 완전판입니다. Foundation Layer부터 Codegen까지 전 과정을 포함하며, LLM이 UI를 정확하게 선언할 수 있도록 설계된 모든 규칙이 담겨 있습니다.\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating ScriptNode type comment**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;38b04564-d288-46a9-9777-dd9f6a0636de&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  &#96;&#96;&#96;typescript\n  {\n-   key: string                   // e.g. \&quot;onClick\&quot;\n+   key: string                   // e.g. \&quot;onclick\&quot; (lowercase only)\n    value: string                 // e.g. \&quot;submitForm\&quot;\n    location: Range&quot;,
        &quot;oldStart&quot;: 1548,
        &quot;newStart&quot;: 1548,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;,
  &quot;contentsAfterEdit&quot;: &quot;# UIH DSL — Complete Guide (생략 없는 완전판)\n\n## Table of Contents\n\n1. [Overview](#overview)\n2. [Philosophy &amp; Design Principles](#philosophy--design-principles)\n3. [Foundation Layer](#foundation-layer)\n4. [Tokenizer Specification](#tokenizer-specification)\n5. [Grammar](#grammar)\n   - [Block Grammar](#block-grammar)\n   - [Property Grammar](#property-grammar)\n   - [Layout Tree Grammar](#layout-tree-grammar)\n   - [Parser BNF Grammar](#parser-bnf-grammar)\n6. [AST Schema Definition](#ast-schema-definition)\n7. [IR (Intermediate Representation) Specification](#ir-intermediate-representation-specification)\n8. [Codegen Rules](#codegen-rules)\n   - [React/Next.js 15 Codegen](#reactnextjs-15-codegen)\n   - [Vue &amp; Svelte Codegen](#vue--svelte-codegen)\n9. [Examples](#examples)\n10. [Version](#version)\n\n---\n\n## Overview\n\nUIH DSL (Universal Interface Hierarchy Domain Specific Language) v2는 **\&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;**를 목표로 하는 도메인 특화 언어입니다.\n\n### 핵심 목표\n- LLM이 UI 구조를 **정확하게** 선언할 수 있도록 설계\n- 모호성 제거 및 결정성(determinism) 보장\n- 사람보다 AI가 더 효과적으로 사용 가능한 DSL\n- UI 구조의 선언적 표현에 집중\n\n### 아키텍처 흐름\n&#96;&#96;&#96;\nDSL 문자열 → Tokenizer → Parser → AST → IR → Codegen → React/Vue/Svelte 코드\n&#96;&#96;&#96;\n\n### 주요 특징\n- 한 줄에 하나의 의미만 (One-intent-per-line)\n- 선택적 문법 금지 - 모든 것이 명시적\n- 쌍따옴표만 허용, 세미콜론 없음\n- 주석 지원 안 함 (모호성 제거)\n- 고정 블록 순서: meta → style → components → layout → script\n\n---\n\n## Philosophy &amp; Design Principles\n\nUIH DSL은 \&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;를 목표로 하는 도메인 특화 언어입니다. 사람보다 LLM이 더 효과적으로 사용할 수 있도록 설계되었으며, UI 구조의 선언적 표현에 집중합니다.\n\n### 1. LLM 친화적 설계 원칙\n\nLLM이 읽고 쓰기 편한 DSL을 지향합니다. 구조는 최대한 명확하고 모호성이 없으며, 선택적 문법을 금지합니다. LLM이 패턴을 쉽게 반복할 수 있는 형태로 자연어 번역 난이도를 낮췄습니다.\n\n### 2. 선언적 UI 설계\n\nUI는 로직 기반보다 구조 기반으로 설계합니다. \&quot;무엇을 만든다\&quot;에 집중하며 \&quot;어떻게 만든다\&quot;는 Codegen이 담당합니다. 상태, 이벤트, 애니메이션은 추상화 계층으로 밀어냅니다.\n\n### 3. 한 줄 한 의미 원칙 (One-intent-per-line)\n\n한 라인에 하나의 의미만 허용합니다. 한 줄에 두 개 의미를 섞으면 LLM이 실수할 가능성이 높아집니다.\n\n#### 좋은 예: 한 줄 한 의미\n&#96;&#96;&#96;dsl\nmeta:\n  title: \&quot;Home\&quot;\n\nmeta:\n  route: \&quot;/\&quot;\n&#96;&#96;&#96;\n\n#### 나쁜 예: 한 줄 다중 의미 (금지)\n&#96;&#96;&#96;dsl\nmeta: title: \&quot;Home\&quot;, route: \&quot;/\&quot;  # 잘못된 예\n&#96;&#96;&#96;\n\n### 4. 고정 블록 순서\n\n블록 구조는 **meta → style → components → layout → script** 순서를 유지합니다. 이 순서는 LLM이 외우기 쉽고 Codegen의 예측 가능성과 AST의 결정성을 보장합니다.\n\n### 5. 최소 표현, 최대 의미\n\nDSL은 짧고 규칙적이어야 합니다. CSS-like verbose, YAML 계층 증가, JSX 로직 섞임을 금지합니다. 의미 전달에 집중하는 최소 선언적 DSL입니다.\n\n### 6. 오류 제로 문법\n\n\&quot;AI가 틀릴 수 없는 언어\&quot;를 목표로 합니다. 쌍따옴표만 허용하고 세미콜론 없이 콜론만 사용합니다. 모든 키는 고정된 string literal이며 optional field를 최소화합니다.\n\n### 7. AST 1:1 매핑\n\n모든 UI 요소가 AST에 직접 매핑됩니다. meta 블록 → MetaNode, style 블록 → StyleNode, layout 블록 → LayoutTree로 변환됩니다.\n\n### 8. 기계 친화적 우선\n\n\&quot;사람이 읽으면 조금 불편할 것\&quot; 정도가 적정 수준입니다. 사람 UX보다 AI 정확성을 우선합니다.\n\n---\n\n## Foundation Layer\n\nUIH DSL의 가장 낮은 레벨 사양입니다. Character부터 Ordering까지의 기본 규칙을 정의하며, LLM이 실수할 수 없는 엄격한 문법을 제공합니다.\n\n### 1. Character Layer (문자 규칙)\n\n#### ALLOWED_CHARACTERS\n- a~z (lowercase alphabets)\n- 0~9 (digits)\n- hyphen (-)\n- underscore (_)\n- space ( )\n- newline (\\n)\n- braces: { }\n- colon (:)\n- double-quote (\&quot;)\n\n#### DISALLOWED_CHARACTERS\n- single-quote (&#39;)\n- semicolon (;)\n- parentheses ()\n- backtick (&#96;)\n- tab (\\t)\n- CRLF (\\r\\n)\n\n#### NEWLINE\n- always LF (\\n)\n- CRLF not supported\n\n### 2. Indentation Layer (들여쓰기 규칙)\n\n#### INDENTATION\n- exactly 2 spaces ONLY\n- tabs NOT allowed\n- indentation increases only inside a block\n- indentation does not imply hierarchy (not YAML)\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {           // ❌ 탭 사용 금지\n  title: \&quot;Home\&quot;  // ✅ 정확히 2 space\n}\n&#96;&#96;&#96;\n\n### 3. Token Layer (토큰 기본 규칙)\n\n#### TOKENS\n- IDENTIFIER = &#96;[a-z][a-z0-9.]*&#96;\n- STRING = &#96;\&quot;[^\&quot;\\\\]*(?:\\\\.[^\&quot;\\\\]*)*\&quot;&#96; (supports &#96;\\\&quot;&#96; escape)\n- NUMBER = &#96;\\d+(?:\\.\\d+)?&#96;\n- LBRACE = &#96;{&#96;\n- RBRACE = &#96;}&#96;\n- COLON = &#96;:&#96;\n- NEWLINE = &#96;\\n&#96;\n- WHITESPACE = single space\n\n#### IDENTIFIER_RULES\n- lowercase only\n- dot notation allowed (e.g. &#96;color.primary&#96;)\n- do NOT mix hyphens inside identifiers (LLM error-prone)\n\n#### STRING_RULES\n- must use double quotes only\n- escaping uses &#96;\\\&quot;&#96;\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {\n  color.primary: \&quot;#fff\&quot;    // ✅ dot notation 허용\n  label: \&quot;Click \\\&quot;here\\\&quot;\&quot;  // ✅ escape 허용\n  width: 100.5            // ✅ 소수 허용\n}\n&#96;&#96;&#96;\n\n### 4. Comment Layer (코멘트)\n\n#### COMMENTS\n- comments NOT supported\n- any attempt to use &#96;//&#96; or &#96;#&#96; is invalid\n- purpose: reduce ambiguity for LLM\n\n### 5. Statement Layer (기본 문장 구조)\n\n#### STATEMENT_TYPES\n- Block Declaration\n- Property Declaration\n\n#### BLOCK_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt; {\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n#### PROPERTY_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n#### SEMICOLON\n- NOT allowed (never used)\n\n### 6. Block Layer (블록 기본 규칙)\n\n#### BLOCK_STRUCTURE\n&#96;&#96;&#96;\nblockName {\n  property: \&quot;value\&quot;\n  property: 123\n  property: true\n}\n&#96;&#96;&#96;\n\n#### BLOCK_RULES\n- block cannot contain nested blocks\n- ONLY layout block may contain nested layout nodes\n\n### 7. Ordering Layer (순서 강제)\n\n#### BLOCK_ORDER\n1. meta\n2. style\n3. components (optional)\n4. layout\n5. script (optional)\n\n#### RULE\n- if a block appears, must follow this order\n- missing blocks are allowed except meta/style/layout\n\n### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  primary-color: \&quot;#111\&quot;\n}\n\ncomponents {\n  Button {\n    variant: \&quot;primary\&quot;\n  }\n}\n\nlayout {\n  Container {\n    children: \&quot;Button\&quot;\n  }\n}\n\nscript {\n  // optional script\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단\n- 잘못된 들여쓰기 발견 시 구문 오류\n- 코멘트 시도 시 즉시 무효 처리\n- 블록 순서 위반 시 파싱 실패\n- layout 외 중첩 블록 시도 시 오류\n\n---\n\n## Tokenizer Specification\n\nFoundation Layer + Grammar Layers 기반의 공식 토큰화 규칙입니다. DSL 문자열을 균일한 Token 리스트로 변환하며, 모든 파싱의 기반이 됩니다.\n\n### 1. Tokenizer Overview\n\n#### PURPOSE\n- DSL 문자열을 균일한 Token 리스트로 변환\n- 모호성 없는 deterministic token stream 생성\n- 모든 파싱은 이 토큰 리스트 기반으로 진행\n\n#### INPUT\n- LF 기반의 DSL 문자열\n\n#### OUTPUT\n- 순차적 Token 배열\n\n### 2. Token Types\n\n#### TOKENS\n- &#96;IDENTIFIER&#96; - meta, title, color.primary, class 등\n- &#96;STRING&#96; - \&quot;Hello\&quot;\n- &#96;NUMBER&#96; - 0, 12, 0.8\n- &#96;BOOLEAN&#96; - true, false\n- &#96;LBRACE&#96; - {\n- &#96;RBRACE&#96; - }\n- &#96;LPAREN&#96; - (\n- &#96;RPAREN&#96; - )\n- &#96;COLON&#96; - :\n- &#96;COMMA&#96; - ,\n- &#96;NEWLINE&#96; - \\n\n- &#96;WHITESPACE&#96; - space (only used between tokens)\n- &#96;TEXT_STRING&#96; - layout children string ONLY (disambiguation)\n- &#96;EOF&#96; - end of file marker\n\n### 3. Identifier Detection\n\n#### IDENTIFIER_RULES\n- regex: &#96;^[a-z][a-z0-9.]*$&#96;\n- lowercase only\n- dot notation allowed\n- hyphens, underscores 금지\n\n#### TAGNAME_RULES\n- starts with uppercase letter\n- subsequent chars: &#96;[a-zA-Z0-9]&#96;\n- TagName (e.g. Div, Header) 구분용\n\n#### TAGNAME_EXAMPLES\n&#96;&#96;&#96;\nDiv\nSection\nImage\nH1\n&#96;&#96;&#96;\n\n### 4. String Token Rules\n\n#### STRING\n- starts with &#96;\&quot;&#96;\n- ends with &#96;\&quot;&#96;\n- inside supports &#96;\\\&quot;&#96;\n- no multi-line\n\n#### TEXT_STRING\n- STRING과 동일한 문법\n- 단, layout children context에서만 등장\n- Parser에서 context-aware로 구분\n\n### 5. Number Token Rules\n\n#### NUMBER\n- regex: &#96;^[0-9]+(\\.[0-9]+)?$&#96;\n- no negative numbers\n- no units (px, rem 등)\n\n### 6. Boolean Token Rules\n\n#### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n- strictly lowercase\n\n### 7. Brace / Symbol Tokens\n\n#### SYMBOL_TOKENS\n- &#96;LBRACE&#96;: &#96;{&#96;\n- &#96;RBRACE&#96;: &#96;}&#96;\n- &#96;LPAREN&#96;: &#96;(&#96;\n- &#96;RPAREN&#96;: &#96;)&#96;\n- &#96;COLON&#96;: &#96;:&#96;\n- &#96;COMMA&#96;: &#96;,&#96;\n\n#### NOTES\n- semicolon NOT allowed\n- backtick NOT allowed\n\n### 8. Whitespace / Newline Rules\n\n#### WHITESPACE\n- single space &#96;&#39; &#39;&#96;\n- no tabs\n- no multi-space sequences except indentation (2 spaces)\n\n#### NEWLINE\n- LF only\n- CRLF invalid\n\n### 9. Layout Context Rules (Critical)\n\n#### LAYOUT_MODE\nTokenizer enters layout-mode when encountering:\n&#96;&#96;&#96;\nlayout { … }\n&#96;&#96;&#96;\n\n#### CONTEXT_SWITCH\n- after TagName(\n- before encountering next node or text\n\n#### INSIDE_LAYOUT_BLOCK\n- children detection required\n- plain strings must become TEXT_STRING token\n- siblings separated by NEWLINE\n\n#### EXAMPLE\n&#96;&#96;&#96;\n\&quot;Welcome\&quot; → TEXT_STRING inside layout\n&#96;&#96;&#96;\n\n### 10. Tokenization Algorithm (High-Level)\n\n1. iterate through chars\n2. skip whitespace unless meaningful (indent)\n3. detect IDENTIFIER or TAGNAME\n4. detect STRING (with escape)\n5. detect NUMBER\n6. detect BOOLEAN\n7. detect braces &#96;{ }&#96;\n8. detect parentheses &#96;( )&#96;\n9. detect colon &#96;:&#96; or comma &#96;,&#96;\n10. detect newline &#96;\\n&#96;\n11. maintain context stack:\n    - normal\n    - inside layout block\n    - inside attributes\n12. output final EOF token\n\n### 11. Example Token Stream\n\n#### INPUT\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### OUTPUT_TOKENS\n&#96;&#96;&#96;\nIDENTIFIER(layout)\nLBRACE\nNEWLINE\nTAGNAME(Div)\nLPAREN\nIDENTIFIER(class)\nCOLON\nSTRING(\&quot;p-4\&quot;)\nRPAREN\nLBRACE\nNEWLINE\nTEXT_STRING(\&quot;Hello\&quot;)\nNEWLINE\nRBRACE\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Token Stream Examples\n\n#### 기본 블록 토큰화\n&#96;&#96;&#96;dsl\nmeta {\n  title: \&quot;Home\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(meta)\nLBRACE\nNEWLINE\nIDENTIFIER(title)\nCOLON\nSTRING(\&quot;Home\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n#### 스타일 블록 토큰화\n&#96;&#96;&#96;dsl\nstyle {\n  color.primary: \&quot;#fff\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(style)\nLBRACE\nNEWLINE\nIDENTIFIER(color.primary)\nCOLON\nSTRING(\&quot;#fff\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단 및 오류 반환\n- CRLF 줄바꿈 발견 시 LF로 변환 또는 오류\n- 탭 문자 발견 시 공백 변환 또는 오류\n- STRING에서 미닫힘 따옴표 시 오류\n- NUMBER에 음수나 단위 포함 시 오류\n- layout 외 컨텍스트에서 TEXT_STRING 시도 시 오류\n- TAGNAME 규칙 위반 (소문자 시작) 시 IDENTIFIER로 처리\n\n---\n\n## Grammar\n\n### Block Grammar\n\nUIH DSL의 최상위 구조를 정의하는 Block Grammar Layer입니다. Foundation Layer 바로 위에 위치하며, 5개 블록의 선언, 순서, 내용 규칙을 명시합니다.\n\n#### 1. Block Definitions (5개 블록)\n\n##### BLOCKS\n- meta\n- style\n- components (optional)\n- layout\n- script (optional)\n\n##### RULES\n- 블록은 반드시 이 순서를 따라야 함: meta → style → components → layout → script\n- meta, style, layout은 필수\n- components, script는 선택\n- 각 블록은 정확히 한 번만 등장\n- 중복 블록 금지\n\n#### 2. Block Syntax (기본 문법)\n\n##### BLOCK_SYNTAX\n&#96;&#96;&#96;\n&lt;blockName&gt; {\n  &lt;property&gt;: &lt;value&gt;\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n&#96;&#96;&#96;\n\n##### SYNTAX_COMPONENTS\n- 블록 시작: IDENTIFIER + &#96; {&#96;\n- 블록 끝: &#96;}&#96; 단독 줄\n\n#### 3. Block Content Rules\n\n##### 공통 규칙\n- 블록 내부에는 property statements만 존재\n- block 내부에 block 중첩 금지\n- 단, layout 블록만 예외적으로 UI tree 구조 허용\n\n##### PROPERTY_RULE\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### VALUE_TYPES\n- string\n- number\n- boolean\n- enum-like literals (string 값)\n- list (향후 정의)\n\n#### 4. Block-Specific Rules\n\n##### (1) META BLOCK\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Page title\&quot;\n  route: \&quot;/path\&quot;\n  theme: \&quot;light\&quot;|\&quot;dark\&quot;\n}\n&#96;&#96;&#96;\n\n**META_RESTRICTIONS:**\n- meta는 UI 문서의 metadata만 포함\n- layout 정보나 스타일 정보 포함 금지\n\n##### (2) STYLE BLOCK\n&#96;&#96;&#96;\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n}\n&#96;&#96;&#96;\n\n**STYLE_RESTRICTIONS:**\n- key는 dot notation 사용 가능\n- 값은 string 또는 number\n- layout 관련 속성 금지\n- theme override 불가\n\n##### (3) COMPONENTS BLOCK (optional)\n&#96;&#96;&#96;\ncomponents {\n  Card\n  Button\n  Input\n}\n&#96;&#96;&#96;\n\n**COMPONENTS_RULES:**\n- 등록할 컴포넌트 이름만 줄 단위로 나열\n- 중첩 구조 없음\n- 속성 없음\n- 문자열 아님: &#96;\&quot;Card\&quot;&#96; 금지, &#96;Card&#96;만 허용\n\n##### (4) LAYOUT BLOCK\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n**LAYOUT_RULES:**\n- 유일하게 중첩 구조 허용\n- 노드 문법은 별도 Layer에서 정의\n- property는 inline attribute 형태 가능\n- block-like structure 유지\n\n##### (5) SCRIPT BLOCK (optional)\n&#96;&#96;&#96;\nscript {\n  onclick: \&quot;submitForm\&quot;\n  onload: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n**SCRIPT_RESTRICTIONS:**\n- event/behavior mapping만 정의\n- JS code 삽입 금지\n- inline function 금지\n- event identifier는 반드시 lowercase (camelCase 금지)\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n  spacing.unit: 8\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n}\n\nlayout {\n  Div(class:\&quot;container mx-auto p-4\&quot;) {\n    Card(class:\&quot;bg-white shadow-lg\&quot;) {\n      Button(onclick:\&quot;handleSubmit\&quot;) {\n        \&quot;Submit\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;processForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 파싱 실패\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유효 (경고)\n- components/script 외 블록에서 중첩 시도 시 오류\n- layout 외 블록에서 attribute 사용 시 오류\n\n---\n\n### Property Grammar\n\nUIH DSL 안정성의 핵심인 Property Grammar Layer입니다. Block Grammar 위에 쌓이며, 속성 선언, 값 타입, 범위 규칙을 정의합니다.\n\n#### 1. Property Declaration Syntax\n\n##### PROPERTY_SYNTAX\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\nradius.default: 8\nenabled: true\n&#96;&#96;&#96;\n\n##### RULES\n- identifier는 반드시 lowercase\n- dot notation 허용 (&#96;color.primary&#96; 등)\n- colon(:) 뒤에는 반드시 space 1개\n- value는 줄 끝까지\n\n#### 2. Identifier Rules\n\n##### IDENTIFIER\n- 패턴: &#96;[a-z][a-z0-9.]*&#96;\n- 소문자만 허용\n- 숫자는 뒤쪽에만 허용\n- dot(.)은 중첩 속성 의미로만 사용\n- hyphen 금지 (LLM 오류 방지)\n- underscore 금지\n\n##### VALID\n&#96;&#96;&#96;\ncolor.primary\nfont.size\nborder.width\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nColor.Primary    // 대문자\nfont-size        // hyphen\nfont_size        // underscore\nprimary2.color   // 숫자 앞쪽\n&#96;&#96;&#96;\n\n#### 3. Value Types (5가지)\n\n##### VALUE_TYPES\n1. STRING\n2. NUMBER\n3. BOOLEAN\n4. ENUM-LIKE (string 기반)\n5. LIST (여러 값 나열, 줄 단위)\n\n#### 4. String Value Rules\n\n##### STRING\n- 무조건 double-quote 사용\n- 내부에 &#96;\&quot;&#96; 포함 시 &#96;\\\&quot;&#96;로 escape\n- single-quote 절대 금지\n\n##### VALID\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\ndescription: \&quot;He said \\\&quot;ok\\\&quot;\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\ntitle: &#39;Home&#39;      // single-quote\nname: \&quot;Home\&quot;       // curly quotes\n&#96;&#96;&#96;\n\n#### 5. Number Value Rules\n\n##### NUMBER\n- 정수 또는 소숫점 가능\n- 음수는 허용하지 않음\n- 단위(px 등) 금지 → unitless 구조\n\n##### VALID\n&#96;&#96;&#96;\nradius: 12\nopacity: 0.85\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nradius: -4     // 음수\nwidth: 10px    // 단위 포함\n&#96;&#96;&#96;\n\n#### 6. Boolean Value Rules\n\n##### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nenabled: true\nvisible: false\n&#96;&#96;&#96;\n\n#### 7. Enum-like String Rules\n\n##### ENUM_STRING\n- 문자열이지만 값이 고정된 타입처럼 쓰는 케이스\n- allowed values는 별도 block schema마다 정의\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntheme: \&quot;light\&quot; | \&quot;dark\&quot;\nsize: \&quot;sm\&quot; | \&quot;md\&quot; | \&quot;lg\&quot;\n&#96;&#96;&#96;\n\n#### 8. List Value (Block-like list)\n\n##### LIST\n- 각 항목은 줄 단위로 입력\n- 대괄호 &#96;[]&#96; 문법 없음 (LLM 오류 방지)\n- 문자열/식별자 혼용 가능\n\n##### SYNTAX\n&#96;&#96;&#96;\nitems {\n  \&quot;one\&quot;\n  \&quot;two\&quot;\n  \&quot;three\&quot;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- list block 내부에는 property 없음\n- indent 2 spaces 유지\n\n##### EXAMPLE\n&#96;&#96;&#96;\ntags {\n  \&quot;news\&quot;\n  \&quot;feature\&quot;\n  \&quot;announcement\&quot;\n}\n&#96;&#96;&#96;\n\n#### 9. Property Scope Rules (Block별 허용 속성 경계)\n\n##### META_SCOPE\n- meta는 UI metadata만 포함\n- route, title, theme, description 등\n\n##### STYLE_SCOPE\n- 색상, 폰트, radius 등 UI 스타일만\n- layout 속성 금지 (width, height 등은 layout block에서만)\n\n##### COMPONENTS_SCOPE\n- property 없음 (등록만)\n\n##### LAYOUT_SCOPE\n- inline attribute만 (class, id, ref 등)\n- 값은 무조건 string\n- boolean/number 사용 금지\n\n##### SCRIPT_SCOPE\n- event mapping 전용\n- 값은 무조건 string\n\n#### 10. Final Validation Rules\n\n1. 모든 property는 블록 내부에서만 존재\n2. 같은 identifier 중복 선언 금지\n3. meta/style/script는 property-only 구조\n4. components는 선언만 (property 없음)\n5. layout만 child nodes 보유 가능\n6. value의 타입은 block-specific rule을 반드시 준수\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main dashboard page\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  border.radius: 8\n  spacing.unit: 16\n}\n\ncomponents {\n  Card\n  Button\n  Input\n}\n\nlayout {\n  class: \&quot;container\&quot;\n  id: \&quot;main-content\&quot;\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;handleForm\&quot;\n  onrefresh: \&quot;reloadData\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 대문자 identifier 사용 시 토큰화 실패\n- hyphen/underscore 사용 시 구문 오류\n- single-quote나 curly quotes 사용 시 파싱 실패\n- 음수나 단위 포함 숫자 시 값 오류\n- 블록별 스코프 위반 시 validation 실패\n- 중복 property 선언 시 마지막 값만 유효 (경고)\n\n---\n\n### Layout Tree Grammar\n\nUIH DSL의 핵심 구조인 Layout Tree Grammar Layer입니다. Block Grammar와 Property Grammar 위에서 동작하며, UI 구성 요소의 트리 구조를 정의합니다.\n\n#### 1. Layout Block Overview\n\n##### LAYOUT_BLOCK\n&#96;&#96;&#96;\nlayout {\n  &lt;layout-node&gt;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- DSL에서 유일하게 중첩 구조를 가질 수 있는 블록\n- 모든 UI 구성 요소는 layout node로 표현\n- 노드는 \&quot;구조\&quot;만 표현, 스타일/로직은 표현하지 않음\n\n#### 2. Layout Node Syntax\n\n##### NODE_SYNTAX\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;) {\n  &lt;children&gt;\n}\n&#96;&#96;&#96;\n\n##### OR (children 없는 경우)\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;)\n&#96;&#96;&#96;\n\n##### NOTES\n- TagName은 PascalCase 컴포넌트 또는 HTML-like 사용 가능\n- attributes는 inline 형태 only\n- attributes는 옵션, 없어도 됨\n- children 블록은 중첩 가능\n\n##### VALID\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) {\n  \&quot;Hello\&quot;\n}\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nDiv {\n  class: \&quot;p-4\&quot;    // 속성은 block 기반이 아니라 inline only\n}\n&#96;&#96;&#96;\n\n#### 3. TagName Rules\n\n##### TAGNAME\n- 반드시 알파벳으로 시작\n- PascalCase 또는 UpperCamelCase 권장\n- HTML-like 소문자 태그는 사용 가능 (&#96;div&#96;, &#96;span&#96;) 단 내부적으로는 UpperCase 변환됨\n\n##### VALID\n&#96;&#96;&#96;\nDiv\nSection\nImage\nheader   // 허용하지만 변환 시 Header로 취급\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n3Div     // 숫자 시작\n_Box     // underscore 시작\n-Node    // hyphen 시작\n&#96;&#96;&#96;\n\n#### 4. Attribute Syntax\n\n##### ATTRIBUTES\n&#96;&#96;&#96;\n&lt;identifier&gt;:\&quot;&lt;string&gt;\&quot;\n&#96;&#96;&#96;\n\n##### RULES\n- value는 무조건 string only\n- boolean/number 금지\n- &#96;class:\&quot;p-4\&quot;&#96; 형태처럼 inline만 허용\n- 각 attribute는 콤마(&#96;,&#96;)로 구분\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;, id:\&quot;main\&quot;, ref:\&quot;root\&quot;)\n&#96;&#96;&#96;\n\n##### STRICT_RULES\n- 속성 순서는 의미 없음 (LLM 실수 방지로 자유 순서)\n- attribute key는 lower-case only\n- 속성 개수 0~5 정도 권장\n\n#### 5. Children Rules\n\n##### CHILD_TYPES\n- string literal\n- another layout node\n- list of siblings (node 여러 개 배치)\n\n##### STRING_CHILD\n&#96;&#96;&#96;\n\&quot;Hello world\&quot;\n&#96;&#96;&#96;\n\n##### NESTED_NODE\n&#96;&#96;&#96;\nDiv(class:\&quot;mt-4\&quot;) {\n  \&quot;content\&quot;\n}\n&#96;&#96;&#96;\n\n##### SIBLINGS\n&#96;&#96;&#96;\nDiv(...) { ... }\nP(...) { ... }\nImage(...)\n&#96;&#96;&#96;\n\n#### 6. Text Node Rules\n\n##### TEXT_NODE\n- 무조건 double-quote string\n- 줄바꿈 포함 금지\n- 텍스트 덩어리는 여러 줄로 쪼개면 안 됨\n\n##### VALID\n&#96;&#96;&#96;\n\&quot;Sign in to continue\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n\&quot;Hello\n World\&quot;    // 줄바꿈 포함\n&#96;&#96;&#96;\n\n#### 7. Node Termination Rules\n\n##### CLOSING_RULES\n- 블록 노드는 반드시 &#96;}&#96; 단독 줄로 닫는다\n- inline-only 노드는 종료 블록 없음\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;px-4\&quot;) {\n  P {\n    \&quot;Hello\&quot;\n  }\n  Image(src:\&quot;/logo.png\&quot;)\n}\n&#96;&#96;&#96;\n\n#### 8. Layout Grammar Formal Pattern\n\n##### LAYOUT_NODE_GRAMMAR\n&#96;&#96;&#96;\nNode:\n  Tag (Attributes?) (ChildrenBlock?)\n\nTag:\n  IDENTIFIER\n\nAttributes:\n  \&quot;(\&quot; AttributeList \&quot;)\&quot;\n\nAttributeList:\n  Attribute (\&quot;,\&quot; Attribute)*\n\nAttribute:\n  IDENTIFIER \&quot;:\&quot; STRING\n\nChildrenBlock:\n  \&quot;{\&quot; NewLine Indented(NodeOrText)+ \&quot;}\&quot;\n\nNodeOrText:\n  Node | STRING\n&#96;&#96;&#96;\n\n#### 9. Validation Rules\n\n1. layout은 트리 구조만 표현한다\n2. inline attributes만 허용\n3. 속성은 string-only\n4. children은 반드시 정해진 중첩 규칙을 따른다\n5. Node 이름은 PascalCase가 기본\n6. 문자열 children 외에는 모든 children은 Node여야 한다\n7. siblings 허용, 순서 보존\n\n#### 10. Example (Valid Layout Tree)\n\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;min-h-screen flex flex-col\&quot;) {\n    Header(class:\&quot;p-4 bg-gray-100\&quot;) {\n      H1 {\n        \&quot;Dashboard\&quot;\n      }\n    }\n\n    Main(class:\&quot;flex-1 p-6\&quot;) {\n      Card(class:\&quot;shadow\&quot;) {\n        P {\n          \&quot;Welcome back!\&quot;\n        }\n      }\n    }\n\n    Footer(class:\&quot;p-4 text-center\&quot;) {\n      \&quot;© 2025 The Bespoke\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto\&quot;) {\n    Navbar(class:\&quot;flex justify-between items-center p-4\&quot;) {\n      Logo(class:\&quot;text-xl font-bold\&quot;) {\n        \&quot;UIH\&quot;\n      }\n      Nav(class:\&quot;space-x-4\&quot;) {\n        Link(href:\&quot;/home\&quot;) {\n          \&quot;Home\&quot;\n        }\n        Link(href:\&quot;/about\&quot;) {\n          \&quot;About\&quot;\n        }\n      }\n    }\n\n    Content(class:\&quot;grid grid-cols-3 gap-6 p-6\&quot;) {\n      Sidebar(class:\&quot;col-span-1 bg-gray-50 p-4\&quot;) {\n        Menu {\n          \&quot;Dashboard\&quot;\n          \&quot;Settings\&quot;\n          \&quot;Profile\&quot;\n        }\n      }\n\n      Main(class:\&quot;col-span-2\&quot;) {\n        Article(class:\&quot;prose\&quot;) {\n          H2 {\n            \&quot;Getting Started\&quot;\n          }\n          P {\n            \&quot;Welcome to UIH DSL documentation.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- TagName에 숫자/특수문자 시작 시 토큰화 실패\n- 속성에 boolean/number 값 사용 시 파싱 오류\n- 텍스트 노드에 줄바꿈 포함 시 validation 실패\n- 노드 종료 &#96;}&#96; 누락 시 구문 오류\n- 중첩 깊이가 너무 깊을 경우 (권장 5레벨 초과) 경고\n- siblings 간 순서가 UI 의미에 영향 줄 경우 재검토\n\n---\n\n### Parser BNF Grammar\n\nTokenizer 위에서 동작하는 공식 문법 엔진 정의입니다. Token Stream을 Abstract Syntax Tree(AST)로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- Token Stream → Abstract Syntax Tree(AST)\n\n##### PARSER_MODE\n- strict non-ambiguous grammar\n- no recovery parsing (에러는 즉시 throw)\n- deterministic (LLM-friendly)\n- recursive descent parser 기반 구조\n\n#### 2. Entry Point\n\n##### Program\n&#96;&#96;&#96;\nProgram ::= MetaBlock StyleBlock ComponentsBlock? LayoutBlock ScriptBlock? EOF\n&#96;&#96;&#96;\n\n#### 3. Blocks\n\n##### Block_Definitions\n&#96;&#96;&#96;\nMetaBlock       ::= \&quot;meta\&quot; BlockBody(MetaProperty)\nStyleBlock      ::= \&quot;style\&quot; BlockBody(StyleProperty)\nComponentsBlock ::= \&quot;components\&quot; BlockBody(ComponentEntry)\nLayoutBlock     ::= \&quot;layout\&quot; LayoutBody\nScriptBlock     ::= \&quot;script\&quot; BlockBody(ScriptProperty)\n&#96;&#96;&#96;\n\n#### 4. Generic Block Body\n\n##### BlockBody\n&#96;&#96;&#96;\nBlockBody(&lt;T&gt;) ::= LBRACE NEWLINE (Indent &lt;T&gt; NEWLINE)* RBRACE\nIndent         ::= WHITESPACE WHITESPACE    # 2 spaces only\n&#96;&#96;&#96;\n\n#### 5. META Block Grammar\n\n##### MetaProperty\n&#96;&#96;&#96;\nMetaProperty ::= Identifier \&quot;:\&quot; MetaValue\nMetaValue    ::= STRING | NUMBER | BOOLEAN | EnumString\n&#96;&#96;&#96;\n\n##### Allowed_Meta_Keys\n- title, route, theme, description\n\n#### 6. STYLE Block Grammar\n\n##### StyleProperty\n&#96;&#96;&#96;\nStyleProperty ::= StyleKey \&quot;:\&quot; StyleValue\nStyleKey      ::= Identifier ( \&quot;.\&quot; Identifier )*\nStyleValue    ::= STRING | NUMBER | EnumString\n&#96;&#96;&#96;\n\n##### Notes\n- no nested blocks\n- no boolean\n- layout-like attributes 금지\n\n#### 7. COMPONENTS Block Grammar\n\n##### ComponentEntry\n&#96;&#96;&#96;\nComponentEntry ::= ComponentName\nComponentName  ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n##### NOTES\n- but no quotes, no values, one per line\n\n##### Examples\n&#96;&#96;&#96;\nCard\nButton\nInput\n&#96;&#96;&#96;\n\n#### 8. LAYOUT Block Grammar (Core)\n\n##### LayoutBody\n&#96;&#96;&#96;\nLayoutBody     ::= LBRACE NEWLINE Indent LayoutNodeList RBRACE\nLayoutNodeList ::= (LayoutNode NEWLINE)*\nLayoutNode     ::= Tag (Attributes)? (ChildrenBlock)?\nTag            ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n#### 9. Attributes Grammar\n\n##### Attributes\n&#96;&#96;&#96;\nAttributes    ::= LPAREN AttributeList RPAREN\nAttributeList ::= Attribute (COMMA Attribute)*\nAttribute     ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n#### 10. Children Block Grammar\n\n##### ChildrenBlock\n&#96;&#96;&#96;\nChildrenBlock ::= LBRACE NEWLINE Indent ChildrenList RBRACE\nChildrenList  ::= (Child NEWLINE)*\nChild         ::= LayoutNode | TEXT_STRING\n&#96;&#96;&#96;\n\n#### 11. SCRIPT Block Grammar\n\n##### ScriptProperty\n&#96;&#96;&#96;\nScriptProperty ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n##### Allowed_Script_Keys\n- onclick, onload, onsubmit, onmount, onchange\n\n&gt; 모든 script event identifier는 전부 소문자여야 하며 camelCase를 사용하지 않는다.\n\n#### 12. Value Grammars\n\n##### Value_Types\n&#96;&#96;&#96;\nSTRING     ::= \&quot;\\\&quot;\&quot; &lt;chars&gt; \&quot;\\\&quot;\&quot;\nNUMBER     ::= digits ( \&quot;.\&quot; digits )?\nBOOLEAN    ::= \&quot;true\&quot; | \&quot;false\&quot;\nEnumString ::= STRING   # validated in semantic phase\n&#96;&#96;&#96;\n\n#### 13. Identifier Grammars\n\n##### Identifiers\n&#96;&#96;&#96;\nIdentifier ::= [a-z][a-z0-9.]*\nTagName    ::= [A-Z][a-zA-Z0-9]*\n&#96;&#96;&#96;\n\n#### 14. Syntax Constraints (Formal)\n\n1. 모든 블록은 순서 고정\n2. 각 블록은 1회만 등장\n3. meta/style/layout은 필수\n4. components/script는 optional\n5. 들여쓰기 2 spaces only\n6. 속성(colon)은 반드시 &#96;&lt;id&gt;: &lt;value&gt;&#96;\n7. semicolon 금지\n8. layout만 nested structure 허용\n9. children 안에서는 TEXT_STRING 또는 LayoutNode만 허용\n10. parser는 ambiguous branch 금지 (LLM-safe)\n\n#### 15. Complete Example (BNF-valid)\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  radius.default: 8\n}\n\ncomponents {\n  Card\n  Button\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello world\&quot;\n    }\n  }\n}\n\nscript {\n  onclick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### BNF 구조 트리\n\n&#96;&#96;&#96;\nProgram\n├── MetaBlock\n│   ├── LBRACE\n│   ├── MetaProperty (title: \&quot;Home\&quot;)\n│   ├── MetaProperty (route: \&quot;/\&quot;)\n│   └── RBRACE\n├── StyleBlock\n│   ├── LBRACE\n│   ├── StyleProperty (color.primary: \&quot;#0E5EF7\&quot;)\n│   ├── StyleProperty (radius.default: 8)\n│   └── RBRACE\n├── ComponentsBlock\n│   ├── LBRACE\n│   ├── ComponentEntry (Card)\n│   ├── ComponentEntry (Button)\n│   └── RBRACE\n├── LayoutBlock\n│   ├── LBRACE\n│   ├── LayoutNode (Div)\n│   │   ├── Attributes (class:\&quot;p-4\&quot;)\n│   │   └── ChildrenBlock\n│   │       └── LayoutNode (P)\n│   │           └── ChildrenBlock\n│   │               └── TEXT_STRING (\&quot;Hello world\&quot;)\n│   └── RBRACE\n└── ScriptBlock\n    ├── LBRACE\n    ├── ScriptProperty (onClick: \&quot;submitForm\&quot;)\n    └── RBRACE\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 즉시 파싱 중단\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유지 (경고)\n- 들여쓰기 2 space 위반 시 구문 오류\n- layout 외 블록에서 중첩 시도 시 파싱 실패\n- 허용되지 않은 키 사용 시 semantic 오류 (parser 단계에서는 허용)\n- TEXT_STRING이 layout 외 컨텍스트에서 등장 시 오류\n\n---\n\n## AST Schema Definition\n\nParser BNF 위에서 생성되는 최종 AST 구조입니다. 모든 UIH DSL 요소가 이 스키마에 따라 구조화됩니다.\n\n### 1. AST Root\n\n#### ASTRoot\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Program\&quot;\n  meta: MetaNode\n  style: StyleNode\n  components: ComponentsNode | null\n  layout: LayoutNode\n  script: ScriptNode | null\n}\n&#96;&#96;&#96;\n\n### 2. Meta Node\n\n#### MetaNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Meta\&quot;\n  properties: MetaProperty[]\n}\n&#96;&#96;&#96;\n\n#### MetaProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;title\&quot;\n  value: string|number|boolean\n  location: Range     // from tokenizer\n}\n&#96;&#96;&#96;\n\n### 3. Style Node\n\n#### StyleNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Style\&quot;\n  properties: StyleProperty[]\n}\n&#96;&#96;&#96;\n\n#### StyleProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;color.primary\&quot;\n  value: string|number\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 4. Components Node\n\n#### ComponentsNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Components\&quot;\n  components: ComponentEntry[]\n}\n&#96;&#96;&#96;\n\n#### ComponentEntry\n&#96;&#96;&#96;typescript\n{\n  name: string        // e.g. \&quot;Card\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 5. Layout Node (Core Tree Structure)\n\n#### LayoutNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Layout\&quot;\n  children: LayoutElement[]     // top-level nodes inside layout block\n}\n&#96;&#96;&#96;\n\n#### LayoutElement\n&#96;&#96;&#96;typescript\nLayoutElement = LayoutComponent | LayoutText\n&#96;&#96;&#96;\n\n#### 5.1 Layout Component\n&#96;&#96;&#96;typescript\nLayoutComponent {\n  type: \&quot;Component\&quot;\n  tag: string                   // e.g. \&quot;Div\&quot;, \&quot;P\&quot;, \&quot;Header\&quot;\n  attributes: Attribute[]\n  children: LayoutElement[]     // nested structure\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### Attribute\n&#96;&#96;&#96;typescript\n{\n  key: string                   // lower-case only\n  value: string                 // inline string only\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### 5.2 Layout Text Node\n&#96;&#96;&#96;typescript\nLayoutText {\n  type: \&quot;Text\&quot;\n  value: string                 // raw text string\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 6. Script Node\n\n#### ScriptNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Script\&quot;\n  events: ScriptProperty[]\n}\n&#96;&#96;&#96;\n\n#### ScriptProperty\n&#96;&#96;&#96;typescript\n{\n  key: string                   // e.g. \&quot;onclick\&quot; (lowercase only)\n  value: string                 // e.g. \&quot;submitForm\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 7. Range Object (Source Location)\n\n#### Range\n&#96;&#96;&#96;typescript\n{\n  start: Position\n  end: Position\n}\n&#96;&#96;&#96;\n\n#### Position\n&#96;&#96;&#96;typescript\n{\n  line: number\n  column: number\n}\n&#96;&#96;&#96;\n\n### 8. Semantics Rules (Validation Layer)\n\n1. Meta keys must be from allowlist:\n   - title, route, theme, description\n\n2. Style keys may use dot notation but MUST be lowercase.\n\n3. Components must be names only, no properties.\n\n4. Layout:\n   - tag must be a valid TagName or valid identifier\n   - attributes must be string-only\n   - children: array of LayoutElement (component or text)\n\n5. Script:\n   - keys must be known event names\n   - value must be string (function name)\n\n6. No null children arrays. Use &#96;[]&#96; if empty.\n\n7. All nodes must have location data.\n\n### 9. Example: Full AST for a Simple Page\n\n#### Example DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### Generated AST (simplified)\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Home\&quot; },\n      { \&quot;key\&quot;: \&quot;route\&quot;, \&quot;value\&quot;: \&quot;/\&quot; }\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;color.primary\&quot;, \&quot;value\&quot;: \&quot;#0E5EF7\&quot; }\n    ]\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: [\n          { \&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;p-4\&quot; }\n        ],\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n### AST 구조 트리\n\n&#96;&#96;&#96;\nASTRoot (Program)\n├── meta (MetaNode)\n│   └── properties[] (MetaProperty)\n├── style (StyleNode)\n│   └── properties[] (StyleProperty)\n├── components (ComponentsNode | null)\n│   └── components[] (ComponentEntry)\n├── layout (LayoutNode)\n│   └── children[] (LayoutElement)\n│       ├── LayoutComponent\n│       │   ├── attributes[] (Attribute)\n│       │   └── children[] (LayoutElement)\n│       └── LayoutText\n└── script (ScriptNode | null)\n    └── events[] (ScriptProperty)\n&#96;&#96;&#96;\n\n### AST Examples\n\n#### 최소 AST 구조\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      {\&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Minimal\&quot;}\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: []\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Text\&quot;,\n        \&quot;value\&quot;: \&quot;Content\&quot;\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n#### 복잡한 레이아웃 AST\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Layout\&quot;,\n  \&quot;children\&quot;: [\n    {\n      \&quot;type\&quot;: \&quot;Component\&quot;,\n      \&quot;tag\&quot;: \&quot;Div\&quot;,\n      \&quot;attributes\&quot;: [\n        {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;container\&quot;}\n      ],\n      \&quot;children\&quot;: [\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Header\&quot;,\n          \&quot;attributes\&quot;: [],\n          \&quot;children\&quot;: [\n            {\n              \&quot;type\&quot;: \&quot;Component\&quot;,\n              \&quot;tag\&quot;: \&quot;H1\&quot;,\n              \&quot;attributes\&quot;: [],\n              \&quot;children\&quot;: [\n                {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Title\&quot;}\n              ]\n            }\n          ]\n        },\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Main\&quot;,\n          \&quot;attributes\&quot;: [\n            {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;content\&quot;}\n          ],\n          \&quot;children\&quot;: [\n            {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Main content\&quot;}\n          ]\n        }\n      ]\n    }\n  ]\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- location 정보 누락 시 AST 생성 실패\n- 빈 children 배열 대신 null 사용 시 validation 오류\n- 허용되지 않은 meta/style/script 키 사용 시 semantic 오류\n- LayoutComponent의 tag가 유효하지 않은 경우 오류\n- LayoutText에 빈 문자열 사용 시 경고\n- 중첩 깊이가 너무 깊을 경우 (10레벨 초과) 경고 또는 오류\n\n---\n\n## IR (Intermediate Representation) Specification\n\nAST → IR 변환 규칙을 정의합니다. Codegen 단계 직전의 \&quot;정규화된 구조\&quot;로, 플랫폼불문의 공통 인터페이스를 제공합니다.\n\n### 1. Overview\n\n#### IR_GOAL\n- AST의 복잡한 구조를 코드 생성하기 좋게 단순화\n- UI 컴포넌트 트리와 메타데이터를 정규화\n- 플랫폼불문(React/Next/Svelte) 공통 인터페이스로 변환\n- 모든 값은 최종적이고 확정된 형태만 유지\n\n#### INPUT\n- ASTRoot\n\n#### OUTPUT\n- IRRoot\n\n### 2. IR Root\n\n#### IRRoot\n&#96;&#96;&#96;typescript\n{\n  meta: IRMeta\n  style: IRStyle\n  components: IRComponents\n  layout: IRLayoutTree\n  script: IRScript\n}\n&#96;&#96;&#96;\n\n### 3. IRMeta (Final Document Metadata)\n\n#### IRMeta\n&#96;&#96;&#96;typescript\n{\n  title: string\n  route: string\n  theme: \&quot;light\&quot; | \&quot;dark\&quot;\n  description: string | null\n}\n&#96;&#96;&#96;\n\n#### Rules\n- missing values become null\n- enforce route starts with \&quot;/\&quot;\n\n### 4. IRStyle (Flattened Style Tokens)\n\n#### IRStyle\n&#96;&#96;&#96;typescript\n{\n  tokens: Record&lt;string, string | number&gt;\n}\n&#96;&#96;&#96;\n\n#### Examples\n&#96;&#96;&#96;typescript\n{\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n  \&quot;radius.default\&quot;: 8\n}\n&#96;&#96;&#96;\n\n#### Rules\n- dot-notation keys preserved\n- all values converted to primitive string/number\n- no validation here (semantic pass already done)\n\n### 5. IRComponents (Registered Component Map)\n\n#### IRComponents\n&#96;&#96;&#96;typescript\n{\n  list: string[]   // e.g. [\&quot;Card\&quot;, \&quot;Button\&quot;]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- duplicates removed\n- sorted alphabetically for deterministic output\n\n### 6. IRLayoutTree (Normalized UI Tree)\n\n#### IRLayoutTree\n&#96;&#96;&#96;typescript\n{\n  root: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### IRNode\n&#96;&#96;&#96;typescript\nIRNode = IRComponentNode | IRTextNode\n&#96;&#96;&#96;\n\n#### 6.1 IRComponentNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;component\&quot;\n  tag: string\n  attributes: Record&lt;string, string&gt;   // key:string only\n  children: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- attribute keys lower-case enforced\n- children always array\n- empty children =&gt; []\n\n#### 6.2 IRTextNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;text\&quot;\n  value: string\n}\n&#96;&#96;&#96;\n\n#### Rules\n- trimmed text preserved exactly\n- no newline allowed inside text\n\n### 7. IRScript (Event Map)\n\n#### IRScript\n&#96;&#96;&#96;typescript\n{\n  events: Record&lt;string, string&gt;   // onClick → \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Rules\n- all keys normalized to lower-case event names\n- event value must be string only\n- duplicates override earlier definitions\n\n### 8. AST → IR Mapping Rules\n\n1. **MetaNode → IRMeta**\n   - convert property array → object map\n   - apply default values if missing\n   - route must start with \&quot;/\&quot;\n\n2. **StyleNode → IRStyle**\n   - flatten list into tokens object\n   - preserve ordering but output sorted keys for determinism\n\n3. **ComponentsNode → IRComponents**\n   - convert component list → array\n   - remove duplicates\n   - sort alphabetically\n\n4. **LayoutNode → IRLayoutTree**\n   - recursively convert LayoutComponent → IRComponentNode\n   - convert LayoutText → IRTextNode\n   - inline attributes converted to plain object\n\n5. **ScriptNode → IRScript**\n   - property list flattened to event map\n   - enforce lower-case event names\n\n### 9. Example: Full IR Output\n\n#### DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### IR\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Home\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: null,\n    \&quot;description\&quot;: null\n  },\n\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n    }\n  },\n\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: []\n  },\n\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: { \&quot;class\&quot;: \&quot;p-4\&quot; },\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {}\n  }\n}\n&#96;&#96;&#96;\n\n### IR 구조 트리\n\n&#96;&#96;&#96;\nIRRoot\n├── meta (IRMeta)\n│   ├── title: string\n│   ├── route: string\n│   ├── theme: \&quot;light\&quot;|\&quot;dark\&quot;|null\n│   └── description: string|null\n├── style (IRStyle)\n│   └── tokens: Record&lt;string, string|number&gt;\n├── components (IRComponents)\n│   └── list: string[]\n├── layout (IRLayoutTree)\n│   └── root: IRNode[]\n│       ├── IRComponentNode\n│       │   ├── type: \&quot;component\&quot;\n│       │   ├── tag: string\n│       │   ├── attributes: Record&lt;string, string&gt;\n│       │   └── children: IRNode[]\n│       └── IRTextNode\n│           ├── type: \&quot;text\&quot;\n│           └── value: string\n└── script (IRScript)\n    └── events: Record&lt;string, string&gt;\n&#96;&#96;&#96;\n\n### IR Examples\n\n#### 간단한 IR 변환\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Simple\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: \&quot;light\&quot;,\n    \&quot;description\&quot;: null\n  },\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#000\&quot;,\n      \&quot;font.size\&quot;: 14\n    }\n  },\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: [\&quot;Button\&quot;]\n  },\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: {},\n        \&quot;children\&quot;: [\n          {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Content\&quot;}\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {\n      \&quot;onclick\&quot;: \&quot;handleClick\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 복잡한 중첩 레이아웃 IR\n&#96;&#96;&#96;json\n{\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Container\&quot;,\n        \&quot;attributes\&quot;: {\n          \&quot;class\&quot;: \&quot;flex flex-col min-h-screen\&quot;\n        },\n        \&quot;children\&quot;: [\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Header\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;p-4 bg-blue-600\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;H1\&quot;,\n                \&quot;attributes\&quot;: {},\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Dashboard\&quot;}\n                ]\n              }\n            ]\n          },\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Main\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;flex-1 p-6\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;Card\&quot;,\n                \&quot;attributes\&quot;: {\n                  \&quot;class\&quot;: \&quot;bg-white shadow-lg rounded\&quot;\n                },\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Welcome!\&quot;}\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- AST에 location 정보 누락 시 IR 변환 실패\n- route가 \&quot;/\&quot;로 시작하지 않을 경우 변환 시 강제 추가\n- 중복 컴포넌트 등록 시 알파벳 순 정렬로 중복 제거\n- 빈 children 배열을 null로 잘못 설정 시 []로 강제 변환\n- 텍스트 노드에 줄바꿈 포함 시 변환 중 제거 또는 오류\n- 이벤트 키 대소문자 혼재 시 소문자로 통일\n- 스타일 토큰 키 순서가 다를 경우 sorted keys로 결정적 출력 보장\n\n---\n\n## Codegen Rules\n\n### React/Next.js 15 Codegen\n\nIR을 기반으로 안정적인 UI 코드 생성 규칙입니다. React/Next.js 15 (App Router + RSC) 기준으로 IR을 실제 코드로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- IR을 기반으로 안정적인 UI 코드 생성\n- React/Next.js 15 (App Router + RSC) 기준\n- \&quot;디자인 시스템 없는 순수 Layout Tree\&quot;를 코드로 변환\n- 가능한 한 deterministic 하게 출력\n- 로직/상태/이벤트는 최소 수준으로만 개입\n\n##### INPUT\n- IRRoot\n\n##### OUTPUT\n- React Component Source Code (string)\n\n#### 2. Output Structure\n\n파일 구조는 다음 형태로 생성합니다:\n\n&#96;&#96;&#96;\n/page.tsx\n  - metadata (title, description)\n  - default export function Page()\n  - return(...) 내부에 layout tree 삽입\n\n/style-tokens.ts\n  - style.tokens flatten export\n\n/components/index.ts\n  - components registry export\n\n/script-events.ts\n  - event name string mapping export\n&#96;&#96;&#96;\n\n#### 3. Metadata Codegen\n\n##### UIH meta → Next.js metadata\n&#96;&#96;&#96;typescript\nIRMeta {\n  title: string\n  description: string\n}\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;typescript\nexport const metadata = {\n  title: \&quot;&lt;title&gt;\&quot;,\n  description: \&quot;&lt;description&gt;\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- description 없으면 필드 제외\n- theme는 metadata에 직접 쓰지 않음 (스타일토큰 용)\n\n#### 4. Style Token Codegen\n\n##### IRStyle { tokens }\n&#96;&#96;&#96;typescript\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;radius.default\&quot;: 8,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 키는 string 리터럴 그대로\n- numeric/string 그대로 출력\n- sorted keys for deterministic output\n\n#### 5. Component Registry Codegen\n\n##### IRComponents.list → export list\n&#96;&#96;&#96;typescript\nexport const components = {\n  Card,\n  Button,\n  Input,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 자동 import 하지 않음 (상위 시스템이 resolve)\n- keys는 PascalCase 유지\n- duplicates 제거 후 정렬\n\n#### 6. Layout Tree → JSX Codegen\n\n##### IRLayoutTree → React element tree\n\n##### 6.1 Component Node\n&#96;&#96;&#96;typescript\nIRComponentNode {\n  tag: \&quot;Div\&quot;\n  attributes: { class: \&quot;p-4\&quot; }\n  children: [...]\n}\n&#96;&#96;&#96;\n\n##### OUTPUT JSX\n&#96;&#96;&#96;jsx\n&lt;Div className=\&quot;p-4\&quot;&gt;\n  {children...}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n##### RULES\n- attribute.key \&quot;class\&quot; → \&quot;className\&quot;\n- attribute key는 그대로 lower-case 유지\n- value는 string literal\n- children length 0 이면 self-closing 금지 (always explicit block)\n- tag name 그대로 JSX 컴포넌트로 사용\n\n##### 6.2 Text Node\n&#96;&#96;&#96;typescript\nIRTextNode { value: \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;jsx\n{\&quot;Hello\&quot;}\n&#96;&#96;&#96;\n\n##### RULES\n- 텍스트는 JSX children 표현\n- 특수문자는 자동 escape\n\n#### 7. Script Event Codegen\n\n##### IRScript.events → export mapping\n&#96;&#96;&#96;typescript\nexport const eventHandlers = {\n  onClick: \&quot;submitForm\&quot;,\n  onLoad: \&quot;init\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- event 이름은 lower-case normalized\n- 값은 string (함수명)\n- 실제 JS 함수 body는 생성하지 않음\n- 나중 시스템이 자동 wire-up 함\n\n#### 8. Full Page Generation\n\n최종 page.tsx는 다음 구조를 따릅니다:\n\n&#96;&#96;&#96;typescript\nexport const metadata = { ... };\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen p-4\&quot;&gt;\n      &lt;P&gt;{\&quot;Hello\&quot;}&lt;/P&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### RULES\n- 최상위는 항상 &#96;&lt;Div&gt;&#96; 같은 Wrapper로 시작하지 않아도 됨\n- layout.root가 배열이면 Fragment로 감싼다\n- 코드 스타일은 2-space indent\n- 세미콜론 붙이지 않음 (Prettier 옵션 따라감)\n\n#### 9. Determinism Rules\n\n1. 속성 순서는 key 알파벳순 정렬\n2. children 순서는 DSL 입력 순서 그대로\n3. components 목록은 알파벳순 정렬\n4. styleTokens도 key 정렬\n5. eventHandlers key 정렬\n6. output JSX는 항상 multiline\n\n#### 10. Full Example (DSL → IR → JSX)\n\n##### DSL\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n##### JSX OUT\n&#96;&#96;&#96;typescript\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;p-4\&quot;&gt;\n      {\&quot;Hello\&quot;}\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n#### 11. Notes for Engine Integrators\n\n1. Codegen은 \&quot;순수 구조\&quot;만 책임진다\n   - 상태(state), fetch, useEffect 등은 지원하지 않음\n2. 이벤트 핸들러는 단순 라벨링 시스템\n3. 스타일 토큰은 UI 프레임워크에서 직접 해석\n4. React, Vue, Svelte 등 플랫폼별 코드젠 가능\n   - 플랫폼별 레이어는 분리\n\n#### Output Files 구조\n\n&#96;&#96;&#96;\nOutput Files\n├── page.tsx\n│   ├── metadata export\n│   ├── imports (components, styleTokens, eventHandlers)\n│   ├── Page() function\n│   └── JSX return (layout tree)\n├── style-tokens.ts\n│   └── styleTokens export\n├── components/index.ts\n│   └── components export\n└── script-events.ts\n    └── eventHandlers export\n&#96;&#96;&#96;\n\n#### Codegen Examples\n\n##### 전체 페이지 코드 생성 예시\n&#96;&#96;&#96;typescript\n// page.tsx\nexport const metadata = {\n  title: \&quot;Dashboard\&quot;,\n  description: \&quot;Main dashboard page\&quot;\n};\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen flex flex-col\&quot;&gt;\n      &lt;Header className=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n        &lt;H1&gt;\n          {\&quot;Dashboard\&quot;}\n        &lt;/H1&gt;\n      &lt;/Header&gt;\n      &lt;Main className=\&quot;flex-1 p-6\&quot;&gt;\n        &lt;Card className=\&quot;bg-white shadow-lg rounded-lg p-6\&quot;&gt;\n          &lt;P&gt;\n            {\&quot;Welcome back!\&quot;}\n          &lt;/P&gt;\n        &lt;/Card&gt;\n      &lt;/Main&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### 스타일 토큰 파일 예시\n&#96;&#96;&#96;typescript\n// style-tokens.ts\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;color.secondary\&quot;: \&quot;#6B7280\&quot;,\n  \&quot;color.accent\&quot;: \&quot;#F59E0B\&quot;,\n  \&quot;spacing.small\&quot;: 8,\n  \&quot;spacing.medium\&quot;: 16,\n  \&quot;spacing.large\&quot;: 24,\n  \&quot;border.radius\&quot;: 6,\n  \&quot;font.family\&quot;: \&quot;Inter\&quot;,\n  \&quot;font.size.base\&quot;: 16,\n  \&quot;shadow.default\&quot;: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n};\n&#96;&#96;&#96;\n\n##### 컴포넌트 레지스트리 예시\n&#96;&#96;&#96;typescript\n// components/index.ts\nexport const components = {\n  Button,\n  Card,\n  Input,\n  Modal,\n  Sidebar\n};\n&#96;&#96;&#96;\n\n##### 이벤트 핸들러 파일 예시\n&#96;&#96;&#96;typescript\n// script-events.ts\nexport const eventHandlers = {\n  onclick: \&quot;handleClick\&quot;,\n  onload: \&quot;initDashboard\&quot;,\n  onsubmit: \&quot;processForm\&quot;\n};\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- layout.root가 빈 배열일 경우 빈 Fragment 생성\n- 컴포넌트 이름이 JavaScript 예약어와 충돌 시 escaping 필요\n- 텍스트에 JSX 특수문자 포함 시 자동 escape\n- 중첩 깊이가 깊을 경우 코드 포맷팅 유지\n- import 경로 resolve 실패 시 상위 시스템에서 처리\n- styleTokens에 특수문자 키 포함 시 유효한 JS 객체 키로 변환\n\n---\n\n### Vue &amp; Svelte Codegen\n\nReact Codegen과 동일한 IR 기반으로 Vue와 Svelte 코드를 생성하는 규칙입니다. 플랫폼별 렌더링 규칙만 다르게 적용합니다.\n\n## SECTION A — Vue Codegen (SFC 기준)\n\n### GOAL\n- IR → .vue 파일 형태로 변환\n- &#96;&lt;template&gt;&#96; + &#96;&lt;script setup&gt;&#96; + &#96;&lt;style&gt;&#96; 구조 유지\n- 모든 로직은 배제하고 구조만 생성\n\n### OUTPUT FILE STRUCTURE\n&#96;&#96;&#96;\nMyPage.vue\n&#96;&#96;&#96;\n\n### 1. Top-Level Structure\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;!-- layout tree --&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport components...\n\nconst events = {...}\nconst styleTokens = {...}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* optional if needed */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Vue Template 규칙\n\n#### IRComponentNode(tag:\&quot;Div\&quot;, attributes, children)\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  &lt;!-- children --&gt;\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;className&#96; → &#96;class&#96;\n- attribute values: string only\n- children: 그대로 template로 변환\n- Fragment는 &#96;&lt;template&gt;&#96; 안에서 그냥 siblings로 출력\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello (그대로 text node)\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\neventHandlers {\n  onClick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Vue OUTPUT\n&#96;&#96;&#96;vue\n@click=\&quot;submitForm\&quot;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;onClick&#96; → &#96;@click&#96;\n- &#96;onChange&#96; → &#96;@change&#96;\n- &#96;onInput&#96; → &#96;@input&#96;\n- &#96;onLoad&#96; → &#96;@load&#96;\n- value는 함수 이름 string\n- 함수 구현은 생성하지 않음\n\n### 4. Component Registry (imports)\n&#96;&#96;&#96;javascript\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules\n- 속성(sorted)\n- imports(sorted)\n- children 순서 그대로\n- no semicolons\n- template 들여쓰기 2 spaces\n\n## SECTION B — Svelte Codegen (.svelte)\n\n### GOAL\n- Svelte 컴포넌트 파일 하나로 완성\n- &#96;&lt;script&gt;&#96; + markup 구조\n\n### OUTPUT STRUCTURE\n&#96;&#96;&#96;\nMyPage.svelte\n&#96;&#96;&#96;\n\n### 1. File Layout\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import components...\n  export let events = {...}\n  export let styleTokens = {...}\n&lt;/script&gt;\n\n&lt;!-- layout markup --&gt;\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  Hello\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* optional */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Svelte Markup\n\n#### IRComponentNode(tag, attributes, children)\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  {#if ... ?} (없음)\n  {children}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- 클래스는 &#96;class&#96;\n- 속성 문자열만\n- Self-closing 금지\n- children 재귀적 삽입\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\nIRScript:\nonClick → function name\n&#96;&#96;&#96;\n\n#### Svelte OUTPUT\n&#96;&#96;&#96;svelte\non:click={submitForm}\n&#96;&#96;&#96;\n\n#### Mapping\n&#96;&#96;&#96;\nonClick   → on:click\nonChange  → on:change\nonInput   → on:input\nonLoad    → on:load\n&#96;&#96;&#96;\n\n### 4. Components Import\n&#96;&#96;&#96;javascript\nimport Card from \&quot;./Card.svelte\&quot;;\nimport Button from \&quot;./Button.svelte\&quot;;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules (필수)\n\n1. import 순서는 알파벳 정렬\n2. attributes sorted\n3. event names lower-case\n4. children 순서 보존\n5. markup 들여쓰기 2 spaces\n\n## SECTION C — Cross-Platform Notes\n\n1. React / Vue / Svelte 모두 IR만 참조\n2. layout tree는 그대로 세 렌더러에서 재활용\n3. event handler는 단순 label → framework alias로 변환\n4. styleTokens는 컴파일러 외부 시스템이 처리\n5. components는 registry 기반으로 import만 생성\n\n## SECTION D — Example Conversion (Same IR → Vue/Svelte)\n\n### IR\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) { \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n### Vue Template\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Svelte Markup\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte 구조\n\n&#96;&#96;&#96;\nVue Output (.vue)\n├── &lt;template&gt;\n│   └── layout tree (Vue template syntax)\n├── &lt;script setup&gt;\n│   ├── component imports\n│   ├── events object\n│   └── styleTokens object\n└── &lt;style scoped&gt;\n    └── optional styles\n\nSvelte Output (.svelte)\n├── &lt;script&gt;\n│   ├── component imports\n│   ├── export let events = {...}\n│   └── export let styleTokens = {...}\n├── layout markup (Svelte syntax)\n└── &lt;style&gt;\n    └── optional styles\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte Examples\n\n#### Vue SFC 전체 예시\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n    &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n      &lt;H1&gt;\n        Dashboard\n      &lt;/H1&gt;\n    &lt;/Header&gt;\n    &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n      &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; @click=\&quot;handleCardClick\&quot;&gt;\n        &lt;P&gt;\n          Welcome back!\n        &lt;/P&gt;\n      &lt;/Card&gt;\n    &lt;/Main&gt;\n  &lt;/Div&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n\nconst events = {\n  handleCardClick: \&quot;handleCardClick\&quot;\n}\n\nconst styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;spacing.medium\&quot;: 16\n}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### Svelte 컴포넌트 전체 예시\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import Card from \&quot;./Card.svelte\&quot;;\n  import Button from \&quot;./Button.svelte\&quot;;\n\n  export let events = {\n    handleCardClick: \&quot;handleCardClick\&quot;\n  };\n\n  export let styleTokens = {\n    \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n    \&quot;spacing.medium\&quot;: 16\n  };\n&lt;/script&gt;\n\n&lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n  &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n    &lt;H1&gt;\n      Dashboard\n    &lt;/H1&gt;\n  &lt;/Header&gt;\n  &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n    &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; on:click={handleCardClick}&gt;\n      &lt;P&gt;\n        Welcome back!\n      &lt;/P&gt;\n    &lt;/Card&gt;\n  &lt;/Main&gt;\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### 이벤트 매핑 비교\n&#96;&#96;&#96;javascript\n// 동일한 IR 이벤트\n{\n  onClick: \&quot;handleClick\&quot;,\n  onChange: \&quot;handleChange\&quot;,\n  onLoad: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;vue\n&lt;!-- Vue --&gt;\n&lt;Button @click=\&quot;handleClick\&quot; @change=\&quot;handleChange\&quot; @load=\&quot;init\&quot;&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;svelte\n&lt;!-- Svelte --&gt;\n&lt;Button on:click={handleClick} on:change={handleChange} on:load={init}&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;jsx\n&lt;!-- React --&gt;\n&lt;Button onClick={handleClick} onChange={handleChange} onLoad={init}&gt;\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- Vue에서 컴포넌트 이름이 kebab-case로 변환 필요 시 자동 처리\n- Svelte에서 export let 구문이 예약어와 충돌 시 renaming\n- 이벤트 핸들러가 정의되지 않은 경우 플랫폼별 기본 동작\n- 스타일 토큰에 CSS 변수나 함수 포함 시 escaping\n- 중첩 컴포넌트 깊이가 깊을 경우 플랫폼별 최적화 적용\n- 텍스트 콘텐츠에 플랫폼별 특수문자 포함 시 자동 escape\n\n---\n\n## Examples\n\n### 완전한 UIH DSL 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;User Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main user dashboard with analytics\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  color.accent: \&quot;#F59E0B\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n  font.size.h1: 32\n  spacing.small: 8\n  spacing.medium: 16\n  spacing.large: 24\n  border.radius: 6\n  shadow.default: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n  Sidebar\n  Chart\n}\n\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto p-6\&quot;) {\n    Header(class:\&quot;mb-8\&quot;) {\n      Div(class:\&quot;flex justify-between items-center\&quot;) {\n        H1(class:\&quot;text-3xl font-bold\&quot;) {\n          \&quot;Dashboard\&quot;\n        }\n        Button(class:\&quot;px-4 py-2 bg-blue-600 text-white rounded\&quot;) {\n          \&quot;New Report\&quot;\n        }\n      }\n    }\n\n    Div(class:\&quot;grid grid-cols-3 gap-6\&quot;) {\n      Card(class:\&quot;col-span-2\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Analytics Overview\&quot;\n        }\n        Chart(class:\&quot;w-full h-64\&quot;)\n      }\n\n      Card(class:\&quot;col-span-1\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Quick Stats\&quot;\n        }\n        Div(class:\&quot;space-y-4\&quot;) {\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Total Users\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;1,234\&quot;\n            }\n          }\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Active Sessions\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;89\&quot;\n            }\n          }\n        }\n      }\n    }\n\n    Sidebar(class:\&quot;mt-8\&quot;) {\n      H3(class:\&quot;text-lg mb-4\&quot;) {\n        \&quot;Recent Activity\&quot;\n      }\n      Div(class:\&quot;space-y-2\&quot;) {\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;User john@example.com logged in\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;New report generated\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;System backup completed\&quot;\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onLoad: \&quot;initDashboard\&quot;\n  onClick: \&quot;handleButtonClick\&quot;\n  onRefresh: \&quot;refreshData\&quot;\n}\n&#96;&#96;&#96;\n\n### 최소 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Minimal Page\&quot;\n  route: \&quot;/minimal\&quot;\n  theme: \&quot;light\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  spacing.unit: 12\n}\n\nlayout {\n  Div(class:\&quot;min-h-screen flex items-center justify-center bg-gray-50\&quot;) {\n    \&quot;Coming soon\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n### Form 중심 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Sign Up\&quot;\n  route: \&quot;/signup\&quot;\n  theme: \&quot;light\&quot;\n  description: \&quot;Create a new account\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#2563EB\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n}\n\ncomponents {\n  Form\n  Input\n  Button\n  Alert\n}\n\nlayout {\n  Section(class:\&quot;min-h-screen flex items-center justify-center bg-gray-100\&quot;) {\n    Form(class:\&quot;w-full max-w-md space-y-6 bg-white p-8 rounded-xl shadow-lg\&quot;) {\n      H2(class:\&quot;text-2xl font-semibold text-gray-900\&quot;) {\n        \&quot;Create your account\&quot;\n      }\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;email\&quot;, placeholder:\&quot;Enter email\&quot;)\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;password\&quot;, placeholder:\&quot;Enter password\&quot;)\n      Button(class:\&quot;w-full bg-blue-600 text-white py-3 rounded-lg\&quot;) {\n        \&quot;Sign up\&quot;\n      }\n      Alert(class:\&quot;text-sm text-gray-500 text-center\&quot;) {\n        \&quot;By signing up you agree to our terms\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onSubmit: \&quot;handleSignup\&quot;\n  onLoad: \&quot;prefillFromInvite\&quot;\n}\n&#96;&#96;&#96;\n\n### 콘텐츠 피드 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Creator Feed\&quot;\n  route: \&quot;/feed\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Realtime creator activity feed\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#22D3EE\&quot;\n  color.background: \&quot;#0F172A\&quot;\n  font.family: \&quot;Space Grotesk\&quot;\n  spacing.medium: 20\n  radius.card: 12\n}\n\ncomponents {\n  Shell\n  Sidebar\n  Feed\n  FeedItem\n  Avatar\n  Badge\n}\n\nlayout {\n  Shell(class:\&quot;min-h-screen bg-slate-950 text-slate-100\&quot;) {\n    Sidebar(class:\&quot;w-64 border-r border-slate-800 p-6 space-y-6\&quot;) {\n      H1(class:\&quot;text-xl font-semibold tracking-tight\&quot;) {\n        \&quot;Creator Hub\&quot;\n      }\n      Badge(class:\&quot;inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 text-slate-200\&quot;) {\n        \&quot;Live updates\&quot;\n      }\n    }\n    Feed(class:\&quot;flex-1 p-8 space-y-6\&quot;) {\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-cyan-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;heymina.studio\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-300\&quot;) {\n              \&quot;New drop\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Dropped a limited neon kit — 120 packs sold out in 3 minutes.\&quot;\n          }\n        }\n      }\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-pink-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;luvv.wav\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-cyan-500/10 text-cyan-300\&quot;) {\n              \&quot;Stream recap\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Hit 18,245 live viewers tonight — chat requested a synthwave encore.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onRefresh: \&quot;fetchLatestFeed\&quot;\n  onClick: \&quot;openCreatorProfile\&quot;\n}\n&#96;&#96;&#96;\n\n---\n\n## Version\n\n- **Version**: 1.0.0\n- **Last Update**: 2025-11-18\n- **Change Summary**: Complete guide consolidating all UIH DSL specifications\n\n---\n\n## 문서 끝\n\n이 문서는 UIH DSL의 모든 스펙을 \&quot;생략 없이\&quot; 하나의 파일로 통합한 완전판입니다. Foundation Layer부터 Codegen까지 전 과정을 포함하며, LLM이 UI를 정확하게 선언할 수 있도록 설계된 모든 규칙이 담겨 있습니다.\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating IR section comments**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;15e0d734-d549-4ce6-a7e8-a4466b082cbc&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  &#96;&#96;&#96;typescript\n  {\n-   events: Record&lt;string, string&gt;   // onClick → \&quot;submitForm\&quot;\n+   events: Record&lt;string, string&gt;   // onclick → \&quot;submitForm\&quot;\n  }\n  &#96;&#96;&#96;\n  \n  #### Rules\n  - all keys normalized to lower-case event names\n+ - camelCase event keys는 허용되지 않음 (validation 단계에서 차단)\n  - event value must be string only\n  - duplicates override earlier definitions&quot;,
        &quot;oldStart&quot;: 1883,
        &quot;newStart&quot;: 1883,
        &quot;oldLines&quot;: 10,
        &quot;newLines&quot;: 11,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 2
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;,
  &quot;contentsAfterEdit&quot;: &quot;# UIH DSL — Complete Guide (생략 없는 완전판)\n\n## Table of Contents\n\n1. [Overview](#overview)\n2. [Philosophy &amp; Design Principles](#philosophy--design-principles)\n3. [Foundation Layer](#foundation-layer)\n4. [Tokenizer Specification](#tokenizer-specification)\n5. [Grammar](#grammar)\n   - [Block Grammar](#block-grammar)\n   - [Property Grammar](#property-grammar)\n   - [Layout Tree Grammar](#layout-tree-grammar)\n   - [Parser BNF Grammar](#parser-bnf-grammar)\n6. [AST Schema Definition](#ast-schema-definition)\n7. [IR (Intermediate Representation) Specification](#ir-intermediate-representation-specification)\n8. [Codegen Rules](#codegen-rules)\n   - [React/Next.js 15 Codegen](#reactnextjs-15-codegen)\n   - [Vue &amp; Svelte Codegen](#vue--svelte-codegen)\n9. [Examples](#examples)\n10. [Version](#version)\n\n---\n\n## Overview\n\nUIH DSL (Universal Interface Hierarchy Domain Specific Language) v2는 **\&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;**를 목표로 하는 도메인 특화 언어입니다.\n\n### 핵심 목표\n- LLM이 UI 구조를 **정확하게** 선언할 수 있도록 설계\n- 모호성 제거 및 결정성(determinism) 보장\n- 사람보다 AI가 더 효과적으로 사용 가능한 DSL\n- UI 구조의 선언적 표현에 집중\n\n### 아키텍처 흐름\n&#96;&#96;&#96;\nDSL 문자열 → Tokenizer → Parser → AST → IR → Codegen → React/Vue/Svelte 코드\n&#96;&#96;&#96;\n\n### 주요 특징\n- 한 줄에 하나의 의미만 (One-intent-per-line)\n- 선택적 문법 금지 - 모든 것이 명시적\n- 쌍따옴표만 허용, 세미콜론 없음\n- 주석 지원 안 함 (모호성 제거)\n- 고정 블록 순서: meta → style → components → layout → script\n\n---\n\n## Philosophy &amp; Design Principles\n\nUIH DSL은 \&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;를 목표로 하는 도메인 특화 언어입니다. 사람보다 LLM이 더 효과적으로 사용할 수 있도록 설계되었으며, UI 구조의 선언적 표현에 집중합니다.\n\n### 1. LLM 친화적 설계 원칙\n\nLLM이 읽고 쓰기 편한 DSL을 지향합니다. 구조는 최대한 명확하고 모호성이 없으며, 선택적 문법을 금지합니다. LLM이 패턴을 쉽게 반복할 수 있는 형태로 자연어 번역 난이도를 낮췄습니다.\n\n### 2. 선언적 UI 설계\n\nUI는 로직 기반보다 구조 기반으로 설계합니다. \&quot;무엇을 만든다\&quot;에 집중하며 \&quot;어떻게 만든다\&quot;는 Codegen이 담당합니다. 상태, 이벤트, 애니메이션은 추상화 계층으로 밀어냅니다.\n\n### 3. 한 줄 한 의미 원칙 (One-intent-per-line)\n\n한 라인에 하나의 의미만 허용합니다. 한 줄에 두 개 의미를 섞으면 LLM이 실수할 가능성이 높아집니다.\n\n#### 좋은 예: 한 줄 한 의미\n&#96;&#96;&#96;dsl\nmeta:\n  title: \&quot;Home\&quot;\n\nmeta:\n  route: \&quot;/\&quot;\n&#96;&#96;&#96;\n\n#### 나쁜 예: 한 줄 다중 의미 (금지)\n&#96;&#96;&#96;dsl\nmeta: title: \&quot;Home\&quot;, route: \&quot;/\&quot;  # 잘못된 예\n&#96;&#96;&#96;\n\n### 4. 고정 블록 순서\n\n블록 구조는 **meta → style → components → layout → script** 순서를 유지합니다. 이 순서는 LLM이 외우기 쉽고 Codegen의 예측 가능성과 AST의 결정성을 보장합니다.\n\n### 5. 최소 표현, 최대 의미\n\nDSL은 짧고 규칙적이어야 합니다. CSS-like verbose, YAML 계층 증가, JSX 로직 섞임을 금지합니다. 의미 전달에 집중하는 최소 선언적 DSL입니다.\n\n### 6. 오류 제로 문법\n\n\&quot;AI가 틀릴 수 없는 언어\&quot;를 목표로 합니다. 쌍따옴표만 허용하고 세미콜론 없이 콜론만 사용합니다. 모든 키는 고정된 string literal이며 optional field를 최소화합니다.\n\n### 7. AST 1:1 매핑\n\n모든 UI 요소가 AST에 직접 매핑됩니다. meta 블록 → MetaNode, style 블록 → StyleNode, layout 블록 → LayoutTree로 변환됩니다.\n\n### 8. 기계 친화적 우선\n\n\&quot;사람이 읽으면 조금 불편할 것\&quot; 정도가 적정 수준입니다. 사람 UX보다 AI 정확성을 우선합니다.\n\n---\n\n## Foundation Layer\n\nUIH DSL의 가장 낮은 레벨 사양입니다. Character부터 Ordering까지의 기본 규칙을 정의하며, LLM이 실수할 수 없는 엄격한 문법을 제공합니다.\n\n### 1. Character Layer (문자 규칙)\n\n#### ALLOWED_CHARACTERS\n- a~z (lowercase alphabets)\n- 0~9 (digits)\n- hyphen (-)\n- underscore (_)\n- space ( )\n- newline (\\n)\n- braces: { }\n- colon (:)\n- double-quote (\&quot;)\n\n#### DISALLOWED_CHARACTERS\n- single-quote (&#39;)\n- semicolon (;)\n- parentheses ()\n- backtick (&#96;)\n- tab (\\t)\n- CRLF (\\r\\n)\n\n#### NEWLINE\n- always LF (\\n)\n- CRLF not supported\n\n### 2. Indentation Layer (들여쓰기 규칙)\n\n#### INDENTATION\n- exactly 2 spaces ONLY\n- tabs NOT allowed\n- indentation increases only inside a block\n- indentation does not imply hierarchy (not YAML)\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {           // ❌ 탭 사용 금지\n  title: \&quot;Home\&quot;  // ✅ 정확히 2 space\n}\n&#96;&#96;&#96;\n\n### 3. Token Layer (토큰 기본 규칙)\n\n#### TOKENS\n- IDENTIFIER = &#96;[a-z][a-z0-9.]*&#96;\n- STRING = &#96;\&quot;[^\&quot;\\\\]*(?:\\\\.[^\&quot;\\\\]*)*\&quot;&#96; (supports &#96;\\\&quot;&#96; escape)\n- NUMBER = &#96;\\d+(?:\\.\\d+)?&#96;\n- LBRACE = &#96;{&#96;\n- RBRACE = &#96;}&#96;\n- COLON = &#96;:&#96;\n- NEWLINE = &#96;\\n&#96;\n- WHITESPACE = single space\n\n#### IDENTIFIER_RULES\n- lowercase only\n- dot notation allowed (e.g. &#96;color.primary&#96;)\n- do NOT mix hyphens inside identifiers (LLM error-prone)\n\n#### STRING_RULES\n- must use double quotes only\n- escaping uses &#96;\\\&quot;&#96;\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {\n  color.primary: \&quot;#fff\&quot;    // ✅ dot notation 허용\n  label: \&quot;Click \\\&quot;here\\\&quot;\&quot;  // ✅ escape 허용\n  width: 100.5            // ✅ 소수 허용\n}\n&#96;&#96;&#96;\n\n### 4. Comment Layer (코멘트)\n\n#### COMMENTS\n- comments NOT supported\n- any attempt to use &#96;//&#96; or &#96;#&#96; is invalid\n- purpose: reduce ambiguity for LLM\n\n### 5. Statement Layer (기본 문장 구조)\n\n#### STATEMENT_TYPES\n- Block Declaration\n- Property Declaration\n\n#### BLOCK_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt; {\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n#### PROPERTY_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n#### SEMICOLON\n- NOT allowed (never used)\n\n### 6. Block Layer (블록 기본 규칙)\n\n#### BLOCK_STRUCTURE\n&#96;&#96;&#96;\nblockName {\n  property: \&quot;value\&quot;\n  property: 123\n  property: true\n}\n&#96;&#96;&#96;\n\n#### BLOCK_RULES\n- block cannot contain nested blocks\n- ONLY layout block may contain nested layout nodes\n\n### 7. Ordering Layer (순서 강제)\n\n#### BLOCK_ORDER\n1. meta\n2. style\n3. components (optional)\n4. layout\n5. script (optional)\n\n#### RULE\n- if a block appears, must follow this order\n- missing blocks are allowed except meta/style/layout\n\n### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  primary-color: \&quot;#111\&quot;\n}\n\ncomponents {\n  Button {\n    variant: \&quot;primary\&quot;\n  }\n}\n\nlayout {\n  Container {\n    children: \&quot;Button\&quot;\n  }\n}\n\nscript {\n  // optional script\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단\n- 잘못된 들여쓰기 발견 시 구문 오류\n- 코멘트 시도 시 즉시 무효 처리\n- 블록 순서 위반 시 파싱 실패\n- layout 외 중첩 블록 시도 시 오류\n\n---\n\n## Tokenizer Specification\n\nFoundation Layer + Grammar Layers 기반의 공식 토큰화 규칙입니다. DSL 문자열을 균일한 Token 리스트로 변환하며, 모든 파싱의 기반이 됩니다.\n\n### 1. Tokenizer Overview\n\n#### PURPOSE\n- DSL 문자열을 균일한 Token 리스트로 변환\n- 모호성 없는 deterministic token stream 생성\n- 모든 파싱은 이 토큰 리스트 기반으로 진행\n\n#### INPUT\n- LF 기반의 DSL 문자열\n\n#### OUTPUT\n- 순차적 Token 배열\n\n### 2. Token Types\n\n#### TOKENS\n- &#96;IDENTIFIER&#96; - meta, title, color.primary, class 등\n- &#96;STRING&#96; - \&quot;Hello\&quot;\n- &#96;NUMBER&#96; - 0, 12, 0.8\n- &#96;BOOLEAN&#96; - true, false\n- &#96;LBRACE&#96; - {\n- &#96;RBRACE&#96; - }\n- &#96;LPAREN&#96; - (\n- &#96;RPAREN&#96; - )\n- &#96;COLON&#96; - :\n- &#96;COMMA&#96; - ,\n- &#96;NEWLINE&#96; - \\n\n- &#96;WHITESPACE&#96; - space (only used between tokens)\n- &#96;TEXT_STRING&#96; - layout children string ONLY (disambiguation)\n- &#96;EOF&#96; - end of file marker\n\n### 3. Identifier Detection\n\n#### IDENTIFIER_RULES\n- regex: &#96;^[a-z][a-z0-9.]*$&#96;\n- lowercase only\n- dot notation allowed\n- hyphens, underscores 금지\n\n#### TAGNAME_RULES\n- starts with uppercase letter\n- subsequent chars: &#96;[a-zA-Z0-9]&#96;\n- TagName (e.g. Div, Header) 구분용\n\n#### TAGNAME_EXAMPLES\n&#96;&#96;&#96;\nDiv\nSection\nImage\nH1\n&#96;&#96;&#96;\n\n### 4. String Token Rules\n\n#### STRING\n- starts with &#96;\&quot;&#96;\n- ends with &#96;\&quot;&#96;\n- inside supports &#96;\\\&quot;&#96;\n- no multi-line\n\n#### TEXT_STRING\n- STRING과 동일한 문법\n- 단, layout children context에서만 등장\n- Parser에서 context-aware로 구분\n\n### 5. Number Token Rules\n\n#### NUMBER\n- regex: &#96;^[0-9]+(\\.[0-9]+)?$&#96;\n- no negative numbers\n- no units (px, rem 등)\n\n### 6. Boolean Token Rules\n\n#### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n- strictly lowercase\n\n### 7. Brace / Symbol Tokens\n\n#### SYMBOL_TOKENS\n- &#96;LBRACE&#96;: &#96;{&#96;\n- &#96;RBRACE&#96;: &#96;}&#96;\n- &#96;LPAREN&#96;: &#96;(&#96;\n- &#96;RPAREN&#96;: &#96;)&#96;\n- &#96;COLON&#96;: &#96;:&#96;\n- &#96;COMMA&#96;: &#96;,&#96;\n\n#### NOTES\n- semicolon NOT allowed\n- backtick NOT allowed\n\n### 8. Whitespace / Newline Rules\n\n#### WHITESPACE\n- single space &#96;&#39; &#39;&#96;\n- no tabs\n- no multi-space sequences except indentation (2 spaces)\n\n#### NEWLINE\n- LF only\n- CRLF invalid\n\n### 9. Layout Context Rules (Critical)\n\n#### LAYOUT_MODE\nTokenizer enters layout-mode when encountering:\n&#96;&#96;&#96;\nlayout { … }\n&#96;&#96;&#96;\n\n#### CONTEXT_SWITCH\n- after TagName(\n- before encountering next node or text\n\n#### INSIDE_LAYOUT_BLOCK\n- children detection required\n- plain strings must become TEXT_STRING token\n- siblings separated by NEWLINE\n\n#### EXAMPLE\n&#96;&#96;&#96;\n\&quot;Welcome\&quot; → TEXT_STRING inside layout\n&#96;&#96;&#96;\n\n### 10. Tokenization Algorithm (High-Level)\n\n1. iterate through chars\n2. skip whitespace unless meaningful (indent)\n3. detect IDENTIFIER or TAGNAME\n4. detect STRING (with escape)\n5. detect NUMBER\n6. detect BOOLEAN\n7. detect braces &#96;{ }&#96;\n8. detect parentheses &#96;( )&#96;\n9. detect colon &#96;:&#96; or comma &#96;,&#96;\n10. detect newline &#96;\\n&#96;\n11. maintain context stack:\n    - normal\n    - inside layout block\n    - inside attributes\n12. output final EOF token\n\n### 11. Example Token Stream\n\n#### INPUT\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### OUTPUT_TOKENS\n&#96;&#96;&#96;\nIDENTIFIER(layout)\nLBRACE\nNEWLINE\nTAGNAME(Div)\nLPAREN\nIDENTIFIER(class)\nCOLON\nSTRING(\&quot;p-4\&quot;)\nRPAREN\nLBRACE\nNEWLINE\nTEXT_STRING(\&quot;Hello\&quot;)\nNEWLINE\nRBRACE\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Token Stream Examples\n\n#### 기본 블록 토큰화\n&#96;&#96;&#96;dsl\nmeta {\n  title: \&quot;Home\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(meta)\nLBRACE\nNEWLINE\nIDENTIFIER(title)\nCOLON\nSTRING(\&quot;Home\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n#### 스타일 블록 토큰화\n&#96;&#96;&#96;dsl\nstyle {\n  color.primary: \&quot;#fff\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(style)\nLBRACE\nNEWLINE\nIDENTIFIER(color.primary)\nCOLON\nSTRING(\&quot;#fff\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단 및 오류 반환\n- CRLF 줄바꿈 발견 시 LF로 변환 또는 오류\n- 탭 문자 발견 시 공백 변환 또는 오류\n- STRING에서 미닫힘 따옴표 시 오류\n- NUMBER에 음수나 단위 포함 시 오류\n- layout 외 컨텍스트에서 TEXT_STRING 시도 시 오류\n- TAGNAME 규칙 위반 (소문자 시작) 시 IDENTIFIER로 처리\n\n---\n\n## Grammar\n\n### Block Grammar\n\nUIH DSL의 최상위 구조를 정의하는 Block Grammar Layer입니다. Foundation Layer 바로 위에 위치하며, 5개 블록의 선언, 순서, 내용 규칙을 명시합니다.\n\n#### 1. Block Definitions (5개 블록)\n\n##### BLOCKS\n- meta\n- style\n- components (optional)\n- layout\n- script (optional)\n\n##### RULES\n- 블록은 반드시 이 순서를 따라야 함: meta → style → components → layout → script\n- meta, style, layout은 필수\n- components, script는 선택\n- 각 블록은 정확히 한 번만 등장\n- 중복 블록 금지\n\n#### 2. Block Syntax (기본 문법)\n\n##### BLOCK_SYNTAX\n&#96;&#96;&#96;\n&lt;blockName&gt; {\n  &lt;property&gt;: &lt;value&gt;\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n&#96;&#96;&#96;\n\n##### SYNTAX_COMPONENTS\n- 블록 시작: IDENTIFIER + &#96; {&#96;\n- 블록 끝: &#96;}&#96; 단독 줄\n\n#### 3. Block Content Rules\n\n##### 공통 규칙\n- 블록 내부에는 property statements만 존재\n- block 내부에 block 중첩 금지\n- 단, layout 블록만 예외적으로 UI tree 구조 허용\n\n##### PROPERTY_RULE\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### VALUE_TYPES\n- string\n- number\n- boolean\n- enum-like literals (string 값)\n- list (향후 정의)\n\n#### 4. Block-Specific Rules\n\n##### (1) META BLOCK\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Page title\&quot;\n  route: \&quot;/path\&quot;\n  theme: \&quot;light\&quot;|\&quot;dark\&quot;\n}\n&#96;&#96;&#96;\n\n**META_RESTRICTIONS:**\n- meta는 UI 문서의 metadata만 포함\n- layout 정보나 스타일 정보 포함 금지\n\n##### (2) STYLE BLOCK\n&#96;&#96;&#96;\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n}\n&#96;&#96;&#96;\n\n**STYLE_RESTRICTIONS:**\n- key는 dot notation 사용 가능\n- 값은 string 또는 number\n- layout 관련 속성 금지\n- theme override 불가\n\n##### (3) COMPONENTS BLOCK (optional)\n&#96;&#96;&#96;\ncomponents {\n  Card\n  Button\n  Input\n}\n&#96;&#96;&#96;\n\n**COMPONENTS_RULES:**\n- 등록할 컴포넌트 이름만 줄 단위로 나열\n- 중첩 구조 없음\n- 속성 없음\n- 문자열 아님: &#96;\&quot;Card\&quot;&#96; 금지, &#96;Card&#96;만 허용\n\n##### (4) LAYOUT BLOCK\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n**LAYOUT_RULES:**\n- 유일하게 중첩 구조 허용\n- 노드 문법은 별도 Layer에서 정의\n- property는 inline attribute 형태 가능\n- block-like structure 유지\n\n##### (5) SCRIPT BLOCK (optional)\n&#96;&#96;&#96;\nscript {\n  onclick: \&quot;submitForm\&quot;\n  onload: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n**SCRIPT_RESTRICTIONS:**\n- event/behavior mapping만 정의\n- JS code 삽입 금지\n- inline function 금지\n- event identifier는 반드시 lowercase (camelCase 금지)\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n  spacing.unit: 8\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n}\n\nlayout {\n  Div(class:\&quot;container mx-auto p-4\&quot;) {\n    Card(class:\&quot;bg-white shadow-lg\&quot;) {\n      Button(onclick:\&quot;handleSubmit\&quot;) {\n        \&quot;Submit\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;processForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 파싱 실패\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유효 (경고)\n- components/script 외 블록에서 중첩 시도 시 오류\n- layout 외 블록에서 attribute 사용 시 오류\n\n---\n\n### Property Grammar\n\nUIH DSL 안정성의 핵심인 Property Grammar Layer입니다. Block Grammar 위에 쌓이며, 속성 선언, 값 타입, 범위 규칙을 정의합니다.\n\n#### 1. Property Declaration Syntax\n\n##### PROPERTY_SYNTAX\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\nradius.default: 8\nenabled: true\n&#96;&#96;&#96;\n\n##### RULES\n- identifier는 반드시 lowercase\n- dot notation 허용 (&#96;color.primary&#96; 등)\n- colon(:) 뒤에는 반드시 space 1개\n- value는 줄 끝까지\n\n#### 2. Identifier Rules\n\n##### IDENTIFIER\n- 패턴: &#96;[a-z][a-z0-9.]*&#96;\n- 소문자만 허용\n- 숫자는 뒤쪽에만 허용\n- dot(.)은 중첩 속성 의미로만 사용\n- hyphen 금지 (LLM 오류 방지)\n- underscore 금지\n\n##### VALID\n&#96;&#96;&#96;\ncolor.primary\nfont.size\nborder.width\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nColor.Primary    // 대문자\nfont-size        // hyphen\nfont_size        // underscore\nprimary2.color   // 숫자 앞쪽\n&#96;&#96;&#96;\n\n#### 3. Value Types (5가지)\n\n##### VALUE_TYPES\n1. STRING\n2. NUMBER\n3. BOOLEAN\n4. ENUM-LIKE (string 기반)\n5. LIST (여러 값 나열, 줄 단위)\n\n#### 4. String Value Rules\n\n##### STRING\n- 무조건 double-quote 사용\n- 내부에 &#96;\&quot;&#96; 포함 시 &#96;\\\&quot;&#96;로 escape\n- single-quote 절대 금지\n\n##### VALID\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\ndescription: \&quot;He said \\\&quot;ok\\\&quot;\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\ntitle: &#39;Home&#39;      // single-quote\nname: \&quot;Home\&quot;       // curly quotes\n&#96;&#96;&#96;\n\n#### 5. Number Value Rules\n\n##### NUMBER\n- 정수 또는 소숫점 가능\n- 음수는 허용하지 않음\n- 단위(px 등) 금지 → unitless 구조\n\n##### VALID\n&#96;&#96;&#96;\nradius: 12\nopacity: 0.85\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nradius: -4     // 음수\nwidth: 10px    // 단위 포함\n&#96;&#96;&#96;\n\n#### 6. Boolean Value Rules\n\n##### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nenabled: true\nvisible: false\n&#96;&#96;&#96;\n\n#### 7. Enum-like String Rules\n\n##### ENUM_STRING\n- 문자열이지만 값이 고정된 타입처럼 쓰는 케이스\n- allowed values는 별도 block schema마다 정의\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntheme: \&quot;light\&quot; | \&quot;dark\&quot;\nsize: \&quot;sm\&quot; | \&quot;md\&quot; | \&quot;lg\&quot;\n&#96;&#96;&#96;\n\n#### 8. List Value (Block-like list)\n\n##### LIST\n- 각 항목은 줄 단위로 입력\n- 대괄호 &#96;[]&#96; 문법 없음 (LLM 오류 방지)\n- 문자열/식별자 혼용 가능\n\n##### SYNTAX\n&#96;&#96;&#96;\nitems {\n  \&quot;one\&quot;\n  \&quot;two\&quot;\n  \&quot;three\&quot;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- list block 내부에는 property 없음\n- indent 2 spaces 유지\n\n##### EXAMPLE\n&#96;&#96;&#96;\ntags {\n  \&quot;news\&quot;\n  \&quot;feature\&quot;\n  \&quot;announcement\&quot;\n}\n&#96;&#96;&#96;\n\n#### 9. Property Scope Rules (Block별 허용 속성 경계)\n\n##### META_SCOPE\n- meta는 UI metadata만 포함\n- route, title, theme, description 등\n\n##### STYLE_SCOPE\n- 색상, 폰트, radius 등 UI 스타일만\n- layout 속성 금지 (width, height 등은 layout block에서만)\n\n##### COMPONENTS_SCOPE\n- property 없음 (등록만)\n\n##### LAYOUT_SCOPE\n- inline attribute만 (class, id, ref 등)\n- 값은 무조건 string\n- boolean/number 사용 금지\n\n##### SCRIPT_SCOPE\n- event mapping 전용\n- 값은 무조건 string\n\n#### 10. Final Validation Rules\n\n1. 모든 property는 블록 내부에서만 존재\n2. 같은 identifier 중복 선언 금지\n3. meta/style/script는 property-only 구조\n4. components는 선언만 (property 없음)\n5. layout만 child nodes 보유 가능\n6. value의 타입은 block-specific rule을 반드시 준수\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main dashboard page\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  border.radius: 8\n  spacing.unit: 16\n}\n\ncomponents {\n  Card\n  Button\n  Input\n}\n\nlayout {\n  class: \&quot;container\&quot;\n  id: \&quot;main-content\&quot;\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;handleForm\&quot;\n  onrefresh: \&quot;reloadData\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 대문자 identifier 사용 시 토큰화 실패\n- hyphen/underscore 사용 시 구문 오류\n- single-quote나 curly quotes 사용 시 파싱 실패\n- 음수나 단위 포함 숫자 시 값 오류\n- 블록별 스코프 위반 시 validation 실패\n- 중복 property 선언 시 마지막 값만 유효 (경고)\n\n---\n\n### Layout Tree Grammar\n\nUIH DSL의 핵심 구조인 Layout Tree Grammar Layer입니다. Block Grammar와 Property Grammar 위에서 동작하며, UI 구성 요소의 트리 구조를 정의합니다.\n\n#### 1. Layout Block Overview\n\n##### LAYOUT_BLOCK\n&#96;&#96;&#96;\nlayout {\n  &lt;layout-node&gt;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- DSL에서 유일하게 중첩 구조를 가질 수 있는 블록\n- 모든 UI 구성 요소는 layout node로 표현\n- 노드는 \&quot;구조\&quot;만 표현, 스타일/로직은 표현하지 않음\n\n#### 2. Layout Node Syntax\n\n##### NODE_SYNTAX\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;) {\n  &lt;children&gt;\n}\n&#96;&#96;&#96;\n\n##### OR (children 없는 경우)\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;)\n&#96;&#96;&#96;\n\n##### NOTES\n- TagName은 PascalCase 컴포넌트 또는 HTML-like 사용 가능\n- attributes는 inline 형태 only\n- attributes는 옵션, 없어도 됨\n- children 블록은 중첩 가능\n\n##### VALID\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) {\n  \&quot;Hello\&quot;\n}\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nDiv {\n  class: \&quot;p-4\&quot;    // 속성은 block 기반이 아니라 inline only\n}\n&#96;&#96;&#96;\n\n#### 3. TagName Rules\n\n##### TAGNAME\n- 반드시 알파벳으로 시작\n- PascalCase 또는 UpperCamelCase 권장\n- HTML-like 소문자 태그는 사용 가능 (&#96;div&#96;, &#96;span&#96;) 단 내부적으로는 UpperCase 변환됨\n\n##### VALID\n&#96;&#96;&#96;\nDiv\nSection\nImage\nheader   // 허용하지만 변환 시 Header로 취급\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n3Div     // 숫자 시작\n_Box     // underscore 시작\n-Node    // hyphen 시작\n&#96;&#96;&#96;\n\n#### 4. Attribute Syntax\n\n##### ATTRIBUTES\n&#96;&#96;&#96;\n&lt;identifier&gt;:\&quot;&lt;string&gt;\&quot;\n&#96;&#96;&#96;\n\n##### RULES\n- value는 무조건 string only\n- boolean/number 금지\n- &#96;class:\&quot;p-4\&quot;&#96; 형태처럼 inline만 허용\n- 각 attribute는 콤마(&#96;,&#96;)로 구분\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;, id:\&quot;main\&quot;, ref:\&quot;root\&quot;)\n&#96;&#96;&#96;\n\n##### STRICT_RULES\n- 속성 순서는 의미 없음 (LLM 실수 방지로 자유 순서)\n- attribute key는 lower-case only\n- 속성 개수 0~5 정도 권장\n\n#### 5. Children Rules\n\n##### CHILD_TYPES\n- string literal\n- another layout node\n- list of siblings (node 여러 개 배치)\n\n##### STRING_CHILD\n&#96;&#96;&#96;\n\&quot;Hello world\&quot;\n&#96;&#96;&#96;\n\n##### NESTED_NODE\n&#96;&#96;&#96;\nDiv(class:\&quot;mt-4\&quot;) {\n  \&quot;content\&quot;\n}\n&#96;&#96;&#96;\n\n##### SIBLINGS\n&#96;&#96;&#96;\nDiv(...) { ... }\nP(...) { ... }\nImage(...)\n&#96;&#96;&#96;\n\n#### 6. Text Node Rules\n\n##### TEXT_NODE\n- 무조건 double-quote string\n- 줄바꿈 포함 금지\n- 텍스트 덩어리는 여러 줄로 쪼개면 안 됨\n\n##### VALID\n&#96;&#96;&#96;\n\&quot;Sign in to continue\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n\&quot;Hello\n World\&quot;    // 줄바꿈 포함\n&#96;&#96;&#96;\n\n#### 7. Node Termination Rules\n\n##### CLOSING_RULES\n- 블록 노드는 반드시 &#96;}&#96; 단독 줄로 닫는다\n- inline-only 노드는 종료 블록 없음\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;px-4\&quot;) {\n  P {\n    \&quot;Hello\&quot;\n  }\n  Image(src:\&quot;/logo.png\&quot;)\n}\n&#96;&#96;&#96;\n\n#### 8. Layout Grammar Formal Pattern\n\n##### LAYOUT_NODE_GRAMMAR\n&#96;&#96;&#96;\nNode:\n  Tag (Attributes?) (ChildrenBlock?)\n\nTag:\n  IDENTIFIER\n\nAttributes:\n  \&quot;(\&quot; AttributeList \&quot;)\&quot;\n\nAttributeList:\n  Attribute (\&quot;,\&quot; Attribute)*\n\nAttribute:\n  IDENTIFIER \&quot;:\&quot; STRING\n\nChildrenBlock:\n  \&quot;{\&quot; NewLine Indented(NodeOrText)+ \&quot;}\&quot;\n\nNodeOrText:\n  Node | STRING\n&#96;&#96;&#96;\n\n#### 9. Validation Rules\n\n1. layout은 트리 구조만 표현한다\n2. inline attributes만 허용\n3. 속성은 string-only\n4. children은 반드시 정해진 중첩 규칙을 따른다\n5. Node 이름은 PascalCase가 기본\n6. 문자열 children 외에는 모든 children은 Node여야 한다\n7. siblings 허용, 순서 보존\n\n#### 10. Example (Valid Layout Tree)\n\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;min-h-screen flex flex-col\&quot;) {\n    Header(class:\&quot;p-4 bg-gray-100\&quot;) {\n      H1 {\n        \&quot;Dashboard\&quot;\n      }\n    }\n\n    Main(class:\&quot;flex-1 p-6\&quot;) {\n      Card(class:\&quot;shadow\&quot;) {\n        P {\n          \&quot;Welcome back!\&quot;\n        }\n      }\n    }\n\n    Footer(class:\&quot;p-4 text-center\&quot;) {\n      \&quot;© 2025 The Bespoke\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto\&quot;) {\n    Navbar(class:\&quot;flex justify-between items-center p-4\&quot;) {\n      Logo(class:\&quot;text-xl font-bold\&quot;) {\n        \&quot;UIH\&quot;\n      }\n      Nav(class:\&quot;space-x-4\&quot;) {\n        Link(href:\&quot;/home\&quot;) {\n          \&quot;Home\&quot;\n        }\n        Link(href:\&quot;/about\&quot;) {\n          \&quot;About\&quot;\n        }\n      }\n    }\n\n    Content(class:\&quot;grid grid-cols-3 gap-6 p-6\&quot;) {\n      Sidebar(class:\&quot;col-span-1 bg-gray-50 p-4\&quot;) {\n        Menu {\n          \&quot;Dashboard\&quot;\n          \&quot;Settings\&quot;\n          \&quot;Profile\&quot;\n        }\n      }\n\n      Main(class:\&quot;col-span-2\&quot;) {\n        Article(class:\&quot;prose\&quot;) {\n          H2 {\n            \&quot;Getting Started\&quot;\n          }\n          P {\n            \&quot;Welcome to UIH DSL documentation.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- TagName에 숫자/특수문자 시작 시 토큰화 실패\n- 속성에 boolean/number 값 사용 시 파싱 오류\n- 텍스트 노드에 줄바꿈 포함 시 validation 실패\n- 노드 종료 &#96;}&#96; 누락 시 구문 오류\n- 중첩 깊이가 너무 깊을 경우 (권장 5레벨 초과) 경고\n- siblings 간 순서가 UI 의미에 영향 줄 경우 재검토\n\n---\n\n### Parser BNF Grammar\n\nTokenizer 위에서 동작하는 공식 문법 엔진 정의입니다. Token Stream을 Abstract Syntax Tree(AST)로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- Token Stream → Abstract Syntax Tree(AST)\n\n##### PARSER_MODE\n- strict non-ambiguous grammar\n- no recovery parsing (에러는 즉시 throw)\n- deterministic (LLM-friendly)\n- recursive descent parser 기반 구조\n\n#### 2. Entry Point\n\n##### Program\n&#96;&#96;&#96;\nProgram ::= MetaBlock StyleBlock ComponentsBlock? LayoutBlock ScriptBlock? EOF\n&#96;&#96;&#96;\n\n#### 3. Blocks\n\n##### Block_Definitions\n&#96;&#96;&#96;\nMetaBlock       ::= \&quot;meta\&quot; BlockBody(MetaProperty)\nStyleBlock      ::= \&quot;style\&quot; BlockBody(StyleProperty)\nComponentsBlock ::= \&quot;components\&quot; BlockBody(ComponentEntry)\nLayoutBlock     ::= \&quot;layout\&quot; LayoutBody\nScriptBlock     ::= \&quot;script\&quot; BlockBody(ScriptProperty)\n&#96;&#96;&#96;\n\n#### 4. Generic Block Body\n\n##### BlockBody\n&#96;&#96;&#96;\nBlockBody(&lt;T&gt;) ::= LBRACE NEWLINE (Indent &lt;T&gt; NEWLINE)* RBRACE\nIndent         ::= WHITESPACE WHITESPACE    # 2 spaces only\n&#96;&#96;&#96;\n\n#### 5. META Block Grammar\n\n##### MetaProperty\n&#96;&#96;&#96;\nMetaProperty ::= Identifier \&quot;:\&quot; MetaValue\nMetaValue    ::= STRING | NUMBER | BOOLEAN | EnumString\n&#96;&#96;&#96;\n\n##### Allowed_Meta_Keys\n- title, route, theme, description\n\n#### 6. STYLE Block Grammar\n\n##### StyleProperty\n&#96;&#96;&#96;\nStyleProperty ::= StyleKey \&quot;:\&quot; StyleValue\nStyleKey      ::= Identifier ( \&quot;.\&quot; Identifier )*\nStyleValue    ::= STRING | NUMBER | EnumString\n&#96;&#96;&#96;\n\n##### Notes\n- no nested blocks\n- no boolean\n- layout-like attributes 금지\n\n#### 7. COMPONENTS Block Grammar\n\n##### ComponentEntry\n&#96;&#96;&#96;\nComponentEntry ::= ComponentName\nComponentName  ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n##### NOTES\n- but no quotes, no values, one per line\n\n##### Examples\n&#96;&#96;&#96;\nCard\nButton\nInput\n&#96;&#96;&#96;\n\n#### 8. LAYOUT Block Grammar (Core)\n\n##### LayoutBody\n&#96;&#96;&#96;\nLayoutBody     ::= LBRACE NEWLINE Indent LayoutNodeList RBRACE\nLayoutNodeList ::= (LayoutNode NEWLINE)*\nLayoutNode     ::= Tag (Attributes)? (ChildrenBlock)?\nTag            ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n#### 9. Attributes Grammar\n\n##### Attributes\n&#96;&#96;&#96;\nAttributes    ::= LPAREN AttributeList RPAREN\nAttributeList ::= Attribute (COMMA Attribute)*\nAttribute     ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n#### 10. Children Block Grammar\n\n##### ChildrenBlock\n&#96;&#96;&#96;\nChildrenBlock ::= LBRACE NEWLINE Indent ChildrenList RBRACE\nChildrenList  ::= (Child NEWLINE)*\nChild         ::= LayoutNode | TEXT_STRING\n&#96;&#96;&#96;\n\n#### 11. SCRIPT Block Grammar\n\n##### ScriptProperty\n&#96;&#96;&#96;\nScriptProperty ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n##### Allowed_Script_Keys\n- onclick, onload, onsubmit, onmount, onchange\n\n&gt; 모든 script event identifier는 전부 소문자여야 하며 camelCase를 사용하지 않는다.\n\n#### 12. Value Grammars\n\n##### Value_Types\n&#96;&#96;&#96;\nSTRING     ::= \&quot;\\\&quot;\&quot; &lt;chars&gt; \&quot;\\\&quot;\&quot;\nNUMBER     ::= digits ( \&quot;.\&quot; digits )?\nBOOLEAN    ::= \&quot;true\&quot; | \&quot;false\&quot;\nEnumString ::= STRING   # validated in semantic phase\n&#96;&#96;&#96;\n\n#### 13. Identifier Grammars\n\n##### Identifiers\n&#96;&#96;&#96;\nIdentifier ::= [a-z][a-z0-9.]*\nTagName    ::= [A-Z][a-zA-Z0-9]*\n&#96;&#96;&#96;\n\n#### 14. Syntax Constraints (Formal)\n\n1. 모든 블록은 순서 고정\n2. 각 블록은 1회만 등장\n3. meta/style/layout은 필수\n4. components/script는 optional\n5. 들여쓰기 2 spaces only\n6. 속성(colon)은 반드시 &#96;&lt;id&gt;: &lt;value&gt;&#96;\n7. semicolon 금지\n8. layout만 nested structure 허용\n9. children 안에서는 TEXT_STRING 또는 LayoutNode만 허용\n10. parser는 ambiguous branch 금지 (LLM-safe)\n\n#### 15. Complete Example (BNF-valid)\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  radius.default: 8\n}\n\ncomponents {\n  Card\n  Button\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello world\&quot;\n    }\n  }\n}\n\nscript {\n  onclick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### BNF 구조 트리\n\n&#96;&#96;&#96;\nProgram\n├── MetaBlock\n│   ├── LBRACE\n│   ├── MetaProperty (title: \&quot;Home\&quot;)\n│   ├── MetaProperty (route: \&quot;/\&quot;)\n│   └── RBRACE\n├── StyleBlock\n│   ├── LBRACE\n│   ├── StyleProperty (color.primary: \&quot;#0E5EF7\&quot;)\n│   ├── StyleProperty (radius.default: 8)\n│   └── RBRACE\n├── ComponentsBlock\n│   ├── LBRACE\n│   ├── ComponentEntry (Card)\n│   ├── ComponentEntry (Button)\n│   └── RBRACE\n├── LayoutBlock\n│   ├── LBRACE\n│   ├── LayoutNode (Div)\n│   │   ├── Attributes (class:\&quot;p-4\&quot;)\n│   │   └── ChildrenBlock\n│   │       └── LayoutNode (P)\n│   │           └── ChildrenBlock\n│   │               └── TEXT_STRING (\&quot;Hello world\&quot;)\n│   └── RBRACE\n└── ScriptBlock\n    ├── LBRACE\n    ├── ScriptProperty (onClick: \&quot;submitForm\&quot;)\n    └── RBRACE\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 즉시 파싱 중단\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유지 (경고)\n- 들여쓰기 2 space 위반 시 구문 오류\n- layout 외 블록에서 중첩 시도 시 파싱 실패\n- 허용되지 않은 키 사용 시 semantic 오류 (parser 단계에서는 허용)\n- TEXT_STRING이 layout 외 컨텍스트에서 등장 시 오류\n\n---\n\n## AST Schema Definition\n\nParser BNF 위에서 생성되는 최종 AST 구조입니다. 모든 UIH DSL 요소가 이 스키마에 따라 구조화됩니다.\n\n### 1. AST Root\n\n#### ASTRoot\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Program\&quot;\n  meta: MetaNode\n  style: StyleNode\n  components: ComponentsNode | null\n  layout: LayoutNode\n  script: ScriptNode | null\n}\n&#96;&#96;&#96;\n\n### 2. Meta Node\n\n#### MetaNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Meta\&quot;\n  properties: MetaProperty[]\n}\n&#96;&#96;&#96;\n\n#### MetaProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;title\&quot;\n  value: string|number|boolean\n  location: Range     // from tokenizer\n}\n&#96;&#96;&#96;\n\n### 3. Style Node\n\n#### StyleNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Style\&quot;\n  properties: StyleProperty[]\n}\n&#96;&#96;&#96;\n\n#### StyleProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;color.primary\&quot;\n  value: string|number\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 4. Components Node\n\n#### ComponentsNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Components\&quot;\n  components: ComponentEntry[]\n}\n&#96;&#96;&#96;\n\n#### ComponentEntry\n&#96;&#96;&#96;typescript\n{\n  name: string        // e.g. \&quot;Card\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 5. Layout Node (Core Tree Structure)\n\n#### LayoutNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Layout\&quot;\n  children: LayoutElement[]     // top-level nodes inside layout block\n}\n&#96;&#96;&#96;\n\n#### LayoutElement\n&#96;&#96;&#96;typescript\nLayoutElement = LayoutComponent | LayoutText\n&#96;&#96;&#96;\n\n#### 5.1 Layout Component\n&#96;&#96;&#96;typescript\nLayoutComponent {\n  type: \&quot;Component\&quot;\n  tag: string                   // e.g. \&quot;Div\&quot;, \&quot;P\&quot;, \&quot;Header\&quot;\n  attributes: Attribute[]\n  children: LayoutElement[]     // nested structure\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### Attribute\n&#96;&#96;&#96;typescript\n{\n  key: string                   // lower-case only\n  value: string                 // inline string only\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### 5.2 Layout Text Node\n&#96;&#96;&#96;typescript\nLayoutText {\n  type: \&quot;Text\&quot;\n  value: string                 // raw text string\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 6. Script Node\n\n#### ScriptNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Script\&quot;\n  events: ScriptProperty[]\n}\n&#96;&#96;&#96;\n\n#### ScriptProperty\n&#96;&#96;&#96;typescript\n{\n  key: string                   // e.g. \&quot;onclick\&quot; (lowercase only)\n  value: string                 // e.g. \&quot;submitForm\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 7. Range Object (Source Location)\n\n#### Range\n&#96;&#96;&#96;typescript\n{\n  start: Position\n  end: Position\n}\n&#96;&#96;&#96;\n\n#### Position\n&#96;&#96;&#96;typescript\n{\n  line: number\n  column: number\n}\n&#96;&#96;&#96;\n\n### 8. Semantics Rules (Validation Layer)\n\n1. Meta keys must be from allowlist:\n   - title, route, theme, description\n\n2. Style keys may use dot notation but MUST be lowercase.\n\n3. Components must be names only, no properties.\n\n4. Layout:\n   - tag must be a valid TagName or valid identifier\n   - attributes must be string-only\n   - children: array of LayoutElement (component or text)\n\n5. Script:\n   - keys must be known event names\n   - value must be string (function name)\n\n6. No null children arrays. Use &#96;[]&#96; if empty.\n\n7. All nodes must have location data.\n\n### 9. Example: Full AST for a Simple Page\n\n#### Example DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### Generated AST (simplified)\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Home\&quot; },\n      { \&quot;key\&quot;: \&quot;route\&quot;, \&quot;value\&quot;: \&quot;/\&quot; }\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;color.primary\&quot;, \&quot;value\&quot;: \&quot;#0E5EF7\&quot; }\n    ]\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: [\n          { \&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;p-4\&quot; }\n        ],\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n### AST 구조 트리\n\n&#96;&#96;&#96;\nASTRoot (Program)\n├── meta (MetaNode)\n│   └── properties[] (MetaProperty)\n├── style (StyleNode)\n│   └── properties[] (StyleProperty)\n├── components (ComponentsNode | null)\n│   └── components[] (ComponentEntry)\n├── layout (LayoutNode)\n│   └── children[] (LayoutElement)\n│       ├── LayoutComponent\n│       │   ├── attributes[] (Attribute)\n│       │   └── children[] (LayoutElement)\n│       └── LayoutText\n└── script (ScriptNode | null)\n    └── events[] (ScriptProperty)\n&#96;&#96;&#96;\n\n### AST Examples\n\n#### 최소 AST 구조\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      {\&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Minimal\&quot;}\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: []\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Text\&quot;,\n        \&quot;value\&quot;: \&quot;Content\&quot;\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n#### 복잡한 레이아웃 AST\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Layout\&quot;,\n  \&quot;children\&quot;: [\n    {\n      \&quot;type\&quot;: \&quot;Component\&quot;,\n      \&quot;tag\&quot;: \&quot;Div\&quot;,\n      \&quot;attributes\&quot;: [\n        {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;container\&quot;}\n      ],\n      \&quot;children\&quot;: [\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Header\&quot;,\n          \&quot;attributes\&quot;: [],\n          \&quot;children\&quot;: [\n            {\n              \&quot;type\&quot;: \&quot;Component\&quot;,\n              \&quot;tag\&quot;: \&quot;H1\&quot;,\n              \&quot;attributes\&quot;: [],\n              \&quot;children\&quot;: [\n                {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Title\&quot;}\n              ]\n            }\n          ]\n        },\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Main\&quot;,\n          \&quot;attributes\&quot;: [\n            {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;content\&quot;}\n          ],\n          \&quot;children\&quot;: [\n            {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Main content\&quot;}\n          ]\n        }\n      ]\n    }\n  ]\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- location 정보 누락 시 AST 생성 실패\n- 빈 children 배열 대신 null 사용 시 validation 오류\n- 허용되지 않은 meta/style/script 키 사용 시 semantic 오류\n- LayoutComponent의 tag가 유효하지 않은 경우 오류\n- LayoutText에 빈 문자열 사용 시 경고\n- 중첩 깊이가 너무 깊을 경우 (10레벨 초과) 경고 또는 오류\n\n---\n\n## IR (Intermediate Representation) Specification\n\nAST → IR 변환 규칙을 정의합니다. Codegen 단계 직전의 \&quot;정규화된 구조\&quot;로, 플랫폼불문의 공통 인터페이스를 제공합니다.\n\n### 1. Overview\n\n#### IR_GOAL\n- AST의 복잡한 구조를 코드 생성하기 좋게 단순화\n- UI 컴포넌트 트리와 메타데이터를 정규화\n- 플랫폼불문(React/Next/Svelte) 공통 인터페이스로 변환\n- 모든 값은 최종적이고 확정된 형태만 유지\n\n#### INPUT\n- ASTRoot\n\n#### OUTPUT\n- IRRoot\n\n### 2. IR Root\n\n#### IRRoot\n&#96;&#96;&#96;typescript\n{\n  meta: IRMeta\n  style: IRStyle\n  components: IRComponents\n  layout: IRLayoutTree\n  script: IRScript\n}\n&#96;&#96;&#96;\n\n### 3. IRMeta (Final Document Metadata)\n\n#### IRMeta\n&#96;&#96;&#96;typescript\n{\n  title: string\n  route: string\n  theme: \&quot;light\&quot; | \&quot;dark\&quot;\n  description: string | null\n}\n&#96;&#96;&#96;\n\n#### Rules\n- missing values become null\n- enforce route starts with \&quot;/\&quot;\n\n### 4. IRStyle (Flattened Style Tokens)\n\n#### IRStyle\n&#96;&#96;&#96;typescript\n{\n  tokens: Record&lt;string, string | number&gt;\n}\n&#96;&#96;&#96;\n\n#### Examples\n&#96;&#96;&#96;typescript\n{\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n  \&quot;radius.default\&quot;: 8\n}\n&#96;&#96;&#96;\n\n#### Rules\n- dot-notation keys preserved\n- all values converted to primitive string/number\n- no validation here (semantic pass already done)\n\n### 5. IRComponents (Registered Component Map)\n\n#### IRComponents\n&#96;&#96;&#96;typescript\n{\n  list: string[]   // e.g. [\&quot;Card\&quot;, \&quot;Button\&quot;]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- duplicates removed\n- sorted alphabetically for deterministic output\n\n### 6. IRLayoutTree (Normalized UI Tree)\n\n#### IRLayoutTree\n&#96;&#96;&#96;typescript\n{\n  root: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### IRNode\n&#96;&#96;&#96;typescript\nIRNode = IRComponentNode | IRTextNode\n&#96;&#96;&#96;\n\n#### 6.1 IRComponentNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;component\&quot;\n  tag: string\n  attributes: Record&lt;string, string&gt;   // key:string only\n  children: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- attribute keys lower-case enforced\n- children always array\n- empty children =&gt; []\n\n#### 6.2 IRTextNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;text\&quot;\n  value: string\n}\n&#96;&#96;&#96;\n\n#### Rules\n- trimmed text preserved exactly\n- no newline allowed inside text\n\n### 7. IRScript (Event Map)\n\n#### IRScript\n&#96;&#96;&#96;typescript\n{\n  events: Record&lt;string, string&gt;   // onclick → \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Rules\n- all keys normalized to lower-case event names\n- camelCase event keys는 허용되지 않음 (validation 단계에서 차단)\n- event value must be string only\n- duplicates override earlier definitions\n\n### 8. AST → IR Mapping Rules\n\n1. **MetaNode → IRMeta**\n   - convert property array → object map\n   - apply default values if missing\n   - route must start with \&quot;/\&quot;\n\n2. **StyleNode → IRStyle**\n   - flatten list into tokens object\n   - preserve ordering but output sorted keys for determinism\n\n3. **ComponentsNode → IRComponents**\n   - convert component list → array\n   - remove duplicates\n   - sort alphabetically\n\n4. **LayoutNode → IRLayoutTree**\n   - recursively convert LayoutComponent → IRComponentNode\n   - convert LayoutText → IRTextNode\n   - inline attributes converted to plain object\n\n5. **ScriptNode → IRScript**\n   - property list flattened to event map\n   - enforce lower-case event names\n\n### 9. Example: Full IR Output\n\n#### DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### IR\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Home\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: null,\n    \&quot;description\&quot;: null\n  },\n\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n    }\n  },\n\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: []\n  },\n\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: { \&quot;class\&quot;: \&quot;p-4\&quot; },\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {}\n  }\n}\n&#96;&#96;&#96;\n\n### IR 구조 트리\n\n&#96;&#96;&#96;\nIRRoot\n├── meta (IRMeta)\n│   ├── title: string\n│   ├── route: string\n│   ├── theme: \&quot;light\&quot;|\&quot;dark\&quot;|null\n│   └── description: string|null\n├── style (IRStyle)\n│   └── tokens: Record&lt;string, string|number&gt;\n├── components (IRComponents)\n│   └── list: string[]\n├── layout (IRLayoutTree)\n│   └── root: IRNode[]\n│       ├── IRComponentNode\n│       │   ├── type: \&quot;component\&quot;\n│       │   ├── tag: string\n│       │   ├── attributes: Record&lt;string, string&gt;\n│       │   └── children: IRNode[]\n│       └── IRTextNode\n│           ├── type: \&quot;text\&quot;\n│           └── value: string\n└── script (IRScript)\n    └── events: Record&lt;string, string&gt;\n&#96;&#96;&#96;\n\n### IR Examples\n\n#### 간단한 IR 변환\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Simple\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: \&quot;light\&quot;,\n    \&quot;description\&quot;: null\n  },\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#000\&quot;,\n      \&quot;font.size\&quot;: 14\n    }\n  },\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: [\&quot;Button\&quot;]\n  },\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: {},\n        \&quot;children\&quot;: [\n          {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Content\&quot;}\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {\n      \&quot;onclick\&quot;: \&quot;handleClick\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 복잡한 중첩 레이아웃 IR\n&#96;&#96;&#96;json\n{\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Container\&quot;,\n        \&quot;attributes\&quot;: {\n          \&quot;class\&quot;: \&quot;flex flex-col min-h-screen\&quot;\n        },\n        \&quot;children\&quot;: [\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Header\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;p-4 bg-blue-600\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;H1\&quot;,\n                \&quot;attributes\&quot;: {},\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Dashboard\&quot;}\n                ]\n              }\n            ]\n          },\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Main\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;flex-1 p-6\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;Card\&quot;,\n                \&quot;attributes\&quot;: {\n                  \&quot;class\&quot;: \&quot;bg-white shadow-lg rounded\&quot;\n                },\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Welcome!\&quot;}\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- AST에 location 정보 누락 시 IR 변환 실패\n- route가 \&quot;/\&quot;로 시작하지 않을 경우 변환 시 강제 추가\n- 중복 컴포넌트 등록 시 알파벳 순 정렬로 중복 제거\n- 빈 children 배열을 null로 잘못 설정 시 []로 강제 변환\n- 텍스트 노드에 줄바꿈 포함 시 변환 중 제거 또는 오류\n- 이벤트 키 대소문자 혼재 시 소문자로 통일\n- 스타일 토큰 키 순서가 다를 경우 sorted keys로 결정적 출력 보장\n\n---\n\n## Codegen Rules\n\n### React/Next.js 15 Codegen\n\nIR을 기반으로 안정적인 UI 코드 생성 규칙입니다. React/Next.js 15 (App Router + RSC) 기준으로 IR을 실제 코드로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- IR을 기반으로 안정적인 UI 코드 생성\n- React/Next.js 15 (App Router + RSC) 기준\n- \&quot;디자인 시스템 없는 순수 Layout Tree\&quot;를 코드로 변환\n- 가능한 한 deterministic 하게 출력\n- 로직/상태/이벤트는 최소 수준으로만 개입\n\n##### INPUT\n- IRRoot\n\n##### OUTPUT\n- React Component Source Code (string)\n\n#### 2. Output Structure\n\n파일 구조는 다음 형태로 생성합니다:\n\n&#96;&#96;&#96;\n/page.tsx\n  - metadata (title, description)\n  - default export function Page()\n  - return(...) 내부에 layout tree 삽입\n\n/style-tokens.ts\n  - style.tokens flatten export\n\n/components/index.ts\n  - components registry export\n\n/script-events.ts\n  - event name string mapping export\n&#96;&#96;&#96;\n\n#### 3. Metadata Codegen\n\n##### UIH meta → Next.js metadata\n&#96;&#96;&#96;typescript\nIRMeta {\n  title: string\n  description: string\n}\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;typescript\nexport const metadata = {\n  title: \&quot;&lt;title&gt;\&quot;,\n  description: \&quot;&lt;description&gt;\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- description 없으면 필드 제외\n- theme는 metadata에 직접 쓰지 않음 (스타일토큰 용)\n\n#### 4. Style Token Codegen\n\n##### IRStyle { tokens }\n&#96;&#96;&#96;typescript\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;radius.default\&quot;: 8,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 키는 string 리터럴 그대로\n- numeric/string 그대로 출력\n- sorted keys for deterministic output\n\n#### 5. Component Registry Codegen\n\n##### IRComponents.list → export list\n&#96;&#96;&#96;typescript\nexport const components = {\n  Card,\n  Button,\n  Input,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 자동 import 하지 않음 (상위 시스템이 resolve)\n- keys는 PascalCase 유지\n- duplicates 제거 후 정렬\n\n#### 6. Layout Tree → JSX Codegen\n\n##### IRLayoutTree → React element tree\n\n##### 6.1 Component Node\n&#96;&#96;&#96;typescript\nIRComponentNode {\n  tag: \&quot;Div\&quot;\n  attributes: { class: \&quot;p-4\&quot; }\n  children: [...]\n}\n&#96;&#96;&#96;\n\n##### OUTPUT JSX\n&#96;&#96;&#96;jsx\n&lt;Div className=\&quot;p-4\&quot;&gt;\n  {children...}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n##### RULES\n- attribute.key \&quot;class\&quot; → \&quot;className\&quot;\n- attribute key는 그대로 lower-case 유지\n- value는 string literal\n- children length 0 이면 self-closing 금지 (always explicit block)\n- tag name 그대로 JSX 컴포넌트로 사용\n\n##### 6.2 Text Node\n&#96;&#96;&#96;typescript\nIRTextNode { value: \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;jsx\n{\&quot;Hello\&quot;}\n&#96;&#96;&#96;\n\n##### RULES\n- 텍스트는 JSX children 표현\n- 특수문자는 자동 escape\n\n#### 7. Script Event Codegen\n\n##### IRScript.events → export mapping\n&#96;&#96;&#96;typescript\nexport const eventHandlers = {\n  onClick: \&quot;submitForm\&quot;,\n  onLoad: \&quot;init\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- event 이름은 lower-case normalized\n- 값은 string (함수명)\n- 실제 JS 함수 body는 생성하지 않음\n- 나중 시스템이 자동 wire-up 함\n\n#### 8. Full Page Generation\n\n최종 page.tsx는 다음 구조를 따릅니다:\n\n&#96;&#96;&#96;typescript\nexport const metadata = { ... };\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen p-4\&quot;&gt;\n      &lt;P&gt;{\&quot;Hello\&quot;}&lt;/P&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### RULES\n- 최상위는 항상 &#96;&lt;Div&gt;&#96; 같은 Wrapper로 시작하지 않아도 됨\n- layout.root가 배열이면 Fragment로 감싼다\n- 코드 스타일은 2-space indent\n- 세미콜론 붙이지 않음 (Prettier 옵션 따라감)\n\n#### 9. Determinism Rules\n\n1. 속성 순서는 key 알파벳순 정렬\n2. children 순서는 DSL 입력 순서 그대로\n3. components 목록은 알파벳순 정렬\n4. styleTokens도 key 정렬\n5. eventHandlers key 정렬\n6. output JSX는 항상 multiline\n\n#### 10. Full Example (DSL → IR → JSX)\n\n##### DSL\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n##### JSX OUT\n&#96;&#96;&#96;typescript\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;p-4\&quot;&gt;\n      {\&quot;Hello\&quot;}\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n#### 11. Notes for Engine Integrators\n\n1. Codegen은 \&quot;순수 구조\&quot;만 책임진다\n   - 상태(state), fetch, useEffect 등은 지원하지 않음\n2. 이벤트 핸들러는 단순 라벨링 시스템\n3. 스타일 토큰은 UI 프레임워크에서 직접 해석\n4. React, Vue, Svelte 등 플랫폼별 코드젠 가능\n   - 플랫폼별 레이어는 분리\n\n#### Output Files 구조\n\n&#96;&#96;&#96;\nOutput Files\n├── page.tsx\n│   ├── metadata export\n│   ├── imports (components, styleTokens, eventHandlers)\n│   ├── Page() function\n│   └── JSX return (layout tree)\n├── style-tokens.ts\n│   └── styleTokens export\n├── components/index.ts\n│   └── components export\n└── script-events.ts\n    └── eventHandlers export\n&#96;&#96;&#96;\n\n#### Codegen Examples\n\n##### 전체 페이지 코드 생성 예시\n&#96;&#96;&#96;typescript\n// page.tsx\nexport const metadata = {\n  title: \&quot;Dashboard\&quot;,\n  description: \&quot;Main dashboard page\&quot;\n};\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen flex flex-col\&quot;&gt;\n      &lt;Header className=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n        &lt;H1&gt;\n          {\&quot;Dashboard\&quot;}\n        &lt;/H1&gt;\n      &lt;/Header&gt;\n      &lt;Main className=\&quot;flex-1 p-6\&quot;&gt;\n        &lt;Card className=\&quot;bg-white shadow-lg rounded-lg p-6\&quot;&gt;\n          &lt;P&gt;\n            {\&quot;Welcome back!\&quot;}\n          &lt;/P&gt;\n        &lt;/Card&gt;\n      &lt;/Main&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### 스타일 토큰 파일 예시\n&#96;&#96;&#96;typescript\n// style-tokens.ts\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;color.secondary\&quot;: \&quot;#6B7280\&quot;,\n  \&quot;color.accent\&quot;: \&quot;#F59E0B\&quot;,\n  \&quot;spacing.small\&quot;: 8,\n  \&quot;spacing.medium\&quot;: 16,\n  \&quot;spacing.large\&quot;: 24,\n  \&quot;border.radius\&quot;: 6,\n  \&quot;font.family\&quot;: \&quot;Inter\&quot;,\n  \&quot;font.size.base\&quot;: 16,\n  \&quot;shadow.default\&quot;: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n};\n&#96;&#96;&#96;\n\n##### 컴포넌트 레지스트리 예시\n&#96;&#96;&#96;typescript\n// components/index.ts\nexport const components = {\n  Button,\n  Card,\n  Input,\n  Modal,\n  Sidebar\n};\n&#96;&#96;&#96;\n\n##### 이벤트 핸들러 파일 예시\n&#96;&#96;&#96;typescript\n// script-events.ts\nexport const eventHandlers = {\n  onclick: \&quot;handleClick\&quot;,\n  onload: \&quot;initDashboard\&quot;,\n  onsubmit: \&quot;processForm\&quot;\n};\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- layout.root가 빈 배열일 경우 빈 Fragment 생성\n- 컴포넌트 이름이 JavaScript 예약어와 충돌 시 escaping 필요\n- 텍스트에 JSX 특수문자 포함 시 자동 escape\n- 중첩 깊이가 깊을 경우 코드 포맷팅 유지\n- import 경로 resolve 실패 시 상위 시스템에서 처리\n- styleTokens에 특수문자 키 포함 시 유효한 JS 객체 키로 변환\n\n---\n\n### Vue &amp; Svelte Codegen\n\nReact Codegen과 동일한 IR 기반으로 Vue와 Svelte 코드를 생성하는 규칙입니다. 플랫폼별 렌더링 규칙만 다르게 적용합니다.\n\n## SECTION A — Vue Codegen (SFC 기준)\n\n### GOAL\n- IR → .vue 파일 형태로 변환\n- &#96;&lt;template&gt;&#96; + &#96;&lt;script setup&gt;&#96; + &#96;&lt;style&gt;&#96; 구조 유지\n- 모든 로직은 배제하고 구조만 생성\n\n### OUTPUT FILE STRUCTURE\n&#96;&#96;&#96;\nMyPage.vue\n&#96;&#96;&#96;\n\n### 1. Top-Level Structure\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;!-- layout tree --&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport components...\n\nconst events = {...}\nconst styleTokens = {...}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* optional if needed */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Vue Template 규칙\n\n#### IRComponentNode(tag:\&quot;Div\&quot;, attributes, children)\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  &lt;!-- children --&gt;\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;className&#96; → &#96;class&#96;\n- attribute values: string only\n- children: 그대로 template로 변환\n- Fragment는 &#96;&lt;template&gt;&#96; 안에서 그냥 siblings로 출력\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello (그대로 text node)\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\neventHandlers {\n  onClick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Vue OUTPUT\n&#96;&#96;&#96;vue\n@click=\&quot;submitForm\&quot;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;onClick&#96; → &#96;@click&#96;\n- &#96;onChange&#96; → &#96;@change&#96;\n- &#96;onInput&#96; → &#96;@input&#96;\n- &#96;onLoad&#96; → &#96;@load&#96;\n- value는 함수 이름 string\n- 함수 구현은 생성하지 않음\n\n### 4. Component Registry (imports)\n&#96;&#96;&#96;javascript\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules\n- 속성(sorted)\n- imports(sorted)\n- children 순서 그대로\n- no semicolons\n- template 들여쓰기 2 spaces\n\n## SECTION B — Svelte Codegen (.svelte)\n\n### GOAL\n- Svelte 컴포넌트 파일 하나로 완성\n- &#96;&lt;script&gt;&#96; + markup 구조\n\n### OUTPUT STRUCTURE\n&#96;&#96;&#96;\nMyPage.svelte\n&#96;&#96;&#96;\n\n### 1. File Layout\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import components...\n  export let events = {...}\n  export let styleTokens = {...}\n&lt;/script&gt;\n\n&lt;!-- layout markup --&gt;\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  Hello\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* optional */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Svelte Markup\n\n#### IRComponentNode(tag, attributes, children)\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  {#if ... ?} (없음)\n  {children}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- 클래스는 &#96;class&#96;\n- 속성 문자열만\n- Self-closing 금지\n- children 재귀적 삽입\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\nIRScript:\nonClick → function name\n&#96;&#96;&#96;\n\n#### Svelte OUTPUT\n&#96;&#96;&#96;svelte\non:click={submitForm}\n&#96;&#96;&#96;\n\n#### Mapping\n&#96;&#96;&#96;\nonClick   → on:click\nonChange  → on:change\nonInput   → on:input\nonLoad    → on:load\n&#96;&#96;&#96;\n\n### 4. Components Import\n&#96;&#96;&#96;javascript\nimport Card from \&quot;./Card.svelte\&quot;;\nimport Button from \&quot;./Button.svelte\&quot;;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules (필수)\n\n1. import 순서는 알파벳 정렬\n2. attributes sorted\n3. event names lower-case\n4. children 순서 보존\n5. markup 들여쓰기 2 spaces\n\n## SECTION C — Cross-Platform Notes\n\n1. React / Vue / Svelte 모두 IR만 참조\n2. layout tree는 그대로 세 렌더러에서 재활용\n3. event handler는 단순 label → framework alias로 변환\n4. styleTokens는 컴파일러 외부 시스템이 처리\n5. components는 registry 기반으로 import만 생성\n\n## SECTION D — Example Conversion (Same IR → Vue/Svelte)\n\n### IR\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) { \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n### Vue Template\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Svelte Markup\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte 구조\n\n&#96;&#96;&#96;\nVue Output (.vue)\n├── &lt;template&gt;\n│   └── layout tree (Vue template syntax)\n├── &lt;script setup&gt;\n│   ├── component imports\n│   ├── events object\n│   └── styleTokens object\n└── &lt;style scoped&gt;\n    └── optional styles\n\nSvelte Output (.svelte)\n├── &lt;script&gt;\n│   ├── component imports\n│   ├── export let events = {...}\n│   └── export let styleTokens = {...}\n├── layout markup (Svelte syntax)\n└── &lt;style&gt;\n    └── optional styles\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte Examples\n\n#### Vue SFC 전체 예시\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n    &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n      &lt;H1&gt;\n        Dashboard\n      &lt;/H1&gt;\n    &lt;/Header&gt;\n    &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n      &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; @click=\&quot;handleCardClick\&quot;&gt;\n        &lt;P&gt;\n          Welcome back!\n        &lt;/P&gt;\n      &lt;/Card&gt;\n    &lt;/Main&gt;\n  &lt;/Div&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n\nconst events = {\n  handleCardClick: \&quot;handleCardClick\&quot;\n}\n\nconst styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;spacing.medium\&quot;: 16\n}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### Svelte 컴포넌트 전체 예시\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import Card from \&quot;./Card.svelte\&quot;;\n  import Button from \&quot;./Button.svelte\&quot;;\n\n  export let events = {\n    handleCardClick: \&quot;handleCardClick\&quot;\n  };\n\n  export let styleTokens = {\n    \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n    \&quot;spacing.medium\&quot;: 16\n  };\n&lt;/script&gt;\n\n&lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n  &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n    &lt;H1&gt;\n      Dashboard\n    &lt;/H1&gt;\n  &lt;/Header&gt;\n  &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n    &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; on:click={handleCardClick}&gt;\n      &lt;P&gt;\n        Welcome back!\n      &lt;/P&gt;\n    &lt;/Card&gt;\n  &lt;/Main&gt;\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### 이벤트 매핑 비교\n&#96;&#96;&#96;javascript\n// 동일한 IR 이벤트\n{\n  onClick: \&quot;handleClick\&quot;,\n  onChange: \&quot;handleChange\&quot;,\n  onLoad: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;vue\n&lt;!-- Vue --&gt;\n&lt;Button @click=\&quot;handleClick\&quot; @change=\&quot;handleChange\&quot; @load=\&quot;init\&quot;&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;svelte\n&lt;!-- Svelte --&gt;\n&lt;Button on:click={handleClick} on:change={handleChange} on:load={init}&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;jsx\n&lt;!-- React --&gt;\n&lt;Button onClick={handleClick} onChange={handleChange} onLoad={init}&gt;\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- Vue에서 컴포넌트 이름이 kebab-case로 변환 필요 시 자동 처리\n- Svelte에서 export let 구문이 예약어와 충돌 시 renaming\n- 이벤트 핸들러가 정의되지 않은 경우 플랫폼별 기본 동작\n- 스타일 토큰에 CSS 변수나 함수 포함 시 escaping\n- 중첩 컴포넌트 깊이가 깊을 경우 플랫폼별 최적화 적용\n- 텍스트 콘텐츠에 플랫폼별 특수문자 포함 시 자동 escape\n\n---\n\n## Examples\n\n### 완전한 UIH DSL 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;User Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main user dashboard with analytics\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  color.accent: \&quot;#F59E0B\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n  font.size.h1: 32\n  spacing.small: 8\n  spacing.medium: 16\n  spacing.large: 24\n  border.radius: 6\n  shadow.default: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n  Sidebar\n  Chart\n}\n\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto p-6\&quot;) {\n    Header(class:\&quot;mb-8\&quot;) {\n      Div(class:\&quot;flex justify-between items-center\&quot;) {\n        H1(class:\&quot;text-3xl font-bold\&quot;) {\n          \&quot;Dashboard\&quot;\n        }\n        Button(class:\&quot;px-4 py-2 bg-blue-600 text-white rounded\&quot;) {\n          \&quot;New Report\&quot;\n        }\n      }\n    }\n\n    Div(class:\&quot;grid grid-cols-3 gap-6\&quot;) {\n      Card(class:\&quot;col-span-2\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Analytics Overview\&quot;\n        }\n        Chart(class:\&quot;w-full h-64\&quot;)\n      }\n\n      Card(class:\&quot;col-span-1\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Quick Stats\&quot;\n        }\n        Div(class:\&quot;space-y-4\&quot;) {\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Total Users\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;1,234\&quot;\n            }\n          }\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Active Sessions\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;89\&quot;\n            }\n          }\n        }\n      }\n    }\n\n    Sidebar(class:\&quot;mt-8\&quot;) {\n      H3(class:\&quot;text-lg mb-4\&quot;) {\n        \&quot;Recent Activity\&quot;\n      }\n      Div(class:\&quot;space-y-2\&quot;) {\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;User john@example.com logged in\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;New report generated\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;System backup completed\&quot;\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onLoad: \&quot;initDashboard\&quot;\n  onClick: \&quot;handleButtonClick\&quot;\n  onRefresh: \&quot;refreshData\&quot;\n}\n&#96;&#96;&#96;\n\n### 최소 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Minimal Page\&quot;\n  route: \&quot;/minimal\&quot;\n  theme: \&quot;light\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  spacing.unit: 12\n}\n\nlayout {\n  Div(class:\&quot;min-h-screen flex items-center justify-center bg-gray-50\&quot;) {\n    \&quot;Coming soon\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n### Form 중심 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Sign Up\&quot;\n  route: \&quot;/signup\&quot;\n  theme: \&quot;light\&quot;\n  description: \&quot;Create a new account\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#2563EB\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n}\n\ncomponents {\n  Form\n  Input\n  Button\n  Alert\n}\n\nlayout {\n  Section(class:\&quot;min-h-screen flex items-center justify-center bg-gray-100\&quot;) {\n    Form(class:\&quot;w-full max-w-md space-y-6 bg-white p-8 rounded-xl shadow-lg\&quot;) {\n      H2(class:\&quot;text-2xl font-semibold text-gray-900\&quot;) {\n        \&quot;Create your account\&quot;\n      }\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;email\&quot;, placeholder:\&quot;Enter email\&quot;)\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;password\&quot;, placeholder:\&quot;Enter password\&quot;)\n      Button(class:\&quot;w-full bg-blue-600 text-white py-3 rounded-lg\&quot;) {\n        \&quot;Sign up\&quot;\n      }\n      Alert(class:\&quot;text-sm text-gray-500 text-center\&quot;) {\n        \&quot;By signing up you agree to our terms\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onSubmit: \&quot;handleSignup\&quot;\n  onLoad: \&quot;prefillFromInvite\&quot;\n}\n&#96;&#96;&#96;\n\n### 콘텐츠 피드 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Creator Feed\&quot;\n  route: \&quot;/feed\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Realtime creator activity feed\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#22D3EE\&quot;\n  color.background: \&quot;#0F172A\&quot;\n  font.family: \&quot;Space Grotesk\&quot;\n  spacing.medium: 20\n  radius.card: 12\n}\n\ncomponents {\n  Shell\n  Sidebar\n  Feed\n  FeedItem\n  Avatar\n  Badge\n}\n\nlayout {\n  Shell(class:\&quot;min-h-screen bg-slate-950 text-slate-100\&quot;) {\n    Sidebar(class:\&quot;w-64 border-r border-slate-800 p-6 space-y-6\&quot;) {\n      H1(class:\&quot;text-xl font-semibold tracking-tight\&quot;) {\n        \&quot;Creator Hub\&quot;\n      }\n      Badge(class:\&quot;inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 text-slate-200\&quot;) {\n        \&quot;Live updates\&quot;\n      }\n    }\n    Feed(class:\&quot;flex-1 p-8 space-y-6\&quot;) {\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-cyan-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;heymina.studio\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-300\&quot;) {\n              \&quot;New drop\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Dropped a limited neon kit — 120 packs sold out in 3 minutes.\&quot;\n          }\n        }\n      }\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-pink-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;luvv.wav\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-cyan-500/10 text-cyan-300\&quot;) {\n              \&quot;Stream recap\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Hit 18,245 live viewers tonight — chat requested a synthwave encore.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onRefresh: \&quot;fetchLatestFeed\&quot;\n  onClick: \&quot;openCreatorProfile\&quot;\n}\n&#96;&#96;&#96;\n\n---\n\n## Version\n\n- **Version**: 1.0.0\n- **Last Update**: 2025-11-18\n- **Change Summary**: Complete guide consolidating all UIH DSL specifications\n\n---\n\n## 문서 끝\n\n이 문서는 UIH DSL의 모든 스펙을 \&quot;생략 없이\&quot; 하나의 파일로 통합한 완전판입니다. Foundation Layer부터 Codegen까지 전 과정을 포함하며, LLM이 UI를 정확하게 선언할 수 있도록 설계된 모든 규칙이 담겨 있습니다.\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Checking eventHandlers snippet around line 2245**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating event handlers to onclick/onload**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;083cc908-3280-446d-a254-529c8b6f1663&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  &#96;&#96;&#96;typescript\n  export const eventHandlers = {\n-   onClick: \&quot;submitForm\&quot;,\n-   onLoad: \&quot;init\&quot;,\n+   onclick: \&quot;submitForm\&quot;,\n+   onload: \&quot;init\&quot;,\n  };\n  &#96;&#96;&#96;&quot;,
        &quot;oldStart&quot;: 2251,
        &quot;newStart&quot;: 2251,
        &quot;oldLines&quot;: 6,
        &quot;newLines&quot;: 6,
        &quot;linesRemoved&quot;: 2,
        &quot;linesAdded&quot;: 2
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;,
  &quot;contentsAfterEdit&quot;: &quot;# UIH DSL — Complete Guide (생략 없는 완전판)\n\n## Table of Contents\n\n1. [Overview](#overview)\n2. [Philosophy &amp; Design Principles](#philosophy--design-principles)\n3. [Foundation Layer](#foundation-layer)\n4. [Tokenizer Specification](#tokenizer-specification)\n5. [Grammar](#grammar)\n   - [Block Grammar](#block-grammar)\n   - [Property Grammar](#property-grammar)\n   - [Layout Tree Grammar](#layout-tree-grammar)\n   - [Parser BNF Grammar](#parser-bnf-grammar)\n6. [AST Schema Definition](#ast-schema-definition)\n7. [IR (Intermediate Representation) Specification](#ir-intermediate-representation-specification)\n8. [Codegen Rules](#codegen-rules)\n   - [React/Next.js 15 Codegen](#reactnextjs-15-codegen)\n   - [Vue &amp; Svelte Codegen](#vue--svelte-codegen)\n9. [Examples](#examples)\n10. [Version](#version)\n\n---\n\n## Overview\n\nUIH DSL (Universal Interface Hierarchy Domain Specific Language) v2는 **\&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;**를 목표로 하는 도메인 특화 언어입니다.\n\n### 핵심 목표\n- LLM이 UI 구조를 **정확하게** 선언할 수 있도록 설계\n- 모호성 제거 및 결정성(determinism) 보장\n- 사람보다 AI가 더 효과적으로 사용 가능한 DSL\n- UI 구조의 선언적 표현에 집중\n\n### 아키텍처 흐름\n&#96;&#96;&#96;\nDSL 문자열 → Tokenizer → Parser → AST → IR → Codegen → React/Vue/Svelte 코드\n&#96;&#96;&#96;\n\n### 주요 특징\n- 한 줄에 하나의 의미만 (One-intent-per-line)\n- 선택적 문법 금지 - 모든 것이 명시적\n- 쌍따옴표만 허용, 세미콜론 없음\n- 주석 지원 안 함 (모호성 제거)\n- 고정 블록 순서: meta → style → components → layout → script\n\n---\n\n## Philosophy &amp; Design Principles\n\nUIH DSL은 \&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;를 목표로 하는 도메인 특화 언어입니다. 사람보다 LLM이 더 효과적으로 사용할 수 있도록 설계되었으며, UI 구조의 선언적 표현에 집중합니다.\n\n### 1. LLM 친화적 설계 원칙\n\nLLM이 읽고 쓰기 편한 DSL을 지향합니다. 구조는 최대한 명확하고 모호성이 없으며, 선택적 문법을 금지합니다. LLM이 패턴을 쉽게 반복할 수 있는 형태로 자연어 번역 난이도를 낮췄습니다.\n\n### 2. 선언적 UI 설계\n\nUI는 로직 기반보다 구조 기반으로 설계합니다. \&quot;무엇을 만든다\&quot;에 집중하며 \&quot;어떻게 만든다\&quot;는 Codegen이 담당합니다. 상태, 이벤트, 애니메이션은 추상화 계층으로 밀어냅니다.\n\n### 3. 한 줄 한 의미 원칙 (One-intent-per-line)\n\n한 라인에 하나의 의미만 허용합니다. 한 줄에 두 개 의미를 섞으면 LLM이 실수할 가능성이 높아집니다.\n\n#### 좋은 예: 한 줄 한 의미\n&#96;&#96;&#96;dsl\nmeta:\n  title: \&quot;Home\&quot;\n\nmeta:\n  route: \&quot;/\&quot;\n&#96;&#96;&#96;\n\n#### 나쁜 예: 한 줄 다중 의미 (금지)\n&#96;&#96;&#96;dsl\nmeta: title: \&quot;Home\&quot;, route: \&quot;/\&quot;  # 잘못된 예\n&#96;&#96;&#96;\n\n### 4. 고정 블록 순서\n\n블록 구조는 **meta → style → components → layout → script** 순서를 유지합니다. 이 순서는 LLM이 외우기 쉽고 Codegen의 예측 가능성과 AST의 결정성을 보장합니다.\n\n### 5. 최소 표현, 최대 의미\n\nDSL은 짧고 규칙적이어야 합니다. CSS-like verbose, YAML 계층 증가, JSX 로직 섞임을 금지합니다. 의미 전달에 집중하는 최소 선언적 DSL입니다.\n\n### 6. 오류 제로 문법\n\n\&quot;AI가 틀릴 수 없는 언어\&quot;를 목표로 합니다. 쌍따옴표만 허용하고 세미콜론 없이 콜론만 사용합니다. 모든 키는 고정된 string literal이며 optional field를 최소화합니다.\n\n### 7. AST 1:1 매핑\n\n모든 UI 요소가 AST에 직접 매핑됩니다. meta 블록 → MetaNode, style 블록 → StyleNode, layout 블록 → LayoutTree로 변환됩니다.\n\n### 8. 기계 친화적 우선\n\n\&quot;사람이 읽으면 조금 불편할 것\&quot; 정도가 적정 수준입니다. 사람 UX보다 AI 정확성을 우선합니다.\n\n---\n\n## Foundation Layer\n\nUIH DSL의 가장 낮은 레벨 사양입니다. Character부터 Ordering까지의 기본 규칙을 정의하며, LLM이 실수할 수 없는 엄격한 문법을 제공합니다.\n\n### 1. Character Layer (문자 규칙)\n\n#### ALLOWED_CHARACTERS\n- a~z (lowercase alphabets)\n- 0~9 (digits)\n- hyphen (-)\n- underscore (_)\n- space ( )\n- newline (\\n)\n- braces: { }\n- colon (:)\n- double-quote (\&quot;)\n\n#### DISALLOWED_CHARACTERS\n- single-quote (&#39;)\n- semicolon (;)\n- parentheses ()\n- backtick (&#96;)\n- tab (\\t)\n- CRLF (\\r\\n)\n\n#### NEWLINE\n- always LF (\\n)\n- CRLF not supported\n\n### 2. Indentation Layer (들여쓰기 규칙)\n\n#### INDENTATION\n- exactly 2 spaces ONLY\n- tabs NOT allowed\n- indentation increases only inside a block\n- indentation does not imply hierarchy (not YAML)\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {           // ❌ 탭 사용 금지\n  title: \&quot;Home\&quot;  // ✅ 정확히 2 space\n}\n&#96;&#96;&#96;\n\n### 3. Token Layer (토큰 기본 규칙)\n\n#### TOKENS\n- IDENTIFIER = &#96;[a-z][a-z0-9.]*&#96;\n- STRING = &#96;\&quot;[^\&quot;\\\\]*(?:\\\\.[^\&quot;\\\\]*)*\&quot;&#96; (supports &#96;\\\&quot;&#96; escape)\n- NUMBER = &#96;\\d+(?:\\.\\d+)?&#96;\n- LBRACE = &#96;{&#96;\n- RBRACE = &#96;}&#96;\n- COLON = &#96;:&#96;\n- NEWLINE = &#96;\\n&#96;\n- WHITESPACE = single space\n\n#### IDENTIFIER_RULES\n- lowercase only\n- dot notation allowed (e.g. &#96;color.primary&#96;)\n- do NOT mix hyphens inside identifiers (LLM error-prone)\n\n#### STRING_RULES\n- must use double quotes only\n- escaping uses &#96;\\\&quot;&#96;\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {\n  color.primary: \&quot;#fff\&quot;    // ✅ dot notation 허용\n  label: \&quot;Click \\\&quot;here\\\&quot;\&quot;  // ✅ escape 허용\n  width: 100.5            // ✅ 소수 허용\n}\n&#96;&#96;&#96;\n\n### 4. Comment Layer (코멘트)\n\n#### COMMENTS\n- comments NOT supported\n- any attempt to use &#96;//&#96; or &#96;#&#96; is invalid\n- purpose: reduce ambiguity for LLM\n\n### 5. Statement Layer (기본 문장 구조)\n\n#### STATEMENT_TYPES\n- Block Declaration\n- Property Declaration\n\n#### BLOCK_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt; {\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n#### PROPERTY_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n#### SEMICOLON\n- NOT allowed (never used)\n\n### 6. Block Layer (블록 기본 규칙)\n\n#### BLOCK_STRUCTURE\n&#96;&#96;&#96;\nblockName {\n  property: \&quot;value\&quot;\n  property: 123\n  property: true\n}\n&#96;&#96;&#96;\n\n#### BLOCK_RULES\n- block cannot contain nested blocks\n- ONLY layout block may contain nested layout nodes\n\n### 7. Ordering Layer (순서 강제)\n\n#### BLOCK_ORDER\n1. meta\n2. style\n3. components (optional)\n4. layout\n5. script (optional)\n\n#### RULE\n- if a block appears, must follow this order\n- missing blocks are allowed except meta/style/layout\n\n### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  primary-color: \&quot;#111\&quot;\n}\n\ncomponents {\n  Button {\n    variant: \&quot;primary\&quot;\n  }\n}\n\nlayout {\n  Container {\n    children: \&quot;Button\&quot;\n  }\n}\n\nscript {\n  // optional script\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단\n- 잘못된 들여쓰기 발견 시 구문 오류\n- 코멘트 시도 시 즉시 무효 처리\n- 블록 순서 위반 시 파싱 실패\n- layout 외 중첩 블록 시도 시 오류\n\n---\n\n## Tokenizer Specification\n\nFoundation Layer + Grammar Layers 기반의 공식 토큰화 규칙입니다. DSL 문자열을 균일한 Token 리스트로 변환하며, 모든 파싱의 기반이 됩니다.\n\n### 1. Tokenizer Overview\n\n#### PURPOSE\n- DSL 문자열을 균일한 Token 리스트로 변환\n- 모호성 없는 deterministic token stream 생성\n- 모든 파싱은 이 토큰 리스트 기반으로 진행\n\n#### INPUT\n- LF 기반의 DSL 문자열\n\n#### OUTPUT\n- 순차적 Token 배열\n\n### 2. Token Types\n\n#### TOKENS\n- &#96;IDENTIFIER&#96; - meta, title, color.primary, class 등\n- &#96;STRING&#96; - \&quot;Hello\&quot;\n- &#96;NUMBER&#96; - 0, 12, 0.8\n- &#96;BOOLEAN&#96; - true, false\n- &#96;LBRACE&#96; - {\n- &#96;RBRACE&#96; - }\n- &#96;LPAREN&#96; - (\n- &#96;RPAREN&#96; - )\n- &#96;COLON&#96; - :\n- &#96;COMMA&#96; - ,\n- &#96;NEWLINE&#96; - \\n\n- &#96;WHITESPACE&#96; - space (only used between tokens)\n- &#96;TEXT_STRING&#96; - layout children string ONLY (disambiguation)\n- &#96;EOF&#96; - end of file marker\n\n### 3. Identifier Detection\n\n#### IDENTIFIER_RULES\n- regex: &#96;^[a-z][a-z0-9.]*$&#96;\n- lowercase only\n- dot notation allowed\n- hyphens, underscores 금지\n\n#### TAGNAME_RULES\n- starts with uppercase letter\n- subsequent chars: &#96;[a-zA-Z0-9]&#96;\n- TagName (e.g. Div, Header) 구분용\n\n#### TAGNAME_EXAMPLES\n&#96;&#96;&#96;\nDiv\nSection\nImage\nH1\n&#96;&#96;&#96;\n\n### 4. String Token Rules\n\n#### STRING\n- starts with &#96;\&quot;&#96;\n- ends with &#96;\&quot;&#96;\n- inside supports &#96;\\\&quot;&#96;\n- no multi-line\n\n#### TEXT_STRING\n- STRING과 동일한 문법\n- 단, layout children context에서만 등장\n- Parser에서 context-aware로 구분\n\n### 5. Number Token Rules\n\n#### NUMBER\n- regex: &#96;^[0-9]+(\\.[0-9]+)?$&#96;\n- no negative numbers\n- no units (px, rem 등)\n\n### 6. Boolean Token Rules\n\n#### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n- strictly lowercase\n\n### 7. Brace / Symbol Tokens\n\n#### SYMBOL_TOKENS\n- &#96;LBRACE&#96;: &#96;{&#96;\n- &#96;RBRACE&#96;: &#96;}&#96;\n- &#96;LPAREN&#96;: &#96;(&#96;\n- &#96;RPAREN&#96;: &#96;)&#96;\n- &#96;COLON&#96;: &#96;:&#96;\n- &#96;COMMA&#96;: &#96;,&#96;\n\n#### NOTES\n- semicolon NOT allowed\n- backtick NOT allowed\n\n### 8. Whitespace / Newline Rules\n\n#### WHITESPACE\n- single space &#96;&#39; &#39;&#96;\n- no tabs\n- no multi-space sequences except indentation (2 spaces)\n\n#### NEWLINE\n- LF only\n- CRLF invalid\n\n### 9. Layout Context Rules (Critical)\n\n#### LAYOUT_MODE\nTokenizer enters layout-mode when encountering:\n&#96;&#96;&#96;\nlayout { … }\n&#96;&#96;&#96;\n\n#### CONTEXT_SWITCH\n- after TagName(\n- before encountering next node or text\n\n#### INSIDE_LAYOUT_BLOCK\n- children detection required\n- plain strings must become TEXT_STRING token\n- siblings separated by NEWLINE\n\n#### EXAMPLE\n&#96;&#96;&#96;\n\&quot;Welcome\&quot; → TEXT_STRING inside layout\n&#96;&#96;&#96;\n\n### 10. Tokenization Algorithm (High-Level)\n\n1. iterate through chars\n2. skip whitespace unless meaningful (indent)\n3. detect IDENTIFIER or TAGNAME\n4. detect STRING (with escape)\n5. detect NUMBER\n6. detect BOOLEAN\n7. detect braces &#96;{ }&#96;\n8. detect parentheses &#96;( )&#96;\n9. detect colon &#96;:&#96; or comma &#96;,&#96;\n10. detect newline &#96;\\n&#96;\n11. maintain context stack:\n    - normal\n    - inside layout block\n    - inside attributes\n12. output final EOF token\n\n### 11. Example Token Stream\n\n#### INPUT\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### OUTPUT_TOKENS\n&#96;&#96;&#96;\nIDENTIFIER(layout)\nLBRACE\nNEWLINE\nTAGNAME(Div)\nLPAREN\nIDENTIFIER(class)\nCOLON\nSTRING(\&quot;p-4\&quot;)\nRPAREN\nLBRACE\nNEWLINE\nTEXT_STRING(\&quot;Hello\&quot;)\nNEWLINE\nRBRACE\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Token Stream Examples\n\n#### 기본 블록 토큰화\n&#96;&#96;&#96;dsl\nmeta {\n  title: \&quot;Home\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(meta)\nLBRACE\nNEWLINE\nIDENTIFIER(title)\nCOLON\nSTRING(\&quot;Home\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n#### 스타일 블록 토큰화\n&#96;&#96;&#96;dsl\nstyle {\n  color.primary: \&quot;#fff\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(style)\nLBRACE\nNEWLINE\nIDENTIFIER(color.primary)\nCOLON\nSTRING(\&quot;#fff\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단 및 오류 반환\n- CRLF 줄바꿈 발견 시 LF로 변환 또는 오류\n- 탭 문자 발견 시 공백 변환 또는 오류\n- STRING에서 미닫힘 따옴표 시 오류\n- NUMBER에 음수나 단위 포함 시 오류\n- layout 외 컨텍스트에서 TEXT_STRING 시도 시 오류\n- TAGNAME 규칙 위반 (소문자 시작) 시 IDENTIFIER로 처리\n\n---\n\n## Grammar\n\n### Block Grammar\n\nUIH DSL의 최상위 구조를 정의하는 Block Grammar Layer입니다. Foundation Layer 바로 위에 위치하며, 5개 블록의 선언, 순서, 내용 규칙을 명시합니다.\n\n#### 1. Block Definitions (5개 블록)\n\n##### BLOCKS\n- meta\n- style\n- components (optional)\n- layout\n- script (optional)\n\n##### RULES\n- 블록은 반드시 이 순서를 따라야 함: meta → style → components → layout → script\n- meta, style, layout은 필수\n- components, script는 선택\n- 각 블록은 정확히 한 번만 등장\n- 중복 블록 금지\n\n#### 2. Block Syntax (기본 문법)\n\n##### BLOCK_SYNTAX\n&#96;&#96;&#96;\n&lt;blockName&gt; {\n  &lt;property&gt;: &lt;value&gt;\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n&#96;&#96;&#96;\n\n##### SYNTAX_COMPONENTS\n- 블록 시작: IDENTIFIER + &#96; {&#96;\n- 블록 끝: &#96;}&#96; 단독 줄\n\n#### 3. Block Content Rules\n\n##### 공통 규칙\n- 블록 내부에는 property statements만 존재\n- block 내부에 block 중첩 금지\n- 단, layout 블록만 예외적으로 UI tree 구조 허용\n\n##### PROPERTY_RULE\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### VALUE_TYPES\n- string\n- number\n- boolean\n- enum-like literals (string 값)\n- list (향후 정의)\n\n#### 4. Block-Specific Rules\n\n##### (1) META BLOCK\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Page title\&quot;\n  route: \&quot;/path\&quot;\n  theme: \&quot;light\&quot;|\&quot;dark\&quot;\n}\n&#96;&#96;&#96;\n\n**META_RESTRICTIONS:**\n- meta는 UI 문서의 metadata만 포함\n- layout 정보나 스타일 정보 포함 금지\n\n##### (2) STYLE BLOCK\n&#96;&#96;&#96;\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n}\n&#96;&#96;&#96;\n\n**STYLE_RESTRICTIONS:**\n- key는 dot notation 사용 가능\n- 값은 string 또는 number\n- layout 관련 속성 금지\n- theme override 불가\n\n##### (3) COMPONENTS BLOCK (optional)\n&#96;&#96;&#96;\ncomponents {\n  Card\n  Button\n  Input\n}\n&#96;&#96;&#96;\n\n**COMPONENTS_RULES:**\n- 등록할 컴포넌트 이름만 줄 단위로 나열\n- 중첩 구조 없음\n- 속성 없음\n- 문자열 아님: &#96;\&quot;Card\&quot;&#96; 금지, &#96;Card&#96;만 허용\n\n##### (4) LAYOUT BLOCK\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n**LAYOUT_RULES:**\n- 유일하게 중첩 구조 허용\n- 노드 문법은 별도 Layer에서 정의\n- property는 inline attribute 형태 가능\n- block-like structure 유지\n\n##### (5) SCRIPT BLOCK (optional)\n&#96;&#96;&#96;\nscript {\n  onclick: \&quot;submitForm\&quot;\n  onload: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n**SCRIPT_RESTRICTIONS:**\n- event/behavior mapping만 정의\n- JS code 삽입 금지\n- inline function 금지\n- event identifier는 반드시 lowercase (camelCase 금지)\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n  spacing.unit: 8\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n}\n\nlayout {\n  Div(class:\&quot;container mx-auto p-4\&quot;) {\n    Card(class:\&quot;bg-white shadow-lg\&quot;) {\n      Button(onclick:\&quot;handleSubmit\&quot;) {\n        \&quot;Submit\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;processForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 파싱 실패\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유효 (경고)\n- components/script 외 블록에서 중첩 시도 시 오류\n- layout 외 블록에서 attribute 사용 시 오류\n\n---\n\n### Property Grammar\n\nUIH DSL 안정성의 핵심인 Property Grammar Layer입니다. Block Grammar 위에 쌓이며, 속성 선언, 값 타입, 범위 규칙을 정의합니다.\n\n#### 1. Property Declaration Syntax\n\n##### PROPERTY_SYNTAX\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\nradius.default: 8\nenabled: true\n&#96;&#96;&#96;\n\n##### RULES\n- identifier는 반드시 lowercase\n- dot notation 허용 (&#96;color.primary&#96; 등)\n- colon(:) 뒤에는 반드시 space 1개\n- value는 줄 끝까지\n\n#### 2. Identifier Rules\n\n##### IDENTIFIER\n- 패턴: &#96;[a-z][a-z0-9.]*&#96;\n- 소문자만 허용\n- 숫자는 뒤쪽에만 허용\n- dot(.)은 중첩 속성 의미로만 사용\n- hyphen 금지 (LLM 오류 방지)\n- underscore 금지\n\n##### VALID\n&#96;&#96;&#96;\ncolor.primary\nfont.size\nborder.width\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nColor.Primary    // 대문자\nfont-size        // hyphen\nfont_size        // underscore\nprimary2.color   // 숫자 앞쪽\n&#96;&#96;&#96;\n\n#### 3. Value Types (5가지)\n\n##### VALUE_TYPES\n1. STRING\n2. NUMBER\n3. BOOLEAN\n4. ENUM-LIKE (string 기반)\n5. LIST (여러 값 나열, 줄 단위)\n\n#### 4. String Value Rules\n\n##### STRING\n- 무조건 double-quote 사용\n- 내부에 &#96;\&quot;&#96; 포함 시 &#96;\\\&quot;&#96;로 escape\n- single-quote 절대 금지\n\n##### VALID\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\ndescription: \&quot;He said \\\&quot;ok\\\&quot;\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\ntitle: &#39;Home&#39;      // single-quote\nname: \&quot;Home\&quot;       // curly quotes\n&#96;&#96;&#96;\n\n#### 5. Number Value Rules\n\n##### NUMBER\n- 정수 또는 소숫점 가능\n- 음수는 허용하지 않음\n- 단위(px 등) 금지 → unitless 구조\n\n##### VALID\n&#96;&#96;&#96;\nradius: 12\nopacity: 0.85\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nradius: -4     // 음수\nwidth: 10px    // 단위 포함\n&#96;&#96;&#96;\n\n#### 6. Boolean Value Rules\n\n##### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nenabled: true\nvisible: false\n&#96;&#96;&#96;\n\n#### 7. Enum-like String Rules\n\n##### ENUM_STRING\n- 문자열이지만 값이 고정된 타입처럼 쓰는 케이스\n- allowed values는 별도 block schema마다 정의\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntheme: \&quot;light\&quot; | \&quot;dark\&quot;\nsize: \&quot;sm\&quot; | \&quot;md\&quot; | \&quot;lg\&quot;\n&#96;&#96;&#96;\n\n#### 8. List Value (Block-like list)\n\n##### LIST\n- 각 항목은 줄 단위로 입력\n- 대괄호 &#96;[]&#96; 문법 없음 (LLM 오류 방지)\n- 문자열/식별자 혼용 가능\n\n##### SYNTAX\n&#96;&#96;&#96;\nitems {\n  \&quot;one\&quot;\n  \&quot;two\&quot;\n  \&quot;three\&quot;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- list block 내부에는 property 없음\n- indent 2 spaces 유지\n\n##### EXAMPLE\n&#96;&#96;&#96;\ntags {\n  \&quot;news\&quot;\n  \&quot;feature\&quot;\n  \&quot;announcement\&quot;\n}\n&#96;&#96;&#96;\n\n#### 9. Property Scope Rules (Block별 허용 속성 경계)\n\n##### META_SCOPE\n- meta는 UI metadata만 포함\n- route, title, theme, description 등\n\n##### STYLE_SCOPE\n- 색상, 폰트, radius 등 UI 스타일만\n- layout 속성 금지 (width, height 등은 layout block에서만)\n\n##### COMPONENTS_SCOPE\n- property 없음 (등록만)\n\n##### LAYOUT_SCOPE\n- inline attribute만 (class, id, ref 등)\n- 값은 무조건 string\n- boolean/number 사용 금지\n\n##### SCRIPT_SCOPE\n- event mapping 전용\n- 값은 무조건 string\n\n#### 10. Final Validation Rules\n\n1. 모든 property는 블록 내부에서만 존재\n2. 같은 identifier 중복 선언 금지\n3. meta/style/script는 property-only 구조\n4. components는 선언만 (property 없음)\n5. layout만 child nodes 보유 가능\n6. value의 타입은 block-specific rule을 반드시 준수\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main dashboard page\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  border.radius: 8\n  spacing.unit: 16\n}\n\ncomponents {\n  Card\n  Button\n  Input\n}\n\nlayout {\n  class: \&quot;container\&quot;\n  id: \&quot;main-content\&quot;\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;handleForm\&quot;\n  onrefresh: \&quot;reloadData\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 대문자 identifier 사용 시 토큰화 실패\n- hyphen/underscore 사용 시 구문 오류\n- single-quote나 curly quotes 사용 시 파싱 실패\n- 음수나 단위 포함 숫자 시 값 오류\n- 블록별 스코프 위반 시 validation 실패\n- 중복 property 선언 시 마지막 값만 유효 (경고)\n\n---\n\n### Layout Tree Grammar\n\nUIH DSL의 핵심 구조인 Layout Tree Grammar Layer입니다. Block Grammar와 Property Grammar 위에서 동작하며, UI 구성 요소의 트리 구조를 정의합니다.\n\n#### 1. Layout Block Overview\n\n##### LAYOUT_BLOCK\n&#96;&#96;&#96;\nlayout {\n  &lt;layout-node&gt;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- DSL에서 유일하게 중첩 구조를 가질 수 있는 블록\n- 모든 UI 구성 요소는 layout node로 표현\n- 노드는 \&quot;구조\&quot;만 표현, 스타일/로직은 표현하지 않음\n\n#### 2. Layout Node Syntax\n\n##### NODE_SYNTAX\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;) {\n  &lt;children&gt;\n}\n&#96;&#96;&#96;\n\n##### OR (children 없는 경우)\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;)\n&#96;&#96;&#96;\n\n##### NOTES\n- TagName은 PascalCase 컴포넌트 또는 HTML-like 사용 가능\n- attributes는 inline 형태 only\n- attributes는 옵션, 없어도 됨\n- children 블록은 중첩 가능\n\n##### VALID\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) {\n  \&quot;Hello\&quot;\n}\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nDiv {\n  class: \&quot;p-4\&quot;    // 속성은 block 기반이 아니라 inline only\n}\n&#96;&#96;&#96;\n\n#### 3. TagName Rules\n\n##### TAGNAME\n- 반드시 알파벳으로 시작\n- PascalCase 또는 UpperCamelCase 권장\n- HTML-like 소문자 태그는 사용 가능 (&#96;div&#96;, &#96;span&#96;) 단 내부적으로는 UpperCase 변환됨\n\n##### VALID\n&#96;&#96;&#96;\nDiv\nSection\nImage\nheader   // 허용하지만 변환 시 Header로 취급\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n3Div     // 숫자 시작\n_Box     // underscore 시작\n-Node    // hyphen 시작\n&#96;&#96;&#96;\n\n#### 4. Attribute Syntax\n\n##### ATTRIBUTES\n&#96;&#96;&#96;\n&lt;identifier&gt;:\&quot;&lt;string&gt;\&quot;\n&#96;&#96;&#96;\n\n##### RULES\n- value는 무조건 string only\n- boolean/number 금지\n- &#96;class:\&quot;p-4\&quot;&#96; 형태처럼 inline만 허용\n- 각 attribute는 콤마(&#96;,&#96;)로 구분\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;, id:\&quot;main\&quot;, ref:\&quot;root\&quot;)\n&#96;&#96;&#96;\n\n##### STRICT_RULES\n- 속성 순서는 의미 없음 (LLM 실수 방지로 자유 순서)\n- attribute key는 lower-case only\n- 속성 개수 0~5 정도 권장\n\n#### 5. Children Rules\n\n##### CHILD_TYPES\n- string literal\n- another layout node\n- list of siblings (node 여러 개 배치)\n\n##### STRING_CHILD\n&#96;&#96;&#96;\n\&quot;Hello world\&quot;\n&#96;&#96;&#96;\n\n##### NESTED_NODE\n&#96;&#96;&#96;\nDiv(class:\&quot;mt-4\&quot;) {\n  \&quot;content\&quot;\n}\n&#96;&#96;&#96;\n\n##### SIBLINGS\n&#96;&#96;&#96;\nDiv(...) { ... }\nP(...) { ... }\nImage(...)\n&#96;&#96;&#96;\n\n#### 6. Text Node Rules\n\n##### TEXT_NODE\n- 무조건 double-quote string\n- 줄바꿈 포함 금지\n- 텍스트 덩어리는 여러 줄로 쪼개면 안 됨\n\n##### VALID\n&#96;&#96;&#96;\n\&quot;Sign in to continue\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n\&quot;Hello\n World\&quot;    // 줄바꿈 포함\n&#96;&#96;&#96;\n\n#### 7. Node Termination Rules\n\n##### CLOSING_RULES\n- 블록 노드는 반드시 &#96;}&#96; 단독 줄로 닫는다\n- inline-only 노드는 종료 블록 없음\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;px-4\&quot;) {\n  P {\n    \&quot;Hello\&quot;\n  }\n  Image(src:\&quot;/logo.png\&quot;)\n}\n&#96;&#96;&#96;\n\n#### 8. Layout Grammar Formal Pattern\n\n##### LAYOUT_NODE_GRAMMAR\n&#96;&#96;&#96;\nNode:\n  Tag (Attributes?) (ChildrenBlock?)\n\nTag:\n  IDENTIFIER\n\nAttributes:\n  \&quot;(\&quot; AttributeList \&quot;)\&quot;\n\nAttributeList:\n  Attribute (\&quot;,\&quot; Attribute)*\n\nAttribute:\n  IDENTIFIER \&quot;:\&quot; STRING\n\nChildrenBlock:\n  \&quot;{\&quot; NewLine Indented(NodeOrText)+ \&quot;}\&quot;\n\nNodeOrText:\n  Node | STRING\n&#96;&#96;&#96;\n\n#### 9. Validation Rules\n\n1. layout은 트리 구조만 표현한다\n2. inline attributes만 허용\n3. 속성은 string-only\n4. children은 반드시 정해진 중첩 규칙을 따른다\n5. Node 이름은 PascalCase가 기본\n6. 문자열 children 외에는 모든 children은 Node여야 한다\n7. siblings 허용, 순서 보존\n\n#### 10. Example (Valid Layout Tree)\n\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;min-h-screen flex flex-col\&quot;) {\n    Header(class:\&quot;p-4 bg-gray-100\&quot;) {\n      H1 {\n        \&quot;Dashboard\&quot;\n      }\n    }\n\n    Main(class:\&quot;flex-1 p-6\&quot;) {\n      Card(class:\&quot;shadow\&quot;) {\n        P {\n          \&quot;Welcome back!\&quot;\n        }\n      }\n    }\n\n    Footer(class:\&quot;p-4 text-center\&quot;) {\n      \&quot;© 2025 The Bespoke\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto\&quot;) {\n    Navbar(class:\&quot;flex justify-between items-center p-4\&quot;) {\n      Logo(class:\&quot;text-xl font-bold\&quot;) {\n        \&quot;UIH\&quot;\n      }\n      Nav(class:\&quot;space-x-4\&quot;) {\n        Link(href:\&quot;/home\&quot;) {\n          \&quot;Home\&quot;\n        }\n        Link(href:\&quot;/about\&quot;) {\n          \&quot;About\&quot;\n        }\n      }\n    }\n\n    Content(class:\&quot;grid grid-cols-3 gap-6 p-6\&quot;) {\n      Sidebar(class:\&quot;col-span-1 bg-gray-50 p-4\&quot;) {\n        Menu {\n          \&quot;Dashboard\&quot;\n          \&quot;Settings\&quot;\n          \&quot;Profile\&quot;\n        }\n      }\n\n      Main(class:\&quot;col-span-2\&quot;) {\n        Article(class:\&quot;prose\&quot;) {\n          H2 {\n            \&quot;Getting Started\&quot;\n          }\n          P {\n            \&quot;Welcome to UIH DSL documentation.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- TagName에 숫자/특수문자 시작 시 토큰화 실패\n- 속성에 boolean/number 값 사용 시 파싱 오류\n- 텍스트 노드에 줄바꿈 포함 시 validation 실패\n- 노드 종료 &#96;}&#96; 누락 시 구문 오류\n- 중첩 깊이가 너무 깊을 경우 (권장 5레벨 초과) 경고\n- siblings 간 순서가 UI 의미에 영향 줄 경우 재검토\n\n---\n\n### Parser BNF Grammar\n\nTokenizer 위에서 동작하는 공식 문법 엔진 정의입니다. Token Stream을 Abstract Syntax Tree(AST)로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- Token Stream → Abstract Syntax Tree(AST)\n\n##### PARSER_MODE\n- strict non-ambiguous grammar\n- no recovery parsing (에러는 즉시 throw)\n- deterministic (LLM-friendly)\n- recursive descent parser 기반 구조\n\n#### 2. Entry Point\n\n##### Program\n&#96;&#96;&#96;\nProgram ::= MetaBlock StyleBlock ComponentsBlock? LayoutBlock ScriptBlock? EOF\n&#96;&#96;&#96;\n\n#### 3. Blocks\n\n##### Block_Definitions\n&#96;&#96;&#96;\nMetaBlock       ::= \&quot;meta\&quot; BlockBody(MetaProperty)\nStyleBlock      ::= \&quot;style\&quot; BlockBody(StyleProperty)\nComponentsBlock ::= \&quot;components\&quot; BlockBody(ComponentEntry)\nLayoutBlock     ::= \&quot;layout\&quot; LayoutBody\nScriptBlock     ::= \&quot;script\&quot; BlockBody(ScriptProperty)\n&#96;&#96;&#96;\n\n#### 4. Generic Block Body\n\n##### BlockBody\n&#96;&#96;&#96;\nBlockBody(&lt;T&gt;) ::= LBRACE NEWLINE (Indent &lt;T&gt; NEWLINE)* RBRACE\nIndent         ::= WHITESPACE WHITESPACE    # 2 spaces only\n&#96;&#96;&#96;\n\n#### 5. META Block Grammar\n\n##### MetaProperty\n&#96;&#96;&#96;\nMetaProperty ::= Identifier \&quot;:\&quot; MetaValue\nMetaValue    ::= STRING | NUMBER | BOOLEAN | EnumString\n&#96;&#96;&#96;\n\n##### Allowed_Meta_Keys\n- title, route, theme, description\n\n#### 6. STYLE Block Grammar\n\n##### StyleProperty\n&#96;&#96;&#96;\nStyleProperty ::= StyleKey \&quot;:\&quot; StyleValue\nStyleKey      ::= Identifier ( \&quot;.\&quot; Identifier )*\nStyleValue    ::= STRING | NUMBER | EnumString\n&#96;&#96;&#96;\n\n##### Notes\n- no nested blocks\n- no boolean\n- layout-like attributes 금지\n\n#### 7. COMPONENTS Block Grammar\n\n##### ComponentEntry\n&#96;&#96;&#96;\nComponentEntry ::= ComponentName\nComponentName  ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n##### NOTES\n- but no quotes, no values, one per line\n\n##### Examples\n&#96;&#96;&#96;\nCard\nButton\nInput\n&#96;&#96;&#96;\n\n#### 8. LAYOUT Block Grammar (Core)\n\n##### LayoutBody\n&#96;&#96;&#96;\nLayoutBody     ::= LBRACE NEWLINE Indent LayoutNodeList RBRACE\nLayoutNodeList ::= (LayoutNode NEWLINE)*\nLayoutNode     ::= Tag (Attributes)? (ChildrenBlock)?\nTag            ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n#### 9. Attributes Grammar\n\n##### Attributes\n&#96;&#96;&#96;\nAttributes    ::= LPAREN AttributeList RPAREN\nAttributeList ::= Attribute (COMMA Attribute)*\nAttribute     ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n#### 10. Children Block Grammar\n\n##### ChildrenBlock\n&#96;&#96;&#96;\nChildrenBlock ::= LBRACE NEWLINE Indent ChildrenList RBRACE\nChildrenList  ::= (Child NEWLINE)*\nChild         ::= LayoutNode | TEXT_STRING\n&#96;&#96;&#96;\n\n#### 11. SCRIPT Block Grammar\n\n##### ScriptProperty\n&#96;&#96;&#96;\nScriptProperty ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n##### Allowed_Script_Keys\n- onclick, onload, onsubmit, onmount, onchange\n\n&gt; 모든 script event identifier는 전부 소문자여야 하며 camelCase를 사용하지 않는다.\n\n#### 12. Value Grammars\n\n##### Value_Types\n&#96;&#96;&#96;\nSTRING     ::= \&quot;\\\&quot;\&quot; &lt;chars&gt; \&quot;\\\&quot;\&quot;\nNUMBER     ::= digits ( \&quot;.\&quot; digits )?\nBOOLEAN    ::= \&quot;true\&quot; | \&quot;false\&quot;\nEnumString ::= STRING   # validated in semantic phase\n&#96;&#96;&#96;\n\n#### 13. Identifier Grammars\n\n##### Identifiers\n&#96;&#96;&#96;\nIdentifier ::= [a-z][a-z0-9.]*\nTagName    ::= [A-Z][a-zA-Z0-9]*\n&#96;&#96;&#96;\n\n#### 14. Syntax Constraints (Formal)\n\n1. 모든 블록은 순서 고정\n2. 각 블록은 1회만 등장\n3. meta/style/layout은 필수\n4. components/script는 optional\n5. 들여쓰기 2 spaces only\n6. 속성(colon)은 반드시 &#96;&lt;id&gt;: &lt;value&gt;&#96;\n7. semicolon 금지\n8. layout만 nested structure 허용\n9. children 안에서는 TEXT_STRING 또는 LayoutNode만 허용\n10. parser는 ambiguous branch 금지 (LLM-safe)\n\n#### 15. Complete Example (BNF-valid)\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  radius.default: 8\n}\n\ncomponents {\n  Card\n  Button\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello world\&quot;\n    }\n  }\n}\n\nscript {\n  onclick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### BNF 구조 트리\n\n&#96;&#96;&#96;\nProgram\n├── MetaBlock\n│   ├── LBRACE\n│   ├── MetaProperty (title: \&quot;Home\&quot;)\n│   ├── MetaProperty (route: \&quot;/\&quot;)\n│   └── RBRACE\n├── StyleBlock\n│   ├── LBRACE\n│   ├── StyleProperty (color.primary: \&quot;#0E5EF7\&quot;)\n│   ├── StyleProperty (radius.default: 8)\n│   └── RBRACE\n├── ComponentsBlock\n│   ├── LBRACE\n│   ├── ComponentEntry (Card)\n│   ├── ComponentEntry (Button)\n│   └── RBRACE\n├── LayoutBlock\n│   ├── LBRACE\n│   ├── LayoutNode (Div)\n│   │   ├── Attributes (class:\&quot;p-4\&quot;)\n│   │   └── ChildrenBlock\n│   │       └── LayoutNode (P)\n│   │           └── ChildrenBlock\n│   │               └── TEXT_STRING (\&quot;Hello world\&quot;)\n│   └── RBRACE\n└── ScriptBlock\n    ├── LBRACE\n    ├── ScriptProperty (onClick: \&quot;submitForm\&quot;)\n    └── RBRACE\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 즉시 파싱 중단\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유지 (경고)\n- 들여쓰기 2 space 위반 시 구문 오류\n- layout 외 블록에서 중첩 시도 시 파싱 실패\n- 허용되지 않은 키 사용 시 semantic 오류 (parser 단계에서는 허용)\n- TEXT_STRING이 layout 외 컨텍스트에서 등장 시 오류\n\n---\n\n## AST Schema Definition\n\nParser BNF 위에서 생성되는 최종 AST 구조입니다. 모든 UIH DSL 요소가 이 스키마에 따라 구조화됩니다.\n\n### 1. AST Root\n\n#### ASTRoot\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Program\&quot;\n  meta: MetaNode\n  style: StyleNode\n  components: ComponentsNode | null\n  layout: LayoutNode\n  script: ScriptNode | null\n}\n&#96;&#96;&#96;\n\n### 2. Meta Node\n\n#### MetaNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Meta\&quot;\n  properties: MetaProperty[]\n}\n&#96;&#96;&#96;\n\n#### MetaProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;title\&quot;\n  value: string|number|boolean\n  location: Range     // from tokenizer\n}\n&#96;&#96;&#96;\n\n### 3. Style Node\n\n#### StyleNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Style\&quot;\n  properties: StyleProperty[]\n}\n&#96;&#96;&#96;\n\n#### StyleProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;color.primary\&quot;\n  value: string|number\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 4. Components Node\n\n#### ComponentsNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Components\&quot;\n  components: ComponentEntry[]\n}\n&#96;&#96;&#96;\n\n#### ComponentEntry\n&#96;&#96;&#96;typescript\n{\n  name: string        // e.g. \&quot;Card\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 5. Layout Node (Core Tree Structure)\n\n#### LayoutNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Layout\&quot;\n  children: LayoutElement[]     // top-level nodes inside layout block\n}\n&#96;&#96;&#96;\n\n#### LayoutElement\n&#96;&#96;&#96;typescript\nLayoutElement = LayoutComponent | LayoutText\n&#96;&#96;&#96;\n\n#### 5.1 Layout Component\n&#96;&#96;&#96;typescript\nLayoutComponent {\n  type: \&quot;Component\&quot;\n  tag: string                   // e.g. \&quot;Div\&quot;, \&quot;P\&quot;, \&quot;Header\&quot;\n  attributes: Attribute[]\n  children: LayoutElement[]     // nested structure\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### Attribute\n&#96;&#96;&#96;typescript\n{\n  key: string                   // lower-case only\n  value: string                 // inline string only\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### 5.2 Layout Text Node\n&#96;&#96;&#96;typescript\nLayoutText {\n  type: \&quot;Text\&quot;\n  value: string                 // raw text string\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 6. Script Node\n\n#### ScriptNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Script\&quot;\n  events: ScriptProperty[]\n}\n&#96;&#96;&#96;\n\n#### ScriptProperty\n&#96;&#96;&#96;typescript\n{\n  key: string                   // e.g. \&quot;onclick\&quot; (lowercase only)\n  value: string                 // e.g. \&quot;submitForm\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 7. Range Object (Source Location)\n\n#### Range\n&#96;&#96;&#96;typescript\n{\n  start: Position\n  end: Position\n}\n&#96;&#96;&#96;\n\n#### Position\n&#96;&#96;&#96;typescript\n{\n  line: number\n  column: number\n}\n&#96;&#96;&#96;\n\n### 8. Semantics Rules (Validation Layer)\n\n1. Meta keys must be from allowlist:\n   - title, route, theme, description\n\n2. Style keys may use dot notation but MUST be lowercase.\n\n3. Components must be names only, no properties.\n\n4. Layout:\n   - tag must be a valid TagName or valid identifier\n   - attributes must be string-only\n   - children: array of LayoutElement (component or text)\n\n5. Script:\n   - keys must be known event names\n   - value must be string (function name)\n\n6. No null children arrays. Use &#96;[]&#96; if empty.\n\n7. All nodes must have location data.\n\n### 9. Example: Full AST for a Simple Page\n\n#### Example DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### Generated AST (simplified)\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Home\&quot; },\n      { \&quot;key\&quot;: \&quot;route\&quot;, \&quot;value\&quot;: \&quot;/\&quot; }\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;color.primary\&quot;, \&quot;value\&quot;: \&quot;#0E5EF7\&quot; }\n    ]\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: [\n          { \&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;p-4\&quot; }\n        ],\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n### AST 구조 트리\n\n&#96;&#96;&#96;\nASTRoot (Program)\n├── meta (MetaNode)\n│   └── properties[] (MetaProperty)\n├── style (StyleNode)\n│   └── properties[] (StyleProperty)\n├── components (ComponentsNode | null)\n│   └── components[] (ComponentEntry)\n├── layout (LayoutNode)\n│   └── children[] (LayoutElement)\n│       ├── LayoutComponent\n│       │   ├── attributes[] (Attribute)\n│       │   └── children[] (LayoutElement)\n│       └── LayoutText\n└── script (ScriptNode | null)\n    └── events[] (ScriptProperty)\n&#96;&#96;&#96;\n\n### AST Examples\n\n#### 최소 AST 구조\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      {\&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Minimal\&quot;}\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: []\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Text\&quot;,\n        \&quot;value\&quot;: \&quot;Content\&quot;\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n#### 복잡한 레이아웃 AST\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Layout\&quot;,\n  \&quot;children\&quot;: [\n    {\n      \&quot;type\&quot;: \&quot;Component\&quot;,\n      \&quot;tag\&quot;: \&quot;Div\&quot;,\n      \&quot;attributes\&quot;: [\n        {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;container\&quot;}\n      ],\n      \&quot;children\&quot;: [\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Header\&quot;,\n          \&quot;attributes\&quot;: [],\n          \&quot;children\&quot;: [\n            {\n              \&quot;type\&quot;: \&quot;Component\&quot;,\n              \&quot;tag\&quot;: \&quot;H1\&quot;,\n              \&quot;attributes\&quot;: [],\n              \&quot;children\&quot;: [\n                {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Title\&quot;}\n              ]\n            }\n          ]\n        },\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Main\&quot;,\n          \&quot;attributes\&quot;: [\n            {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;content\&quot;}\n          ],\n          \&quot;children\&quot;: [\n            {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Main content\&quot;}\n          ]\n        }\n      ]\n    }\n  ]\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- location 정보 누락 시 AST 생성 실패\n- 빈 children 배열 대신 null 사용 시 validation 오류\n- 허용되지 않은 meta/style/script 키 사용 시 semantic 오류\n- LayoutComponent의 tag가 유효하지 않은 경우 오류\n- LayoutText에 빈 문자열 사용 시 경고\n- 중첩 깊이가 너무 깊을 경우 (10레벨 초과) 경고 또는 오류\n\n---\n\n## IR (Intermediate Representation) Specification\n\nAST → IR 변환 규칙을 정의합니다. Codegen 단계 직전의 \&quot;정규화된 구조\&quot;로, 플랫폼불문의 공통 인터페이스를 제공합니다.\n\n### 1. Overview\n\n#### IR_GOAL\n- AST의 복잡한 구조를 코드 생성하기 좋게 단순화\n- UI 컴포넌트 트리와 메타데이터를 정규화\n- 플랫폼불문(React/Next/Svelte) 공통 인터페이스로 변환\n- 모든 값은 최종적이고 확정된 형태만 유지\n\n#### INPUT\n- ASTRoot\n\n#### OUTPUT\n- IRRoot\n\n### 2. IR Root\n\n#### IRRoot\n&#96;&#96;&#96;typescript\n{\n  meta: IRMeta\n  style: IRStyle\n  components: IRComponents\n  layout: IRLayoutTree\n  script: IRScript\n}\n&#96;&#96;&#96;\n\n### 3. IRMeta (Final Document Metadata)\n\n#### IRMeta\n&#96;&#96;&#96;typescript\n{\n  title: string\n  route: string\n  theme: \&quot;light\&quot; | \&quot;dark\&quot;\n  description: string | null\n}\n&#96;&#96;&#96;\n\n#### Rules\n- missing values become null\n- enforce route starts with \&quot;/\&quot;\n\n### 4. IRStyle (Flattened Style Tokens)\n\n#### IRStyle\n&#96;&#96;&#96;typescript\n{\n  tokens: Record&lt;string, string | number&gt;\n}\n&#96;&#96;&#96;\n\n#### Examples\n&#96;&#96;&#96;typescript\n{\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n  \&quot;radius.default\&quot;: 8\n}\n&#96;&#96;&#96;\n\n#### Rules\n- dot-notation keys preserved\n- all values converted to primitive string/number\n- no validation here (semantic pass already done)\n\n### 5. IRComponents (Registered Component Map)\n\n#### IRComponents\n&#96;&#96;&#96;typescript\n{\n  list: string[]   // e.g. [\&quot;Card\&quot;, \&quot;Button\&quot;]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- duplicates removed\n- sorted alphabetically for deterministic output\n\n### 6. IRLayoutTree (Normalized UI Tree)\n\n#### IRLayoutTree\n&#96;&#96;&#96;typescript\n{\n  root: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### IRNode\n&#96;&#96;&#96;typescript\nIRNode = IRComponentNode | IRTextNode\n&#96;&#96;&#96;\n\n#### 6.1 IRComponentNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;component\&quot;\n  tag: string\n  attributes: Record&lt;string, string&gt;   // key:string only\n  children: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- attribute keys lower-case enforced\n- children always array\n- empty children =&gt; []\n\n#### 6.2 IRTextNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;text\&quot;\n  value: string\n}\n&#96;&#96;&#96;\n\n#### Rules\n- trimmed text preserved exactly\n- no newline allowed inside text\n\n### 7. IRScript (Event Map)\n\n#### IRScript\n&#96;&#96;&#96;typescript\n{\n  events: Record&lt;string, string&gt;   // onclick → \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Rules\n- all keys normalized to lower-case event names\n- camelCase event keys는 허용되지 않음 (validation 단계에서 차단)\n- event value must be string only\n- duplicates override earlier definitions\n\n### 8. AST → IR Mapping Rules\n\n1. **MetaNode → IRMeta**\n   - convert property array → object map\n   - apply default values if missing\n   - route must start with \&quot;/\&quot;\n\n2. **StyleNode → IRStyle**\n   - flatten list into tokens object\n   - preserve ordering but output sorted keys for determinism\n\n3. **ComponentsNode → IRComponents**\n   - convert component list → array\n   - remove duplicates\n   - sort alphabetically\n\n4. **LayoutNode → IRLayoutTree**\n   - recursively convert LayoutComponent → IRComponentNode\n   - convert LayoutText → IRTextNode\n   - inline attributes converted to plain object\n\n5. **ScriptNode → IRScript**\n   - property list flattened to event map\n   - enforce lower-case event names\n\n### 9. Example: Full IR Output\n\n#### DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### IR\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Home\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: null,\n    \&quot;description\&quot;: null\n  },\n\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n    }\n  },\n\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: []\n  },\n\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: { \&quot;class\&quot;: \&quot;p-4\&quot; },\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {}\n  }\n}\n&#96;&#96;&#96;\n\n### IR 구조 트리\n\n&#96;&#96;&#96;\nIRRoot\n├── meta (IRMeta)\n│   ├── title: string\n│   ├── route: string\n│   ├── theme: \&quot;light\&quot;|\&quot;dark\&quot;|null\n│   └── description: string|null\n├── style (IRStyle)\n│   └── tokens: Record&lt;string, string|number&gt;\n├── components (IRComponents)\n│   └── list: string[]\n├── layout (IRLayoutTree)\n│   └── root: IRNode[]\n│       ├── IRComponentNode\n│       │   ├── type: \&quot;component\&quot;\n│       │   ├── tag: string\n│       │   ├── attributes: Record&lt;string, string&gt;\n│       │   └── children: IRNode[]\n│       └── IRTextNode\n│           ├── type: \&quot;text\&quot;\n│           └── value: string\n└── script (IRScript)\n    └── events: Record&lt;string, string&gt;\n&#96;&#96;&#96;\n\n### IR Examples\n\n#### 간단한 IR 변환\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Simple\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: \&quot;light\&quot;,\n    \&quot;description\&quot;: null\n  },\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#000\&quot;,\n      \&quot;font.size\&quot;: 14\n    }\n  },\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: [\&quot;Button\&quot;]\n  },\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: {},\n        \&quot;children\&quot;: [\n          {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Content\&quot;}\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {\n      \&quot;onclick\&quot;: \&quot;handleClick\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 복잡한 중첩 레이아웃 IR\n&#96;&#96;&#96;json\n{\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Container\&quot;,\n        \&quot;attributes\&quot;: {\n          \&quot;class\&quot;: \&quot;flex flex-col min-h-screen\&quot;\n        },\n        \&quot;children\&quot;: [\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Header\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;p-4 bg-blue-600\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;H1\&quot;,\n                \&quot;attributes\&quot;: {},\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Dashboard\&quot;}\n                ]\n              }\n            ]\n          },\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Main\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;flex-1 p-6\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;Card\&quot;,\n                \&quot;attributes\&quot;: {\n                  \&quot;class\&quot;: \&quot;bg-white shadow-lg rounded\&quot;\n                },\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Welcome!\&quot;}\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- AST에 location 정보 누락 시 IR 변환 실패\n- route가 \&quot;/\&quot;로 시작하지 않을 경우 변환 시 강제 추가\n- 중복 컴포넌트 등록 시 알파벳 순 정렬로 중복 제거\n- 빈 children 배열을 null로 잘못 설정 시 []로 강제 변환\n- 텍스트 노드에 줄바꿈 포함 시 변환 중 제거 또는 오류\n- 이벤트 키 대소문자 혼재 시 소문자로 통일\n- 스타일 토큰 키 순서가 다를 경우 sorted keys로 결정적 출력 보장\n\n---\n\n## Codegen Rules\n\n### React/Next.js 15 Codegen\n\nIR을 기반으로 안정적인 UI 코드 생성 규칙입니다. React/Next.js 15 (App Router + RSC) 기준으로 IR을 실제 코드로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- IR을 기반으로 안정적인 UI 코드 생성\n- React/Next.js 15 (App Router + RSC) 기준\n- \&quot;디자인 시스템 없는 순수 Layout Tree\&quot;를 코드로 변환\n- 가능한 한 deterministic 하게 출력\n- 로직/상태/이벤트는 최소 수준으로만 개입\n\n##### INPUT\n- IRRoot\n\n##### OUTPUT\n- React Component Source Code (string)\n\n#### 2. Output Structure\n\n파일 구조는 다음 형태로 생성합니다:\n\n&#96;&#96;&#96;\n/page.tsx\n  - metadata (title, description)\n  - default export function Page()\n  - return(...) 내부에 layout tree 삽입\n\n/style-tokens.ts\n  - style.tokens flatten export\n\n/components/index.ts\n  - components registry export\n\n/script-events.ts\n  - event name string mapping export\n&#96;&#96;&#96;\n\n#### 3. Metadata Codegen\n\n##### UIH meta → Next.js metadata\n&#96;&#96;&#96;typescript\nIRMeta {\n  title: string\n  description: string\n}\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;typescript\nexport const metadata = {\n  title: \&quot;&lt;title&gt;\&quot;,\n  description: \&quot;&lt;description&gt;\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- description 없으면 필드 제외\n- theme는 metadata에 직접 쓰지 않음 (스타일토큰 용)\n\n#### 4. Style Token Codegen\n\n##### IRStyle { tokens }\n&#96;&#96;&#96;typescript\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;radius.default\&quot;: 8,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 키는 string 리터럴 그대로\n- numeric/string 그대로 출력\n- sorted keys for deterministic output\n\n#### 5. Component Registry Codegen\n\n##### IRComponents.list → export list\n&#96;&#96;&#96;typescript\nexport const components = {\n  Card,\n  Button,\n  Input,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 자동 import 하지 않음 (상위 시스템이 resolve)\n- keys는 PascalCase 유지\n- duplicates 제거 후 정렬\n\n#### 6. Layout Tree → JSX Codegen\n\n##### IRLayoutTree → React element tree\n\n##### 6.1 Component Node\n&#96;&#96;&#96;typescript\nIRComponentNode {\n  tag: \&quot;Div\&quot;\n  attributes: { class: \&quot;p-4\&quot; }\n  children: [...]\n}\n&#96;&#96;&#96;\n\n##### OUTPUT JSX\n&#96;&#96;&#96;jsx\n&lt;Div className=\&quot;p-4\&quot;&gt;\n  {children...}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n##### RULES\n- attribute.key \&quot;class\&quot; → \&quot;className\&quot;\n- attribute key는 그대로 lower-case 유지\n- value는 string literal\n- children length 0 이면 self-closing 금지 (always explicit block)\n- tag name 그대로 JSX 컴포넌트로 사용\n\n##### 6.2 Text Node\n&#96;&#96;&#96;typescript\nIRTextNode { value: \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;jsx\n{\&quot;Hello\&quot;}\n&#96;&#96;&#96;\n\n##### RULES\n- 텍스트는 JSX children 표현\n- 특수문자는 자동 escape\n\n#### 7. Script Event Codegen\n\n##### IRScript.events → export mapping\n&#96;&#96;&#96;typescript\nexport const eventHandlers = {\n  onclick: \&quot;submitForm\&quot;,\n  onload: \&quot;init\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- event 이름은 lower-case normalized\n- 값은 string (함수명)\n- 실제 JS 함수 body는 생성하지 않음\n- 나중 시스템이 자동 wire-up 함\n\n#### 8. Full Page Generation\n\n최종 page.tsx는 다음 구조를 따릅니다:\n\n&#96;&#96;&#96;typescript\nexport const metadata = { ... };\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen p-4\&quot;&gt;\n      &lt;P&gt;{\&quot;Hello\&quot;}&lt;/P&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### RULES\n- 최상위는 항상 &#96;&lt;Div&gt;&#96; 같은 Wrapper로 시작하지 않아도 됨\n- layout.root가 배열이면 Fragment로 감싼다\n- 코드 스타일은 2-space indent\n- 세미콜론 붙이지 않음 (Prettier 옵션 따라감)\n\n#### 9. Determinism Rules\n\n1. 속성 순서는 key 알파벳순 정렬\n2. children 순서는 DSL 입력 순서 그대로\n3. components 목록은 알파벳순 정렬\n4. styleTokens도 key 정렬\n5. eventHandlers key 정렬\n6. output JSX는 항상 multiline\n\n#### 10. Full Example (DSL → IR → JSX)\n\n##### DSL\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n##### JSX OUT\n&#96;&#96;&#96;typescript\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;p-4\&quot;&gt;\n      {\&quot;Hello\&quot;}\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n#### 11. Notes for Engine Integrators\n\n1. Codegen은 \&quot;순수 구조\&quot;만 책임진다\n   - 상태(state), fetch, useEffect 등은 지원하지 않음\n2. 이벤트 핸들러는 단순 라벨링 시스템\n3. 스타일 토큰은 UI 프레임워크에서 직접 해석\n4. React, Vue, Svelte 등 플랫폼별 코드젠 가능\n   - 플랫폼별 레이어는 분리\n\n#### Output Files 구조\n\n&#96;&#96;&#96;\nOutput Files\n├── page.tsx\n│   ├── metadata export\n│   ├── imports (components, styleTokens, eventHandlers)\n│   ├── Page() function\n│   └── JSX return (layout tree)\n├── style-tokens.ts\n│   └── styleTokens export\n├── components/index.ts\n│   └── components export\n└── script-events.ts\n    └── eventHandlers export\n&#96;&#96;&#96;\n\n#### Codegen Examples\n\n##### 전체 페이지 코드 생성 예시\n&#96;&#96;&#96;typescript\n// page.tsx\nexport const metadata = {\n  title: \&quot;Dashboard\&quot;,\n  description: \&quot;Main dashboard page\&quot;\n};\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen flex flex-col\&quot;&gt;\n      &lt;Header className=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n        &lt;H1&gt;\n          {\&quot;Dashboard\&quot;}\n        &lt;/H1&gt;\n      &lt;/Header&gt;\n      &lt;Main className=\&quot;flex-1 p-6\&quot;&gt;\n        &lt;Card className=\&quot;bg-white shadow-lg rounded-lg p-6\&quot;&gt;\n          &lt;P&gt;\n            {\&quot;Welcome back!\&quot;}\n          &lt;/P&gt;\n        &lt;/Card&gt;\n      &lt;/Main&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### 스타일 토큰 파일 예시\n&#96;&#96;&#96;typescript\n// style-tokens.ts\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;color.secondary\&quot;: \&quot;#6B7280\&quot;,\n  \&quot;color.accent\&quot;: \&quot;#F59E0B\&quot;,\n  \&quot;spacing.small\&quot;: 8,\n  \&quot;spacing.medium\&quot;: 16,\n  \&quot;spacing.large\&quot;: 24,\n  \&quot;border.radius\&quot;: 6,\n  \&quot;font.family\&quot;: \&quot;Inter\&quot;,\n  \&quot;font.size.base\&quot;: 16,\n  \&quot;shadow.default\&quot;: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n};\n&#96;&#96;&#96;\n\n##### 컴포넌트 레지스트리 예시\n&#96;&#96;&#96;typescript\n// components/index.ts\nexport const components = {\n  Button,\n  Card,\n  Input,\n  Modal,\n  Sidebar\n};\n&#96;&#96;&#96;\n\n##### 이벤트 핸들러 파일 예시\n&#96;&#96;&#96;typescript\n// script-events.ts\nexport const eventHandlers = {\n  onclick: \&quot;handleClick\&quot;,\n  onload: \&quot;initDashboard\&quot;,\n  onsubmit: \&quot;processForm\&quot;\n};\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- layout.root가 빈 배열일 경우 빈 Fragment 생성\n- 컴포넌트 이름이 JavaScript 예약어와 충돌 시 escaping 필요\n- 텍스트에 JSX 특수문자 포함 시 자동 escape\n- 중첩 깊이가 깊을 경우 코드 포맷팅 유지\n- import 경로 resolve 실패 시 상위 시스템에서 처리\n- styleTokens에 특수문자 키 포함 시 유효한 JS 객체 키로 변환\n\n---\n\n### Vue &amp; Svelte Codegen\n\nReact Codegen과 동일한 IR 기반으로 Vue와 Svelte 코드를 생성하는 규칙입니다. 플랫폼별 렌더링 규칙만 다르게 적용합니다.\n\n## SECTION A — Vue Codegen (SFC 기준)\n\n### GOAL\n- IR → .vue 파일 형태로 변환\n- &#96;&lt;template&gt;&#96; + &#96;&lt;script setup&gt;&#96; + &#96;&lt;style&gt;&#96; 구조 유지\n- 모든 로직은 배제하고 구조만 생성\n\n### OUTPUT FILE STRUCTURE\n&#96;&#96;&#96;\nMyPage.vue\n&#96;&#96;&#96;\n\n### 1. Top-Level Structure\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;!-- layout tree --&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport components...\n\nconst events = {...}\nconst styleTokens = {...}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* optional if needed */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Vue Template 규칙\n\n#### IRComponentNode(tag:\&quot;Div\&quot;, attributes, children)\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  &lt;!-- children --&gt;\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;className&#96; → &#96;class&#96;\n- attribute values: string only\n- children: 그대로 template로 변환\n- Fragment는 &#96;&lt;template&gt;&#96; 안에서 그냥 siblings로 출력\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello (그대로 text node)\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\neventHandlers {\n  onClick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Vue OUTPUT\n&#96;&#96;&#96;vue\n@click=\&quot;submitForm\&quot;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;onClick&#96; → &#96;@click&#96;\n- &#96;onChange&#96; → &#96;@change&#96;\n- &#96;onInput&#96; → &#96;@input&#96;\n- &#96;onLoad&#96; → &#96;@load&#96;\n- value는 함수 이름 string\n- 함수 구현은 생성하지 않음\n\n### 4. Component Registry (imports)\n&#96;&#96;&#96;javascript\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules\n- 속성(sorted)\n- imports(sorted)\n- children 순서 그대로\n- no semicolons\n- template 들여쓰기 2 spaces\n\n## SECTION B — Svelte Codegen (.svelte)\n\n### GOAL\n- Svelte 컴포넌트 파일 하나로 완성\n- &#96;&lt;script&gt;&#96; + markup 구조\n\n### OUTPUT STRUCTURE\n&#96;&#96;&#96;\nMyPage.svelte\n&#96;&#96;&#96;\n\n### 1. File Layout\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import components...\n  export let events = {...}\n  export let styleTokens = {...}\n&lt;/script&gt;\n\n&lt;!-- layout markup --&gt;\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  Hello\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* optional */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Svelte Markup\n\n#### IRComponentNode(tag, attributes, children)\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  {#if ... ?} (없음)\n  {children}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- 클래스는 &#96;class&#96;\n- 속성 문자열만\n- Self-closing 금지\n- children 재귀적 삽입\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\nIRScript:\nonClick → function name\n&#96;&#96;&#96;\n\n#### Svelte OUTPUT\n&#96;&#96;&#96;svelte\non:click={submitForm}\n&#96;&#96;&#96;\n\n#### Mapping\n&#96;&#96;&#96;\nonClick   → on:click\nonChange  → on:change\nonInput   → on:input\nonLoad    → on:load\n&#96;&#96;&#96;\n\n### 4. Components Import\n&#96;&#96;&#96;javascript\nimport Card from \&quot;./Card.svelte\&quot;;\nimport Button from \&quot;./Button.svelte\&quot;;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules (필수)\n\n1. import 순서는 알파벳 정렬\n2. attributes sorted\n3. event names lower-case\n4. children 순서 보존\n5. markup 들여쓰기 2 spaces\n\n## SECTION C — Cross-Platform Notes\n\n1. React / Vue / Svelte 모두 IR만 참조\n2. layout tree는 그대로 세 렌더러에서 재활용\n3. event handler는 단순 label → framework alias로 변환\n4. styleTokens는 컴파일러 외부 시스템이 처리\n5. components는 registry 기반으로 import만 생성\n\n## SECTION D — Example Conversion (Same IR → Vue/Svelte)\n\n### IR\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) { \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n### Vue Template\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Svelte Markup\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte 구조\n\n&#96;&#96;&#96;\nVue Output (.vue)\n├── &lt;template&gt;\n│   └── layout tree (Vue template syntax)\n├── &lt;script setup&gt;\n│   ├── component imports\n│   ├── events object\n│   └── styleTokens object\n└── &lt;style scoped&gt;\n    └── optional styles\n\nSvelte Output (.svelte)\n├── &lt;script&gt;\n│   ├── component imports\n│   ├── export let events = {...}\n│   └── export let styleTokens = {...}\n├── layout markup (Svelte syntax)\n└── &lt;style&gt;\n    └── optional styles\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte Examples\n\n#### Vue SFC 전체 예시\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n    &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n      &lt;H1&gt;\n        Dashboard\n      &lt;/H1&gt;\n    &lt;/Header&gt;\n    &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n      &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; @click=\&quot;handleCardClick\&quot;&gt;\n        &lt;P&gt;\n          Welcome back!\n        &lt;/P&gt;\n      &lt;/Card&gt;\n    &lt;/Main&gt;\n  &lt;/Div&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n\nconst events = {\n  handleCardClick: \&quot;handleCardClick\&quot;\n}\n\nconst styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;spacing.medium\&quot;: 16\n}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### Svelte 컴포넌트 전체 예시\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import Card from \&quot;./Card.svelte\&quot;;\n  import Button from \&quot;./Button.svelte\&quot;;\n\n  export let events = {\n    handleCardClick: \&quot;handleCardClick\&quot;\n  };\n\n  export let styleTokens = {\n    \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n    \&quot;spacing.medium\&quot;: 16\n  };\n&lt;/script&gt;\n\n&lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n  &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n    &lt;H1&gt;\n      Dashboard\n    &lt;/H1&gt;\n  &lt;/Header&gt;\n  &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n    &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; on:click={handleCardClick}&gt;\n      &lt;P&gt;\n        Welcome back!\n      &lt;/P&gt;\n    &lt;/Card&gt;\n  &lt;/Main&gt;\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### 이벤트 매핑 비교\n&#96;&#96;&#96;javascript\n// 동일한 IR 이벤트\n{\n  onClick: \&quot;handleClick\&quot;,\n  onChange: \&quot;handleChange\&quot;,\n  onLoad: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;vue\n&lt;!-- Vue --&gt;\n&lt;Button @click=\&quot;handleClick\&quot; @change=\&quot;handleChange\&quot; @load=\&quot;init\&quot;&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;svelte\n&lt;!-- Svelte --&gt;\n&lt;Button on:click={handleClick} on:change={handleChange} on:load={init}&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;jsx\n&lt;!-- React --&gt;\n&lt;Button onClick={handleClick} onChange={handleChange} onLoad={init}&gt;\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- Vue에서 컴포넌트 이름이 kebab-case로 변환 필요 시 자동 처리\n- Svelte에서 export let 구문이 예약어와 충돌 시 renaming\n- 이벤트 핸들러가 정의되지 않은 경우 플랫폼별 기본 동작\n- 스타일 토큰에 CSS 변수나 함수 포함 시 escaping\n- 중첩 컴포넌트 깊이가 깊을 경우 플랫폼별 최적화 적용\n- 텍스트 콘텐츠에 플랫폼별 특수문자 포함 시 자동 escape\n\n---\n\n## Examples\n\n### 완전한 UIH DSL 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;User Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main user dashboard with analytics\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  color.accent: \&quot;#F59E0B\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n  font.size.h1: 32\n  spacing.small: 8\n  spacing.medium: 16\n  spacing.large: 24\n  border.radius: 6\n  shadow.default: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n  Sidebar\n  Chart\n}\n\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto p-6\&quot;) {\n    Header(class:\&quot;mb-8\&quot;) {\n      Div(class:\&quot;flex justify-between items-center\&quot;) {\n        H1(class:\&quot;text-3xl font-bold\&quot;) {\n          \&quot;Dashboard\&quot;\n        }\n        Button(class:\&quot;px-4 py-2 bg-blue-600 text-white rounded\&quot;) {\n          \&quot;New Report\&quot;\n        }\n      }\n    }\n\n    Div(class:\&quot;grid grid-cols-3 gap-6\&quot;) {\n      Card(class:\&quot;col-span-2\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Analytics Overview\&quot;\n        }\n        Chart(class:\&quot;w-full h-64\&quot;)\n      }\n\n      Card(class:\&quot;col-span-1\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Quick Stats\&quot;\n        }\n        Div(class:\&quot;space-y-4\&quot;) {\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Total Users\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;1,234\&quot;\n            }\n          }\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Active Sessions\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;89\&quot;\n            }\n          }\n        }\n      }\n    }\n\n    Sidebar(class:\&quot;mt-8\&quot;) {\n      H3(class:\&quot;text-lg mb-4\&quot;) {\n        \&quot;Recent Activity\&quot;\n      }\n      Div(class:\&quot;space-y-2\&quot;) {\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;User john@example.com logged in\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;New report generated\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;System backup completed\&quot;\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onLoad: \&quot;initDashboard\&quot;\n  onClick: \&quot;handleButtonClick\&quot;\n  onRefresh: \&quot;refreshData\&quot;\n}\n&#96;&#96;&#96;\n\n### 최소 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Minimal Page\&quot;\n  route: \&quot;/minimal\&quot;\n  theme: \&quot;light\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  spacing.unit: 12\n}\n\nlayout {\n  Div(class:\&quot;min-h-screen flex items-center justify-center bg-gray-50\&quot;) {\n    \&quot;Coming soon\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n### Form 중심 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Sign Up\&quot;\n  route: \&quot;/signup\&quot;\n  theme: \&quot;light\&quot;\n  description: \&quot;Create a new account\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#2563EB\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n}\n\ncomponents {\n  Form\n  Input\n  Button\n  Alert\n}\n\nlayout {\n  Section(class:\&quot;min-h-screen flex items-center justify-center bg-gray-100\&quot;) {\n    Form(class:\&quot;w-full max-w-md space-y-6 bg-white p-8 rounded-xl shadow-lg\&quot;) {\n      H2(class:\&quot;text-2xl font-semibold text-gray-900\&quot;) {\n        \&quot;Create your account\&quot;\n      }\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;email\&quot;, placeholder:\&quot;Enter email\&quot;)\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;password\&quot;, placeholder:\&quot;Enter password\&quot;)\n      Button(class:\&quot;w-full bg-blue-600 text-white py-3 rounded-lg\&quot;) {\n        \&quot;Sign up\&quot;\n      }\n      Alert(class:\&quot;text-sm text-gray-500 text-center\&quot;) {\n        \&quot;By signing up you agree to our terms\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onSubmit: \&quot;handleSignup\&quot;\n  onLoad: \&quot;prefillFromInvite\&quot;\n}\n&#96;&#96;&#96;\n\n### 콘텐츠 피드 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Creator Feed\&quot;\n  route: \&quot;/feed\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Realtime creator activity feed\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#22D3EE\&quot;\n  color.background: \&quot;#0F172A\&quot;\n  font.family: \&quot;Space Grotesk\&quot;\n  spacing.medium: 20\n  radius.card: 12\n}\n\ncomponents {\n  Shell\n  Sidebar\n  Feed\n  FeedItem\n  Avatar\n  Badge\n}\n\nlayout {\n  Shell(class:\&quot;min-h-screen bg-slate-950 text-slate-100\&quot;) {\n    Sidebar(class:\&quot;w-64 border-r border-slate-800 p-6 space-y-6\&quot;) {\n      H1(class:\&quot;text-xl font-semibold tracking-tight\&quot;) {\n        \&quot;Creator Hub\&quot;\n      }\n      Badge(class:\&quot;inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 text-slate-200\&quot;) {\n        \&quot;Live updates\&quot;\n      }\n    }\n    Feed(class:\&quot;flex-1 p-8 space-y-6\&quot;) {\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-cyan-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;heymina.studio\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-300\&quot;) {\n              \&quot;New drop\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Dropped a limited neon kit — 120 packs sold out in 3 minutes.\&quot;\n          }\n        }\n      }\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-pink-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;luvv.wav\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-cyan-500/10 text-cyan-300\&quot;) {\n              \&quot;Stream recap\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Hit 18,245 live viewers tonight — chat requested a synthwave encore.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onRefresh: \&quot;fetchLatestFeed\&quot;\n  onClick: \&quot;openCreatorProfile\&quot;\n}\n&#96;&#96;&#96;\n\n---\n\n## Version\n\n- **Version**: 1.0.0\n- **Last Update**: 2025-11-18\n- **Change Summary**: Complete guide consolidating all UIH DSL specifications\n\n---\n\n## 문서 끝\n\n이 문서는 UIH DSL의 모든 스펙을 \&quot;생략 없이\&quot; 하나의 파일로 통합한 완전판입니다. Foundation Layer부터 Codegen까지 전 과정을 포함하며, LLM이 UI를 정확하게 선언할 수 있도록 설계된 모든 규칙이 담겨 있습니다.\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Preparing to update Vue and Svelte event mappings**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating eventHandlers snippet and rules**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;bc47da44-a74d-4100-8c46-0bbeb9b1ed39&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  &#96;&#96;&#96;javascript\n  eventHandlers {\n-   onClick: \&quot;submitForm\&quot;\n+   onclick: \&quot;submitForm\&quot;\n  }\n  &#96;&#96;&#96;&quot;,
        &quot;oldStart&quot;: 2486,
        &quot;newStart&quot;: 2486,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;  \n  #### RULES\n- - &#96;onClick&#96; → &#96;@click&#96;\n- - &#96;onChange&#96; → &#96;@change&#96;\n- - &#96;onInput&#96; → &#96;@input&#96;\n- - &#96;onLoad&#96; → &#96;@load&#96;\n+ - DSL &#96;onclick&#96; → Vue &#96;@click&#96;\n+ - DSL &#96;onchange&#96; → Vue &#96;@change&#96;\n+ - DSL &#96;oninput&#96; → Vue &#96;@input&#96;\n+ - DSL &#96;onload&#96; → Vue &#96;@load&#96;\n  - value는 함수 이름 string\n  - 함수 구현은 생성하지 않음&quot;,
        &quot;oldStart&quot;: 2496,
        &quot;newStart&quot;: 2496,
        &quot;oldLines&quot;: 8,
        &quot;newLines&quot;: 8,
        &quot;linesRemoved&quot;: 4,
        &quot;linesAdded&quot;: 4
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;,
  &quot;contentsAfterEdit&quot;: &quot;# UIH DSL — Complete Guide (생략 없는 완전판)\n\n## Table of Contents\n\n1. [Overview](#overview)\n2. [Philosophy &amp; Design Principles](#philosophy--design-principles)\n3. [Foundation Layer](#foundation-layer)\n4. [Tokenizer Specification](#tokenizer-specification)\n5. [Grammar](#grammar)\n   - [Block Grammar](#block-grammar)\n   - [Property Grammar](#property-grammar)\n   - [Layout Tree Grammar](#layout-tree-grammar)\n   - [Parser BNF Grammar](#parser-bnf-grammar)\n6. [AST Schema Definition](#ast-schema-definition)\n7. [IR (Intermediate Representation) Specification](#ir-intermediate-representation-specification)\n8. [Codegen Rules](#codegen-rules)\n   - [React/Next.js 15 Codegen](#reactnextjs-15-codegen)\n   - [Vue &amp; Svelte Codegen](#vue--svelte-codegen)\n9. [Examples](#examples)\n10. [Version](#version)\n\n---\n\n## Overview\n\nUIH DSL (Universal Interface Hierarchy Domain Specific Language) v2는 **\&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;**를 목표로 하는 도메인 특화 언어입니다.\n\n### 핵심 목표\n- LLM이 UI 구조를 **정확하게** 선언할 수 있도록 설계\n- 모호성 제거 및 결정성(determinism) 보장\n- 사람보다 AI가 더 효과적으로 사용 가능한 DSL\n- UI 구조의 선언적 표현에 집중\n\n### 아키텍처 흐름\n&#96;&#96;&#96;\nDSL 문자열 → Tokenizer → Parser → AST → IR → Codegen → React/Vue/Svelte 코드\n&#96;&#96;&#96;\n\n### 주요 특징\n- 한 줄에 하나의 의미만 (One-intent-per-line)\n- 선택적 문법 금지 - 모든 것이 명시적\n- 쌍따옴표만 허용, 세미콜론 없음\n- 주석 지원 안 함 (모호성 제거)\n- 고정 블록 순서: meta → style → components → layout → script\n\n---\n\n## Philosophy &amp; Design Principles\n\nUIH DSL은 \&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;를 목표로 하는 도메인 특화 언어입니다. 사람보다 LLM이 더 효과적으로 사용할 수 있도록 설계되었으며, UI 구조의 선언적 표현에 집중합니다.\n\n### 1. LLM 친화적 설계 원칙\n\nLLM이 읽고 쓰기 편한 DSL을 지향합니다. 구조는 최대한 명확하고 모호성이 없으며, 선택적 문법을 금지합니다. LLM이 패턴을 쉽게 반복할 수 있는 형태로 자연어 번역 난이도를 낮췄습니다.\n\n### 2. 선언적 UI 설계\n\nUI는 로직 기반보다 구조 기반으로 설계합니다. \&quot;무엇을 만든다\&quot;에 집중하며 \&quot;어떻게 만든다\&quot;는 Codegen이 담당합니다. 상태, 이벤트, 애니메이션은 추상화 계층으로 밀어냅니다.\n\n### 3. 한 줄 한 의미 원칙 (One-intent-per-line)\n\n한 라인에 하나의 의미만 허용합니다. 한 줄에 두 개 의미를 섞으면 LLM이 실수할 가능성이 높아집니다.\n\n#### 좋은 예: 한 줄 한 의미\n&#96;&#96;&#96;dsl\nmeta:\n  title: \&quot;Home\&quot;\n\nmeta:\n  route: \&quot;/\&quot;\n&#96;&#96;&#96;\n\n#### 나쁜 예: 한 줄 다중 의미 (금지)\n&#96;&#96;&#96;dsl\nmeta: title: \&quot;Home\&quot;, route: \&quot;/\&quot;  # 잘못된 예\n&#96;&#96;&#96;\n\n### 4. 고정 블록 순서\n\n블록 구조는 **meta → style → components → layout → script** 순서를 유지합니다. 이 순서는 LLM이 외우기 쉽고 Codegen의 예측 가능성과 AST의 결정성을 보장합니다.\n\n### 5. 최소 표현, 최대 의미\n\nDSL은 짧고 규칙적이어야 합니다. CSS-like verbose, YAML 계층 증가, JSX 로직 섞임을 금지합니다. 의미 전달에 집중하는 최소 선언적 DSL입니다.\n\n### 6. 오류 제로 문법\n\n\&quot;AI가 틀릴 수 없는 언어\&quot;를 목표로 합니다. 쌍따옴표만 허용하고 세미콜론 없이 콜론만 사용합니다. 모든 키는 고정된 string literal이며 optional field를 최소화합니다.\n\n### 7. AST 1:1 매핑\n\n모든 UI 요소가 AST에 직접 매핑됩니다. meta 블록 → MetaNode, style 블록 → StyleNode, layout 블록 → LayoutTree로 변환됩니다.\n\n### 8. 기계 친화적 우선\n\n\&quot;사람이 읽으면 조금 불편할 것\&quot; 정도가 적정 수준입니다. 사람 UX보다 AI 정확성을 우선합니다.\n\n---\n\n## Foundation Layer\n\nUIH DSL의 가장 낮은 레벨 사양입니다. Character부터 Ordering까지의 기본 규칙을 정의하며, LLM이 실수할 수 없는 엄격한 문법을 제공합니다.\n\n### 1. Character Layer (문자 규칙)\n\n#### ALLOWED_CHARACTERS\n- a~z (lowercase alphabets)\n- 0~9 (digits)\n- hyphen (-)\n- underscore (_)\n- space ( )\n- newline (\\n)\n- braces: { }\n- colon (:)\n- double-quote (\&quot;)\n\n#### DISALLOWED_CHARACTERS\n- single-quote (&#39;)\n- semicolon (;)\n- parentheses ()\n- backtick (&#96;)\n- tab (\\t)\n- CRLF (\\r\\n)\n\n#### NEWLINE\n- always LF (\\n)\n- CRLF not supported\n\n### 2. Indentation Layer (들여쓰기 규칙)\n\n#### INDENTATION\n- exactly 2 spaces ONLY\n- tabs NOT allowed\n- indentation increases only inside a block\n- indentation does not imply hierarchy (not YAML)\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {           // ❌ 탭 사용 금지\n  title: \&quot;Home\&quot;  // ✅ 정확히 2 space\n}\n&#96;&#96;&#96;\n\n### 3. Token Layer (토큰 기본 규칙)\n\n#### TOKENS\n- IDENTIFIER = &#96;[a-z][a-z0-9.]*&#96;\n- STRING = &#96;\&quot;[^\&quot;\\\\]*(?:\\\\.[^\&quot;\\\\]*)*\&quot;&#96; (supports &#96;\\\&quot;&#96; escape)\n- NUMBER = &#96;\\d+(?:\\.\\d+)?&#96;\n- LBRACE = &#96;{&#96;\n- RBRACE = &#96;}&#96;\n- COLON = &#96;:&#96;\n- NEWLINE = &#96;\\n&#96;\n- WHITESPACE = single space\n\n#### IDENTIFIER_RULES\n- lowercase only\n- dot notation allowed (e.g. &#96;color.primary&#96;)\n- do NOT mix hyphens inside identifiers (LLM error-prone)\n\n#### STRING_RULES\n- must use double quotes only\n- escaping uses &#96;\\\&quot;&#96;\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {\n  color.primary: \&quot;#fff\&quot;    // ✅ dot notation 허용\n  label: \&quot;Click \\\&quot;here\\\&quot;\&quot;  // ✅ escape 허용\n  width: 100.5            // ✅ 소수 허용\n}\n&#96;&#96;&#96;\n\n### 4. Comment Layer (코멘트)\n\n#### COMMENTS\n- comments NOT supported\n- any attempt to use &#96;//&#96; or &#96;#&#96; is invalid\n- purpose: reduce ambiguity for LLM\n\n### 5. Statement Layer (기본 문장 구조)\n\n#### STATEMENT_TYPES\n- Block Declaration\n- Property Declaration\n\n#### BLOCK_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt; {\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n#### PROPERTY_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n#### SEMICOLON\n- NOT allowed (never used)\n\n### 6. Block Layer (블록 기본 규칙)\n\n#### BLOCK_STRUCTURE\n&#96;&#96;&#96;\nblockName {\n  property: \&quot;value\&quot;\n  property: 123\n  property: true\n}\n&#96;&#96;&#96;\n\n#### BLOCK_RULES\n- block cannot contain nested blocks\n- ONLY layout block may contain nested layout nodes\n\n### 7. Ordering Layer (순서 강제)\n\n#### BLOCK_ORDER\n1. meta\n2. style\n3. components (optional)\n4. layout\n5. script (optional)\n\n#### RULE\n- if a block appears, must follow this order\n- missing blocks are allowed except meta/style/layout\n\n### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  primary-color: \&quot;#111\&quot;\n}\n\ncomponents {\n  Button {\n    variant: \&quot;primary\&quot;\n  }\n}\n\nlayout {\n  Container {\n    children: \&quot;Button\&quot;\n  }\n}\n\nscript {\n  // optional script\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단\n- 잘못된 들여쓰기 발견 시 구문 오류\n- 코멘트 시도 시 즉시 무효 처리\n- 블록 순서 위반 시 파싱 실패\n- layout 외 중첩 블록 시도 시 오류\n\n---\n\n## Tokenizer Specification\n\nFoundation Layer + Grammar Layers 기반의 공식 토큰화 규칙입니다. DSL 문자열을 균일한 Token 리스트로 변환하며, 모든 파싱의 기반이 됩니다.\n\n### 1. Tokenizer Overview\n\n#### PURPOSE\n- DSL 문자열을 균일한 Token 리스트로 변환\n- 모호성 없는 deterministic token stream 생성\n- 모든 파싱은 이 토큰 리스트 기반으로 진행\n\n#### INPUT\n- LF 기반의 DSL 문자열\n\n#### OUTPUT\n- 순차적 Token 배열\n\n### 2. Token Types\n\n#### TOKENS\n- &#96;IDENTIFIER&#96; - meta, title, color.primary, class 등\n- &#96;STRING&#96; - \&quot;Hello\&quot;\n- &#96;NUMBER&#96; - 0, 12, 0.8\n- &#96;BOOLEAN&#96; - true, false\n- &#96;LBRACE&#96; - {\n- &#96;RBRACE&#96; - }\n- &#96;LPAREN&#96; - (\n- &#96;RPAREN&#96; - )\n- &#96;COLON&#96; - :\n- &#96;COMMA&#96; - ,\n- &#96;NEWLINE&#96; - \\n\n- &#96;WHITESPACE&#96; - space (only used between tokens)\n- &#96;TEXT_STRING&#96; - layout children string ONLY (disambiguation)\n- &#96;EOF&#96; - end of file marker\n\n### 3. Identifier Detection\n\n#### IDENTIFIER_RULES\n- regex: &#96;^[a-z][a-z0-9.]*$&#96;\n- lowercase only\n- dot notation allowed\n- hyphens, underscores 금지\n\n#### TAGNAME_RULES\n- starts with uppercase letter\n- subsequent chars: &#96;[a-zA-Z0-9]&#96;\n- TagName (e.g. Div, Header) 구분용\n\n#### TAGNAME_EXAMPLES\n&#96;&#96;&#96;\nDiv\nSection\nImage\nH1\n&#96;&#96;&#96;\n\n### 4. String Token Rules\n\n#### STRING\n- starts with &#96;\&quot;&#96;\n- ends with &#96;\&quot;&#96;\n- inside supports &#96;\\\&quot;&#96;\n- no multi-line\n\n#### TEXT_STRING\n- STRING과 동일한 문법\n- 단, layout children context에서만 등장\n- Parser에서 context-aware로 구분\n\n### 5. Number Token Rules\n\n#### NUMBER\n- regex: &#96;^[0-9]+(\\.[0-9]+)?$&#96;\n- no negative numbers\n- no units (px, rem 등)\n\n### 6. Boolean Token Rules\n\n#### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n- strictly lowercase\n\n### 7. Brace / Symbol Tokens\n\n#### SYMBOL_TOKENS\n- &#96;LBRACE&#96;: &#96;{&#96;\n- &#96;RBRACE&#96;: &#96;}&#96;\n- &#96;LPAREN&#96;: &#96;(&#96;\n- &#96;RPAREN&#96;: &#96;)&#96;\n- &#96;COLON&#96;: &#96;:&#96;\n- &#96;COMMA&#96;: &#96;,&#96;\n\n#### NOTES\n- semicolon NOT allowed\n- backtick NOT allowed\n\n### 8. Whitespace / Newline Rules\n\n#### WHITESPACE\n- single space &#96;&#39; &#39;&#96;\n- no tabs\n- no multi-space sequences except indentation (2 spaces)\n\n#### NEWLINE\n- LF only\n- CRLF invalid\n\n### 9. Layout Context Rules (Critical)\n\n#### LAYOUT_MODE\nTokenizer enters layout-mode when encountering:\n&#96;&#96;&#96;\nlayout { … }\n&#96;&#96;&#96;\n\n#### CONTEXT_SWITCH\n- after TagName(\n- before encountering next node or text\n\n#### INSIDE_LAYOUT_BLOCK\n- children detection required\n- plain strings must become TEXT_STRING token\n- siblings separated by NEWLINE\n\n#### EXAMPLE\n&#96;&#96;&#96;\n\&quot;Welcome\&quot; → TEXT_STRING inside layout\n&#96;&#96;&#96;\n\n### 10. Tokenization Algorithm (High-Level)\n\n1. iterate through chars\n2. skip whitespace unless meaningful (indent)\n3. detect IDENTIFIER or TAGNAME\n4. detect STRING (with escape)\n5. detect NUMBER\n6. detect BOOLEAN\n7. detect braces &#96;{ }&#96;\n8. detect parentheses &#96;( )&#96;\n9. detect colon &#96;:&#96; or comma &#96;,&#96;\n10. detect newline &#96;\\n&#96;\n11. maintain context stack:\n    - normal\n    - inside layout block\n    - inside attributes\n12. output final EOF token\n\n### 11. Example Token Stream\n\n#### INPUT\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### OUTPUT_TOKENS\n&#96;&#96;&#96;\nIDENTIFIER(layout)\nLBRACE\nNEWLINE\nTAGNAME(Div)\nLPAREN\nIDENTIFIER(class)\nCOLON\nSTRING(\&quot;p-4\&quot;)\nRPAREN\nLBRACE\nNEWLINE\nTEXT_STRING(\&quot;Hello\&quot;)\nNEWLINE\nRBRACE\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Token Stream Examples\n\n#### 기본 블록 토큰화\n&#96;&#96;&#96;dsl\nmeta {\n  title: \&quot;Home\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(meta)\nLBRACE\nNEWLINE\nIDENTIFIER(title)\nCOLON\nSTRING(\&quot;Home\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n#### 스타일 블록 토큰화\n&#96;&#96;&#96;dsl\nstyle {\n  color.primary: \&quot;#fff\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(style)\nLBRACE\nNEWLINE\nIDENTIFIER(color.primary)\nCOLON\nSTRING(\&quot;#fff\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단 및 오류 반환\n- CRLF 줄바꿈 발견 시 LF로 변환 또는 오류\n- 탭 문자 발견 시 공백 변환 또는 오류\n- STRING에서 미닫힘 따옴표 시 오류\n- NUMBER에 음수나 단위 포함 시 오류\n- layout 외 컨텍스트에서 TEXT_STRING 시도 시 오류\n- TAGNAME 규칙 위반 (소문자 시작) 시 IDENTIFIER로 처리\n\n---\n\n## Grammar\n\n### Block Grammar\n\nUIH DSL의 최상위 구조를 정의하는 Block Grammar Layer입니다. Foundation Layer 바로 위에 위치하며, 5개 블록의 선언, 순서, 내용 규칙을 명시합니다.\n\n#### 1. Block Definitions (5개 블록)\n\n##### BLOCKS\n- meta\n- style\n- components (optional)\n- layout\n- script (optional)\n\n##### RULES\n- 블록은 반드시 이 순서를 따라야 함: meta → style → components → layout → script\n- meta, style, layout은 필수\n- components, script는 선택\n- 각 블록은 정확히 한 번만 등장\n- 중복 블록 금지\n\n#### 2. Block Syntax (기본 문법)\n\n##### BLOCK_SYNTAX\n&#96;&#96;&#96;\n&lt;blockName&gt; {\n  &lt;property&gt;: &lt;value&gt;\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n&#96;&#96;&#96;\n\n##### SYNTAX_COMPONENTS\n- 블록 시작: IDENTIFIER + &#96; {&#96;\n- 블록 끝: &#96;}&#96; 단독 줄\n\n#### 3. Block Content Rules\n\n##### 공통 규칙\n- 블록 내부에는 property statements만 존재\n- block 내부에 block 중첩 금지\n- 단, layout 블록만 예외적으로 UI tree 구조 허용\n\n##### PROPERTY_RULE\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### VALUE_TYPES\n- string\n- number\n- boolean\n- enum-like literals (string 값)\n- list (향후 정의)\n\n#### 4. Block-Specific Rules\n\n##### (1) META BLOCK\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Page title\&quot;\n  route: \&quot;/path\&quot;\n  theme: \&quot;light\&quot;|\&quot;dark\&quot;\n}\n&#96;&#96;&#96;\n\n**META_RESTRICTIONS:**\n- meta는 UI 문서의 metadata만 포함\n- layout 정보나 스타일 정보 포함 금지\n\n##### (2) STYLE BLOCK\n&#96;&#96;&#96;\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n}\n&#96;&#96;&#96;\n\n**STYLE_RESTRICTIONS:**\n- key는 dot notation 사용 가능\n- 값은 string 또는 number\n- layout 관련 속성 금지\n- theme override 불가\n\n##### (3) COMPONENTS BLOCK (optional)\n&#96;&#96;&#96;\ncomponents {\n  Card\n  Button\n  Input\n}\n&#96;&#96;&#96;\n\n**COMPONENTS_RULES:**\n- 등록할 컴포넌트 이름만 줄 단위로 나열\n- 중첩 구조 없음\n- 속성 없음\n- 문자열 아님: &#96;\&quot;Card\&quot;&#96; 금지, &#96;Card&#96;만 허용\n\n##### (4) LAYOUT BLOCK\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n**LAYOUT_RULES:**\n- 유일하게 중첩 구조 허용\n- 노드 문법은 별도 Layer에서 정의\n- property는 inline attribute 형태 가능\n- block-like structure 유지\n\n##### (5) SCRIPT BLOCK (optional)\n&#96;&#96;&#96;\nscript {\n  onclick: \&quot;submitForm\&quot;\n  onload: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n**SCRIPT_RESTRICTIONS:**\n- event/behavior mapping만 정의\n- JS code 삽입 금지\n- inline function 금지\n- event identifier는 반드시 lowercase (camelCase 금지)\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n  spacing.unit: 8\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n}\n\nlayout {\n  Div(class:\&quot;container mx-auto p-4\&quot;) {\n    Card(class:\&quot;bg-white shadow-lg\&quot;) {\n      Button(onclick:\&quot;handleSubmit\&quot;) {\n        \&quot;Submit\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;processForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 파싱 실패\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유효 (경고)\n- components/script 외 블록에서 중첩 시도 시 오류\n- layout 외 블록에서 attribute 사용 시 오류\n\n---\n\n### Property Grammar\n\nUIH DSL 안정성의 핵심인 Property Grammar Layer입니다. Block Grammar 위에 쌓이며, 속성 선언, 값 타입, 범위 규칙을 정의합니다.\n\n#### 1. Property Declaration Syntax\n\n##### PROPERTY_SYNTAX\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\nradius.default: 8\nenabled: true\n&#96;&#96;&#96;\n\n##### RULES\n- identifier는 반드시 lowercase\n- dot notation 허용 (&#96;color.primary&#96; 등)\n- colon(:) 뒤에는 반드시 space 1개\n- value는 줄 끝까지\n\n#### 2. Identifier Rules\n\n##### IDENTIFIER\n- 패턴: &#96;[a-z][a-z0-9.]*&#96;\n- 소문자만 허용\n- 숫자는 뒤쪽에만 허용\n- dot(.)은 중첩 속성 의미로만 사용\n- hyphen 금지 (LLM 오류 방지)\n- underscore 금지\n\n##### VALID\n&#96;&#96;&#96;\ncolor.primary\nfont.size\nborder.width\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nColor.Primary    // 대문자\nfont-size        // hyphen\nfont_size        // underscore\nprimary2.color   // 숫자 앞쪽\n&#96;&#96;&#96;\n\n#### 3. Value Types (5가지)\n\n##### VALUE_TYPES\n1. STRING\n2. NUMBER\n3. BOOLEAN\n4. ENUM-LIKE (string 기반)\n5. LIST (여러 값 나열, 줄 단위)\n\n#### 4. String Value Rules\n\n##### STRING\n- 무조건 double-quote 사용\n- 내부에 &#96;\&quot;&#96; 포함 시 &#96;\\\&quot;&#96;로 escape\n- single-quote 절대 금지\n\n##### VALID\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\ndescription: \&quot;He said \\\&quot;ok\\\&quot;\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\ntitle: &#39;Home&#39;      // single-quote\nname: \&quot;Home\&quot;       // curly quotes\n&#96;&#96;&#96;\n\n#### 5. Number Value Rules\n\n##### NUMBER\n- 정수 또는 소숫점 가능\n- 음수는 허용하지 않음\n- 단위(px 등) 금지 → unitless 구조\n\n##### VALID\n&#96;&#96;&#96;\nradius: 12\nopacity: 0.85\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nradius: -4     // 음수\nwidth: 10px    // 단위 포함\n&#96;&#96;&#96;\n\n#### 6. Boolean Value Rules\n\n##### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nenabled: true\nvisible: false\n&#96;&#96;&#96;\n\n#### 7. Enum-like String Rules\n\n##### ENUM_STRING\n- 문자열이지만 값이 고정된 타입처럼 쓰는 케이스\n- allowed values는 별도 block schema마다 정의\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntheme: \&quot;light\&quot; | \&quot;dark\&quot;\nsize: \&quot;sm\&quot; | \&quot;md\&quot; | \&quot;lg\&quot;\n&#96;&#96;&#96;\n\n#### 8. List Value (Block-like list)\n\n##### LIST\n- 각 항목은 줄 단위로 입력\n- 대괄호 &#96;[]&#96; 문법 없음 (LLM 오류 방지)\n- 문자열/식별자 혼용 가능\n\n##### SYNTAX\n&#96;&#96;&#96;\nitems {\n  \&quot;one\&quot;\n  \&quot;two\&quot;\n  \&quot;three\&quot;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- list block 내부에는 property 없음\n- indent 2 spaces 유지\n\n##### EXAMPLE\n&#96;&#96;&#96;\ntags {\n  \&quot;news\&quot;\n  \&quot;feature\&quot;\n  \&quot;announcement\&quot;\n}\n&#96;&#96;&#96;\n\n#### 9. Property Scope Rules (Block별 허용 속성 경계)\n\n##### META_SCOPE\n- meta는 UI metadata만 포함\n- route, title, theme, description 등\n\n##### STYLE_SCOPE\n- 색상, 폰트, radius 등 UI 스타일만\n- layout 속성 금지 (width, height 등은 layout block에서만)\n\n##### COMPONENTS_SCOPE\n- property 없음 (등록만)\n\n##### LAYOUT_SCOPE\n- inline attribute만 (class, id, ref 등)\n- 값은 무조건 string\n- boolean/number 사용 금지\n\n##### SCRIPT_SCOPE\n- event mapping 전용\n- 값은 무조건 string\n\n#### 10. Final Validation Rules\n\n1. 모든 property는 블록 내부에서만 존재\n2. 같은 identifier 중복 선언 금지\n3. meta/style/script는 property-only 구조\n4. components는 선언만 (property 없음)\n5. layout만 child nodes 보유 가능\n6. value의 타입은 block-specific rule을 반드시 준수\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main dashboard page\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  border.radius: 8\n  spacing.unit: 16\n}\n\ncomponents {\n  Card\n  Button\n  Input\n}\n\nlayout {\n  class: \&quot;container\&quot;\n  id: \&quot;main-content\&quot;\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;handleForm\&quot;\n  onrefresh: \&quot;reloadData\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 대문자 identifier 사용 시 토큰화 실패\n- hyphen/underscore 사용 시 구문 오류\n- single-quote나 curly quotes 사용 시 파싱 실패\n- 음수나 단위 포함 숫자 시 값 오류\n- 블록별 스코프 위반 시 validation 실패\n- 중복 property 선언 시 마지막 값만 유효 (경고)\n\n---\n\n### Layout Tree Grammar\n\nUIH DSL의 핵심 구조인 Layout Tree Grammar Layer입니다. Block Grammar와 Property Grammar 위에서 동작하며, UI 구성 요소의 트리 구조를 정의합니다.\n\n#### 1. Layout Block Overview\n\n##### LAYOUT_BLOCK\n&#96;&#96;&#96;\nlayout {\n  &lt;layout-node&gt;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- DSL에서 유일하게 중첩 구조를 가질 수 있는 블록\n- 모든 UI 구성 요소는 layout node로 표현\n- 노드는 \&quot;구조\&quot;만 표현, 스타일/로직은 표현하지 않음\n\n#### 2. Layout Node Syntax\n\n##### NODE_SYNTAX\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;) {\n  &lt;children&gt;\n}\n&#96;&#96;&#96;\n\n##### OR (children 없는 경우)\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;)\n&#96;&#96;&#96;\n\n##### NOTES\n- TagName은 PascalCase 컴포넌트 또는 HTML-like 사용 가능\n- attributes는 inline 형태 only\n- attributes는 옵션, 없어도 됨\n- children 블록은 중첩 가능\n\n##### VALID\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) {\n  \&quot;Hello\&quot;\n}\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nDiv {\n  class: \&quot;p-4\&quot;    // 속성은 block 기반이 아니라 inline only\n}\n&#96;&#96;&#96;\n\n#### 3. TagName Rules\n\n##### TAGNAME\n- 반드시 알파벳으로 시작\n- PascalCase 또는 UpperCamelCase 권장\n- HTML-like 소문자 태그는 사용 가능 (&#96;div&#96;, &#96;span&#96;) 단 내부적으로는 UpperCase 변환됨\n\n##### VALID\n&#96;&#96;&#96;\nDiv\nSection\nImage\nheader   // 허용하지만 변환 시 Header로 취급\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n3Div     // 숫자 시작\n_Box     // underscore 시작\n-Node    // hyphen 시작\n&#96;&#96;&#96;\n\n#### 4. Attribute Syntax\n\n##### ATTRIBUTES\n&#96;&#96;&#96;\n&lt;identifier&gt;:\&quot;&lt;string&gt;\&quot;\n&#96;&#96;&#96;\n\n##### RULES\n- value는 무조건 string only\n- boolean/number 금지\n- &#96;class:\&quot;p-4\&quot;&#96; 형태처럼 inline만 허용\n- 각 attribute는 콤마(&#96;,&#96;)로 구분\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;, id:\&quot;main\&quot;, ref:\&quot;root\&quot;)\n&#96;&#96;&#96;\n\n##### STRICT_RULES\n- 속성 순서는 의미 없음 (LLM 실수 방지로 자유 순서)\n- attribute key는 lower-case only\n- 속성 개수 0~5 정도 권장\n\n#### 5. Children Rules\n\n##### CHILD_TYPES\n- string literal\n- another layout node\n- list of siblings (node 여러 개 배치)\n\n##### STRING_CHILD\n&#96;&#96;&#96;\n\&quot;Hello world\&quot;\n&#96;&#96;&#96;\n\n##### NESTED_NODE\n&#96;&#96;&#96;\nDiv(class:\&quot;mt-4\&quot;) {\n  \&quot;content\&quot;\n}\n&#96;&#96;&#96;\n\n##### SIBLINGS\n&#96;&#96;&#96;\nDiv(...) { ... }\nP(...) { ... }\nImage(...)\n&#96;&#96;&#96;\n\n#### 6. Text Node Rules\n\n##### TEXT_NODE\n- 무조건 double-quote string\n- 줄바꿈 포함 금지\n- 텍스트 덩어리는 여러 줄로 쪼개면 안 됨\n\n##### VALID\n&#96;&#96;&#96;\n\&quot;Sign in to continue\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n\&quot;Hello\n World\&quot;    // 줄바꿈 포함\n&#96;&#96;&#96;\n\n#### 7. Node Termination Rules\n\n##### CLOSING_RULES\n- 블록 노드는 반드시 &#96;}&#96; 단독 줄로 닫는다\n- inline-only 노드는 종료 블록 없음\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;px-4\&quot;) {\n  P {\n    \&quot;Hello\&quot;\n  }\n  Image(src:\&quot;/logo.png\&quot;)\n}\n&#96;&#96;&#96;\n\n#### 8. Layout Grammar Formal Pattern\n\n##### LAYOUT_NODE_GRAMMAR\n&#96;&#96;&#96;\nNode:\n  Tag (Attributes?) (ChildrenBlock?)\n\nTag:\n  IDENTIFIER\n\nAttributes:\n  \&quot;(\&quot; AttributeList \&quot;)\&quot;\n\nAttributeList:\n  Attribute (\&quot;,\&quot; Attribute)*\n\nAttribute:\n  IDENTIFIER \&quot;:\&quot; STRING\n\nChildrenBlock:\n  \&quot;{\&quot; NewLine Indented(NodeOrText)+ \&quot;}\&quot;\n\nNodeOrText:\n  Node | STRING\n&#96;&#96;&#96;\n\n#### 9. Validation Rules\n\n1. layout은 트리 구조만 표현한다\n2. inline attributes만 허용\n3. 속성은 string-only\n4. children은 반드시 정해진 중첩 규칙을 따른다\n5. Node 이름은 PascalCase가 기본\n6. 문자열 children 외에는 모든 children은 Node여야 한다\n7. siblings 허용, 순서 보존\n\n#### 10. Example (Valid Layout Tree)\n\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;min-h-screen flex flex-col\&quot;) {\n    Header(class:\&quot;p-4 bg-gray-100\&quot;) {\n      H1 {\n        \&quot;Dashboard\&quot;\n      }\n    }\n\n    Main(class:\&quot;flex-1 p-6\&quot;) {\n      Card(class:\&quot;shadow\&quot;) {\n        P {\n          \&quot;Welcome back!\&quot;\n        }\n      }\n    }\n\n    Footer(class:\&quot;p-4 text-center\&quot;) {\n      \&quot;© 2025 The Bespoke\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto\&quot;) {\n    Navbar(class:\&quot;flex justify-between items-center p-4\&quot;) {\n      Logo(class:\&quot;text-xl font-bold\&quot;) {\n        \&quot;UIH\&quot;\n      }\n      Nav(class:\&quot;space-x-4\&quot;) {\n        Link(href:\&quot;/home\&quot;) {\n          \&quot;Home\&quot;\n        }\n        Link(href:\&quot;/about\&quot;) {\n          \&quot;About\&quot;\n        }\n      }\n    }\n\n    Content(class:\&quot;grid grid-cols-3 gap-6 p-6\&quot;) {\n      Sidebar(class:\&quot;col-span-1 bg-gray-50 p-4\&quot;) {\n        Menu {\n          \&quot;Dashboard\&quot;\n          \&quot;Settings\&quot;\n          \&quot;Profile\&quot;\n        }\n      }\n\n      Main(class:\&quot;col-span-2\&quot;) {\n        Article(class:\&quot;prose\&quot;) {\n          H2 {\n            \&quot;Getting Started\&quot;\n          }\n          P {\n            \&quot;Welcome to UIH DSL documentation.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- TagName에 숫자/특수문자 시작 시 토큰화 실패\n- 속성에 boolean/number 값 사용 시 파싱 오류\n- 텍스트 노드에 줄바꿈 포함 시 validation 실패\n- 노드 종료 &#96;}&#96; 누락 시 구문 오류\n- 중첩 깊이가 너무 깊을 경우 (권장 5레벨 초과) 경고\n- siblings 간 순서가 UI 의미에 영향 줄 경우 재검토\n\n---\n\n### Parser BNF Grammar\n\nTokenizer 위에서 동작하는 공식 문법 엔진 정의입니다. Token Stream을 Abstract Syntax Tree(AST)로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- Token Stream → Abstract Syntax Tree(AST)\n\n##### PARSER_MODE\n- strict non-ambiguous grammar\n- no recovery parsing (에러는 즉시 throw)\n- deterministic (LLM-friendly)\n- recursive descent parser 기반 구조\n\n#### 2. Entry Point\n\n##### Program\n&#96;&#96;&#96;\nProgram ::= MetaBlock StyleBlock ComponentsBlock? LayoutBlock ScriptBlock? EOF\n&#96;&#96;&#96;\n\n#### 3. Blocks\n\n##### Block_Definitions\n&#96;&#96;&#96;\nMetaBlock       ::= \&quot;meta\&quot; BlockBody(MetaProperty)\nStyleBlock      ::= \&quot;style\&quot; BlockBody(StyleProperty)\nComponentsBlock ::= \&quot;components\&quot; BlockBody(ComponentEntry)\nLayoutBlock     ::= \&quot;layout\&quot; LayoutBody\nScriptBlock     ::= \&quot;script\&quot; BlockBody(ScriptProperty)\n&#96;&#96;&#96;\n\n#### 4. Generic Block Body\n\n##### BlockBody\n&#96;&#96;&#96;\nBlockBody(&lt;T&gt;) ::= LBRACE NEWLINE (Indent &lt;T&gt; NEWLINE)* RBRACE\nIndent         ::= WHITESPACE WHITESPACE    # 2 spaces only\n&#96;&#96;&#96;\n\n#### 5. META Block Grammar\n\n##### MetaProperty\n&#96;&#96;&#96;\nMetaProperty ::= Identifier \&quot;:\&quot; MetaValue\nMetaValue    ::= STRING | NUMBER | BOOLEAN | EnumString\n&#96;&#96;&#96;\n\n##### Allowed_Meta_Keys\n- title, route, theme, description\n\n#### 6. STYLE Block Grammar\n\n##### StyleProperty\n&#96;&#96;&#96;\nStyleProperty ::= StyleKey \&quot;:\&quot; StyleValue\nStyleKey      ::= Identifier ( \&quot;.\&quot; Identifier )*\nStyleValue    ::= STRING | NUMBER | EnumString\n&#96;&#96;&#96;\n\n##### Notes\n- no nested blocks\n- no boolean\n- layout-like attributes 금지\n\n#### 7. COMPONENTS Block Grammar\n\n##### ComponentEntry\n&#96;&#96;&#96;\nComponentEntry ::= ComponentName\nComponentName  ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n##### NOTES\n- but no quotes, no values, one per line\n\n##### Examples\n&#96;&#96;&#96;\nCard\nButton\nInput\n&#96;&#96;&#96;\n\n#### 8. LAYOUT Block Grammar (Core)\n\n##### LayoutBody\n&#96;&#96;&#96;\nLayoutBody     ::= LBRACE NEWLINE Indent LayoutNodeList RBRACE\nLayoutNodeList ::= (LayoutNode NEWLINE)*\nLayoutNode     ::= Tag (Attributes)? (ChildrenBlock)?\nTag            ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n#### 9. Attributes Grammar\n\n##### Attributes\n&#96;&#96;&#96;\nAttributes    ::= LPAREN AttributeList RPAREN\nAttributeList ::= Attribute (COMMA Attribute)*\nAttribute     ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n#### 10. Children Block Grammar\n\n##### ChildrenBlock\n&#96;&#96;&#96;\nChildrenBlock ::= LBRACE NEWLINE Indent ChildrenList RBRACE\nChildrenList  ::= (Child NEWLINE)*\nChild         ::= LayoutNode | TEXT_STRING\n&#96;&#96;&#96;\n\n#### 11. SCRIPT Block Grammar\n\n##### ScriptProperty\n&#96;&#96;&#96;\nScriptProperty ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n##### Allowed_Script_Keys\n- onclick, onload, onsubmit, onmount, onchange\n\n&gt; 모든 script event identifier는 전부 소문자여야 하며 camelCase를 사용하지 않는다.\n\n#### 12. Value Grammars\n\n##### Value_Types\n&#96;&#96;&#96;\nSTRING     ::= \&quot;\\\&quot;\&quot; &lt;chars&gt; \&quot;\\\&quot;\&quot;\nNUMBER     ::= digits ( \&quot;.\&quot; digits )?\nBOOLEAN    ::= \&quot;true\&quot; | \&quot;false\&quot;\nEnumString ::= STRING   # validated in semantic phase\n&#96;&#96;&#96;\n\n#### 13. Identifier Grammars\n\n##### Identifiers\n&#96;&#96;&#96;\nIdentifier ::= [a-z][a-z0-9.]*\nTagName    ::= [A-Z][a-zA-Z0-9]*\n&#96;&#96;&#96;\n\n#### 14. Syntax Constraints (Formal)\n\n1. 모든 블록은 순서 고정\n2. 각 블록은 1회만 등장\n3. meta/style/layout은 필수\n4. components/script는 optional\n5. 들여쓰기 2 spaces only\n6. 속성(colon)은 반드시 &#96;&lt;id&gt;: &lt;value&gt;&#96;\n7. semicolon 금지\n8. layout만 nested structure 허용\n9. children 안에서는 TEXT_STRING 또는 LayoutNode만 허용\n10. parser는 ambiguous branch 금지 (LLM-safe)\n\n#### 15. Complete Example (BNF-valid)\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  radius.default: 8\n}\n\ncomponents {\n  Card\n  Button\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello world\&quot;\n    }\n  }\n}\n\nscript {\n  onclick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### BNF 구조 트리\n\n&#96;&#96;&#96;\nProgram\n├── MetaBlock\n│   ├── LBRACE\n│   ├── MetaProperty (title: \&quot;Home\&quot;)\n│   ├── MetaProperty (route: \&quot;/\&quot;)\n│   └── RBRACE\n├── StyleBlock\n│   ├── LBRACE\n│   ├── StyleProperty (color.primary: \&quot;#0E5EF7\&quot;)\n│   ├── StyleProperty (radius.default: 8)\n│   └── RBRACE\n├── ComponentsBlock\n│   ├── LBRACE\n│   ├── ComponentEntry (Card)\n│   ├── ComponentEntry (Button)\n│   └── RBRACE\n├── LayoutBlock\n│   ├── LBRACE\n│   ├── LayoutNode (Div)\n│   │   ├── Attributes (class:\&quot;p-4\&quot;)\n│   │   └── ChildrenBlock\n│   │       └── LayoutNode (P)\n│   │           └── ChildrenBlock\n│   │               └── TEXT_STRING (\&quot;Hello world\&quot;)\n│   └── RBRACE\n└── ScriptBlock\n    ├── LBRACE\n    ├── ScriptProperty (onClick: \&quot;submitForm\&quot;)\n    └── RBRACE\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 즉시 파싱 중단\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유지 (경고)\n- 들여쓰기 2 space 위반 시 구문 오류\n- layout 외 블록에서 중첩 시도 시 파싱 실패\n- 허용되지 않은 키 사용 시 semantic 오류 (parser 단계에서는 허용)\n- TEXT_STRING이 layout 외 컨텍스트에서 등장 시 오류\n\n---\n\n## AST Schema Definition\n\nParser BNF 위에서 생성되는 최종 AST 구조입니다. 모든 UIH DSL 요소가 이 스키마에 따라 구조화됩니다.\n\n### 1. AST Root\n\n#### ASTRoot\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Program\&quot;\n  meta: MetaNode\n  style: StyleNode\n  components: ComponentsNode | null\n  layout: LayoutNode\n  script: ScriptNode | null\n}\n&#96;&#96;&#96;\n\n### 2. Meta Node\n\n#### MetaNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Meta\&quot;\n  properties: MetaProperty[]\n}\n&#96;&#96;&#96;\n\n#### MetaProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;title\&quot;\n  value: string|number|boolean\n  location: Range     // from tokenizer\n}\n&#96;&#96;&#96;\n\n### 3. Style Node\n\n#### StyleNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Style\&quot;\n  properties: StyleProperty[]\n}\n&#96;&#96;&#96;\n\n#### StyleProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;color.primary\&quot;\n  value: string|number\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 4. Components Node\n\n#### ComponentsNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Components\&quot;\n  components: ComponentEntry[]\n}\n&#96;&#96;&#96;\n\n#### ComponentEntry\n&#96;&#96;&#96;typescript\n{\n  name: string        // e.g. \&quot;Card\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 5. Layout Node (Core Tree Structure)\n\n#### LayoutNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Layout\&quot;\n  children: LayoutElement[]     // top-level nodes inside layout block\n}\n&#96;&#96;&#96;\n\n#### LayoutElement\n&#96;&#96;&#96;typescript\nLayoutElement = LayoutComponent | LayoutText\n&#96;&#96;&#96;\n\n#### 5.1 Layout Component\n&#96;&#96;&#96;typescript\nLayoutComponent {\n  type: \&quot;Component\&quot;\n  tag: string                   // e.g. \&quot;Div\&quot;, \&quot;P\&quot;, \&quot;Header\&quot;\n  attributes: Attribute[]\n  children: LayoutElement[]     // nested structure\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### Attribute\n&#96;&#96;&#96;typescript\n{\n  key: string                   // lower-case only\n  value: string                 // inline string only\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### 5.2 Layout Text Node\n&#96;&#96;&#96;typescript\nLayoutText {\n  type: \&quot;Text\&quot;\n  value: string                 // raw text string\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 6. Script Node\n\n#### ScriptNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Script\&quot;\n  events: ScriptProperty[]\n}\n&#96;&#96;&#96;\n\n#### ScriptProperty\n&#96;&#96;&#96;typescript\n{\n  key: string                   // e.g. \&quot;onclick\&quot; (lowercase only)\n  value: string                 // e.g. \&quot;submitForm\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 7. Range Object (Source Location)\n\n#### Range\n&#96;&#96;&#96;typescript\n{\n  start: Position\n  end: Position\n}\n&#96;&#96;&#96;\n\n#### Position\n&#96;&#96;&#96;typescript\n{\n  line: number\n  column: number\n}\n&#96;&#96;&#96;\n\n### 8. Semantics Rules (Validation Layer)\n\n1. Meta keys must be from allowlist:\n   - title, route, theme, description\n\n2. Style keys may use dot notation but MUST be lowercase.\n\n3. Components must be names only, no properties.\n\n4. Layout:\n   - tag must be a valid TagName or valid identifier\n   - attributes must be string-only\n   - children: array of LayoutElement (component or text)\n\n5. Script:\n   - keys must be known event names\n   - value must be string (function name)\n\n6. No null children arrays. Use &#96;[]&#96; if empty.\n\n7. All nodes must have location data.\n\n### 9. Example: Full AST for a Simple Page\n\n#### Example DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### Generated AST (simplified)\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Home\&quot; },\n      { \&quot;key\&quot;: \&quot;route\&quot;, \&quot;value\&quot;: \&quot;/\&quot; }\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;color.primary\&quot;, \&quot;value\&quot;: \&quot;#0E5EF7\&quot; }\n    ]\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: [\n          { \&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;p-4\&quot; }\n        ],\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n### AST 구조 트리\n\n&#96;&#96;&#96;\nASTRoot (Program)\n├── meta (MetaNode)\n│   └── properties[] (MetaProperty)\n├── style (StyleNode)\n│   └── properties[] (StyleProperty)\n├── components (ComponentsNode | null)\n│   └── components[] (ComponentEntry)\n├── layout (LayoutNode)\n│   └── children[] (LayoutElement)\n│       ├── LayoutComponent\n│       │   ├── attributes[] (Attribute)\n│       │   └── children[] (LayoutElement)\n│       └── LayoutText\n└── script (ScriptNode | null)\n    └── events[] (ScriptProperty)\n&#96;&#96;&#96;\n\n### AST Examples\n\n#### 최소 AST 구조\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      {\&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Minimal\&quot;}\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: []\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Text\&quot;,\n        \&quot;value\&quot;: \&quot;Content\&quot;\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n#### 복잡한 레이아웃 AST\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Layout\&quot;,\n  \&quot;children\&quot;: [\n    {\n      \&quot;type\&quot;: \&quot;Component\&quot;,\n      \&quot;tag\&quot;: \&quot;Div\&quot;,\n      \&quot;attributes\&quot;: [\n        {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;container\&quot;}\n      ],\n      \&quot;children\&quot;: [\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Header\&quot;,\n          \&quot;attributes\&quot;: [],\n          \&quot;children\&quot;: [\n            {\n              \&quot;type\&quot;: \&quot;Component\&quot;,\n              \&quot;tag\&quot;: \&quot;H1\&quot;,\n              \&quot;attributes\&quot;: [],\n              \&quot;children\&quot;: [\n                {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Title\&quot;}\n              ]\n            }\n          ]\n        },\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Main\&quot;,\n          \&quot;attributes\&quot;: [\n            {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;content\&quot;}\n          ],\n          \&quot;children\&quot;: [\n            {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Main content\&quot;}\n          ]\n        }\n      ]\n    }\n  ]\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- location 정보 누락 시 AST 생성 실패\n- 빈 children 배열 대신 null 사용 시 validation 오류\n- 허용되지 않은 meta/style/script 키 사용 시 semantic 오류\n- LayoutComponent의 tag가 유효하지 않은 경우 오류\n- LayoutText에 빈 문자열 사용 시 경고\n- 중첩 깊이가 너무 깊을 경우 (10레벨 초과) 경고 또는 오류\n\n---\n\n## IR (Intermediate Representation) Specification\n\nAST → IR 변환 규칙을 정의합니다. Codegen 단계 직전의 \&quot;정규화된 구조\&quot;로, 플랫폼불문의 공통 인터페이스를 제공합니다.\n\n### 1. Overview\n\n#### IR_GOAL\n- AST의 복잡한 구조를 코드 생성하기 좋게 단순화\n- UI 컴포넌트 트리와 메타데이터를 정규화\n- 플랫폼불문(React/Next/Svelte) 공통 인터페이스로 변환\n- 모든 값은 최종적이고 확정된 형태만 유지\n\n#### INPUT\n- ASTRoot\n\n#### OUTPUT\n- IRRoot\n\n### 2. IR Root\n\n#### IRRoot\n&#96;&#96;&#96;typescript\n{\n  meta: IRMeta\n  style: IRStyle\n  components: IRComponents\n  layout: IRLayoutTree\n  script: IRScript\n}\n&#96;&#96;&#96;\n\n### 3. IRMeta (Final Document Metadata)\n\n#### IRMeta\n&#96;&#96;&#96;typescript\n{\n  title: string\n  route: string\n  theme: \&quot;light\&quot; | \&quot;dark\&quot;\n  description: string | null\n}\n&#96;&#96;&#96;\n\n#### Rules\n- missing values become null\n- enforce route starts with \&quot;/\&quot;\n\n### 4. IRStyle (Flattened Style Tokens)\n\n#### IRStyle\n&#96;&#96;&#96;typescript\n{\n  tokens: Record&lt;string, string | number&gt;\n}\n&#96;&#96;&#96;\n\n#### Examples\n&#96;&#96;&#96;typescript\n{\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n  \&quot;radius.default\&quot;: 8\n}\n&#96;&#96;&#96;\n\n#### Rules\n- dot-notation keys preserved\n- all values converted to primitive string/number\n- no validation here (semantic pass already done)\n\n### 5. IRComponents (Registered Component Map)\n\n#### IRComponents\n&#96;&#96;&#96;typescript\n{\n  list: string[]   // e.g. [\&quot;Card\&quot;, \&quot;Button\&quot;]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- duplicates removed\n- sorted alphabetically for deterministic output\n\n### 6. IRLayoutTree (Normalized UI Tree)\n\n#### IRLayoutTree\n&#96;&#96;&#96;typescript\n{\n  root: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### IRNode\n&#96;&#96;&#96;typescript\nIRNode = IRComponentNode | IRTextNode\n&#96;&#96;&#96;\n\n#### 6.1 IRComponentNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;component\&quot;\n  tag: string\n  attributes: Record&lt;string, string&gt;   // key:string only\n  children: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- attribute keys lower-case enforced\n- children always array\n- empty children =&gt; []\n\n#### 6.2 IRTextNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;text\&quot;\n  value: string\n}\n&#96;&#96;&#96;\n\n#### Rules\n- trimmed text preserved exactly\n- no newline allowed inside text\n\n### 7. IRScript (Event Map)\n\n#### IRScript\n&#96;&#96;&#96;typescript\n{\n  events: Record&lt;string, string&gt;   // onclick → \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Rules\n- all keys normalized to lower-case event names\n- camelCase event keys는 허용되지 않음 (validation 단계에서 차단)\n- event value must be string only\n- duplicates override earlier definitions\n\n### 8. AST → IR Mapping Rules\n\n1. **MetaNode → IRMeta**\n   - convert property array → object map\n   - apply default values if missing\n   - route must start with \&quot;/\&quot;\n\n2. **StyleNode → IRStyle**\n   - flatten list into tokens object\n   - preserve ordering but output sorted keys for determinism\n\n3. **ComponentsNode → IRComponents**\n   - convert component list → array\n   - remove duplicates\n   - sort alphabetically\n\n4. **LayoutNode → IRLayoutTree**\n   - recursively convert LayoutComponent → IRComponentNode\n   - convert LayoutText → IRTextNode\n   - inline attributes converted to plain object\n\n5. **ScriptNode → IRScript**\n   - property list flattened to event map\n   - enforce lower-case event names\n\n### 9. Example: Full IR Output\n\n#### DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### IR\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Home\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: null,\n    \&quot;description\&quot;: null\n  },\n\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n    }\n  },\n\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: []\n  },\n\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: { \&quot;class\&quot;: \&quot;p-4\&quot; },\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {}\n  }\n}\n&#96;&#96;&#96;\n\n### IR 구조 트리\n\n&#96;&#96;&#96;\nIRRoot\n├── meta (IRMeta)\n│   ├── title: string\n│   ├── route: string\n│   ├── theme: \&quot;light\&quot;|\&quot;dark\&quot;|null\n│   └── description: string|null\n├── style (IRStyle)\n│   └── tokens: Record&lt;string, string|number&gt;\n├── components (IRComponents)\n│   └── list: string[]\n├── layout (IRLayoutTree)\n│   └── root: IRNode[]\n│       ├── IRComponentNode\n│       │   ├── type: \&quot;component\&quot;\n│       │   ├── tag: string\n│       │   ├── attributes: Record&lt;string, string&gt;\n│       │   └── children: IRNode[]\n│       └── IRTextNode\n│           ├── type: \&quot;text\&quot;\n│           └── value: string\n└── script (IRScript)\n    └── events: Record&lt;string, string&gt;\n&#96;&#96;&#96;\n\n### IR Examples\n\n#### 간단한 IR 변환\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Simple\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: \&quot;light\&quot;,\n    \&quot;description\&quot;: null\n  },\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#000\&quot;,\n      \&quot;font.size\&quot;: 14\n    }\n  },\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: [\&quot;Button\&quot;]\n  },\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: {},\n        \&quot;children\&quot;: [\n          {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Content\&quot;}\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {\n      \&quot;onclick\&quot;: \&quot;handleClick\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 복잡한 중첩 레이아웃 IR\n&#96;&#96;&#96;json\n{\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Container\&quot;,\n        \&quot;attributes\&quot;: {\n          \&quot;class\&quot;: \&quot;flex flex-col min-h-screen\&quot;\n        },\n        \&quot;children\&quot;: [\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Header\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;p-4 bg-blue-600\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;H1\&quot;,\n                \&quot;attributes\&quot;: {},\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Dashboard\&quot;}\n                ]\n              }\n            ]\n          },\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Main\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;flex-1 p-6\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;Card\&quot;,\n                \&quot;attributes\&quot;: {\n                  \&quot;class\&quot;: \&quot;bg-white shadow-lg rounded\&quot;\n                },\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Welcome!\&quot;}\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- AST에 location 정보 누락 시 IR 변환 실패\n- route가 \&quot;/\&quot;로 시작하지 않을 경우 변환 시 강제 추가\n- 중복 컴포넌트 등록 시 알파벳 순 정렬로 중복 제거\n- 빈 children 배열을 null로 잘못 설정 시 []로 강제 변환\n- 텍스트 노드에 줄바꿈 포함 시 변환 중 제거 또는 오류\n- 이벤트 키 대소문자 혼재 시 소문자로 통일\n- 스타일 토큰 키 순서가 다를 경우 sorted keys로 결정적 출력 보장\n\n---\n\n## Codegen Rules\n\n### React/Next.js 15 Codegen\n\nIR을 기반으로 안정적인 UI 코드 생성 규칙입니다. React/Next.js 15 (App Router + RSC) 기준으로 IR을 실제 코드로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- IR을 기반으로 안정적인 UI 코드 생성\n- React/Next.js 15 (App Router + RSC) 기준\n- \&quot;디자인 시스템 없는 순수 Layout Tree\&quot;를 코드로 변환\n- 가능한 한 deterministic 하게 출력\n- 로직/상태/이벤트는 최소 수준으로만 개입\n\n##### INPUT\n- IRRoot\n\n##### OUTPUT\n- React Component Source Code (string)\n\n#### 2. Output Structure\n\n파일 구조는 다음 형태로 생성합니다:\n\n&#96;&#96;&#96;\n/page.tsx\n  - metadata (title, description)\n  - default export function Page()\n  - return(...) 내부에 layout tree 삽입\n\n/style-tokens.ts\n  - style.tokens flatten export\n\n/components/index.ts\n  - components registry export\n\n/script-events.ts\n  - event name string mapping export\n&#96;&#96;&#96;\n\n#### 3. Metadata Codegen\n\n##### UIH meta → Next.js metadata\n&#96;&#96;&#96;typescript\nIRMeta {\n  title: string\n  description: string\n}\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;typescript\nexport const metadata = {\n  title: \&quot;&lt;title&gt;\&quot;,\n  description: \&quot;&lt;description&gt;\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- description 없으면 필드 제외\n- theme는 metadata에 직접 쓰지 않음 (스타일토큰 용)\n\n#### 4. Style Token Codegen\n\n##### IRStyle { tokens }\n&#96;&#96;&#96;typescript\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;radius.default\&quot;: 8,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 키는 string 리터럴 그대로\n- numeric/string 그대로 출력\n- sorted keys for deterministic output\n\n#### 5. Component Registry Codegen\n\n##### IRComponents.list → export list\n&#96;&#96;&#96;typescript\nexport const components = {\n  Card,\n  Button,\n  Input,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 자동 import 하지 않음 (상위 시스템이 resolve)\n- keys는 PascalCase 유지\n- duplicates 제거 후 정렬\n\n#### 6. Layout Tree → JSX Codegen\n\n##### IRLayoutTree → React element tree\n\n##### 6.1 Component Node\n&#96;&#96;&#96;typescript\nIRComponentNode {\n  tag: \&quot;Div\&quot;\n  attributes: { class: \&quot;p-4\&quot; }\n  children: [...]\n}\n&#96;&#96;&#96;\n\n##### OUTPUT JSX\n&#96;&#96;&#96;jsx\n&lt;Div className=\&quot;p-4\&quot;&gt;\n  {children...}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n##### RULES\n- attribute.key \&quot;class\&quot; → \&quot;className\&quot;\n- attribute key는 그대로 lower-case 유지\n- value는 string literal\n- children length 0 이면 self-closing 금지 (always explicit block)\n- tag name 그대로 JSX 컴포넌트로 사용\n\n##### 6.2 Text Node\n&#96;&#96;&#96;typescript\nIRTextNode { value: \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;jsx\n{\&quot;Hello\&quot;}\n&#96;&#96;&#96;\n\n##### RULES\n- 텍스트는 JSX children 표현\n- 특수문자는 자동 escape\n\n#### 7. Script Event Codegen\n\n##### IRScript.events → export mapping\n&#96;&#96;&#96;typescript\nexport const eventHandlers = {\n  onclick: \&quot;submitForm\&quot;,\n  onload: \&quot;init\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- event 이름은 lower-case normalized\n- 값은 string (함수명)\n- 실제 JS 함수 body는 생성하지 않음\n- 나중 시스템이 자동 wire-up 함\n\n#### 8. Full Page Generation\n\n최종 page.tsx는 다음 구조를 따릅니다:\n\n&#96;&#96;&#96;typescript\nexport const metadata = { ... };\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen p-4\&quot;&gt;\n      &lt;P&gt;{\&quot;Hello\&quot;}&lt;/P&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### RULES\n- 최상위는 항상 &#96;&lt;Div&gt;&#96; 같은 Wrapper로 시작하지 않아도 됨\n- layout.root가 배열이면 Fragment로 감싼다\n- 코드 스타일은 2-space indent\n- 세미콜론 붙이지 않음 (Prettier 옵션 따라감)\n\n#### 9. Determinism Rules\n\n1. 속성 순서는 key 알파벳순 정렬\n2. children 순서는 DSL 입력 순서 그대로\n3. components 목록은 알파벳순 정렬\n4. styleTokens도 key 정렬\n5. eventHandlers key 정렬\n6. output JSX는 항상 multiline\n\n#### 10. Full Example (DSL → IR → JSX)\n\n##### DSL\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n##### JSX OUT\n&#96;&#96;&#96;typescript\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;p-4\&quot;&gt;\n      {\&quot;Hello\&quot;}\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n#### 11. Notes for Engine Integrators\n\n1. Codegen은 \&quot;순수 구조\&quot;만 책임진다\n   - 상태(state), fetch, useEffect 등은 지원하지 않음\n2. 이벤트 핸들러는 단순 라벨링 시스템\n3. 스타일 토큰은 UI 프레임워크에서 직접 해석\n4. React, Vue, Svelte 등 플랫폼별 코드젠 가능\n   - 플랫폼별 레이어는 분리\n\n#### Output Files 구조\n\n&#96;&#96;&#96;\nOutput Files\n├── page.tsx\n│   ├── metadata export\n│   ├── imports (components, styleTokens, eventHandlers)\n│   ├── Page() function\n│   └── JSX return (layout tree)\n├── style-tokens.ts\n│   └── styleTokens export\n├── components/index.ts\n│   └── components export\n└── script-events.ts\n    └── eventHandlers export\n&#96;&#96;&#96;\n\n#### Codegen Examples\n\n##### 전체 페이지 코드 생성 예시\n&#96;&#96;&#96;typescript\n// page.tsx\nexport const metadata = {\n  title: \&quot;Dashboard\&quot;,\n  description: \&quot;Main dashboard page\&quot;\n};\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen flex flex-col\&quot;&gt;\n      &lt;Header className=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n        &lt;H1&gt;\n          {\&quot;Dashboard\&quot;}\n        &lt;/H1&gt;\n      &lt;/Header&gt;\n      &lt;Main className=\&quot;flex-1 p-6\&quot;&gt;\n        &lt;Card className=\&quot;bg-white shadow-lg rounded-lg p-6\&quot;&gt;\n          &lt;P&gt;\n            {\&quot;Welcome back!\&quot;}\n          &lt;/P&gt;\n        &lt;/Card&gt;\n      &lt;/Main&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### 스타일 토큰 파일 예시\n&#96;&#96;&#96;typescript\n// style-tokens.ts\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;color.secondary\&quot;: \&quot;#6B7280\&quot;,\n  \&quot;color.accent\&quot;: \&quot;#F59E0B\&quot;,\n  \&quot;spacing.small\&quot;: 8,\n  \&quot;spacing.medium\&quot;: 16,\n  \&quot;spacing.large\&quot;: 24,\n  \&quot;border.radius\&quot;: 6,\n  \&quot;font.family\&quot;: \&quot;Inter\&quot;,\n  \&quot;font.size.base\&quot;: 16,\n  \&quot;shadow.default\&quot;: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n};\n&#96;&#96;&#96;\n\n##### 컴포넌트 레지스트리 예시\n&#96;&#96;&#96;typescript\n// components/index.ts\nexport const components = {\n  Button,\n  Card,\n  Input,\n  Modal,\n  Sidebar\n};\n&#96;&#96;&#96;\n\n##### 이벤트 핸들러 파일 예시\n&#96;&#96;&#96;typescript\n// script-events.ts\nexport const eventHandlers = {\n  onclick: \&quot;handleClick\&quot;,\n  onload: \&quot;initDashboard\&quot;,\n  onsubmit: \&quot;processForm\&quot;\n};\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- layout.root가 빈 배열일 경우 빈 Fragment 생성\n- 컴포넌트 이름이 JavaScript 예약어와 충돌 시 escaping 필요\n- 텍스트에 JSX 특수문자 포함 시 자동 escape\n- 중첩 깊이가 깊을 경우 코드 포맷팅 유지\n- import 경로 resolve 실패 시 상위 시스템에서 처리\n- styleTokens에 특수문자 키 포함 시 유효한 JS 객체 키로 변환\n\n---\n\n### Vue &amp; Svelte Codegen\n\nReact Codegen과 동일한 IR 기반으로 Vue와 Svelte 코드를 생성하는 규칙입니다. 플랫폼별 렌더링 규칙만 다르게 적용합니다.\n\n## SECTION A — Vue Codegen (SFC 기준)\n\n### GOAL\n- IR → .vue 파일 형태로 변환\n- &#96;&lt;template&gt;&#96; + &#96;&lt;script setup&gt;&#96; + &#96;&lt;style&gt;&#96; 구조 유지\n- 모든 로직은 배제하고 구조만 생성\n\n### OUTPUT FILE STRUCTURE\n&#96;&#96;&#96;\nMyPage.vue\n&#96;&#96;&#96;\n\n### 1. Top-Level Structure\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;!-- layout tree --&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport components...\n\nconst events = {...}\nconst styleTokens = {...}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* optional if needed */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Vue Template 규칙\n\n#### IRComponentNode(tag:\&quot;Div\&quot;, attributes, children)\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  &lt;!-- children --&gt;\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;className&#96; → &#96;class&#96;\n- attribute values: string only\n- children: 그대로 template로 변환\n- Fragment는 &#96;&lt;template&gt;&#96; 안에서 그냥 siblings로 출력\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello (그대로 text node)\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\neventHandlers {\n  onclick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Vue OUTPUT\n&#96;&#96;&#96;vue\n@click=\&quot;submitForm\&quot;\n&#96;&#96;&#96;\n\n#### RULES\n- DSL &#96;onclick&#96; → Vue &#96;@click&#96;\n- DSL &#96;onchange&#96; → Vue &#96;@change&#96;\n- DSL &#96;oninput&#96; → Vue &#96;@input&#96;\n- DSL &#96;onload&#96; → Vue &#96;@load&#96;\n- value는 함수 이름 string\n- 함수 구현은 생성하지 않음\n\n### 4. Component Registry (imports)\n&#96;&#96;&#96;javascript\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules\n- 속성(sorted)\n- imports(sorted)\n- children 순서 그대로\n- no semicolons\n- template 들여쓰기 2 spaces\n\n## SECTION B — Svelte Codegen (.svelte)\n\n### GOAL\n- Svelte 컴포넌트 파일 하나로 완성\n- &#96;&lt;script&gt;&#96; + markup 구조\n\n### OUTPUT STRUCTURE\n&#96;&#96;&#96;\nMyPage.svelte\n&#96;&#96;&#96;\n\n### 1. File Layout\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import components...\n  export let events = {...}\n  export let styleTokens = {...}\n&lt;/script&gt;\n\n&lt;!-- layout markup --&gt;\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  Hello\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* optional */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Svelte Markup\n\n#### IRComponentNode(tag, attributes, children)\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  {#if ... ?} (없음)\n  {children}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- 클래스는 &#96;class&#96;\n- 속성 문자열만\n- Self-closing 금지\n- children 재귀적 삽입\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\nIRScript:\nonClick → function name\n&#96;&#96;&#96;\n\n#### Svelte OUTPUT\n&#96;&#96;&#96;svelte\non:click={submitForm}\n&#96;&#96;&#96;\n\n#### Mapping\n&#96;&#96;&#96;\nonClick   → on:click\nonChange  → on:change\nonInput   → on:input\nonLoad    → on:load\n&#96;&#96;&#96;\n\n### 4. Components Import\n&#96;&#96;&#96;javascript\nimport Card from \&quot;./Card.svelte\&quot;;\nimport Button from \&quot;./Button.svelte\&quot;;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules (필수)\n\n1. import 순서는 알파벳 정렬\n2. attributes sorted\n3. event names lower-case\n4. children 순서 보존\n5. markup 들여쓰기 2 spaces\n\n## SECTION C — Cross-Platform Notes\n\n1. React / Vue / Svelte 모두 IR만 참조\n2. layout tree는 그대로 세 렌더러에서 재활용\n3. event handler는 단순 label → framework alias로 변환\n4. styleTokens는 컴파일러 외부 시스템이 처리\n5. components는 registry 기반으로 import만 생성\n\n## SECTION D — Example Conversion (Same IR → Vue/Svelte)\n\n### IR\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) { \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n### Vue Template\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Svelte Markup\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte 구조\n\n&#96;&#96;&#96;\nVue Output (.vue)\n├── &lt;template&gt;\n│   └── layout tree (Vue template syntax)\n├── &lt;script setup&gt;\n│   ├── component imports\n│   ├── events object\n│   └── styleTokens object\n└── &lt;style scoped&gt;\n    └── optional styles\n\nSvelte Output (.svelte)\n├── &lt;script&gt;\n│   ├── component imports\n│   ├── export let events = {...}\n│   └── export let styleTokens = {...}\n├── layout markup (Svelte syntax)\n└── &lt;style&gt;\n    └── optional styles\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte Examples\n\n#### Vue SFC 전체 예시\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n    &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n      &lt;H1&gt;\n        Dashboard\n      &lt;/H1&gt;\n    &lt;/Header&gt;\n    &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n      &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; @click=\&quot;handleCardClick\&quot;&gt;\n        &lt;P&gt;\n          Welcome back!\n        &lt;/P&gt;\n      &lt;/Card&gt;\n    &lt;/Main&gt;\n  &lt;/Div&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n\nconst events = {\n  handleCardClick: \&quot;handleCardClick\&quot;\n}\n\nconst styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;spacing.medium\&quot;: 16\n}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### Svelte 컴포넌트 전체 예시\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import Card from \&quot;./Card.svelte\&quot;;\n  import Button from \&quot;./Button.svelte\&quot;;\n\n  export let events = {\n    handleCardClick: \&quot;handleCardClick\&quot;\n  };\n\n  export let styleTokens = {\n    \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n    \&quot;spacing.medium\&quot;: 16\n  };\n&lt;/script&gt;\n\n&lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n  &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n    &lt;H1&gt;\n      Dashboard\n    &lt;/H1&gt;\n  &lt;/Header&gt;\n  &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n    &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; on:click={handleCardClick}&gt;\n      &lt;P&gt;\n        Welcome back!\n      &lt;/P&gt;\n    &lt;/Card&gt;\n  &lt;/Main&gt;\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### 이벤트 매핑 비교\n&#96;&#96;&#96;javascript\n// 동일한 IR 이벤트\n{\n  onClick: \&quot;handleClick\&quot;,\n  onChange: \&quot;handleChange\&quot;,\n  onLoad: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;vue\n&lt;!-- Vue --&gt;\n&lt;Button @click=\&quot;handleClick\&quot; @change=\&quot;handleChange\&quot; @load=\&quot;init\&quot;&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;svelte\n&lt;!-- Svelte --&gt;\n&lt;Button on:click={handleClick} on:change={handleChange} on:load={init}&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;jsx\n&lt;!-- React --&gt;\n&lt;Button onClick={handleClick} onChange={handleChange} onLoad={init}&gt;\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- Vue에서 컴포넌트 이름이 kebab-case로 변환 필요 시 자동 처리\n- Svelte에서 export let 구문이 예약어와 충돌 시 renaming\n- 이벤트 핸들러가 정의되지 않은 경우 플랫폼별 기본 동작\n- 스타일 토큰에 CSS 변수나 함수 포함 시 escaping\n- 중첩 컴포넌트 깊이가 깊을 경우 플랫폼별 최적화 적용\n- 텍스트 콘텐츠에 플랫폼별 특수문자 포함 시 자동 escape\n\n---\n\n## Examples\n\n### 완전한 UIH DSL 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;User Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main user dashboard with analytics\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  color.accent: \&quot;#F59E0B\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n  font.size.h1: 32\n  spacing.small: 8\n  spacing.medium: 16\n  spacing.large: 24\n  border.radius: 6\n  shadow.default: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n  Sidebar\n  Chart\n}\n\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto p-6\&quot;) {\n    Header(class:\&quot;mb-8\&quot;) {\n      Div(class:\&quot;flex justify-between items-center\&quot;) {\n        H1(class:\&quot;text-3xl font-bold\&quot;) {\n          \&quot;Dashboard\&quot;\n        }\n        Button(class:\&quot;px-4 py-2 bg-blue-600 text-white rounded\&quot;) {\n          \&quot;New Report\&quot;\n        }\n      }\n    }\n\n    Div(class:\&quot;grid grid-cols-3 gap-6\&quot;) {\n      Card(class:\&quot;col-span-2\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Analytics Overview\&quot;\n        }\n        Chart(class:\&quot;w-full h-64\&quot;)\n      }\n\n      Card(class:\&quot;col-span-1\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Quick Stats\&quot;\n        }\n        Div(class:\&quot;space-y-4\&quot;) {\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Total Users\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;1,234\&quot;\n            }\n          }\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Active Sessions\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;89\&quot;\n            }\n          }\n        }\n      }\n    }\n\n    Sidebar(class:\&quot;mt-8\&quot;) {\n      H3(class:\&quot;text-lg mb-4\&quot;) {\n        \&quot;Recent Activity\&quot;\n      }\n      Div(class:\&quot;space-y-2\&quot;) {\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;User john@example.com logged in\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;New report generated\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;System backup completed\&quot;\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onLoad: \&quot;initDashboard\&quot;\n  onClick: \&quot;handleButtonClick\&quot;\n  onRefresh: \&quot;refreshData\&quot;\n}\n&#96;&#96;&#96;\n\n### 최소 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Minimal Page\&quot;\n  route: \&quot;/minimal\&quot;\n  theme: \&quot;light\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  spacing.unit: 12\n}\n\nlayout {\n  Div(class:\&quot;min-h-screen flex items-center justify-center bg-gray-50\&quot;) {\n    \&quot;Coming soon\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n### Form 중심 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Sign Up\&quot;\n  route: \&quot;/signup\&quot;\n  theme: \&quot;light\&quot;\n  description: \&quot;Create a new account\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#2563EB\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n}\n\ncomponents {\n  Form\n  Input\n  Button\n  Alert\n}\n\nlayout {\n  Section(class:\&quot;min-h-screen flex items-center justify-center bg-gray-100\&quot;) {\n    Form(class:\&quot;w-full max-w-md space-y-6 bg-white p-8 rounded-xl shadow-lg\&quot;) {\n      H2(class:\&quot;text-2xl font-semibold text-gray-900\&quot;) {\n        \&quot;Create your account\&quot;\n      }\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;email\&quot;, placeholder:\&quot;Enter email\&quot;)\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;password\&quot;, placeholder:\&quot;Enter password\&quot;)\n      Button(class:\&quot;w-full bg-blue-600 text-white py-3 rounded-lg\&quot;) {\n        \&quot;Sign up\&quot;\n      }\n      Alert(class:\&quot;text-sm text-gray-500 text-center\&quot;) {\n        \&quot;By signing up you agree to our terms\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onSubmit: \&quot;handleSignup\&quot;\n  onLoad: \&quot;prefillFromInvite\&quot;\n}\n&#96;&#96;&#96;\n\n### 콘텐츠 피드 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Creator Feed\&quot;\n  route: \&quot;/feed\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Realtime creator activity feed\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#22D3EE\&quot;\n  color.background: \&quot;#0F172A\&quot;\n  font.family: \&quot;Space Grotesk\&quot;\n  spacing.medium: 20\n  radius.card: 12\n}\n\ncomponents {\n  Shell\n  Sidebar\n  Feed\n  FeedItem\n  Avatar\n  Badge\n}\n\nlayout {\n  Shell(class:\&quot;min-h-screen bg-slate-950 text-slate-100\&quot;) {\n    Sidebar(class:\&quot;w-64 border-r border-slate-800 p-6 space-y-6\&quot;) {\n      H1(class:\&quot;text-xl font-semibold tracking-tight\&quot;) {\n        \&quot;Creator Hub\&quot;\n      }\n      Badge(class:\&quot;inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 text-slate-200\&quot;) {\n        \&quot;Live updates\&quot;\n      }\n    }\n    Feed(class:\&quot;flex-1 p-8 space-y-6\&quot;) {\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-cyan-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;heymina.studio\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-300\&quot;) {\n              \&quot;New drop\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Dropped a limited neon kit — 120 packs sold out in 3 minutes.\&quot;\n          }\n        }\n      }\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-pink-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;luvv.wav\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-cyan-500/10 text-cyan-300\&quot;) {\n              \&quot;Stream recap\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Hit 18,245 live viewers tonight — chat requested a synthwave encore.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onRefresh: \&quot;fetchLatestFeed\&quot;\n  onClick: \&quot;openCreatorProfile\&quot;\n}\n&#96;&#96;&#96;\n\n---\n\n## Version\n\n- **Version**: 1.0.0\n- **Last Update**: 2025-11-18\n- **Change Summary**: Complete guide consolidating all UIH DSL specifications\n\n---\n\n## 문서 끝\n\n이 문서는 UIH DSL의 모든 스펙을 \&quot;생략 없이\&quot; 하나의 파일로 통합한 완전판입니다. Foundation Layer부터 Codegen까지 전 과정을 포함하며, LLM이 UI를 정확하게 선언할 수 있도록 설계된 모든 규칙이 담겨 있습니다.\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Searching for Svelte event mappings**</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "on:click" in "/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md" • 4 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `docs/uih-dsl-complete-guide.md` | `on:click=\{submitForm\}` | L2576 |
| `docs/uih-dsl-complete-guide.md` | `onClick   → on:click` | L2581 |
| `docs/uih-dsl-complete-guide.md` | `<Card class="bg-white shadow-lg rounded-lg p-6" on:click=\{handleCardClick\}>` | L2712 |
| `docs/uih-dsl-complete-guide.md` | `<Button on:click=\{handleClick\} on:change=\{handleChange\} on:load=\{init\}>` | L2742 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating Svelte output snippet**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating event handler mapping**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;fa36587e-9d70-49fe-aaf1-53d11f66b042&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  &#96;&#96;&#96;javascript\n  IRScript:\n- onClick → function name\n+ onclick → function name\n  &#96;&#96;&#96;\n  &quot;,
        &quot;oldStart&quot;: 2569,
        &quot;newStart&quot;: 2569,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;  #### Mapping\n  &#96;&#96;&#96;\n- onClick   → on:click\n- onChange  → on:change\n- onInput   → on:input\n- onLoad    → on:load\n+ onclick   → on:click\n+ onchange  → on:change\n+ oninput   → on:input\n+ onload    → on:load\n  &#96;&#96;&#96;\n  &quot;,
        &quot;oldStart&quot;: 2579,
        &quot;newStart&quot;: 2579,
        &quot;oldLines&quot;: 8,
        &quot;newLines&quot;: 8,
        &quot;linesRemoved&quot;: 4,
        &quot;linesAdded&quot;: 4
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;,
  &quot;contentsAfterEdit&quot;: &quot;# UIH DSL — Complete Guide (생략 없는 완전판)\n\n## Table of Contents\n\n1. [Overview](#overview)\n2. [Philosophy &amp; Design Principles](#philosophy--design-principles)\n3. [Foundation Layer](#foundation-layer)\n4. [Tokenizer Specification](#tokenizer-specification)\n5. [Grammar](#grammar)\n   - [Block Grammar](#block-grammar)\n   - [Property Grammar](#property-grammar)\n   - [Layout Tree Grammar](#layout-tree-grammar)\n   - [Parser BNF Grammar](#parser-bnf-grammar)\n6. [AST Schema Definition](#ast-schema-definition)\n7. [IR (Intermediate Representation) Specification](#ir-intermediate-representation-specification)\n8. [Codegen Rules](#codegen-rules)\n   - [React/Next.js 15 Codegen](#reactnextjs-15-codegen)\n   - [Vue &amp; Svelte Codegen](#vue--svelte-codegen)\n9. [Examples](#examples)\n10. [Version](#version)\n\n---\n\n## Overview\n\nUIH DSL (Universal Interface Hierarchy Domain Specific Language) v2는 **\&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;**를 목표로 하는 도메인 특화 언어입니다.\n\n### 핵심 목표\n- LLM이 UI 구조를 **정확하게** 선언할 수 있도록 설계\n- 모호성 제거 및 결정성(determinism) 보장\n- 사람보다 AI가 더 효과적으로 사용 가능한 DSL\n- UI 구조의 선언적 표현에 집중\n\n### 아키텍처 흐름\n&#96;&#96;&#96;\nDSL 문자열 → Tokenizer → Parser → AST → IR → Codegen → React/Vue/Svelte 코드\n&#96;&#96;&#96;\n\n### 주요 특징\n- 한 줄에 하나의 의미만 (One-intent-per-line)\n- 선택적 문법 금지 - 모든 것이 명시적\n- 쌍따옴표만 허용, 세미콜론 없음\n- 주석 지원 안 함 (모호성 제거)\n- 고정 블록 순서: meta → style → components → layout → script\n\n---\n\n## Philosophy &amp; Design Principles\n\nUIH DSL은 \&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;를 목표로 하는 도메인 특화 언어입니다. 사람보다 LLM이 더 효과적으로 사용할 수 있도록 설계되었으며, UI 구조의 선언적 표현에 집중합니다.\n\n### 1. LLM 친화적 설계 원칙\n\nLLM이 읽고 쓰기 편한 DSL을 지향합니다. 구조는 최대한 명확하고 모호성이 없으며, 선택적 문법을 금지합니다. LLM이 패턴을 쉽게 반복할 수 있는 형태로 자연어 번역 난이도를 낮췄습니다.\n\n### 2. 선언적 UI 설계\n\nUI는 로직 기반보다 구조 기반으로 설계합니다. \&quot;무엇을 만든다\&quot;에 집중하며 \&quot;어떻게 만든다\&quot;는 Codegen이 담당합니다. 상태, 이벤트, 애니메이션은 추상화 계층으로 밀어냅니다.\n\n### 3. 한 줄 한 의미 원칙 (One-intent-per-line)\n\n한 라인에 하나의 의미만 허용합니다. 한 줄에 두 개 의미를 섞으면 LLM이 실수할 가능성이 높아집니다.\n\n#### 좋은 예: 한 줄 한 의미\n&#96;&#96;&#96;dsl\nmeta:\n  title: \&quot;Home\&quot;\n\nmeta:\n  route: \&quot;/\&quot;\n&#96;&#96;&#96;\n\n#### 나쁜 예: 한 줄 다중 의미 (금지)\n&#96;&#96;&#96;dsl\nmeta: title: \&quot;Home\&quot;, route: \&quot;/\&quot;  # 잘못된 예\n&#96;&#96;&#96;\n\n### 4. 고정 블록 순서\n\n블록 구조는 **meta → style → components → layout → script** 순서를 유지합니다. 이 순서는 LLM이 외우기 쉽고 Codegen의 예측 가능성과 AST의 결정성을 보장합니다.\n\n### 5. 최소 표현, 최대 의미\n\nDSL은 짧고 규칙적이어야 합니다. CSS-like verbose, YAML 계층 증가, JSX 로직 섞임을 금지합니다. 의미 전달에 집중하는 최소 선언적 DSL입니다.\n\n### 6. 오류 제로 문법\n\n\&quot;AI가 틀릴 수 없는 언어\&quot;를 목표로 합니다. 쌍따옴표만 허용하고 세미콜론 없이 콜론만 사용합니다. 모든 키는 고정된 string literal이며 optional field를 최소화합니다.\n\n### 7. AST 1:1 매핑\n\n모든 UI 요소가 AST에 직접 매핑됩니다. meta 블록 → MetaNode, style 블록 → StyleNode, layout 블록 → LayoutTree로 변환됩니다.\n\n### 8. 기계 친화적 우선\n\n\&quot;사람이 읽으면 조금 불편할 것\&quot; 정도가 적정 수준입니다. 사람 UX보다 AI 정확성을 우선합니다.\n\n---\n\n## Foundation Layer\n\nUIH DSL의 가장 낮은 레벨 사양입니다. Character부터 Ordering까지의 기본 규칙을 정의하며, LLM이 실수할 수 없는 엄격한 문법을 제공합니다.\n\n### 1. Character Layer (문자 규칙)\n\n#### ALLOWED_CHARACTERS\n- a~z (lowercase alphabets)\n- 0~9 (digits)\n- hyphen (-)\n- underscore (_)\n- space ( )\n- newline (\\n)\n- braces: { }\n- colon (:)\n- double-quote (\&quot;)\n\n#### DISALLOWED_CHARACTERS\n- single-quote (&#39;)\n- semicolon (;)\n- parentheses ()\n- backtick (&#96;)\n- tab (\\t)\n- CRLF (\\r\\n)\n\n#### NEWLINE\n- always LF (\\n)\n- CRLF not supported\n\n### 2. Indentation Layer (들여쓰기 규칙)\n\n#### INDENTATION\n- exactly 2 spaces ONLY\n- tabs NOT allowed\n- indentation increases only inside a block\n- indentation does not imply hierarchy (not YAML)\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {           // ❌ 탭 사용 금지\n  title: \&quot;Home\&quot;  // ✅ 정확히 2 space\n}\n&#96;&#96;&#96;\n\n### 3. Token Layer (토큰 기본 규칙)\n\n#### TOKENS\n- IDENTIFIER = &#96;[a-z][a-z0-9.]*&#96;\n- STRING = &#96;\&quot;[^\&quot;\\\\]*(?:\\\\.[^\&quot;\\\\]*)*\&quot;&#96; (supports &#96;\\\&quot;&#96; escape)\n- NUMBER = &#96;\\d+(?:\\.\\d+)?&#96;\n- LBRACE = &#96;{&#96;\n- RBRACE = &#96;}&#96;\n- COLON = &#96;:&#96;\n- NEWLINE = &#96;\\n&#96;\n- WHITESPACE = single space\n\n#### IDENTIFIER_RULES\n- lowercase only\n- dot notation allowed (e.g. &#96;color.primary&#96;)\n- do NOT mix hyphens inside identifiers (LLM error-prone)\n\n#### STRING_RULES\n- must use double quotes only\n- escaping uses &#96;\\\&quot;&#96;\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {\n  color.primary: \&quot;#fff\&quot;    // ✅ dot notation 허용\n  label: \&quot;Click \\\&quot;here\\\&quot;\&quot;  // ✅ escape 허용\n  width: 100.5            // ✅ 소수 허용\n}\n&#96;&#96;&#96;\n\n### 4. Comment Layer (코멘트)\n\n#### COMMENTS\n- comments NOT supported\n- any attempt to use &#96;//&#96; or &#96;#&#96; is invalid\n- purpose: reduce ambiguity for LLM\n\n### 5. Statement Layer (기본 문장 구조)\n\n#### STATEMENT_TYPES\n- Block Declaration\n- Property Declaration\n\n#### BLOCK_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt; {\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n#### PROPERTY_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n#### SEMICOLON\n- NOT allowed (never used)\n\n### 6. Block Layer (블록 기본 규칙)\n\n#### BLOCK_STRUCTURE\n&#96;&#96;&#96;\nblockName {\n  property: \&quot;value\&quot;\n  property: 123\n  property: true\n}\n&#96;&#96;&#96;\n\n#### BLOCK_RULES\n- block cannot contain nested blocks\n- ONLY layout block may contain nested layout nodes\n\n### 7. Ordering Layer (순서 강제)\n\n#### BLOCK_ORDER\n1. meta\n2. style\n3. components (optional)\n4. layout\n5. script (optional)\n\n#### RULE\n- if a block appears, must follow this order\n- missing blocks are allowed except meta/style/layout\n\n### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  primary-color: \&quot;#111\&quot;\n}\n\ncomponents {\n  Button {\n    variant: \&quot;primary\&quot;\n  }\n}\n\nlayout {\n  Container {\n    children: \&quot;Button\&quot;\n  }\n}\n\nscript {\n  // optional script\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단\n- 잘못된 들여쓰기 발견 시 구문 오류\n- 코멘트 시도 시 즉시 무효 처리\n- 블록 순서 위반 시 파싱 실패\n- layout 외 중첩 블록 시도 시 오류\n\n---\n\n## Tokenizer Specification\n\nFoundation Layer + Grammar Layers 기반의 공식 토큰화 규칙입니다. DSL 문자열을 균일한 Token 리스트로 변환하며, 모든 파싱의 기반이 됩니다.\n\n### 1. Tokenizer Overview\n\n#### PURPOSE\n- DSL 문자열을 균일한 Token 리스트로 변환\n- 모호성 없는 deterministic token stream 생성\n- 모든 파싱은 이 토큰 리스트 기반으로 진행\n\n#### INPUT\n- LF 기반의 DSL 문자열\n\n#### OUTPUT\n- 순차적 Token 배열\n\n### 2. Token Types\n\n#### TOKENS\n- &#96;IDENTIFIER&#96; - meta, title, color.primary, class 등\n- &#96;STRING&#96; - \&quot;Hello\&quot;\n- &#96;NUMBER&#96; - 0, 12, 0.8\n- &#96;BOOLEAN&#96; - true, false\n- &#96;LBRACE&#96; - {\n- &#96;RBRACE&#96; - }\n- &#96;LPAREN&#96; - (\n- &#96;RPAREN&#96; - )\n- &#96;COLON&#96; - :\n- &#96;COMMA&#96; - ,\n- &#96;NEWLINE&#96; - \\n\n- &#96;WHITESPACE&#96; - space (only used between tokens)\n- &#96;TEXT_STRING&#96; - layout children string ONLY (disambiguation)\n- &#96;EOF&#96; - end of file marker\n\n### 3. Identifier Detection\n\n#### IDENTIFIER_RULES\n- regex: &#96;^[a-z][a-z0-9.]*$&#96;\n- lowercase only\n- dot notation allowed\n- hyphens, underscores 금지\n\n#### TAGNAME_RULES\n- starts with uppercase letter\n- subsequent chars: &#96;[a-zA-Z0-9]&#96;\n- TagName (e.g. Div, Header) 구분용\n\n#### TAGNAME_EXAMPLES\n&#96;&#96;&#96;\nDiv\nSection\nImage\nH1\n&#96;&#96;&#96;\n\n### 4. String Token Rules\n\n#### STRING\n- starts with &#96;\&quot;&#96;\n- ends with &#96;\&quot;&#96;\n- inside supports &#96;\\\&quot;&#96;\n- no multi-line\n\n#### TEXT_STRING\n- STRING과 동일한 문법\n- 단, layout children context에서만 등장\n- Parser에서 context-aware로 구분\n\n### 5. Number Token Rules\n\n#### NUMBER\n- regex: &#96;^[0-9]+(\\.[0-9]+)?$&#96;\n- no negative numbers\n- no units (px, rem 등)\n\n### 6. Boolean Token Rules\n\n#### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n- strictly lowercase\n\n### 7. Brace / Symbol Tokens\n\n#### SYMBOL_TOKENS\n- &#96;LBRACE&#96;: &#96;{&#96;\n- &#96;RBRACE&#96;: &#96;}&#96;\n- &#96;LPAREN&#96;: &#96;(&#96;\n- &#96;RPAREN&#96;: &#96;)&#96;\n- &#96;COLON&#96;: &#96;:&#96;\n- &#96;COMMA&#96;: &#96;,&#96;\n\n#### NOTES\n- semicolon NOT allowed\n- backtick NOT allowed\n\n### 8. Whitespace / Newline Rules\n\n#### WHITESPACE\n- single space &#96;&#39; &#39;&#96;\n- no tabs\n- no multi-space sequences except indentation (2 spaces)\n\n#### NEWLINE\n- LF only\n- CRLF invalid\n\n### 9. Layout Context Rules (Critical)\n\n#### LAYOUT_MODE\nTokenizer enters layout-mode when encountering:\n&#96;&#96;&#96;\nlayout { … }\n&#96;&#96;&#96;\n\n#### CONTEXT_SWITCH\n- after TagName(\n- before encountering next node or text\n\n#### INSIDE_LAYOUT_BLOCK\n- children detection required\n- plain strings must become TEXT_STRING token\n- siblings separated by NEWLINE\n\n#### EXAMPLE\n&#96;&#96;&#96;\n\&quot;Welcome\&quot; → TEXT_STRING inside layout\n&#96;&#96;&#96;\n\n### 10. Tokenization Algorithm (High-Level)\n\n1. iterate through chars\n2. skip whitespace unless meaningful (indent)\n3. detect IDENTIFIER or TAGNAME\n4. detect STRING (with escape)\n5. detect NUMBER\n6. detect BOOLEAN\n7. detect braces &#96;{ }&#96;\n8. detect parentheses &#96;( )&#96;\n9. detect colon &#96;:&#96; or comma &#96;,&#96;\n10. detect newline &#96;\\n&#96;\n11. maintain context stack:\n    - normal\n    - inside layout block\n    - inside attributes\n12. output final EOF token\n\n### 11. Example Token Stream\n\n#### INPUT\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### OUTPUT_TOKENS\n&#96;&#96;&#96;\nIDENTIFIER(layout)\nLBRACE\nNEWLINE\nTAGNAME(Div)\nLPAREN\nIDENTIFIER(class)\nCOLON\nSTRING(\&quot;p-4\&quot;)\nRPAREN\nLBRACE\nNEWLINE\nTEXT_STRING(\&quot;Hello\&quot;)\nNEWLINE\nRBRACE\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Token Stream Examples\n\n#### 기본 블록 토큰화\n&#96;&#96;&#96;dsl\nmeta {\n  title: \&quot;Home\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(meta)\nLBRACE\nNEWLINE\nIDENTIFIER(title)\nCOLON\nSTRING(\&quot;Home\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n#### 스타일 블록 토큰화\n&#96;&#96;&#96;dsl\nstyle {\n  color.primary: \&quot;#fff\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(style)\nLBRACE\nNEWLINE\nIDENTIFIER(color.primary)\nCOLON\nSTRING(\&quot;#fff\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단 및 오류 반환\n- CRLF 줄바꿈 발견 시 LF로 변환 또는 오류\n- 탭 문자 발견 시 공백 변환 또는 오류\n- STRING에서 미닫힘 따옴표 시 오류\n- NUMBER에 음수나 단위 포함 시 오류\n- layout 외 컨텍스트에서 TEXT_STRING 시도 시 오류\n- TAGNAME 규칙 위반 (소문자 시작) 시 IDENTIFIER로 처리\n\n---\n\n## Grammar\n\n### Block Grammar\n\nUIH DSL의 최상위 구조를 정의하는 Block Grammar Layer입니다. Foundation Layer 바로 위에 위치하며, 5개 블록의 선언, 순서, 내용 규칙을 명시합니다.\n\n#### 1. Block Definitions (5개 블록)\n\n##### BLOCKS\n- meta\n- style\n- components (optional)\n- layout\n- script (optional)\n\n##### RULES\n- 블록은 반드시 이 순서를 따라야 함: meta → style → components → layout → script\n- meta, style, layout은 필수\n- components, script는 선택\n- 각 블록은 정확히 한 번만 등장\n- 중복 블록 금지\n\n#### 2. Block Syntax (기본 문법)\n\n##### BLOCK_SYNTAX\n&#96;&#96;&#96;\n&lt;blockName&gt; {\n  &lt;property&gt;: &lt;value&gt;\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n&#96;&#96;&#96;\n\n##### SYNTAX_COMPONENTS\n- 블록 시작: IDENTIFIER + &#96; {&#96;\n- 블록 끝: &#96;}&#96; 단독 줄\n\n#### 3. Block Content Rules\n\n##### 공통 규칙\n- 블록 내부에는 property statements만 존재\n- block 내부에 block 중첩 금지\n- 단, layout 블록만 예외적으로 UI tree 구조 허용\n\n##### PROPERTY_RULE\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### VALUE_TYPES\n- string\n- number\n- boolean\n- enum-like literals (string 값)\n- list (향후 정의)\n\n#### 4. Block-Specific Rules\n\n##### (1) META BLOCK\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Page title\&quot;\n  route: \&quot;/path\&quot;\n  theme: \&quot;light\&quot;|\&quot;dark\&quot;\n}\n&#96;&#96;&#96;\n\n**META_RESTRICTIONS:**\n- meta는 UI 문서의 metadata만 포함\n- layout 정보나 스타일 정보 포함 금지\n\n##### (2) STYLE BLOCK\n&#96;&#96;&#96;\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n}\n&#96;&#96;&#96;\n\n**STYLE_RESTRICTIONS:**\n- key는 dot notation 사용 가능\n- 값은 string 또는 number\n- layout 관련 속성 금지\n- theme override 불가\n\n##### (3) COMPONENTS BLOCK (optional)\n&#96;&#96;&#96;\ncomponents {\n  Card\n  Button\n  Input\n}\n&#96;&#96;&#96;\n\n**COMPONENTS_RULES:**\n- 등록할 컴포넌트 이름만 줄 단위로 나열\n- 중첩 구조 없음\n- 속성 없음\n- 문자열 아님: &#96;\&quot;Card\&quot;&#96; 금지, &#96;Card&#96;만 허용\n\n##### (4) LAYOUT BLOCK\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n**LAYOUT_RULES:**\n- 유일하게 중첩 구조 허용\n- 노드 문법은 별도 Layer에서 정의\n- property는 inline attribute 형태 가능\n- block-like structure 유지\n\n##### (5) SCRIPT BLOCK (optional)\n&#96;&#96;&#96;\nscript {\n  onclick: \&quot;submitForm\&quot;\n  onload: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n**SCRIPT_RESTRICTIONS:**\n- event/behavior mapping만 정의\n- JS code 삽입 금지\n- inline function 금지\n- event identifier는 반드시 lowercase (camelCase 금지)\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n  spacing.unit: 8\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n}\n\nlayout {\n  Div(class:\&quot;container mx-auto p-4\&quot;) {\n    Card(class:\&quot;bg-white shadow-lg\&quot;) {\n      Button(onclick:\&quot;handleSubmit\&quot;) {\n        \&quot;Submit\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;processForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 파싱 실패\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유효 (경고)\n- components/script 외 블록에서 중첩 시도 시 오류\n- layout 외 블록에서 attribute 사용 시 오류\n\n---\n\n### Property Grammar\n\nUIH DSL 안정성의 핵심인 Property Grammar Layer입니다. Block Grammar 위에 쌓이며, 속성 선언, 값 타입, 범위 규칙을 정의합니다.\n\n#### 1. Property Declaration Syntax\n\n##### PROPERTY_SYNTAX\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\nradius.default: 8\nenabled: true\n&#96;&#96;&#96;\n\n##### RULES\n- identifier는 반드시 lowercase\n- dot notation 허용 (&#96;color.primary&#96; 등)\n- colon(:) 뒤에는 반드시 space 1개\n- value는 줄 끝까지\n\n#### 2. Identifier Rules\n\n##### IDENTIFIER\n- 패턴: &#96;[a-z][a-z0-9.]*&#96;\n- 소문자만 허용\n- 숫자는 뒤쪽에만 허용\n- dot(.)은 중첩 속성 의미로만 사용\n- hyphen 금지 (LLM 오류 방지)\n- underscore 금지\n\n##### VALID\n&#96;&#96;&#96;\ncolor.primary\nfont.size\nborder.width\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nColor.Primary    // 대문자\nfont-size        // hyphen\nfont_size        // underscore\nprimary2.color   // 숫자 앞쪽\n&#96;&#96;&#96;\n\n#### 3. Value Types (5가지)\n\n##### VALUE_TYPES\n1. STRING\n2. NUMBER\n3. BOOLEAN\n4. ENUM-LIKE (string 기반)\n5. LIST (여러 값 나열, 줄 단위)\n\n#### 4. String Value Rules\n\n##### STRING\n- 무조건 double-quote 사용\n- 내부에 &#96;\&quot;&#96; 포함 시 &#96;\\\&quot;&#96;로 escape\n- single-quote 절대 금지\n\n##### VALID\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\ndescription: \&quot;He said \\\&quot;ok\\\&quot;\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\ntitle: &#39;Home&#39;      // single-quote\nname: \&quot;Home\&quot;       // curly quotes\n&#96;&#96;&#96;\n\n#### 5. Number Value Rules\n\n##### NUMBER\n- 정수 또는 소숫점 가능\n- 음수는 허용하지 않음\n- 단위(px 등) 금지 → unitless 구조\n\n##### VALID\n&#96;&#96;&#96;\nradius: 12\nopacity: 0.85\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nradius: -4     // 음수\nwidth: 10px    // 단위 포함\n&#96;&#96;&#96;\n\n#### 6. Boolean Value Rules\n\n##### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nenabled: true\nvisible: false\n&#96;&#96;&#96;\n\n#### 7. Enum-like String Rules\n\n##### ENUM_STRING\n- 문자열이지만 값이 고정된 타입처럼 쓰는 케이스\n- allowed values는 별도 block schema마다 정의\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntheme: \&quot;light\&quot; | \&quot;dark\&quot;\nsize: \&quot;sm\&quot; | \&quot;md\&quot; | \&quot;lg\&quot;\n&#96;&#96;&#96;\n\n#### 8. List Value (Block-like list)\n\n##### LIST\n- 각 항목은 줄 단위로 입력\n- 대괄호 &#96;[]&#96; 문법 없음 (LLM 오류 방지)\n- 문자열/식별자 혼용 가능\n\n##### SYNTAX\n&#96;&#96;&#96;\nitems {\n  \&quot;one\&quot;\n  \&quot;two\&quot;\n  \&quot;three\&quot;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- list block 내부에는 property 없음\n- indent 2 spaces 유지\n\n##### EXAMPLE\n&#96;&#96;&#96;\ntags {\n  \&quot;news\&quot;\n  \&quot;feature\&quot;\n  \&quot;announcement\&quot;\n}\n&#96;&#96;&#96;\n\n#### 9. Property Scope Rules (Block별 허용 속성 경계)\n\n##### META_SCOPE\n- meta는 UI metadata만 포함\n- route, title, theme, description 등\n\n##### STYLE_SCOPE\n- 색상, 폰트, radius 등 UI 스타일만\n- layout 속성 금지 (width, height 등은 layout block에서만)\n\n##### COMPONENTS_SCOPE\n- property 없음 (등록만)\n\n##### LAYOUT_SCOPE\n- inline attribute만 (class, id, ref 등)\n- 값은 무조건 string\n- boolean/number 사용 금지\n\n##### SCRIPT_SCOPE\n- event mapping 전용\n- 값은 무조건 string\n\n#### 10. Final Validation Rules\n\n1. 모든 property는 블록 내부에서만 존재\n2. 같은 identifier 중복 선언 금지\n3. meta/style/script는 property-only 구조\n4. components는 선언만 (property 없음)\n5. layout만 child nodes 보유 가능\n6. value의 타입은 block-specific rule을 반드시 준수\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main dashboard page\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  border.radius: 8\n  spacing.unit: 16\n}\n\ncomponents {\n  Card\n  Button\n  Input\n}\n\nlayout {\n  class: \&quot;container\&quot;\n  id: \&quot;main-content\&quot;\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;handleForm\&quot;\n  onrefresh: \&quot;reloadData\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 대문자 identifier 사용 시 토큰화 실패\n- hyphen/underscore 사용 시 구문 오류\n- single-quote나 curly quotes 사용 시 파싱 실패\n- 음수나 단위 포함 숫자 시 값 오류\n- 블록별 스코프 위반 시 validation 실패\n- 중복 property 선언 시 마지막 값만 유효 (경고)\n\n---\n\n### Layout Tree Grammar\n\nUIH DSL의 핵심 구조인 Layout Tree Grammar Layer입니다. Block Grammar와 Property Grammar 위에서 동작하며, UI 구성 요소의 트리 구조를 정의합니다.\n\n#### 1. Layout Block Overview\n\n##### LAYOUT_BLOCK\n&#96;&#96;&#96;\nlayout {\n  &lt;layout-node&gt;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- DSL에서 유일하게 중첩 구조를 가질 수 있는 블록\n- 모든 UI 구성 요소는 layout node로 표현\n- 노드는 \&quot;구조\&quot;만 표현, 스타일/로직은 표현하지 않음\n\n#### 2. Layout Node Syntax\n\n##### NODE_SYNTAX\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;) {\n  &lt;children&gt;\n}\n&#96;&#96;&#96;\n\n##### OR (children 없는 경우)\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;)\n&#96;&#96;&#96;\n\n##### NOTES\n- TagName은 PascalCase 컴포넌트 또는 HTML-like 사용 가능\n- attributes는 inline 형태 only\n- attributes는 옵션, 없어도 됨\n- children 블록은 중첩 가능\n\n##### VALID\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) {\n  \&quot;Hello\&quot;\n}\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nDiv {\n  class: \&quot;p-4\&quot;    // 속성은 block 기반이 아니라 inline only\n}\n&#96;&#96;&#96;\n\n#### 3. TagName Rules\n\n##### TAGNAME\n- 반드시 알파벳으로 시작\n- PascalCase 또는 UpperCamelCase 권장\n- HTML-like 소문자 태그는 사용 가능 (&#96;div&#96;, &#96;span&#96;) 단 내부적으로는 UpperCase 변환됨\n\n##### VALID\n&#96;&#96;&#96;\nDiv\nSection\nImage\nheader   // 허용하지만 변환 시 Header로 취급\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n3Div     // 숫자 시작\n_Box     // underscore 시작\n-Node    // hyphen 시작\n&#96;&#96;&#96;\n\n#### 4. Attribute Syntax\n\n##### ATTRIBUTES\n&#96;&#96;&#96;\n&lt;identifier&gt;:\&quot;&lt;string&gt;\&quot;\n&#96;&#96;&#96;\n\n##### RULES\n- value는 무조건 string only\n- boolean/number 금지\n- &#96;class:\&quot;p-4\&quot;&#96; 형태처럼 inline만 허용\n- 각 attribute는 콤마(&#96;,&#96;)로 구분\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;, id:\&quot;main\&quot;, ref:\&quot;root\&quot;)\n&#96;&#96;&#96;\n\n##### STRICT_RULES\n- 속성 순서는 의미 없음 (LLM 실수 방지로 자유 순서)\n- attribute key는 lower-case only\n- 속성 개수 0~5 정도 권장\n\n#### 5. Children Rules\n\n##### CHILD_TYPES\n- string literal\n- another layout node\n- list of siblings (node 여러 개 배치)\n\n##### STRING_CHILD\n&#96;&#96;&#96;\n\&quot;Hello world\&quot;\n&#96;&#96;&#96;\n\n##### NESTED_NODE\n&#96;&#96;&#96;\nDiv(class:\&quot;mt-4\&quot;) {\n  \&quot;content\&quot;\n}\n&#96;&#96;&#96;\n\n##### SIBLINGS\n&#96;&#96;&#96;\nDiv(...) { ... }\nP(...) { ... }\nImage(...)\n&#96;&#96;&#96;\n\n#### 6. Text Node Rules\n\n##### TEXT_NODE\n- 무조건 double-quote string\n- 줄바꿈 포함 금지\n- 텍스트 덩어리는 여러 줄로 쪼개면 안 됨\n\n##### VALID\n&#96;&#96;&#96;\n\&quot;Sign in to continue\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n\&quot;Hello\n World\&quot;    // 줄바꿈 포함\n&#96;&#96;&#96;\n\n#### 7. Node Termination Rules\n\n##### CLOSING_RULES\n- 블록 노드는 반드시 &#96;}&#96; 단독 줄로 닫는다\n- inline-only 노드는 종료 블록 없음\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;px-4\&quot;) {\n  P {\n    \&quot;Hello\&quot;\n  }\n  Image(src:\&quot;/logo.png\&quot;)\n}\n&#96;&#96;&#96;\n\n#### 8. Layout Grammar Formal Pattern\n\n##### LAYOUT_NODE_GRAMMAR\n&#96;&#96;&#96;\nNode:\n  Tag (Attributes?) (ChildrenBlock?)\n\nTag:\n  IDENTIFIER\n\nAttributes:\n  \&quot;(\&quot; AttributeList \&quot;)\&quot;\n\nAttributeList:\n  Attribute (\&quot;,\&quot; Attribute)*\n\nAttribute:\n  IDENTIFIER \&quot;:\&quot; STRING\n\nChildrenBlock:\n  \&quot;{\&quot; NewLine Indented(NodeOrText)+ \&quot;}\&quot;\n\nNodeOrText:\n  Node | STRING\n&#96;&#96;&#96;\n\n#### 9. Validation Rules\n\n1. layout은 트리 구조만 표현한다\n2. inline attributes만 허용\n3. 속성은 string-only\n4. children은 반드시 정해진 중첩 규칙을 따른다\n5. Node 이름은 PascalCase가 기본\n6. 문자열 children 외에는 모든 children은 Node여야 한다\n7. siblings 허용, 순서 보존\n\n#### 10. Example (Valid Layout Tree)\n\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;min-h-screen flex flex-col\&quot;) {\n    Header(class:\&quot;p-4 bg-gray-100\&quot;) {\n      H1 {\n        \&quot;Dashboard\&quot;\n      }\n    }\n\n    Main(class:\&quot;flex-1 p-6\&quot;) {\n      Card(class:\&quot;shadow\&quot;) {\n        P {\n          \&quot;Welcome back!\&quot;\n        }\n      }\n    }\n\n    Footer(class:\&quot;p-4 text-center\&quot;) {\n      \&quot;© 2025 The Bespoke\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto\&quot;) {\n    Navbar(class:\&quot;flex justify-between items-center p-4\&quot;) {\n      Logo(class:\&quot;text-xl font-bold\&quot;) {\n        \&quot;UIH\&quot;\n      }\n      Nav(class:\&quot;space-x-4\&quot;) {\n        Link(href:\&quot;/home\&quot;) {\n          \&quot;Home\&quot;\n        }\n        Link(href:\&quot;/about\&quot;) {\n          \&quot;About\&quot;\n        }\n      }\n    }\n\n    Content(class:\&quot;grid grid-cols-3 gap-6 p-6\&quot;) {\n      Sidebar(class:\&quot;col-span-1 bg-gray-50 p-4\&quot;) {\n        Menu {\n          \&quot;Dashboard\&quot;\n          \&quot;Settings\&quot;\n          \&quot;Profile\&quot;\n        }\n      }\n\n      Main(class:\&quot;col-span-2\&quot;) {\n        Article(class:\&quot;prose\&quot;) {\n          H2 {\n            \&quot;Getting Started\&quot;\n          }\n          P {\n            \&quot;Welcome to UIH DSL documentation.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- TagName에 숫자/특수문자 시작 시 토큰화 실패\n- 속성에 boolean/number 값 사용 시 파싱 오류\n- 텍스트 노드에 줄바꿈 포함 시 validation 실패\n- 노드 종료 &#96;}&#96; 누락 시 구문 오류\n- 중첩 깊이가 너무 깊을 경우 (권장 5레벨 초과) 경고\n- siblings 간 순서가 UI 의미에 영향 줄 경우 재검토\n\n---\n\n### Parser BNF Grammar\n\nTokenizer 위에서 동작하는 공식 문법 엔진 정의입니다. Token Stream을 Abstract Syntax Tree(AST)로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- Token Stream → Abstract Syntax Tree(AST)\n\n##### PARSER_MODE\n- strict non-ambiguous grammar\n- no recovery parsing (에러는 즉시 throw)\n- deterministic (LLM-friendly)\n- recursive descent parser 기반 구조\n\n#### 2. Entry Point\n\n##### Program\n&#96;&#96;&#96;\nProgram ::= MetaBlock StyleBlock ComponentsBlock? LayoutBlock ScriptBlock? EOF\n&#96;&#96;&#96;\n\n#### 3. Blocks\n\n##### Block_Definitions\n&#96;&#96;&#96;\nMetaBlock       ::= \&quot;meta\&quot; BlockBody(MetaProperty)\nStyleBlock      ::= \&quot;style\&quot; BlockBody(StyleProperty)\nComponentsBlock ::= \&quot;components\&quot; BlockBody(ComponentEntry)\nLayoutBlock     ::= \&quot;layout\&quot; LayoutBody\nScriptBlock     ::= \&quot;script\&quot; BlockBody(ScriptProperty)\n&#96;&#96;&#96;\n\n#### 4. Generic Block Body\n\n##### BlockBody\n&#96;&#96;&#96;\nBlockBody(&lt;T&gt;) ::= LBRACE NEWLINE (Indent &lt;T&gt; NEWLINE)* RBRACE\nIndent         ::= WHITESPACE WHITESPACE    # 2 spaces only\n&#96;&#96;&#96;\n\n#### 5. META Block Grammar\n\n##### MetaProperty\n&#96;&#96;&#96;\nMetaProperty ::= Identifier \&quot;:\&quot; MetaValue\nMetaValue    ::= STRING | NUMBER | BOOLEAN | EnumString\n&#96;&#96;&#96;\n\n##### Allowed_Meta_Keys\n- title, route, theme, description\n\n#### 6. STYLE Block Grammar\n\n##### StyleProperty\n&#96;&#96;&#96;\nStyleProperty ::= StyleKey \&quot;:\&quot; StyleValue\nStyleKey      ::= Identifier ( \&quot;.\&quot; Identifier )*\nStyleValue    ::= STRING | NUMBER | EnumString\n&#96;&#96;&#96;\n\n##### Notes\n- no nested blocks\n- no boolean\n- layout-like attributes 금지\n\n#### 7. COMPONENTS Block Grammar\n\n##### ComponentEntry\n&#96;&#96;&#96;\nComponentEntry ::= ComponentName\nComponentName  ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n##### NOTES\n- but no quotes, no values, one per line\n\n##### Examples\n&#96;&#96;&#96;\nCard\nButton\nInput\n&#96;&#96;&#96;\n\n#### 8. LAYOUT Block Grammar (Core)\n\n##### LayoutBody\n&#96;&#96;&#96;\nLayoutBody     ::= LBRACE NEWLINE Indent LayoutNodeList RBRACE\nLayoutNodeList ::= (LayoutNode NEWLINE)*\nLayoutNode     ::= Tag (Attributes)? (ChildrenBlock)?\nTag            ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n#### 9. Attributes Grammar\n\n##### Attributes\n&#96;&#96;&#96;\nAttributes    ::= LPAREN AttributeList RPAREN\nAttributeList ::= Attribute (COMMA Attribute)*\nAttribute     ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n#### 10. Children Block Grammar\n\n##### ChildrenBlock\n&#96;&#96;&#96;\nChildrenBlock ::= LBRACE NEWLINE Indent ChildrenList RBRACE\nChildrenList  ::= (Child NEWLINE)*\nChild         ::= LayoutNode | TEXT_STRING\n&#96;&#96;&#96;\n\n#### 11. SCRIPT Block Grammar\n\n##### ScriptProperty\n&#96;&#96;&#96;\nScriptProperty ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n##### Allowed_Script_Keys\n- onclick, onload, onsubmit, onmount, onchange\n\n&gt; 모든 script event identifier는 전부 소문자여야 하며 camelCase를 사용하지 않는다.\n\n#### 12. Value Grammars\n\n##### Value_Types\n&#96;&#96;&#96;\nSTRING     ::= \&quot;\\\&quot;\&quot; &lt;chars&gt; \&quot;\\\&quot;\&quot;\nNUMBER     ::= digits ( \&quot;.\&quot; digits )?\nBOOLEAN    ::= \&quot;true\&quot; | \&quot;false\&quot;\nEnumString ::= STRING   # validated in semantic phase\n&#96;&#96;&#96;\n\n#### 13. Identifier Grammars\n\n##### Identifiers\n&#96;&#96;&#96;\nIdentifier ::= [a-z][a-z0-9.]*\nTagName    ::= [A-Z][a-zA-Z0-9]*\n&#96;&#96;&#96;\n\n#### 14. Syntax Constraints (Formal)\n\n1. 모든 블록은 순서 고정\n2. 각 블록은 1회만 등장\n3. meta/style/layout은 필수\n4. components/script는 optional\n5. 들여쓰기 2 spaces only\n6. 속성(colon)은 반드시 &#96;&lt;id&gt;: &lt;value&gt;&#96;\n7. semicolon 금지\n8. layout만 nested structure 허용\n9. children 안에서는 TEXT_STRING 또는 LayoutNode만 허용\n10. parser는 ambiguous branch 금지 (LLM-safe)\n\n#### 15. Complete Example (BNF-valid)\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  radius.default: 8\n}\n\ncomponents {\n  Card\n  Button\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello world\&quot;\n    }\n  }\n}\n\nscript {\n  onclick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### BNF 구조 트리\n\n&#96;&#96;&#96;\nProgram\n├── MetaBlock\n│   ├── LBRACE\n│   ├── MetaProperty (title: \&quot;Home\&quot;)\n│   ├── MetaProperty (route: \&quot;/\&quot;)\n│   └── RBRACE\n├── StyleBlock\n│   ├── LBRACE\n│   ├── StyleProperty (color.primary: \&quot;#0E5EF7\&quot;)\n│   ├── StyleProperty (radius.default: 8)\n│   └── RBRACE\n├── ComponentsBlock\n│   ├── LBRACE\n│   ├── ComponentEntry (Card)\n│   ├── ComponentEntry (Button)\n│   └── RBRACE\n├── LayoutBlock\n│   ├── LBRACE\n│   ├── LayoutNode (Div)\n│   │   ├── Attributes (class:\&quot;p-4\&quot;)\n│   │   └── ChildrenBlock\n│   │       └── LayoutNode (P)\n│   │           └── ChildrenBlock\n│   │               └── TEXT_STRING (\&quot;Hello world\&quot;)\n│   └── RBRACE\n└── ScriptBlock\n    ├── LBRACE\n    ├── ScriptProperty (onClick: \&quot;submitForm\&quot;)\n    └── RBRACE\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 즉시 파싱 중단\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유지 (경고)\n- 들여쓰기 2 space 위반 시 구문 오류\n- layout 외 블록에서 중첩 시도 시 파싱 실패\n- 허용되지 않은 키 사용 시 semantic 오류 (parser 단계에서는 허용)\n- TEXT_STRING이 layout 외 컨텍스트에서 등장 시 오류\n\n---\n\n## AST Schema Definition\n\nParser BNF 위에서 생성되는 최종 AST 구조입니다. 모든 UIH DSL 요소가 이 스키마에 따라 구조화됩니다.\n\n### 1. AST Root\n\n#### ASTRoot\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Program\&quot;\n  meta: MetaNode\n  style: StyleNode\n  components: ComponentsNode | null\n  layout: LayoutNode\n  script: ScriptNode | null\n}\n&#96;&#96;&#96;\n\n### 2. Meta Node\n\n#### MetaNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Meta\&quot;\n  properties: MetaProperty[]\n}\n&#96;&#96;&#96;\n\n#### MetaProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;title\&quot;\n  value: string|number|boolean\n  location: Range     // from tokenizer\n}\n&#96;&#96;&#96;\n\n### 3. Style Node\n\n#### StyleNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Style\&quot;\n  properties: StyleProperty[]\n}\n&#96;&#96;&#96;\n\n#### StyleProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;color.primary\&quot;\n  value: string|number\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 4. Components Node\n\n#### ComponentsNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Components\&quot;\n  components: ComponentEntry[]\n}\n&#96;&#96;&#96;\n\n#### ComponentEntry\n&#96;&#96;&#96;typescript\n{\n  name: string        // e.g. \&quot;Card\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 5. Layout Node (Core Tree Structure)\n\n#### LayoutNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Layout\&quot;\n  children: LayoutElement[]     // top-level nodes inside layout block\n}\n&#96;&#96;&#96;\n\n#### LayoutElement\n&#96;&#96;&#96;typescript\nLayoutElement = LayoutComponent | LayoutText\n&#96;&#96;&#96;\n\n#### 5.1 Layout Component\n&#96;&#96;&#96;typescript\nLayoutComponent {\n  type: \&quot;Component\&quot;\n  tag: string                   // e.g. \&quot;Div\&quot;, \&quot;P\&quot;, \&quot;Header\&quot;\n  attributes: Attribute[]\n  children: LayoutElement[]     // nested structure\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### Attribute\n&#96;&#96;&#96;typescript\n{\n  key: string                   // lower-case only\n  value: string                 // inline string only\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### 5.2 Layout Text Node\n&#96;&#96;&#96;typescript\nLayoutText {\n  type: \&quot;Text\&quot;\n  value: string                 // raw text string\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 6. Script Node\n\n#### ScriptNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Script\&quot;\n  events: ScriptProperty[]\n}\n&#96;&#96;&#96;\n\n#### ScriptProperty\n&#96;&#96;&#96;typescript\n{\n  key: string                   // e.g. \&quot;onclick\&quot; (lowercase only)\n  value: string                 // e.g. \&quot;submitForm\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 7. Range Object (Source Location)\n\n#### Range\n&#96;&#96;&#96;typescript\n{\n  start: Position\n  end: Position\n}\n&#96;&#96;&#96;\n\n#### Position\n&#96;&#96;&#96;typescript\n{\n  line: number\n  column: number\n}\n&#96;&#96;&#96;\n\n### 8. Semantics Rules (Validation Layer)\n\n1. Meta keys must be from allowlist:\n   - title, route, theme, description\n\n2. Style keys may use dot notation but MUST be lowercase.\n\n3. Components must be names only, no properties.\n\n4. Layout:\n   - tag must be a valid TagName or valid identifier\n   - attributes must be string-only\n   - children: array of LayoutElement (component or text)\n\n5. Script:\n   - keys must be known event names\n   - value must be string (function name)\n\n6. No null children arrays. Use &#96;[]&#96; if empty.\n\n7. All nodes must have location data.\n\n### 9. Example: Full AST for a Simple Page\n\n#### Example DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### Generated AST (simplified)\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Home\&quot; },\n      { \&quot;key\&quot;: \&quot;route\&quot;, \&quot;value\&quot;: \&quot;/\&quot; }\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;color.primary\&quot;, \&quot;value\&quot;: \&quot;#0E5EF7\&quot; }\n    ]\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: [\n          { \&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;p-4\&quot; }\n        ],\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n### AST 구조 트리\n\n&#96;&#96;&#96;\nASTRoot (Program)\n├── meta (MetaNode)\n│   └── properties[] (MetaProperty)\n├── style (StyleNode)\n│   └── properties[] (StyleProperty)\n├── components (ComponentsNode | null)\n│   └── components[] (ComponentEntry)\n├── layout (LayoutNode)\n│   └── children[] (LayoutElement)\n│       ├── LayoutComponent\n│       │   ├── attributes[] (Attribute)\n│       │   └── children[] (LayoutElement)\n│       └── LayoutText\n└── script (ScriptNode | null)\n    └── events[] (ScriptProperty)\n&#96;&#96;&#96;\n\n### AST Examples\n\n#### 최소 AST 구조\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      {\&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Minimal\&quot;}\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: []\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Text\&quot;,\n        \&quot;value\&quot;: \&quot;Content\&quot;\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n#### 복잡한 레이아웃 AST\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Layout\&quot;,\n  \&quot;children\&quot;: [\n    {\n      \&quot;type\&quot;: \&quot;Component\&quot;,\n      \&quot;tag\&quot;: \&quot;Div\&quot;,\n      \&quot;attributes\&quot;: [\n        {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;container\&quot;}\n      ],\n      \&quot;children\&quot;: [\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Header\&quot;,\n          \&quot;attributes\&quot;: [],\n          \&quot;children\&quot;: [\n            {\n              \&quot;type\&quot;: \&quot;Component\&quot;,\n              \&quot;tag\&quot;: \&quot;H1\&quot;,\n              \&quot;attributes\&quot;: [],\n              \&quot;children\&quot;: [\n                {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Title\&quot;}\n              ]\n            }\n          ]\n        },\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Main\&quot;,\n          \&quot;attributes\&quot;: [\n            {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;content\&quot;}\n          ],\n          \&quot;children\&quot;: [\n            {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Main content\&quot;}\n          ]\n        }\n      ]\n    }\n  ]\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- location 정보 누락 시 AST 생성 실패\n- 빈 children 배열 대신 null 사용 시 validation 오류\n- 허용되지 않은 meta/style/script 키 사용 시 semantic 오류\n- LayoutComponent의 tag가 유효하지 않은 경우 오류\n- LayoutText에 빈 문자열 사용 시 경고\n- 중첩 깊이가 너무 깊을 경우 (10레벨 초과) 경고 또는 오류\n\n---\n\n## IR (Intermediate Representation) Specification\n\nAST → IR 변환 규칙을 정의합니다. Codegen 단계 직전의 \&quot;정규화된 구조\&quot;로, 플랫폼불문의 공통 인터페이스를 제공합니다.\n\n### 1. Overview\n\n#### IR_GOAL\n- AST의 복잡한 구조를 코드 생성하기 좋게 단순화\n- UI 컴포넌트 트리와 메타데이터를 정규화\n- 플랫폼불문(React/Next/Svelte) 공통 인터페이스로 변환\n- 모든 값은 최종적이고 확정된 형태만 유지\n\n#### INPUT\n- ASTRoot\n\n#### OUTPUT\n- IRRoot\n\n### 2. IR Root\n\n#### IRRoot\n&#96;&#96;&#96;typescript\n{\n  meta: IRMeta\n  style: IRStyle\n  components: IRComponents\n  layout: IRLayoutTree\n  script: IRScript\n}\n&#96;&#96;&#96;\n\n### 3. IRMeta (Final Document Metadata)\n\n#### IRMeta\n&#96;&#96;&#96;typescript\n{\n  title: string\n  route: string\n  theme: \&quot;light\&quot; | \&quot;dark\&quot;\n  description: string | null\n}\n&#96;&#96;&#96;\n\n#### Rules\n- missing values become null\n- enforce route starts with \&quot;/\&quot;\n\n### 4. IRStyle (Flattened Style Tokens)\n\n#### IRStyle\n&#96;&#96;&#96;typescript\n{\n  tokens: Record&lt;string, string | number&gt;\n}\n&#96;&#96;&#96;\n\n#### Examples\n&#96;&#96;&#96;typescript\n{\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n  \&quot;radius.default\&quot;: 8\n}\n&#96;&#96;&#96;\n\n#### Rules\n- dot-notation keys preserved\n- all values converted to primitive string/number\n- no validation here (semantic pass already done)\n\n### 5. IRComponents (Registered Component Map)\n\n#### IRComponents\n&#96;&#96;&#96;typescript\n{\n  list: string[]   // e.g. [\&quot;Card\&quot;, \&quot;Button\&quot;]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- duplicates removed\n- sorted alphabetically for deterministic output\n\n### 6. IRLayoutTree (Normalized UI Tree)\n\n#### IRLayoutTree\n&#96;&#96;&#96;typescript\n{\n  root: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### IRNode\n&#96;&#96;&#96;typescript\nIRNode = IRComponentNode | IRTextNode\n&#96;&#96;&#96;\n\n#### 6.1 IRComponentNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;component\&quot;\n  tag: string\n  attributes: Record&lt;string, string&gt;   // key:string only\n  children: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- attribute keys lower-case enforced\n- children always array\n- empty children =&gt; []\n\n#### 6.2 IRTextNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;text\&quot;\n  value: string\n}\n&#96;&#96;&#96;\n\n#### Rules\n- trimmed text preserved exactly\n- no newline allowed inside text\n\n### 7. IRScript (Event Map)\n\n#### IRScript\n&#96;&#96;&#96;typescript\n{\n  events: Record&lt;string, string&gt;   // onclick → \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Rules\n- all keys normalized to lower-case event names\n- camelCase event keys는 허용되지 않음 (validation 단계에서 차단)\n- event value must be string only\n- duplicates override earlier definitions\n\n### 8. AST → IR Mapping Rules\n\n1. **MetaNode → IRMeta**\n   - convert property array → object map\n   - apply default values if missing\n   - route must start with \&quot;/\&quot;\n\n2. **StyleNode → IRStyle**\n   - flatten list into tokens object\n   - preserve ordering but output sorted keys for determinism\n\n3. **ComponentsNode → IRComponents**\n   - convert component list → array\n   - remove duplicates\n   - sort alphabetically\n\n4. **LayoutNode → IRLayoutTree**\n   - recursively convert LayoutComponent → IRComponentNode\n   - convert LayoutText → IRTextNode\n   - inline attributes converted to plain object\n\n5. **ScriptNode → IRScript**\n   - property list flattened to event map\n   - enforce lower-case event names\n\n### 9. Example: Full IR Output\n\n#### DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### IR\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Home\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: null,\n    \&quot;description\&quot;: null\n  },\n\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n    }\n  },\n\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: []\n  },\n\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: { \&quot;class\&quot;: \&quot;p-4\&quot; },\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {}\n  }\n}\n&#96;&#96;&#96;\n\n### IR 구조 트리\n\n&#96;&#96;&#96;\nIRRoot\n├── meta (IRMeta)\n│   ├── title: string\n│   ├── route: string\n│   ├── theme: \&quot;light\&quot;|\&quot;dark\&quot;|null\n│   └── description: string|null\n├── style (IRStyle)\n│   └── tokens: Record&lt;string, string|number&gt;\n├── components (IRComponents)\n│   └── list: string[]\n├── layout (IRLayoutTree)\n│   └── root: IRNode[]\n│       ├── IRComponentNode\n│       │   ├── type: \&quot;component\&quot;\n│       │   ├── tag: string\n│       │   ├── attributes: Record&lt;string, string&gt;\n│       │   └── children: IRNode[]\n│       └── IRTextNode\n│           ├── type: \&quot;text\&quot;\n│           └── value: string\n└── script (IRScript)\n    └── events: Record&lt;string, string&gt;\n&#96;&#96;&#96;\n\n### IR Examples\n\n#### 간단한 IR 변환\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Simple\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: \&quot;light\&quot;,\n    \&quot;description\&quot;: null\n  },\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#000\&quot;,\n      \&quot;font.size\&quot;: 14\n    }\n  },\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: [\&quot;Button\&quot;]\n  },\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: {},\n        \&quot;children\&quot;: [\n          {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Content\&quot;}\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {\n      \&quot;onclick\&quot;: \&quot;handleClick\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 복잡한 중첩 레이아웃 IR\n&#96;&#96;&#96;json\n{\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Container\&quot;,\n        \&quot;attributes\&quot;: {\n          \&quot;class\&quot;: \&quot;flex flex-col min-h-screen\&quot;\n        },\n        \&quot;children\&quot;: [\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Header\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;p-4 bg-blue-600\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;H1\&quot;,\n                \&quot;attributes\&quot;: {},\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Dashboard\&quot;}\n                ]\n              }\n            ]\n          },\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Main\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;flex-1 p-6\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;Card\&quot;,\n                \&quot;attributes\&quot;: {\n                  \&quot;class\&quot;: \&quot;bg-white shadow-lg rounded\&quot;\n                },\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Welcome!\&quot;}\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- AST에 location 정보 누락 시 IR 변환 실패\n- route가 \&quot;/\&quot;로 시작하지 않을 경우 변환 시 강제 추가\n- 중복 컴포넌트 등록 시 알파벳 순 정렬로 중복 제거\n- 빈 children 배열을 null로 잘못 설정 시 []로 강제 변환\n- 텍스트 노드에 줄바꿈 포함 시 변환 중 제거 또는 오류\n- 이벤트 키 대소문자 혼재 시 소문자로 통일\n- 스타일 토큰 키 순서가 다를 경우 sorted keys로 결정적 출력 보장\n\n---\n\n## Codegen Rules\n\n### React/Next.js 15 Codegen\n\nIR을 기반으로 안정적인 UI 코드 생성 규칙입니다. React/Next.js 15 (App Router + RSC) 기준으로 IR을 실제 코드로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- IR을 기반으로 안정적인 UI 코드 생성\n- React/Next.js 15 (App Router + RSC) 기준\n- \&quot;디자인 시스템 없는 순수 Layout Tree\&quot;를 코드로 변환\n- 가능한 한 deterministic 하게 출력\n- 로직/상태/이벤트는 최소 수준으로만 개입\n\n##### INPUT\n- IRRoot\n\n##### OUTPUT\n- React Component Source Code (string)\n\n#### 2. Output Structure\n\n파일 구조는 다음 형태로 생성합니다:\n\n&#96;&#96;&#96;\n/page.tsx\n  - metadata (title, description)\n  - default export function Page()\n  - return(...) 내부에 layout tree 삽입\n\n/style-tokens.ts\n  - style.tokens flatten export\n\n/components/index.ts\n  - components registry export\n\n/script-events.ts\n  - event name string mapping export\n&#96;&#96;&#96;\n\n#### 3. Metadata Codegen\n\n##### UIH meta → Next.js metadata\n&#96;&#96;&#96;typescript\nIRMeta {\n  title: string\n  description: string\n}\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;typescript\nexport const metadata = {\n  title: \&quot;&lt;title&gt;\&quot;,\n  description: \&quot;&lt;description&gt;\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- description 없으면 필드 제외\n- theme는 metadata에 직접 쓰지 않음 (스타일토큰 용)\n\n#### 4. Style Token Codegen\n\n##### IRStyle { tokens }\n&#96;&#96;&#96;typescript\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;radius.default\&quot;: 8,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 키는 string 리터럴 그대로\n- numeric/string 그대로 출력\n- sorted keys for deterministic output\n\n#### 5. Component Registry Codegen\n\n##### IRComponents.list → export list\n&#96;&#96;&#96;typescript\nexport const components = {\n  Card,\n  Button,\n  Input,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 자동 import 하지 않음 (상위 시스템이 resolve)\n- keys는 PascalCase 유지\n- duplicates 제거 후 정렬\n\n#### 6. Layout Tree → JSX Codegen\n\n##### IRLayoutTree → React element tree\n\n##### 6.1 Component Node\n&#96;&#96;&#96;typescript\nIRComponentNode {\n  tag: \&quot;Div\&quot;\n  attributes: { class: \&quot;p-4\&quot; }\n  children: [...]\n}\n&#96;&#96;&#96;\n\n##### OUTPUT JSX\n&#96;&#96;&#96;jsx\n&lt;Div className=\&quot;p-4\&quot;&gt;\n  {children...}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n##### RULES\n- attribute.key \&quot;class\&quot; → \&quot;className\&quot;\n- attribute key는 그대로 lower-case 유지\n- value는 string literal\n- children length 0 이면 self-closing 금지 (always explicit block)\n- tag name 그대로 JSX 컴포넌트로 사용\n\n##### 6.2 Text Node\n&#96;&#96;&#96;typescript\nIRTextNode { value: \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;jsx\n{\&quot;Hello\&quot;}\n&#96;&#96;&#96;\n\n##### RULES\n- 텍스트는 JSX children 표현\n- 특수문자는 자동 escape\n\n#### 7. Script Event Codegen\n\n##### IRScript.events → export mapping\n&#96;&#96;&#96;typescript\nexport const eventHandlers = {\n  onclick: \&quot;submitForm\&quot;,\n  onload: \&quot;init\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- event 이름은 lower-case normalized\n- 값은 string (함수명)\n- 실제 JS 함수 body는 생성하지 않음\n- 나중 시스템이 자동 wire-up 함\n\n#### 8. Full Page Generation\n\n최종 page.tsx는 다음 구조를 따릅니다:\n\n&#96;&#96;&#96;typescript\nexport const metadata = { ... };\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen p-4\&quot;&gt;\n      &lt;P&gt;{\&quot;Hello\&quot;}&lt;/P&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### RULES\n- 최상위는 항상 &#96;&lt;Div&gt;&#96; 같은 Wrapper로 시작하지 않아도 됨\n- layout.root가 배열이면 Fragment로 감싼다\n- 코드 스타일은 2-space indent\n- 세미콜론 붙이지 않음 (Prettier 옵션 따라감)\n\n#### 9. Determinism Rules\n\n1. 속성 순서는 key 알파벳순 정렬\n2. children 순서는 DSL 입력 순서 그대로\n3. components 목록은 알파벳순 정렬\n4. styleTokens도 key 정렬\n5. eventHandlers key 정렬\n6. output JSX는 항상 multiline\n\n#### 10. Full Example (DSL → IR → JSX)\n\n##### DSL\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n##### JSX OUT\n&#96;&#96;&#96;typescript\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;p-4\&quot;&gt;\n      {\&quot;Hello\&quot;}\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n#### 11. Notes for Engine Integrators\n\n1. Codegen은 \&quot;순수 구조\&quot;만 책임진다\n   - 상태(state), fetch, useEffect 등은 지원하지 않음\n2. 이벤트 핸들러는 단순 라벨링 시스템\n3. 스타일 토큰은 UI 프레임워크에서 직접 해석\n4. React, Vue, Svelte 등 플랫폼별 코드젠 가능\n   - 플랫폼별 레이어는 분리\n\n#### Output Files 구조\n\n&#96;&#96;&#96;\nOutput Files\n├── page.tsx\n│   ├── metadata export\n│   ├── imports (components, styleTokens, eventHandlers)\n│   ├── Page() function\n│   └── JSX return (layout tree)\n├── style-tokens.ts\n│   └── styleTokens export\n├── components/index.ts\n│   └── components export\n└── script-events.ts\n    └── eventHandlers export\n&#96;&#96;&#96;\n\n#### Codegen Examples\n\n##### 전체 페이지 코드 생성 예시\n&#96;&#96;&#96;typescript\n// page.tsx\nexport const metadata = {\n  title: \&quot;Dashboard\&quot;,\n  description: \&quot;Main dashboard page\&quot;\n};\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen flex flex-col\&quot;&gt;\n      &lt;Header className=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n        &lt;H1&gt;\n          {\&quot;Dashboard\&quot;}\n        &lt;/H1&gt;\n      &lt;/Header&gt;\n      &lt;Main className=\&quot;flex-1 p-6\&quot;&gt;\n        &lt;Card className=\&quot;bg-white shadow-lg rounded-lg p-6\&quot;&gt;\n          &lt;P&gt;\n            {\&quot;Welcome back!\&quot;}\n          &lt;/P&gt;\n        &lt;/Card&gt;\n      &lt;/Main&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### 스타일 토큰 파일 예시\n&#96;&#96;&#96;typescript\n// style-tokens.ts\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;color.secondary\&quot;: \&quot;#6B7280\&quot;,\n  \&quot;color.accent\&quot;: \&quot;#F59E0B\&quot;,\n  \&quot;spacing.small\&quot;: 8,\n  \&quot;spacing.medium\&quot;: 16,\n  \&quot;spacing.large\&quot;: 24,\n  \&quot;border.radius\&quot;: 6,\n  \&quot;font.family\&quot;: \&quot;Inter\&quot;,\n  \&quot;font.size.base\&quot;: 16,\n  \&quot;shadow.default\&quot;: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n};\n&#96;&#96;&#96;\n\n##### 컴포넌트 레지스트리 예시\n&#96;&#96;&#96;typescript\n// components/index.ts\nexport const components = {\n  Button,\n  Card,\n  Input,\n  Modal,\n  Sidebar\n};\n&#96;&#96;&#96;\n\n##### 이벤트 핸들러 파일 예시\n&#96;&#96;&#96;typescript\n// script-events.ts\nexport const eventHandlers = {\n  onclick: \&quot;handleClick\&quot;,\n  onload: \&quot;initDashboard\&quot;,\n  onsubmit: \&quot;processForm\&quot;\n};\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- layout.root가 빈 배열일 경우 빈 Fragment 생성\n- 컴포넌트 이름이 JavaScript 예약어와 충돌 시 escaping 필요\n- 텍스트에 JSX 특수문자 포함 시 자동 escape\n- 중첩 깊이가 깊을 경우 코드 포맷팅 유지\n- import 경로 resolve 실패 시 상위 시스템에서 처리\n- styleTokens에 특수문자 키 포함 시 유효한 JS 객체 키로 변환\n\n---\n\n### Vue &amp; Svelte Codegen\n\nReact Codegen과 동일한 IR 기반으로 Vue와 Svelte 코드를 생성하는 규칙입니다. 플랫폼별 렌더링 규칙만 다르게 적용합니다.\n\n## SECTION A — Vue Codegen (SFC 기준)\n\n### GOAL\n- IR → .vue 파일 형태로 변환\n- &#96;&lt;template&gt;&#96; + &#96;&lt;script setup&gt;&#96; + &#96;&lt;style&gt;&#96; 구조 유지\n- 모든 로직은 배제하고 구조만 생성\n\n### OUTPUT FILE STRUCTURE\n&#96;&#96;&#96;\nMyPage.vue\n&#96;&#96;&#96;\n\n### 1. Top-Level Structure\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;!-- layout tree --&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport components...\n\nconst events = {...}\nconst styleTokens = {...}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* optional if needed */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Vue Template 규칙\n\n#### IRComponentNode(tag:\&quot;Div\&quot;, attributes, children)\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  &lt;!-- children --&gt;\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;className&#96; → &#96;class&#96;\n- attribute values: string only\n- children: 그대로 template로 변환\n- Fragment는 &#96;&lt;template&gt;&#96; 안에서 그냥 siblings로 출력\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello (그대로 text node)\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\neventHandlers {\n  onclick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Vue OUTPUT\n&#96;&#96;&#96;vue\n@click=\&quot;submitForm\&quot;\n&#96;&#96;&#96;\n\n#### RULES\n- DSL &#96;onclick&#96; → Vue &#96;@click&#96;\n- DSL &#96;onchange&#96; → Vue &#96;@change&#96;\n- DSL &#96;oninput&#96; → Vue &#96;@input&#96;\n- DSL &#96;onload&#96; → Vue &#96;@load&#96;\n- value는 함수 이름 string\n- 함수 구현은 생성하지 않음\n\n### 4. Component Registry (imports)\n&#96;&#96;&#96;javascript\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules\n- 속성(sorted)\n- imports(sorted)\n- children 순서 그대로\n- no semicolons\n- template 들여쓰기 2 spaces\n\n## SECTION B — Svelte Codegen (.svelte)\n\n### GOAL\n- Svelte 컴포넌트 파일 하나로 완성\n- &#96;&lt;script&gt;&#96; + markup 구조\n\n### OUTPUT STRUCTURE\n&#96;&#96;&#96;\nMyPage.svelte\n&#96;&#96;&#96;\n\n### 1. File Layout\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import components...\n  export let events = {...}\n  export let styleTokens = {...}\n&lt;/script&gt;\n\n&lt;!-- layout markup --&gt;\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  Hello\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* optional */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Svelte Markup\n\n#### IRComponentNode(tag, attributes, children)\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  {#if ... ?} (없음)\n  {children}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- 클래스는 &#96;class&#96;\n- 속성 문자열만\n- Self-closing 금지\n- children 재귀적 삽입\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\nIRScript:\nonclick → function name\n&#96;&#96;&#96;\n\n#### Svelte OUTPUT\n&#96;&#96;&#96;svelte\non:click={submitForm}\n&#96;&#96;&#96;\n\n#### Mapping\n&#96;&#96;&#96;\nonclick   → on:click\nonchange  → on:change\noninput   → on:input\nonload    → on:load\n&#96;&#96;&#96;\n\n### 4. Components Import\n&#96;&#96;&#96;javascript\nimport Card from \&quot;./Card.svelte\&quot;;\nimport Button from \&quot;./Button.svelte\&quot;;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules (필수)\n\n1. import 순서는 알파벳 정렬\n2. attributes sorted\n3. event names lower-case\n4. children 순서 보존\n5. markup 들여쓰기 2 spaces\n\n## SECTION C — Cross-Platform Notes\n\n1. React / Vue / Svelte 모두 IR만 참조\n2. layout tree는 그대로 세 렌더러에서 재활용\n3. event handler는 단순 label → framework alias로 변환\n4. styleTokens는 컴파일러 외부 시스템이 처리\n5. components는 registry 기반으로 import만 생성\n\n## SECTION D — Example Conversion (Same IR → Vue/Svelte)\n\n### IR\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) { \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n### Vue Template\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Svelte Markup\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte 구조\n\n&#96;&#96;&#96;\nVue Output (.vue)\n├── &lt;template&gt;\n│   └── layout tree (Vue template syntax)\n├── &lt;script setup&gt;\n│   ├── component imports\n│   ├── events object\n│   └── styleTokens object\n└── &lt;style scoped&gt;\n    └── optional styles\n\nSvelte Output (.svelte)\n├── &lt;script&gt;\n│   ├── component imports\n│   ├── export let events = {...}\n│   └── export let styleTokens = {...}\n├── layout markup (Svelte syntax)\n└── &lt;style&gt;\n    └── optional styles\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte Examples\n\n#### Vue SFC 전체 예시\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n    &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n      &lt;H1&gt;\n        Dashboard\n      &lt;/H1&gt;\n    &lt;/Header&gt;\n    &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n      &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; @click=\&quot;handleCardClick\&quot;&gt;\n        &lt;P&gt;\n          Welcome back!\n        &lt;/P&gt;\n      &lt;/Card&gt;\n    &lt;/Main&gt;\n  &lt;/Div&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n\nconst events = {\n  handleCardClick: \&quot;handleCardClick\&quot;\n}\n\nconst styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;spacing.medium\&quot;: 16\n}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### Svelte 컴포넌트 전체 예시\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import Card from \&quot;./Card.svelte\&quot;;\n  import Button from \&quot;./Button.svelte\&quot;;\n\n  export let events = {\n    handleCardClick: \&quot;handleCardClick\&quot;\n  };\n\n  export let styleTokens = {\n    \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n    \&quot;spacing.medium\&quot;: 16\n  };\n&lt;/script&gt;\n\n&lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n  &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n    &lt;H1&gt;\n      Dashboard\n    &lt;/H1&gt;\n  &lt;/Header&gt;\n  &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n    &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; on:click={handleCardClick}&gt;\n      &lt;P&gt;\n        Welcome back!\n      &lt;/P&gt;\n    &lt;/Card&gt;\n  &lt;/Main&gt;\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### 이벤트 매핑 비교\n&#96;&#96;&#96;javascript\n// 동일한 IR 이벤트\n{\n  onClick: \&quot;handleClick\&quot;,\n  onChange: \&quot;handleChange\&quot;,\n  onLoad: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;vue\n&lt;!-- Vue --&gt;\n&lt;Button @click=\&quot;handleClick\&quot; @change=\&quot;handleChange\&quot; @load=\&quot;init\&quot;&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;svelte\n&lt;!-- Svelte --&gt;\n&lt;Button on:click={handleClick} on:change={handleChange} on:load={init}&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;jsx\n&lt;!-- React --&gt;\n&lt;Button onClick={handleClick} onChange={handleChange} onLoad={init}&gt;\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- Vue에서 컴포넌트 이름이 kebab-case로 변환 필요 시 자동 처리\n- Svelte에서 export let 구문이 예약어와 충돌 시 renaming\n- 이벤트 핸들러가 정의되지 않은 경우 플랫폼별 기본 동작\n- 스타일 토큰에 CSS 변수나 함수 포함 시 escaping\n- 중첩 컴포넌트 깊이가 깊을 경우 플랫폼별 최적화 적용\n- 텍스트 콘텐츠에 플랫폼별 특수문자 포함 시 자동 escape\n\n---\n\n## Examples\n\n### 완전한 UIH DSL 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;User Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main user dashboard with analytics\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  color.accent: \&quot;#F59E0B\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n  font.size.h1: 32\n  spacing.small: 8\n  spacing.medium: 16\n  spacing.large: 24\n  border.radius: 6\n  shadow.default: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n  Sidebar\n  Chart\n}\n\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto p-6\&quot;) {\n    Header(class:\&quot;mb-8\&quot;) {\n      Div(class:\&quot;flex justify-between items-center\&quot;) {\n        H1(class:\&quot;text-3xl font-bold\&quot;) {\n          \&quot;Dashboard\&quot;\n        }\n        Button(class:\&quot;px-4 py-2 bg-blue-600 text-white rounded\&quot;) {\n          \&quot;New Report\&quot;\n        }\n      }\n    }\n\n    Div(class:\&quot;grid grid-cols-3 gap-6\&quot;) {\n      Card(class:\&quot;col-span-2\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Analytics Overview\&quot;\n        }\n        Chart(class:\&quot;w-full h-64\&quot;)\n      }\n\n      Card(class:\&quot;col-span-1\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Quick Stats\&quot;\n        }\n        Div(class:\&quot;space-y-4\&quot;) {\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Total Users\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;1,234\&quot;\n            }\n          }\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Active Sessions\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;89\&quot;\n            }\n          }\n        }\n      }\n    }\n\n    Sidebar(class:\&quot;mt-8\&quot;) {\n      H3(class:\&quot;text-lg mb-4\&quot;) {\n        \&quot;Recent Activity\&quot;\n      }\n      Div(class:\&quot;space-y-2\&quot;) {\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;User john@example.com logged in\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;New report generated\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;System backup completed\&quot;\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onLoad: \&quot;initDashboard\&quot;\n  onClick: \&quot;handleButtonClick\&quot;\n  onRefresh: \&quot;refreshData\&quot;\n}\n&#96;&#96;&#96;\n\n### 최소 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Minimal Page\&quot;\n  route: \&quot;/minimal\&quot;\n  theme: \&quot;light\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  spacing.unit: 12\n}\n\nlayout {\n  Div(class:\&quot;min-h-screen flex items-center justify-center bg-gray-50\&quot;) {\n    \&quot;Coming soon\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n### Form 중심 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Sign Up\&quot;\n  route: \&quot;/signup\&quot;\n  theme: \&quot;light\&quot;\n  description: \&quot;Create a new account\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#2563EB\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n}\n\ncomponents {\n  Form\n  Input\n  Button\n  Alert\n}\n\nlayout {\n  Section(class:\&quot;min-h-screen flex items-center justify-center bg-gray-100\&quot;) {\n    Form(class:\&quot;w-full max-w-md space-y-6 bg-white p-8 rounded-xl shadow-lg\&quot;) {\n      H2(class:\&quot;text-2xl font-semibold text-gray-900\&quot;) {\n        \&quot;Create your account\&quot;\n      }\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;email\&quot;, placeholder:\&quot;Enter email\&quot;)\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;password\&quot;, placeholder:\&quot;Enter password\&quot;)\n      Button(class:\&quot;w-full bg-blue-600 text-white py-3 rounded-lg\&quot;) {\n        \&quot;Sign up\&quot;\n      }\n      Alert(class:\&quot;text-sm text-gray-500 text-center\&quot;) {\n        \&quot;By signing up you agree to our terms\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onSubmit: \&quot;handleSignup\&quot;\n  onLoad: \&quot;prefillFromInvite\&quot;\n}\n&#96;&#96;&#96;\n\n### 콘텐츠 피드 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Creator Feed\&quot;\n  route: \&quot;/feed\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Realtime creator activity feed\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#22D3EE\&quot;\n  color.background: \&quot;#0F172A\&quot;\n  font.family: \&quot;Space Grotesk\&quot;\n  spacing.medium: 20\n  radius.card: 12\n}\n\ncomponents {\n  Shell\n  Sidebar\n  Feed\n  FeedItem\n  Avatar\n  Badge\n}\n\nlayout {\n  Shell(class:\&quot;min-h-screen bg-slate-950 text-slate-100\&quot;) {\n    Sidebar(class:\&quot;w-64 border-r border-slate-800 p-6 space-y-6\&quot;) {\n      H1(class:\&quot;text-xl font-semibold tracking-tight\&quot;) {\n        \&quot;Creator Hub\&quot;\n      }\n      Badge(class:\&quot;inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 text-slate-200\&quot;) {\n        \&quot;Live updates\&quot;\n      }\n    }\n    Feed(class:\&quot;flex-1 p-8 space-y-6\&quot;) {\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-cyan-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;heymina.studio\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-300\&quot;) {\n              \&quot;New drop\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Dropped a limited neon kit — 120 packs sold out in 3 minutes.\&quot;\n          }\n        }\n      }\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-pink-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;luvv.wav\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-cyan-500/10 text-cyan-300\&quot;) {\n              \&quot;Stream recap\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Hit 18,245 live viewers tonight — chat requested a synthwave encore.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onRefresh: \&quot;fetchLatestFeed\&quot;\n  onClick: \&quot;openCreatorProfile\&quot;\n}\n&#96;&#96;&#96;\n\n---\n\n## Version\n\n- **Version**: 1.0.0\n- **Last Update**: 2025-11-18\n- **Change Summary**: Complete guide consolidating all UIH DSL specifications\n\n---\n\n## 문서 끝\n\n이 문서는 UIH DSL의 모든 스펙을 \&quot;생략 없이\&quot; 하나의 파일로 통합한 완전판입니다. Foundation Layer부터 Codegen까지 전 과정을 포함하며, LLM이 UI를 정확하게 선언할 수 있도록 설계된 모든 규칙이 담겨 있습니다.\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating event mapping cases**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Adjusting DSL object casing**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;883fc051-09e6-40c9-997c-bab6b03a85b8&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  // 동일한 IR 이벤트\n  {\n-   onClick: \&quot;handleClick\&quot;,\n-   onChange: \&quot;handleChange\&quot;,\n-   onLoad: \&quot;init\&quot;\n+   onclick: \&quot;handleClick\&quot;,\n+   onchange: \&quot;handleChange\&quot;,\n+   onload: \&quot;init\&quot;\n  }\n  &#96;&#96;&#96;&quot;,
        &quot;oldStart&quot;: 2727,
        &quot;newStart&quot;: 2727,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 7,
        &quot;linesRemoved&quot;: 3,
        &quot;linesAdded&quot;: 3
      },
      {
        &quot;diffString&quot;: &quot;  &lt;Button onClick={handleClick} onChange={handleChange} onLoad={init}&gt;\n  &#96;&#96;&#96;\n+ \n+ &gt; DSL 이벤트 키는 항상 소문자지만 React JSX에서는 &#96;onClick&#96;처럼 프레임워크 규칙에 맞게 자동 변환된다.\n  \n  ### Edge Cases&quot;,
        &quot;oldStart&quot;: 2747,
        &quot;newStart&quot;: 2747,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 6,
        &quot;linesAdded&quot;: 2
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/jaewonlee/Documents/CODESBYLEEJAEWON/uih-v2/docs/uih-dsl-complete-guide.md&quot;,
  &quot;contentsAfterEdit&quot;: &quot;# UIH DSL — Complete Guide (생략 없는 완전판)\n\n## Table of Contents\n\n1. [Overview](#overview)\n2. [Philosophy &amp; Design Principles](#philosophy--design-principles)\n3. [Foundation Layer](#foundation-layer)\n4. [Tokenizer Specification](#tokenizer-specification)\n5. [Grammar](#grammar)\n   - [Block Grammar](#block-grammar)\n   - [Property Grammar](#property-grammar)\n   - [Layout Tree Grammar](#layout-tree-grammar)\n   - [Parser BNF Grammar](#parser-bnf-grammar)\n6. [AST Schema Definition](#ast-schema-definition)\n7. [IR (Intermediate Representation) Specification](#ir-intermediate-representation-specification)\n8. [Codegen Rules](#codegen-rules)\n   - [React/Next.js 15 Codegen](#reactnextjs-15-codegen)\n   - [Vue &amp; Svelte Codegen](#vue--svelte-codegen)\n9. [Examples](#examples)\n10. [Version](#version)\n\n---\n\n## Overview\n\nUIH DSL (Universal Interface Hierarchy Domain Specific Language) v2는 **\&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;**를 목표로 하는 도메인 특화 언어입니다.\n\n### 핵심 목표\n- LLM이 UI 구조를 **정확하게** 선언할 수 있도록 설계\n- 모호성 제거 및 결정성(determinism) 보장\n- 사람보다 AI가 더 효과적으로 사용 가능한 DSL\n- UI 구조의 선언적 표현에 집중\n\n### 아키텍처 흐름\n&#96;&#96;&#96;\nDSL 문자열 → Tokenizer → Parser → AST → IR → Codegen → React/Vue/Svelte 코드\n&#96;&#96;&#96;\n\n### 주요 특징\n- 한 줄에 하나의 의미만 (One-intent-per-line)\n- 선택적 문법 금지 - 모든 것이 명시적\n- 쌍따옴표만 허용, 세미콜론 없음\n- 주석 지원 안 함 (모호성 제거)\n- 고정 블록 순서: meta → style → components → layout → script\n\n---\n\n## Philosophy &amp; Design Principles\n\nUIH DSL은 \&quot;AI가 절대 실수하지 않는 UI 선언 언어\&quot;를 목표로 하는 도메인 특화 언어입니다. 사람보다 LLM이 더 효과적으로 사용할 수 있도록 설계되었으며, UI 구조의 선언적 표현에 집중합니다.\n\n### 1. LLM 친화적 설계 원칙\n\nLLM이 읽고 쓰기 편한 DSL을 지향합니다. 구조는 최대한 명확하고 모호성이 없으며, 선택적 문법을 금지합니다. LLM이 패턴을 쉽게 반복할 수 있는 형태로 자연어 번역 난이도를 낮췄습니다.\n\n### 2. 선언적 UI 설계\n\nUI는 로직 기반보다 구조 기반으로 설계합니다. \&quot;무엇을 만든다\&quot;에 집중하며 \&quot;어떻게 만든다\&quot;는 Codegen이 담당합니다. 상태, 이벤트, 애니메이션은 추상화 계층으로 밀어냅니다.\n\n### 3. 한 줄 한 의미 원칙 (One-intent-per-line)\n\n한 라인에 하나의 의미만 허용합니다. 한 줄에 두 개 의미를 섞으면 LLM이 실수할 가능성이 높아집니다.\n\n#### 좋은 예: 한 줄 한 의미\n&#96;&#96;&#96;dsl\nmeta:\n  title: \&quot;Home\&quot;\n\nmeta:\n  route: \&quot;/\&quot;\n&#96;&#96;&#96;\n\n#### 나쁜 예: 한 줄 다중 의미 (금지)\n&#96;&#96;&#96;dsl\nmeta: title: \&quot;Home\&quot;, route: \&quot;/\&quot;  # 잘못된 예\n&#96;&#96;&#96;\n\n### 4. 고정 블록 순서\n\n블록 구조는 **meta → style → components → layout → script** 순서를 유지합니다. 이 순서는 LLM이 외우기 쉽고 Codegen의 예측 가능성과 AST의 결정성을 보장합니다.\n\n### 5. 최소 표현, 최대 의미\n\nDSL은 짧고 규칙적이어야 합니다. CSS-like verbose, YAML 계층 증가, JSX 로직 섞임을 금지합니다. 의미 전달에 집중하는 최소 선언적 DSL입니다.\n\n### 6. 오류 제로 문법\n\n\&quot;AI가 틀릴 수 없는 언어\&quot;를 목표로 합니다. 쌍따옴표만 허용하고 세미콜론 없이 콜론만 사용합니다. 모든 키는 고정된 string literal이며 optional field를 최소화합니다.\n\n### 7. AST 1:1 매핑\n\n모든 UI 요소가 AST에 직접 매핑됩니다. meta 블록 → MetaNode, style 블록 → StyleNode, layout 블록 → LayoutTree로 변환됩니다.\n\n### 8. 기계 친화적 우선\n\n\&quot;사람이 읽으면 조금 불편할 것\&quot; 정도가 적정 수준입니다. 사람 UX보다 AI 정확성을 우선합니다.\n\n---\n\n## Foundation Layer\n\nUIH DSL의 가장 낮은 레벨 사양입니다. Character부터 Ordering까지의 기본 규칙을 정의하며, LLM이 실수할 수 없는 엄격한 문법을 제공합니다.\n\n### 1. Character Layer (문자 규칙)\n\n#### ALLOWED_CHARACTERS\n- a~z (lowercase alphabets)\n- 0~9 (digits)\n- hyphen (-)\n- underscore (_)\n- space ( )\n- newline (\\n)\n- braces: { }\n- colon (:)\n- double-quote (\&quot;)\n\n#### DISALLOWED_CHARACTERS\n- single-quote (&#39;)\n- semicolon (;)\n- parentheses ()\n- backtick (&#96;)\n- tab (\\t)\n- CRLF (\\r\\n)\n\n#### NEWLINE\n- always LF (\\n)\n- CRLF not supported\n\n### 2. Indentation Layer (들여쓰기 규칙)\n\n#### INDENTATION\n- exactly 2 spaces ONLY\n- tabs NOT allowed\n- indentation increases only inside a block\n- indentation does not imply hierarchy (not YAML)\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {           // ❌ 탭 사용 금지\n  title: \&quot;Home\&quot;  // ✅ 정확히 2 space\n}\n&#96;&#96;&#96;\n\n### 3. Token Layer (토큰 기본 규칙)\n\n#### TOKENS\n- IDENTIFIER = &#96;[a-z][a-z0-9.]*&#96;\n- STRING = &#96;\&quot;[^\&quot;\\\\]*(?:\\\\.[^\&quot;\\\\]*)*\&quot;&#96; (supports &#96;\\\&quot;&#96; escape)\n- NUMBER = &#96;\\d+(?:\\.\\d+)?&#96;\n- LBRACE = &#96;{&#96;\n- RBRACE = &#96;}&#96;\n- COLON = &#96;:&#96;\n- NEWLINE = &#96;\\n&#96;\n- WHITESPACE = single space\n\n#### IDENTIFIER_RULES\n- lowercase only\n- dot notation allowed (e.g. &#96;color.primary&#96;)\n- do NOT mix hyphens inside identifiers (LLM error-prone)\n\n#### STRING_RULES\n- must use double quotes only\n- escaping uses &#96;\\\&quot;&#96;\n\n#### 예시\n&#96;&#96;&#96;dsl\nmeta {\n  color.primary: \&quot;#fff\&quot;    // ✅ dot notation 허용\n  label: \&quot;Click \\\&quot;here\\\&quot;\&quot;  // ✅ escape 허용\n  width: 100.5            // ✅ 소수 허용\n}\n&#96;&#96;&#96;\n\n### 4. Comment Layer (코멘트)\n\n#### COMMENTS\n- comments NOT supported\n- any attempt to use &#96;//&#96; or &#96;#&#96; is invalid\n- purpose: reduce ambiguity for LLM\n\n### 5. Statement Layer (기본 문장 구조)\n\n#### STATEMENT_TYPES\n- Block Declaration\n- Property Declaration\n\n#### BLOCK_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt; {\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n#### PROPERTY_DECLARATION\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n#### SEMICOLON\n- NOT allowed (never used)\n\n### 6. Block Layer (블록 기본 규칙)\n\n#### BLOCK_STRUCTURE\n&#96;&#96;&#96;\nblockName {\n  property: \&quot;value\&quot;\n  property: 123\n  property: true\n}\n&#96;&#96;&#96;\n\n#### BLOCK_RULES\n- block cannot contain nested blocks\n- ONLY layout block may contain nested layout nodes\n\n### 7. Ordering Layer (순서 강제)\n\n#### BLOCK_ORDER\n1. meta\n2. style\n3. components (optional)\n4. layout\n5. script (optional)\n\n#### RULE\n- if a block appears, must follow this order\n- missing blocks are allowed except meta/style/layout\n\n### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  primary-color: \&quot;#111\&quot;\n}\n\ncomponents {\n  Button {\n    variant: \&quot;primary\&quot;\n  }\n}\n\nlayout {\n  Container {\n    children: \&quot;Button\&quot;\n  }\n}\n\nscript {\n  // optional script\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단\n- 잘못된 들여쓰기 발견 시 구문 오류\n- 코멘트 시도 시 즉시 무효 처리\n- 블록 순서 위반 시 파싱 실패\n- layout 외 중첩 블록 시도 시 오류\n\n---\n\n## Tokenizer Specification\n\nFoundation Layer + Grammar Layers 기반의 공식 토큰화 규칙입니다. DSL 문자열을 균일한 Token 리스트로 변환하며, 모든 파싱의 기반이 됩니다.\n\n### 1. Tokenizer Overview\n\n#### PURPOSE\n- DSL 문자열을 균일한 Token 리스트로 변환\n- 모호성 없는 deterministic token stream 생성\n- 모든 파싱은 이 토큰 리스트 기반으로 진행\n\n#### INPUT\n- LF 기반의 DSL 문자열\n\n#### OUTPUT\n- 순차적 Token 배열\n\n### 2. Token Types\n\n#### TOKENS\n- &#96;IDENTIFIER&#96; - meta, title, color.primary, class 등\n- &#96;STRING&#96; - \&quot;Hello\&quot;\n- &#96;NUMBER&#96; - 0, 12, 0.8\n- &#96;BOOLEAN&#96; - true, false\n- &#96;LBRACE&#96; - {\n- &#96;RBRACE&#96; - }\n- &#96;LPAREN&#96; - (\n- &#96;RPAREN&#96; - )\n- &#96;COLON&#96; - :\n- &#96;COMMA&#96; - ,\n- &#96;NEWLINE&#96; - \\n\n- &#96;WHITESPACE&#96; - space (only used between tokens)\n- &#96;TEXT_STRING&#96; - layout children string ONLY (disambiguation)\n- &#96;EOF&#96; - end of file marker\n\n### 3. Identifier Detection\n\n#### IDENTIFIER_RULES\n- regex: &#96;^[a-z][a-z0-9.]*$&#96;\n- lowercase only\n- dot notation allowed\n- hyphens, underscores 금지\n\n#### TAGNAME_RULES\n- starts with uppercase letter\n- subsequent chars: &#96;[a-zA-Z0-9]&#96;\n- TagName (e.g. Div, Header) 구분용\n\n#### TAGNAME_EXAMPLES\n&#96;&#96;&#96;\nDiv\nSection\nImage\nH1\n&#96;&#96;&#96;\n\n### 4. String Token Rules\n\n#### STRING\n- starts with &#96;\&quot;&#96;\n- ends with &#96;\&quot;&#96;\n- inside supports &#96;\\\&quot;&#96;\n- no multi-line\n\n#### TEXT_STRING\n- STRING과 동일한 문법\n- 단, layout children context에서만 등장\n- Parser에서 context-aware로 구분\n\n### 5. Number Token Rules\n\n#### NUMBER\n- regex: &#96;^[0-9]+(\\.[0-9]+)?$&#96;\n- no negative numbers\n- no units (px, rem 등)\n\n### 6. Boolean Token Rules\n\n#### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n- strictly lowercase\n\n### 7. Brace / Symbol Tokens\n\n#### SYMBOL_TOKENS\n- &#96;LBRACE&#96;: &#96;{&#96;\n- &#96;RBRACE&#96;: &#96;}&#96;\n- &#96;LPAREN&#96;: &#96;(&#96;\n- &#96;RPAREN&#96;: &#96;)&#96;\n- &#96;COLON&#96;: &#96;:&#96;\n- &#96;COMMA&#96;: &#96;,&#96;\n\n#### NOTES\n- semicolon NOT allowed\n- backtick NOT allowed\n\n### 8. Whitespace / Newline Rules\n\n#### WHITESPACE\n- single space &#96;&#39; &#39;&#96;\n- no tabs\n- no multi-space sequences except indentation (2 spaces)\n\n#### NEWLINE\n- LF only\n- CRLF invalid\n\n### 9. Layout Context Rules (Critical)\n\n#### LAYOUT_MODE\nTokenizer enters layout-mode when encountering:\n&#96;&#96;&#96;\nlayout { … }\n&#96;&#96;&#96;\n\n#### CONTEXT_SWITCH\n- after TagName(\n- before encountering next node or text\n\n#### INSIDE_LAYOUT_BLOCK\n- children detection required\n- plain strings must become TEXT_STRING token\n- siblings separated by NEWLINE\n\n#### EXAMPLE\n&#96;&#96;&#96;\n\&quot;Welcome\&quot; → TEXT_STRING inside layout\n&#96;&#96;&#96;\n\n### 10. Tokenization Algorithm (High-Level)\n\n1. iterate through chars\n2. skip whitespace unless meaningful (indent)\n3. detect IDENTIFIER or TAGNAME\n4. detect STRING (with escape)\n5. detect NUMBER\n6. detect BOOLEAN\n7. detect braces &#96;{ }&#96;\n8. detect parentheses &#96;( )&#96;\n9. detect colon &#96;:&#96; or comma &#96;,&#96;\n10. detect newline &#96;\\n&#96;\n11. maintain context stack:\n    - normal\n    - inside layout block\n    - inside attributes\n12. output final EOF token\n\n### 11. Example Token Stream\n\n#### INPUT\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### OUTPUT_TOKENS\n&#96;&#96;&#96;\nIDENTIFIER(layout)\nLBRACE\nNEWLINE\nTAGNAME(Div)\nLPAREN\nIDENTIFIER(class)\nCOLON\nSTRING(\&quot;p-4\&quot;)\nRPAREN\nLBRACE\nNEWLINE\nTEXT_STRING(\&quot;Hello\&quot;)\nNEWLINE\nRBRACE\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Token Stream Examples\n\n#### 기본 블록 토큰화\n&#96;&#96;&#96;dsl\nmeta {\n  title: \&quot;Home\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(meta)\nLBRACE\nNEWLINE\nIDENTIFIER(title)\nCOLON\nSTRING(\&quot;Home\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n#### 스타일 블록 토큰화\n&#96;&#96;&#96;dsl\nstyle {\n  color.primary: \&quot;#fff\&quot;\n}\n&#96;&#96;&#96;\n\n**Tokens:**\n&#96;&#96;&#96;\nIDENTIFIER(style)\nLBRACE\nNEWLINE\nIDENTIFIER(color.primary)\nCOLON\nSTRING(\&quot;#fff\&quot;)\nNEWLINE\nRBRACE\nEOF\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- 허용되지 않은 문자 발견 시 토큰화 중단 및 오류 반환\n- CRLF 줄바꿈 발견 시 LF로 변환 또는 오류\n- 탭 문자 발견 시 공백 변환 또는 오류\n- STRING에서 미닫힘 따옴표 시 오류\n- NUMBER에 음수나 단위 포함 시 오류\n- layout 외 컨텍스트에서 TEXT_STRING 시도 시 오류\n- TAGNAME 규칙 위반 (소문자 시작) 시 IDENTIFIER로 처리\n\n---\n\n## Grammar\n\n### Block Grammar\n\nUIH DSL의 최상위 구조를 정의하는 Block Grammar Layer입니다. Foundation Layer 바로 위에 위치하며, 5개 블록의 선언, 순서, 내용 규칙을 명시합니다.\n\n#### 1. Block Definitions (5개 블록)\n\n##### BLOCKS\n- meta\n- style\n- components (optional)\n- layout\n- script (optional)\n\n##### RULES\n- 블록은 반드시 이 순서를 따라야 함: meta → style → components → layout → script\n- meta, style, layout은 필수\n- components, script는 선택\n- 각 블록은 정확히 한 번만 등장\n- 중복 블록 금지\n\n#### 2. Block Syntax (기본 문법)\n\n##### BLOCK_SYNTAX\n&#96;&#96;&#96;\n&lt;blockName&gt; {\n  &lt;property&gt;: &lt;value&gt;\n  &lt;property&gt;: &lt;value&gt;\n}\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n&#96;&#96;&#96;\n\n##### SYNTAX_COMPONENTS\n- 블록 시작: IDENTIFIER + &#96; {&#96;\n- 블록 끝: &#96;}&#96; 단독 줄\n\n#### 3. Block Content Rules\n\n##### 공통 규칙\n- 블록 내부에는 property statements만 존재\n- block 내부에 block 중첩 금지\n- 단, layout 블록만 예외적으로 UI tree 구조 허용\n\n##### PROPERTY_RULE\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### VALUE_TYPES\n- string\n- number\n- boolean\n- enum-like literals (string 값)\n- list (향후 정의)\n\n#### 4. Block-Specific Rules\n\n##### (1) META BLOCK\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Page title\&quot;\n  route: \&quot;/path\&quot;\n  theme: \&quot;light\&quot;|\&quot;dark\&quot;\n}\n&#96;&#96;&#96;\n\n**META_RESTRICTIONS:**\n- meta는 UI 문서의 metadata만 포함\n- layout 정보나 스타일 정보 포함 금지\n\n##### (2) STYLE BLOCK\n&#96;&#96;&#96;\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n}\n&#96;&#96;&#96;\n\n**STYLE_RESTRICTIONS:**\n- key는 dot notation 사용 가능\n- 값은 string 또는 number\n- layout 관련 속성 금지\n- theme override 불가\n\n##### (3) COMPONENTS BLOCK (optional)\n&#96;&#96;&#96;\ncomponents {\n  Card\n  Button\n  Input\n}\n&#96;&#96;&#96;\n\n**COMPONENTS_RULES:**\n- 등록할 컴포넌트 이름만 줄 단위로 나열\n- 중첩 구조 없음\n- 속성 없음\n- 문자열 아님: &#96;\&quot;Card\&quot;&#96; 금지, &#96;Card&#96;만 허용\n\n##### (4) LAYOUT BLOCK\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n**LAYOUT_RULES:**\n- 유일하게 중첩 구조 허용\n- 노드 문법은 별도 Layer에서 정의\n- property는 inline attribute 형태 가능\n- block-like structure 유지\n\n##### (5) SCRIPT BLOCK (optional)\n&#96;&#96;&#96;\nscript {\n  onclick: \&quot;submitForm\&quot;\n  onload: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n**SCRIPT_RESTRICTIONS:**\n- event/behavior mapping만 정의\n- JS code 삽입 금지\n- inline function 금지\n- event identifier는 반드시 lowercase (camelCase 금지)\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  font.family: \&quot;Inter\&quot;\n  spacing.unit: 8\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n}\n\nlayout {\n  Div(class:\&quot;container mx-auto p-4\&quot;) {\n    Card(class:\&quot;bg-white shadow-lg\&quot;) {\n      Button(onclick:\&quot;handleSubmit\&quot;) {\n        \&quot;Submit\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;processForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 파싱 실패\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유효 (경고)\n- components/script 외 블록에서 중첩 시도 시 오류\n- layout 외 블록에서 attribute 사용 시 오류\n\n---\n\n### Property Grammar\n\nUIH DSL 안정성의 핵심인 Property Grammar Layer입니다. Block Grammar 위에 쌓이며, 속성 선언, 값 타입, 범위 규칙을 정의합니다.\n\n#### 1. Property Declaration Syntax\n\n##### PROPERTY_SYNTAX\n&#96;&#96;&#96;\n&lt;identifier&gt;: &lt;value&gt;\n&#96;&#96;&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\nradius.default: 8\nenabled: true\n&#96;&#96;&#96;\n\n##### RULES\n- identifier는 반드시 lowercase\n- dot notation 허용 (&#96;color.primary&#96; 등)\n- colon(:) 뒤에는 반드시 space 1개\n- value는 줄 끝까지\n\n#### 2. Identifier Rules\n\n##### IDENTIFIER\n- 패턴: &#96;[a-z][a-z0-9.]*&#96;\n- 소문자만 허용\n- 숫자는 뒤쪽에만 허용\n- dot(.)은 중첩 속성 의미로만 사용\n- hyphen 금지 (LLM 오류 방지)\n- underscore 금지\n\n##### VALID\n&#96;&#96;&#96;\ncolor.primary\nfont.size\nborder.width\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nColor.Primary    // 대문자\nfont-size        // hyphen\nfont_size        // underscore\nprimary2.color   // 숫자 앞쪽\n&#96;&#96;&#96;\n\n#### 3. Value Types (5가지)\n\n##### VALUE_TYPES\n1. STRING\n2. NUMBER\n3. BOOLEAN\n4. ENUM-LIKE (string 기반)\n5. LIST (여러 값 나열, 줄 단위)\n\n#### 4. String Value Rules\n\n##### STRING\n- 무조건 double-quote 사용\n- 내부에 &#96;\&quot;&#96; 포함 시 &#96;\\\&quot;&#96;로 escape\n- single-quote 절대 금지\n\n##### VALID\n&#96;&#96;&#96;\ntitle: \&quot;Home\&quot;\ndescription: \&quot;He said \\\&quot;ok\\\&quot;\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\ntitle: &#39;Home&#39;      // single-quote\nname: \&quot;Home\&quot;       // curly quotes\n&#96;&#96;&#96;\n\n#### 5. Number Value Rules\n\n##### NUMBER\n- 정수 또는 소숫점 가능\n- 음수는 허용하지 않음\n- 단위(px 등) 금지 → unitless 구조\n\n##### VALID\n&#96;&#96;&#96;\nradius: 12\nopacity: 0.85\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nradius: -4     // 음수\nwidth: 10px    // 단위 포함\n&#96;&#96;&#96;\n\n#### 6. Boolean Value Rules\n\n##### BOOLEAN\n- &#96;true&#96; or &#96;false&#96;\n\n##### EXAMPLES\n&#96;&#96;&#96;\nenabled: true\nvisible: false\n&#96;&#96;&#96;\n\n#### 7. Enum-like String Rules\n\n##### ENUM_STRING\n- 문자열이지만 값이 고정된 타입처럼 쓰는 케이스\n- allowed values는 별도 block schema마다 정의\n\n##### EXAMPLES\n&#96;&#96;&#96;\ntheme: \&quot;light\&quot; | \&quot;dark\&quot;\nsize: \&quot;sm\&quot; | \&quot;md\&quot; | \&quot;lg\&quot;\n&#96;&#96;&#96;\n\n#### 8. List Value (Block-like list)\n\n##### LIST\n- 각 항목은 줄 단위로 입력\n- 대괄호 &#96;[]&#96; 문법 없음 (LLM 오류 방지)\n- 문자열/식별자 혼용 가능\n\n##### SYNTAX\n&#96;&#96;&#96;\nitems {\n  \&quot;one\&quot;\n  \&quot;two\&quot;\n  \&quot;three\&quot;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- list block 내부에는 property 없음\n- indent 2 spaces 유지\n\n##### EXAMPLE\n&#96;&#96;&#96;\ntags {\n  \&quot;news\&quot;\n  \&quot;feature\&quot;\n  \&quot;announcement\&quot;\n}\n&#96;&#96;&#96;\n\n#### 9. Property Scope Rules (Block별 허용 속성 경계)\n\n##### META_SCOPE\n- meta는 UI metadata만 포함\n- route, title, theme, description 등\n\n##### STYLE_SCOPE\n- 색상, 폰트, radius 등 UI 스타일만\n- layout 속성 금지 (width, height 등은 layout block에서만)\n\n##### COMPONENTS_SCOPE\n- property 없음 (등록만)\n\n##### LAYOUT_SCOPE\n- inline attribute만 (class, id, ref 등)\n- 값은 무조건 string\n- boolean/number 사용 금지\n\n##### SCRIPT_SCOPE\n- event mapping 전용\n- 값은 무조건 string\n\n#### 10. Final Validation Rules\n\n1. 모든 property는 블록 내부에서만 존재\n2. 같은 identifier 중복 선언 금지\n3. meta/style/script는 property-only 구조\n4. components는 선언만 (property 없음)\n5. layout만 child nodes 보유 가능\n6. value의 타입은 block-specific rule을 반드시 준수\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main dashboard page\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  border.radius: 8\n  spacing.unit: 16\n}\n\ncomponents {\n  Card\n  Button\n  Input\n}\n\nlayout {\n  class: \&quot;container\&quot;\n  id: \&quot;main-content\&quot;\n}\n\nscript {\n  onload: \&quot;initDashboard\&quot;\n  onsubmit: \&quot;handleForm\&quot;\n  onrefresh: \&quot;reloadData\&quot;\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 대문자 identifier 사용 시 토큰화 실패\n- hyphen/underscore 사용 시 구문 오류\n- single-quote나 curly quotes 사용 시 파싱 실패\n- 음수나 단위 포함 숫자 시 값 오류\n- 블록별 스코프 위반 시 validation 실패\n- 중복 property 선언 시 마지막 값만 유효 (경고)\n\n---\n\n### Layout Tree Grammar\n\nUIH DSL의 핵심 구조인 Layout Tree Grammar Layer입니다. Block Grammar와 Property Grammar 위에서 동작하며, UI 구성 요소의 트리 구조를 정의합니다.\n\n#### 1. Layout Block Overview\n\n##### LAYOUT_BLOCK\n&#96;&#96;&#96;\nlayout {\n  &lt;layout-node&gt;\n}\n&#96;&#96;&#96;\n\n##### NOTES\n- DSL에서 유일하게 중첩 구조를 가질 수 있는 블록\n- 모든 UI 구성 요소는 layout node로 표현\n- 노드는 \&quot;구조\&quot;만 표현, 스타일/로직은 표현하지 않음\n\n#### 2. Layout Node Syntax\n\n##### NODE_SYNTAX\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;) {\n  &lt;children&gt;\n}\n&#96;&#96;&#96;\n\n##### OR (children 없는 경우)\n&#96;&#96;&#96;\n&lt;TagName&gt;(&lt;attributes&gt;)\n&#96;&#96;&#96;\n\n##### NOTES\n- TagName은 PascalCase 컴포넌트 또는 HTML-like 사용 가능\n- attributes는 inline 형태 only\n- attributes는 옵션, 없어도 됨\n- children 블록은 중첩 가능\n\n##### VALID\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) {\n  \&quot;Hello\&quot;\n}\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\nDiv {\n  class: \&quot;p-4\&quot;    // 속성은 block 기반이 아니라 inline only\n}\n&#96;&#96;&#96;\n\n#### 3. TagName Rules\n\n##### TAGNAME\n- 반드시 알파벳으로 시작\n- PascalCase 또는 UpperCamelCase 권장\n- HTML-like 소문자 태그는 사용 가능 (&#96;div&#96;, &#96;span&#96;) 단 내부적으로는 UpperCase 변환됨\n\n##### VALID\n&#96;&#96;&#96;\nDiv\nSection\nImage\nheader   // 허용하지만 변환 시 Header로 취급\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n3Div     // 숫자 시작\n_Box     // underscore 시작\n-Node    // hyphen 시작\n&#96;&#96;&#96;\n\n#### 4. Attribute Syntax\n\n##### ATTRIBUTES\n&#96;&#96;&#96;\n&lt;identifier&gt;:\&quot;&lt;string&gt;\&quot;\n&#96;&#96;&#96;\n\n##### RULES\n- value는 무조건 string only\n- boolean/number 금지\n- &#96;class:\&quot;p-4\&quot;&#96; 형태처럼 inline만 허용\n- 각 attribute는 콤마(&#96;,&#96;)로 구분\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;, id:\&quot;main\&quot;, ref:\&quot;root\&quot;)\n&#96;&#96;&#96;\n\n##### STRICT_RULES\n- 속성 순서는 의미 없음 (LLM 실수 방지로 자유 순서)\n- attribute key는 lower-case only\n- 속성 개수 0~5 정도 권장\n\n#### 5. Children Rules\n\n##### CHILD_TYPES\n- string literal\n- another layout node\n- list of siblings (node 여러 개 배치)\n\n##### STRING_CHILD\n&#96;&#96;&#96;\n\&quot;Hello world\&quot;\n&#96;&#96;&#96;\n\n##### NESTED_NODE\n&#96;&#96;&#96;\nDiv(class:\&quot;mt-4\&quot;) {\n  \&quot;content\&quot;\n}\n&#96;&#96;&#96;\n\n##### SIBLINGS\n&#96;&#96;&#96;\nDiv(...) { ... }\nP(...) { ... }\nImage(...)\n&#96;&#96;&#96;\n\n#### 6. Text Node Rules\n\n##### TEXT_NODE\n- 무조건 double-quote string\n- 줄바꿈 포함 금지\n- 텍스트 덩어리는 여러 줄로 쪼개면 안 됨\n\n##### VALID\n&#96;&#96;&#96;\n\&quot;Sign in to continue\&quot;\n&#96;&#96;&#96;\n\n##### INVALID\n&#96;&#96;&#96;\n\&quot;Hello\n World\&quot;    // 줄바꿈 포함\n&#96;&#96;&#96;\n\n#### 7. Node Termination Rules\n\n##### CLOSING_RULES\n- 블록 노드는 반드시 &#96;}&#96; 단독 줄로 닫는다\n- inline-only 노드는 종료 블록 없음\n\n##### EXAMPLE\n&#96;&#96;&#96;\nDiv(class:\&quot;px-4\&quot;) {\n  P {\n    \&quot;Hello\&quot;\n  }\n  Image(src:\&quot;/logo.png\&quot;)\n}\n&#96;&#96;&#96;\n\n#### 8. Layout Grammar Formal Pattern\n\n##### LAYOUT_NODE_GRAMMAR\n&#96;&#96;&#96;\nNode:\n  Tag (Attributes?) (ChildrenBlock?)\n\nTag:\n  IDENTIFIER\n\nAttributes:\n  \&quot;(\&quot; AttributeList \&quot;)\&quot;\n\nAttributeList:\n  Attribute (\&quot;,\&quot; Attribute)*\n\nAttribute:\n  IDENTIFIER \&quot;:\&quot; STRING\n\nChildrenBlock:\n  \&quot;{\&quot; NewLine Indented(NodeOrText)+ \&quot;}\&quot;\n\nNodeOrText:\n  Node | STRING\n&#96;&#96;&#96;\n\n#### 9. Validation Rules\n\n1. layout은 트리 구조만 표현한다\n2. inline attributes만 허용\n3. 속성은 string-only\n4. children은 반드시 정해진 중첩 규칙을 따른다\n5. Node 이름은 PascalCase가 기본\n6. 문자열 children 외에는 모든 children은 Node여야 한다\n7. siblings 허용, 순서 보존\n\n#### 10. Example (Valid Layout Tree)\n\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;min-h-screen flex flex-col\&quot;) {\n    Header(class:\&quot;p-4 bg-gray-100\&quot;) {\n      H1 {\n        \&quot;Dashboard\&quot;\n      }\n    }\n\n    Main(class:\&quot;flex-1 p-6\&quot;) {\n      Card(class:\&quot;shadow\&quot;) {\n        P {\n          \&quot;Welcome back!\&quot;\n        }\n      }\n    }\n\n    Footer(class:\&quot;p-4 text-center\&quot;) {\n      \&quot;© 2025 The Bespoke\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 전체 구조 예시\n\n&#96;&#96;&#96;\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto\&quot;) {\n    Navbar(class:\&quot;flex justify-between items-center p-4\&quot;) {\n      Logo(class:\&quot;text-xl font-bold\&quot;) {\n        \&quot;UIH\&quot;\n      }\n      Nav(class:\&quot;space-x-4\&quot;) {\n        Link(href:\&quot;/home\&quot;) {\n          \&quot;Home\&quot;\n        }\n        Link(href:\&quot;/about\&quot;) {\n          \&quot;About\&quot;\n        }\n      }\n    }\n\n    Content(class:\&quot;grid grid-cols-3 gap-6 p-6\&quot;) {\n      Sidebar(class:\&quot;col-span-1 bg-gray-50 p-4\&quot;) {\n        Menu {\n          \&quot;Dashboard\&quot;\n          \&quot;Settings\&quot;\n          \&quot;Profile\&quot;\n        }\n      }\n\n      Main(class:\&quot;col-span-2\&quot;) {\n        Article(class:\&quot;prose\&quot;) {\n          H2 {\n            \&quot;Getting Started\&quot;\n          }\n          P {\n            \&quot;Welcome to UIH DSL documentation.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- TagName에 숫자/특수문자 시작 시 토큰화 실패\n- 속성에 boolean/number 값 사용 시 파싱 오류\n- 텍스트 노드에 줄바꿈 포함 시 validation 실패\n- 노드 종료 &#96;}&#96; 누락 시 구문 오류\n- 중첩 깊이가 너무 깊을 경우 (권장 5레벨 초과) 경고\n- siblings 간 순서가 UI 의미에 영향 줄 경우 재검토\n\n---\n\n### Parser BNF Grammar\n\nTokenizer 위에서 동작하는 공식 문법 엔진 정의입니다. Token Stream을 Abstract Syntax Tree(AST)로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- Token Stream → Abstract Syntax Tree(AST)\n\n##### PARSER_MODE\n- strict non-ambiguous grammar\n- no recovery parsing (에러는 즉시 throw)\n- deterministic (LLM-friendly)\n- recursive descent parser 기반 구조\n\n#### 2. Entry Point\n\n##### Program\n&#96;&#96;&#96;\nProgram ::= MetaBlock StyleBlock ComponentsBlock? LayoutBlock ScriptBlock? EOF\n&#96;&#96;&#96;\n\n#### 3. Blocks\n\n##### Block_Definitions\n&#96;&#96;&#96;\nMetaBlock       ::= \&quot;meta\&quot; BlockBody(MetaProperty)\nStyleBlock      ::= \&quot;style\&quot; BlockBody(StyleProperty)\nComponentsBlock ::= \&quot;components\&quot; BlockBody(ComponentEntry)\nLayoutBlock     ::= \&quot;layout\&quot; LayoutBody\nScriptBlock     ::= \&quot;script\&quot; BlockBody(ScriptProperty)\n&#96;&#96;&#96;\n\n#### 4. Generic Block Body\n\n##### BlockBody\n&#96;&#96;&#96;\nBlockBody(&lt;T&gt;) ::= LBRACE NEWLINE (Indent &lt;T&gt; NEWLINE)* RBRACE\nIndent         ::= WHITESPACE WHITESPACE    # 2 spaces only\n&#96;&#96;&#96;\n\n#### 5. META Block Grammar\n\n##### MetaProperty\n&#96;&#96;&#96;\nMetaProperty ::= Identifier \&quot;:\&quot; MetaValue\nMetaValue    ::= STRING | NUMBER | BOOLEAN | EnumString\n&#96;&#96;&#96;\n\n##### Allowed_Meta_Keys\n- title, route, theme, description\n\n#### 6. STYLE Block Grammar\n\n##### StyleProperty\n&#96;&#96;&#96;\nStyleProperty ::= StyleKey \&quot;:\&quot; StyleValue\nStyleKey      ::= Identifier ( \&quot;.\&quot; Identifier )*\nStyleValue    ::= STRING | NUMBER | EnumString\n&#96;&#96;&#96;\n\n##### Notes\n- no nested blocks\n- no boolean\n- layout-like attributes 금지\n\n#### 7. COMPONENTS Block Grammar\n\n##### ComponentEntry\n&#96;&#96;&#96;\nComponentEntry ::= ComponentName\nComponentName  ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n##### NOTES\n- but no quotes, no values, one per line\n\n##### Examples\n&#96;&#96;&#96;\nCard\nButton\nInput\n&#96;&#96;&#96;\n\n#### 8. LAYOUT Block Grammar (Core)\n\n##### LayoutBody\n&#96;&#96;&#96;\nLayoutBody     ::= LBRACE NEWLINE Indent LayoutNodeList RBRACE\nLayoutNodeList ::= (LayoutNode NEWLINE)*\nLayoutNode     ::= Tag (Attributes)? (ChildrenBlock)?\nTag            ::= TAGNAME | IDENTIFIER\n&#96;&#96;&#96;\n\n#### 9. Attributes Grammar\n\n##### Attributes\n&#96;&#96;&#96;\nAttributes    ::= LPAREN AttributeList RPAREN\nAttributeList ::= Attribute (COMMA Attribute)*\nAttribute     ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n#### 10. Children Block Grammar\n\n##### ChildrenBlock\n&#96;&#96;&#96;\nChildrenBlock ::= LBRACE NEWLINE Indent ChildrenList RBRACE\nChildrenList  ::= (Child NEWLINE)*\nChild         ::= LayoutNode | TEXT_STRING\n&#96;&#96;&#96;\n\n#### 11. SCRIPT Block Grammar\n\n##### ScriptProperty\n&#96;&#96;&#96;\nScriptProperty ::= Identifier \&quot;:\&quot; STRING\n&#96;&#96;&#96;\n\n##### Allowed_Script_Keys\n- onclick, onload, onsubmit, onmount, onchange\n\n&gt; 모든 script event identifier는 전부 소문자여야 하며 camelCase를 사용하지 않는다.\n\n#### 12. Value Grammars\n\n##### Value_Types\n&#96;&#96;&#96;\nSTRING     ::= \&quot;\\\&quot;\&quot; &lt;chars&gt; \&quot;\\\&quot;\&quot;\nNUMBER     ::= digits ( \&quot;.\&quot; digits )?\nBOOLEAN    ::= \&quot;true\&quot; | \&quot;false\&quot;\nEnumString ::= STRING   # validated in semantic phase\n&#96;&#96;&#96;\n\n#### 13. Identifier Grammars\n\n##### Identifiers\n&#96;&#96;&#96;\nIdentifier ::= [a-z][a-z0-9.]*\nTagName    ::= [A-Z][a-zA-Z0-9]*\n&#96;&#96;&#96;\n\n#### 14. Syntax Constraints (Formal)\n\n1. 모든 블록은 순서 고정\n2. 각 블록은 1회만 등장\n3. meta/style/layout은 필수\n4. components/script는 optional\n5. 들여쓰기 2 spaces only\n6. 속성(colon)은 반드시 &#96;&lt;id&gt;: &lt;value&gt;&#96;\n7. semicolon 금지\n8. layout만 nested structure 허용\n9. children 안에서는 TEXT_STRING 또는 LayoutNode만 허용\n10. parser는 ambiguous branch 금지 (LLM-safe)\n\n#### 15. Complete Example (BNF-valid)\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  radius.default: 8\n}\n\ncomponents {\n  Card\n  Button\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    P {\n      \&quot;Hello world\&quot;\n    }\n  }\n}\n\nscript {\n  onclick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### BNF 구조 트리\n\n&#96;&#96;&#96;\nProgram\n├── MetaBlock\n│   ├── LBRACE\n│   ├── MetaProperty (title: \&quot;Home\&quot;)\n│   ├── MetaProperty (route: \&quot;/\&quot;)\n│   └── RBRACE\n├── StyleBlock\n│   ├── LBRACE\n│   ├── StyleProperty (color.primary: \&quot;#0E5EF7\&quot;)\n│   ├── StyleProperty (radius.default: 8)\n│   └── RBRACE\n├── ComponentsBlock\n│   ├── LBRACE\n│   ├── ComponentEntry (Card)\n│   ├── ComponentEntry (Button)\n│   └── RBRACE\n├── LayoutBlock\n│   ├── LBRACE\n│   ├── LayoutNode (Div)\n│   │   ├── Attributes (class:\&quot;p-4\&quot;)\n│   │   └── ChildrenBlock\n│   │       └── LayoutNode (P)\n│   │           └── ChildrenBlock\n│   │               └── TEXT_STRING (\&quot;Hello world\&quot;)\n│   └── RBRACE\n└── ScriptBlock\n    ├── LBRACE\n    ├── ScriptProperty (onClick: \&quot;submitForm\&quot;)\n    └── RBRACE\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- 블록 순서 위반 시 즉시 파싱 중단\n- 필수 블록(meta/style/layout) 누락 시 오류\n- 중복 블록 선언 시 마지막 것만 유지 (경고)\n- 들여쓰기 2 space 위반 시 구문 오류\n- layout 외 블록에서 중첩 시도 시 파싱 실패\n- 허용되지 않은 키 사용 시 semantic 오류 (parser 단계에서는 허용)\n- TEXT_STRING이 layout 외 컨텍스트에서 등장 시 오류\n\n---\n\n## AST Schema Definition\n\nParser BNF 위에서 생성되는 최종 AST 구조입니다. 모든 UIH DSL 요소가 이 스키마에 따라 구조화됩니다.\n\n### 1. AST Root\n\n#### ASTRoot\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Program\&quot;\n  meta: MetaNode\n  style: StyleNode\n  components: ComponentsNode | null\n  layout: LayoutNode\n  script: ScriptNode | null\n}\n&#96;&#96;&#96;\n\n### 2. Meta Node\n\n#### MetaNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Meta\&quot;\n  properties: MetaProperty[]\n}\n&#96;&#96;&#96;\n\n#### MetaProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;title\&quot;\n  value: string|number|boolean\n  location: Range     // from tokenizer\n}\n&#96;&#96;&#96;\n\n### 3. Style Node\n\n#### StyleNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Style\&quot;\n  properties: StyleProperty[]\n}\n&#96;&#96;&#96;\n\n#### StyleProperty\n&#96;&#96;&#96;typescript\n{\n  key: string         // e.g. \&quot;color.primary\&quot;\n  value: string|number\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 4. Components Node\n\n#### ComponentsNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Components\&quot;\n  components: ComponentEntry[]\n}\n&#96;&#96;&#96;\n\n#### ComponentEntry\n&#96;&#96;&#96;typescript\n{\n  name: string        // e.g. \&quot;Card\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 5. Layout Node (Core Tree Structure)\n\n#### LayoutNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Layout\&quot;\n  children: LayoutElement[]     // top-level nodes inside layout block\n}\n&#96;&#96;&#96;\n\n#### LayoutElement\n&#96;&#96;&#96;typescript\nLayoutElement = LayoutComponent | LayoutText\n&#96;&#96;&#96;\n\n#### 5.1 Layout Component\n&#96;&#96;&#96;typescript\nLayoutComponent {\n  type: \&quot;Component\&quot;\n  tag: string                   // e.g. \&quot;Div\&quot;, \&quot;P\&quot;, \&quot;Header\&quot;\n  attributes: Attribute[]\n  children: LayoutElement[]     // nested structure\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### Attribute\n&#96;&#96;&#96;typescript\n{\n  key: string                   // lower-case only\n  value: string                 // inline string only\n  location: Range\n}\n&#96;&#96;&#96;\n\n#### 5.2 Layout Text Node\n&#96;&#96;&#96;typescript\nLayoutText {\n  type: \&quot;Text\&quot;\n  value: string                 // raw text string\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 6. Script Node\n\n#### ScriptNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;Script\&quot;\n  events: ScriptProperty[]\n}\n&#96;&#96;&#96;\n\n#### ScriptProperty\n&#96;&#96;&#96;typescript\n{\n  key: string                   // e.g. \&quot;onclick\&quot; (lowercase only)\n  value: string                 // e.g. \&quot;submitForm\&quot;\n  location: Range\n}\n&#96;&#96;&#96;\n\n### 7. Range Object (Source Location)\n\n#### Range\n&#96;&#96;&#96;typescript\n{\n  start: Position\n  end: Position\n}\n&#96;&#96;&#96;\n\n#### Position\n&#96;&#96;&#96;typescript\n{\n  line: number\n  column: number\n}\n&#96;&#96;&#96;\n\n### 8. Semantics Rules (Validation Layer)\n\n1. Meta keys must be from allowlist:\n   - title, route, theme, description\n\n2. Style keys may use dot notation but MUST be lowercase.\n\n3. Components must be names only, no properties.\n\n4. Layout:\n   - tag must be a valid TagName or valid identifier\n   - attributes must be string-only\n   - children: array of LayoutElement (component or text)\n\n5. Script:\n   - keys must be known event names\n   - value must be string (function name)\n\n6. No null children arrays. Use &#96;[]&#96; if empty.\n\n7. All nodes must have location data.\n\n### 9. Example: Full AST for a Simple Page\n\n#### Example DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### Generated AST (simplified)\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Home\&quot; },\n      { \&quot;key\&quot;: \&quot;route\&quot;, \&quot;value\&quot;: \&quot;/\&quot; }\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: [\n      { \&quot;key\&quot;: \&quot;color.primary\&quot;, \&quot;value\&quot;: \&quot;#0E5EF7\&quot; }\n    ]\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: [\n          { \&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;p-4\&quot; }\n        ],\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n### AST 구조 트리\n\n&#96;&#96;&#96;\nASTRoot (Program)\n├── meta (MetaNode)\n│   └── properties[] (MetaProperty)\n├── style (StyleNode)\n│   └── properties[] (StyleProperty)\n├── components (ComponentsNode | null)\n│   └── components[] (ComponentEntry)\n├── layout (LayoutNode)\n│   └── children[] (LayoutElement)\n│       ├── LayoutComponent\n│       │   ├── attributes[] (Attribute)\n│       │   └── children[] (LayoutElement)\n│       └── LayoutText\n└── script (ScriptNode | null)\n    └── events[] (ScriptProperty)\n&#96;&#96;&#96;\n\n### AST Examples\n\n#### 최소 AST 구조\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Program\&quot;,\n  \&quot;meta\&quot;: {\n    \&quot;type\&quot;: \&quot;Meta\&quot;,\n    \&quot;properties\&quot;: [\n      {\&quot;key\&quot;: \&quot;title\&quot;, \&quot;value\&quot;: \&quot;Minimal\&quot;}\n    ]\n  },\n  \&quot;style\&quot;: {\n    \&quot;type\&quot;: \&quot;Style\&quot;,\n    \&quot;properties\&quot;: []\n  },\n  \&quot;components\&quot;: null,\n  \&quot;layout\&quot;: {\n    \&quot;type\&quot;: \&quot;Layout\&quot;,\n    \&quot;children\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;Text\&quot;,\n        \&quot;value\&quot;: \&quot;Content\&quot;\n      }\n    ]\n  },\n  \&quot;script\&quot;: null\n}\n&#96;&#96;&#96;\n\n#### 복잡한 레이아웃 AST\n&#96;&#96;&#96;json\n{\n  \&quot;type\&quot;: \&quot;Layout\&quot;,\n  \&quot;children\&quot;: [\n    {\n      \&quot;type\&quot;: \&quot;Component\&quot;,\n      \&quot;tag\&quot;: \&quot;Div\&quot;,\n      \&quot;attributes\&quot;: [\n        {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;container\&quot;}\n      ],\n      \&quot;children\&quot;: [\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Header\&quot;,\n          \&quot;attributes\&quot;: [],\n          \&quot;children\&quot;: [\n            {\n              \&quot;type\&quot;: \&quot;Component\&quot;,\n              \&quot;tag\&quot;: \&quot;H1\&quot;,\n              \&quot;attributes\&quot;: [],\n              \&quot;children\&quot;: [\n                {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Title\&quot;}\n              ]\n            }\n          ]\n        },\n        {\n          \&quot;type\&quot;: \&quot;Component\&quot;,\n          \&quot;tag\&quot;: \&quot;Main\&quot;,\n          \&quot;attributes\&quot;: [\n            {\&quot;key\&quot;: \&quot;class\&quot;, \&quot;value\&quot;: \&quot;content\&quot;}\n          ],\n          \&quot;children\&quot;: [\n            {\&quot;type\&quot;: \&quot;Text\&quot;, \&quot;value\&quot;: \&quot;Main content\&quot;}\n          ]\n        }\n      ]\n    }\n  ]\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- location 정보 누락 시 AST 생성 실패\n- 빈 children 배열 대신 null 사용 시 validation 오류\n- 허용되지 않은 meta/style/script 키 사용 시 semantic 오류\n- LayoutComponent의 tag가 유효하지 않은 경우 오류\n- LayoutText에 빈 문자열 사용 시 경고\n- 중첩 깊이가 너무 깊을 경우 (10레벨 초과) 경고 또는 오류\n\n---\n\n## IR (Intermediate Representation) Specification\n\nAST → IR 변환 규칙을 정의합니다. Codegen 단계 직전의 \&quot;정규화된 구조\&quot;로, 플랫폼불문의 공통 인터페이스를 제공합니다.\n\n### 1. Overview\n\n#### IR_GOAL\n- AST의 복잡한 구조를 코드 생성하기 좋게 단순화\n- UI 컴포넌트 트리와 메타데이터를 정규화\n- 플랫폼불문(React/Next/Svelte) 공통 인터페이스로 변환\n- 모든 값은 최종적이고 확정된 형태만 유지\n\n#### INPUT\n- ASTRoot\n\n#### OUTPUT\n- IRRoot\n\n### 2. IR Root\n\n#### IRRoot\n&#96;&#96;&#96;typescript\n{\n  meta: IRMeta\n  style: IRStyle\n  components: IRComponents\n  layout: IRLayoutTree\n  script: IRScript\n}\n&#96;&#96;&#96;\n\n### 3. IRMeta (Final Document Metadata)\n\n#### IRMeta\n&#96;&#96;&#96;typescript\n{\n  title: string\n  route: string\n  theme: \&quot;light\&quot; | \&quot;dark\&quot;\n  description: string | null\n}\n&#96;&#96;&#96;\n\n#### Rules\n- missing values become null\n- enforce route starts with \&quot;/\&quot;\n\n### 4. IRStyle (Flattened Style Tokens)\n\n#### IRStyle\n&#96;&#96;&#96;typescript\n{\n  tokens: Record&lt;string, string | number&gt;\n}\n&#96;&#96;&#96;\n\n#### Examples\n&#96;&#96;&#96;typescript\n{\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n  \&quot;radius.default\&quot;: 8\n}\n&#96;&#96;&#96;\n\n#### Rules\n- dot-notation keys preserved\n- all values converted to primitive string/number\n- no validation here (semantic pass already done)\n\n### 5. IRComponents (Registered Component Map)\n\n#### IRComponents\n&#96;&#96;&#96;typescript\n{\n  list: string[]   // e.g. [\&quot;Card\&quot;, \&quot;Button\&quot;]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- duplicates removed\n- sorted alphabetically for deterministic output\n\n### 6. IRLayoutTree (Normalized UI Tree)\n\n#### IRLayoutTree\n&#96;&#96;&#96;typescript\n{\n  root: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### IRNode\n&#96;&#96;&#96;typescript\nIRNode = IRComponentNode | IRTextNode\n&#96;&#96;&#96;\n\n#### 6.1 IRComponentNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;component\&quot;\n  tag: string\n  attributes: Record&lt;string, string&gt;   // key:string only\n  children: IRNode[]\n}\n&#96;&#96;&#96;\n\n#### Rules\n- attribute keys lower-case enforced\n- children always array\n- empty children =&gt; []\n\n#### 6.2 IRTextNode\n&#96;&#96;&#96;typescript\n{\n  type: \&quot;text\&quot;\n  value: string\n}\n&#96;&#96;&#96;\n\n#### Rules\n- trimmed text preserved exactly\n- no newline allowed inside text\n\n### 7. IRScript (Event Map)\n\n#### IRScript\n&#96;&#96;&#96;typescript\n{\n  events: Record&lt;string, string&gt;   // onclick → \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Rules\n- all keys normalized to lower-case event names\n- camelCase event keys는 허용되지 않음 (validation 단계에서 차단)\n- event value must be string only\n- duplicates override earlier definitions\n\n### 8. AST → IR Mapping Rules\n\n1. **MetaNode → IRMeta**\n   - convert property array → object map\n   - apply default values if missing\n   - route must start with \&quot;/\&quot;\n\n2. **StyleNode → IRStyle**\n   - flatten list into tokens object\n   - preserve ordering but output sorted keys for determinism\n\n3. **ComponentsNode → IRComponents**\n   - convert component list → array\n   - remove duplicates\n   - sort alphabetically\n\n4. **LayoutNode → IRLayoutTree**\n   - recursively convert LayoutComponent → IRComponentNode\n   - convert LayoutText → IRTextNode\n   - inline attributes converted to plain object\n\n5. **ScriptNode → IRScript**\n   - property list flattened to event map\n   - enforce lower-case event names\n\n### 9. Example: Full IR Output\n\n#### DSL\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Home\&quot;\n  route: \&quot;/\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n}\n\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n#### IR\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Home\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: null,\n    \&quot;description\&quot;: null\n  },\n\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;\n    }\n  },\n\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: []\n  },\n\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: { \&quot;class\&quot;: \&quot;p-4\&quot; },\n        \&quot;children\&quot;: [\n          { \&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Hello\&quot; }\n        ]\n      }\n    ]\n  },\n\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {}\n  }\n}\n&#96;&#96;&#96;\n\n### IR 구조 트리\n\n&#96;&#96;&#96;\nIRRoot\n├── meta (IRMeta)\n│   ├── title: string\n│   ├── route: string\n│   ├── theme: \&quot;light\&quot;|\&quot;dark\&quot;|null\n│   └── description: string|null\n├── style (IRStyle)\n│   └── tokens: Record&lt;string, string|number&gt;\n├── components (IRComponents)\n│   └── list: string[]\n├── layout (IRLayoutTree)\n│   └── root: IRNode[]\n│       ├── IRComponentNode\n│       │   ├── type: \&quot;component\&quot;\n│       │   ├── tag: string\n│       │   ├── attributes: Record&lt;string, string&gt;\n│       │   └── children: IRNode[]\n│       └── IRTextNode\n│           ├── type: \&quot;text\&quot;\n│           └── value: string\n└── script (IRScript)\n    └── events: Record&lt;string, string&gt;\n&#96;&#96;&#96;\n\n### IR Examples\n\n#### 간단한 IR 변환\n&#96;&#96;&#96;json\n{\n  \&quot;meta\&quot;: {\n    \&quot;title\&quot;: \&quot;Simple\&quot;,\n    \&quot;route\&quot;: \&quot;/\&quot;,\n    \&quot;theme\&quot;: \&quot;light\&quot;,\n    \&quot;description\&quot;: null\n  },\n  \&quot;style\&quot;: {\n    \&quot;tokens\&quot;: {\n      \&quot;color.primary\&quot;: \&quot;#000\&quot;,\n      \&quot;font.size\&quot;: 14\n    }\n  },\n  \&quot;components\&quot;: {\n    \&quot;list\&quot;: [\&quot;Button\&quot;]\n  },\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Div\&quot;,\n        \&quot;attributes\&quot;: {},\n        \&quot;children\&quot;: [\n          {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Content\&quot;}\n        ]\n      }\n    ]\n  },\n  \&quot;script\&quot;: {\n    \&quot;events\&quot;: {\n      \&quot;onclick\&quot;: \&quot;handleClick\&quot;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n#### 복잡한 중첩 레이아웃 IR\n&#96;&#96;&#96;json\n{\n  \&quot;layout\&quot;: {\n    \&quot;root\&quot;: [\n      {\n        \&quot;type\&quot;: \&quot;component\&quot;,\n        \&quot;tag\&quot;: \&quot;Container\&quot;,\n        \&quot;attributes\&quot;: {\n          \&quot;class\&quot;: \&quot;flex flex-col min-h-screen\&quot;\n        },\n        \&quot;children\&quot;: [\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Header\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;p-4 bg-blue-600\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;H1\&quot;,\n                \&quot;attributes\&quot;: {},\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Dashboard\&quot;}\n                ]\n              }\n            ]\n          },\n          {\n            \&quot;type\&quot;: \&quot;component\&quot;,\n            \&quot;tag\&quot;: \&quot;Main\&quot;,\n            \&quot;attributes\&quot;: {\n              \&quot;class\&quot;: \&quot;flex-1 p-6\&quot;\n            },\n            \&quot;children\&quot;: [\n              {\n                \&quot;type\&quot;: \&quot;component\&quot;,\n                \&quot;tag\&quot;: \&quot;Card\&quot;,\n                \&quot;attributes\&quot;: {\n                  \&quot;class\&quot;: \&quot;bg-white shadow-lg rounded\&quot;\n                },\n                \&quot;children\&quot;: [\n                  {\&quot;type\&quot;: \&quot;text\&quot;, \&quot;value\&quot;: \&quot;Welcome!\&quot;}\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n&#96;&#96;&#96;\n\n### Edge Cases\n\n- AST에 location 정보 누락 시 IR 변환 실패\n- route가 \&quot;/\&quot;로 시작하지 않을 경우 변환 시 강제 추가\n- 중복 컴포넌트 등록 시 알파벳 순 정렬로 중복 제거\n- 빈 children 배열을 null로 잘못 설정 시 []로 강제 변환\n- 텍스트 노드에 줄바꿈 포함 시 변환 중 제거 또는 오류\n- 이벤트 키 대소문자 혼재 시 소문자로 통일\n- 스타일 토큰 키 순서가 다를 경우 sorted keys로 결정적 출력 보장\n\n---\n\n## Codegen Rules\n\n### React/Next.js 15 Codegen\n\nIR을 기반으로 안정적인 UI 코드 생성 규칙입니다. React/Next.js 15 (App Router + RSC) 기준으로 IR을 실제 코드로 변환합니다.\n\n#### 1. Overview\n\n##### GOAL\n- IR을 기반으로 안정적인 UI 코드 생성\n- React/Next.js 15 (App Router + RSC) 기준\n- \&quot;디자인 시스템 없는 순수 Layout Tree\&quot;를 코드로 변환\n- 가능한 한 deterministic 하게 출력\n- 로직/상태/이벤트는 최소 수준으로만 개입\n\n##### INPUT\n- IRRoot\n\n##### OUTPUT\n- React Component Source Code (string)\n\n#### 2. Output Structure\n\n파일 구조는 다음 형태로 생성합니다:\n\n&#96;&#96;&#96;\n/page.tsx\n  - metadata (title, description)\n  - default export function Page()\n  - return(...) 내부에 layout tree 삽입\n\n/style-tokens.ts\n  - style.tokens flatten export\n\n/components/index.ts\n  - components registry export\n\n/script-events.ts\n  - event name string mapping export\n&#96;&#96;&#96;\n\n#### 3. Metadata Codegen\n\n##### UIH meta → Next.js metadata\n&#96;&#96;&#96;typescript\nIRMeta {\n  title: string\n  description: string\n}\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;typescript\nexport const metadata = {\n  title: \&quot;&lt;title&gt;\&quot;,\n  description: \&quot;&lt;description&gt;\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- description 없으면 필드 제외\n- theme는 metadata에 직접 쓰지 않음 (스타일토큰 용)\n\n#### 4. Style Token Codegen\n\n##### IRStyle { tokens }\n&#96;&#96;&#96;typescript\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;radius.default\&quot;: 8,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 키는 string 리터럴 그대로\n- numeric/string 그대로 출력\n- sorted keys for deterministic output\n\n#### 5. Component Registry Codegen\n\n##### IRComponents.list → export list\n&#96;&#96;&#96;typescript\nexport const components = {\n  Card,\n  Button,\n  Input,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- 자동 import 하지 않음 (상위 시스템이 resolve)\n- keys는 PascalCase 유지\n- duplicates 제거 후 정렬\n\n#### 6. Layout Tree → JSX Codegen\n\n##### IRLayoutTree → React element tree\n\n##### 6.1 Component Node\n&#96;&#96;&#96;typescript\nIRComponentNode {\n  tag: \&quot;Div\&quot;\n  attributes: { class: \&quot;p-4\&quot; }\n  children: [...]\n}\n&#96;&#96;&#96;\n\n##### OUTPUT JSX\n&#96;&#96;&#96;jsx\n&lt;Div className=\&quot;p-4\&quot;&gt;\n  {children...}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n##### RULES\n- attribute.key \&quot;class\&quot; → \&quot;className\&quot;\n- attribute key는 그대로 lower-case 유지\n- value는 string literal\n- children length 0 이면 self-closing 금지 (always explicit block)\n- tag name 그대로 JSX 컴포넌트로 사용\n\n##### 6.2 Text Node\n&#96;&#96;&#96;typescript\nIRTextNode { value: \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n##### OUTPUT\n&#96;&#96;&#96;jsx\n{\&quot;Hello\&quot;}\n&#96;&#96;&#96;\n\n##### RULES\n- 텍스트는 JSX children 표현\n- 특수문자는 자동 escape\n\n#### 7. Script Event Codegen\n\n##### IRScript.events → export mapping\n&#96;&#96;&#96;typescript\nexport const eventHandlers = {\n  onclick: \&quot;submitForm\&quot;,\n  onload: \&quot;init\&quot;,\n};\n&#96;&#96;&#96;\n\n##### RULES\n- event 이름은 lower-case normalized\n- 값은 string (함수명)\n- 실제 JS 함수 body는 생성하지 않음\n- 나중 시스템이 자동 wire-up 함\n\n#### 8. Full Page Generation\n\n최종 page.tsx는 다음 구조를 따릅니다:\n\n&#96;&#96;&#96;typescript\nexport const metadata = { ... };\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen p-4\&quot;&gt;\n      &lt;P&gt;{\&quot;Hello\&quot;}&lt;/P&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### RULES\n- 최상위는 항상 &#96;&lt;Div&gt;&#96; 같은 Wrapper로 시작하지 않아도 됨\n- layout.root가 배열이면 Fragment로 감싼다\n- 코드 스타일은 2-space indent\n- 세미콜론 붙이지 않음 (Prettier 옵션 따라감)\n\n#### 9. Determinism Rules\n\n1. 속성 순서는 key 알파벳순 정렬\n2. children 순서는 DSL 입력 순서 그대로\n3. components 목록은 알파벳순 정렬\n4. styleTokens도 key 정렬\n5. eventHandlers key 정렬\n6. output JSX는 항상 multiline\n\n#### 10. Full Example (DSL → IR → JSX)\n\n##### DSL\n&#96;&#96;&#96;\nlayout {\n  Div(class:\&quot;p-4\&quot;) {\n    \&quot;Hello\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n##### JSX OUT\n&#96;&#96;&#96;typescript\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;p-4\&quot;&gt;\n      {\&quot;Hello\&quot;}\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n#### 11. Notes for Engine Integrators\n\n1. Codegen은 \&quot;순수 구조\&quot;만 책임진다\n   - 상태(state), fetch, useEffect 등은 지원하지 않음\n2. 이벤트 핸들러는 단순 라벨링 시스템\n3. 스타일 토큰은 UI 프레임워크에서 직접 해석\n4. React, Vue, Svelte 등 플랫폼별 코드젠 가능\n   - 플랫폼별 레이어는 분리\n\n#### Output Files 구조\n\n&#96;&#96;&#96;\nOutput Files\n├── page.tsx\n│   ├── metadata export\n│   ├── imports (components, styleTokens, eventHandlers)\n│   ├── Page() function\n│   └── JSX return (layout tree)\n├── style-tokens.ts\n│   └── styleTokens export\n├── components/index.ts\n│   └── components export\n└── script-events.ts\n    └── eventHandlers export\n&#96;&#96;&#96;\n\n#### Codegen Examples\n\n##### 전체 페이지 코드 생성 예시\n&#96;&#96;&#96;typescript\n// page.tsx\nexport const metadata = {\n  title: \&quot;Dashboard\&quot;,\n  description: \&quot;Main dashboard page\&quot;\n};\n\nimport { components } from \&quot;./components\&quot;;\nimport { styleTokens } from \&quot;./style-tokens\&quot;;\nimport { eventHandlers } from \&quot;./script-events\&quot;;\n\nexport default function Page() {\n  return (\n    &lt;Div className=\&quot;min-h-screen flex flex-col\&quot;&gt;\n      &lt;Header className=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n        &lt;H1&gt;\n          {\&quot;Dashboard\&quot;}\n        &lt;/H1&gt;\n      &lt;/Header&gt;\n      &lt;Main className=\&quot;flex-1 p-6\&quot;&gt;\n        &lt;Card className=\&quot;bg-white shadow-lg rounded-lg p-6\&quot;&gt;\n          &lt;P&gt;\n            {\&quot;Welcome back!\&quot;}\n          &lt;/P&gt;\n        &lt;/Card&gt;\n      &lt;/Main&gt;\n    &lt;/Div&gt;\n  );\n}\n&#96;&#96;&#96;\n\n##### 스타일 토큰 파일 예시\n&#96;&#96;&#96;typescript\n// style-tokens.ts\nexport const styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;color.secondary\&quot;: \&quot;#6B7280\&quot;,\n  \&quot;color.accent\&quot;: \&quot;#F59E0B\&quot;,\n  \&quot;spacing.small\&quot;: 8,\n  \&quot;spacing.medium\&quot;: 16,\n  \&quot;spacing.large\&quot;: 24,\n  \&quot;border.radius\&quot;: 6,\n  \&quot;font.family\&quot;: \&quot;Inter\&quot;,\n  \&quot;font.size.base\&quot;: 16,\n  \&quot;shadow.default\&quot;: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n};\n&#96;&#96;&#96;\n\n##### 컴포넌트 레지스트리 예시\n&#96;&#96;&#96;typescript\n// components/index.ts\nexport const components = {\n  Button,\n  Card,\n  Input,\n  Modal,\n  Sidebar\n};\n&#96;&#96;&#96;\n\n##### 이벤트 핸들러 파일 예시\n&#96;&#96;&#96;typescript\n// script-events.ts\nexport const eventHandlers = {\n  onclick: \&quot;handleClick\&quot;,\n  onload: \&quot;initDashboard\&quot;,\n  onsubmit: \&quot;processForm\&quot;\n};\n&#96;&#96;&#96;\n\n#### Edge Cases\n\n- layout.root가 빈 배열일 경우 빈 Fragment 생성\n- 컴포넌트 이름이 JavaScript 예약어와 충돌 시 escaping 필요\n- 텍스트에 JSX 특수문자 포함 시 자동 escape\n- 중첩 깊이가 깊을 경우 코드 포맷팅 유지\n- import 경로 resolve 실패 시 상위 시스템에서 처리\n- styleTokens에 특수문자 키 포함 시 유효한 JS 객체 키로 변환\n\n---\n\n### Vue &amp; Svelte Codegen\n\nReact Codegen과 동일한 IR 기반으로 Vue와 Svelte 코드를 생성하는 규칙입니다. 플랫폼별 렌더링 규칙만 다르게 적용합니다.\n\n## SECTION A — Vue Codegen (SFC 기준)\n\n### GOAL\n- IR → .vue 파일 형태로 변환\n- &#96;&lt;template&gt;&#96; + &#96;&lt;script setup&gt;&#96; + &#96;&lt;style&gt;&#96; 구조 유지\n- 모든 로직은 배제하고 구조만 생성\n\n### OUTPUT FILE STRUCTURE\n&#96;&#96;&#96;\nMyPage.vue\n&#96;&#96;&#96;\n\n### 1. Top-Level Structure\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;!-- layout tree --&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport components...\n\nconst events = {...}\nconst styleTokens = {...}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* optional if needed */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Vue Template 규칙\n\n#### IRComponentNode(tag:\&quot;Div\&quot;, attributes, children)\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  &lt;!-- children --&gt;\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- &#96;className&#96; → &#96;class&#96;\n- attribute values: string only\n- children: 그대로 template로 변환\n- Fragment는 &#96;&lt;template&gt;&#96; 안에서 그냥 siblings로 출력\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello (그대로 text node)\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\neventHandlers {\n  onclick: \&quot;submitForm\&quot;\n}\n&#96;&#96;&#96;\n\n#### Vue OUTPUT\n&#96;&#96;&#96;vue\n@click=\&quot;submitForm\&quot;\n&#96;&#96;&#96;\n\n#### RULES\n- DSL &#96;onclick&#96; → Vue &#96;@click&#96;\n- DSL &#96;onchange&#96; → Vue &#96;@change&#96;\n- DSL &#96;oninput&#96; → Vue &#96;@input&#96;\n- DSL &#96;onload&#96; → Vue &#96;@load&#96;\n- value는 함수 이름 string\n- 함수 구현은 생성하지 않음\n\n### 4. Component Registry (imports)\n&#96;&#96;&#96;javascript\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules\n- 속성(sorted)\n- imports(sorted)\n- children 순서 그대로\n- no semicolons\n- template 들여쓰기 2 spaces\n\n## SECTION B — Svelte Codegen (.svelte)\n\n### GOAL\n- Svelte 컴포넌트 파일 하나로 완성\n- &#96;&lt;script&gt;&#96; + markup 구조\n\n### OUTPUT STRUCTURE\n&#96;&#96;&#96;\nMyPage.svelte\n&#96;&#96;&#96;\n\n### 1. File Layout\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import components...\n  export let events = {...}\n  export let styleTokens = {...}\n&lt;/script&gt;\n\n&lt;!-- layout markup --&gt;\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  Hello\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* optional */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n### 2. Layout Tree → Svelte Markup\n\n#### IRComponentNode(tag, attributes, children)\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;\n  {#if ... ?} (없음)\n  {children}\n&lt;/Div&gt;\n&#96;&#96;&#96;\n\n#### RULES\n- 클래스는 &#96;class&#96;\n- 속성 문자열만\n- Self-closing 금지\n- children 재귀적 삽입\n\n#### IRTextNode\n&#96;&#96;&#96;\n\&quot;Hello\&quot; → Hello\n&#96;&#96;&#96;\n\n### 3. Event Mapping\n&#96;&#96;&#96;javascript\nIRScript:\nonclick → function name\n&#96;&#96;&#96;\n\n#### Svelte OUTPUT\n&#96;&#96;&#96;svelte\non:click={submitForm}\n&#96;&#96;&#96;\n\n#### Mapping\n&#96;&#96;&#96;\nonclick   → on:click\nonchange  → on:change\noninput   → on:input\nonload    → on:load\n&#96;&#96;&#96;\n\n### 4. Components Import\n&#96;&#96;&#96;javascript\nimport Card from \&quot;./Card.svelte\&quot;;\nimport Button from \&quot;./Button.svelte\&quot;;\n&#96;&#96;&#96;\n\n### 5. Determinism Rules (필수)\n\n1. import 순서는 알파벳 정렬\n2. attributes sorted\n3. event names lower-case\n4. children 순서 보존\n5. markup 들여쓰기 2 spaces\n\n## SECTION C — Cross-Platform Notes\n\n1. React / Vue / Svelte 모두 IR만 참조\n2. layout tree는 그대로 세 렌더러에서 재활용\n3. event handler는 단순 label → framework alias로 변환\n4. styleTokens는 컴파일러 외부 시스템이 처리\n5. components는 registry 기반으로 import만 생성\n\n## SECTION D — Example Conversion (Same IR → Vue/Svelte)\n\n### IR\n&#96;&#96;&#96;\nDiv(class:\&quot;p-4\&quot;) { \&quot;Hello\&quot; }\n&#96;&#96;&#96;\n\n### Vue Template\n&#96;&#96;&#96;vue\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Svelte Markup\n&#96;&#96;&#96;svelte\n&lt;Div class=\&quot;p-4\&quot;&gt;Hello&lt;/Div&gt;\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte 구조\n\n&#96;&#96;&#96;\nVue Output (.vue)\n├── &lt;template&gt;\n│   └── layout tree (Vue template syntax)\n├── &lt;script setup&gt;\n│   ├── component imports\n│   ├── events object\n│   └── styleTokens object\n└── &lt;style scoped&gt;\n    └── optional styles\n\nSvelte Output (.svelte)\n├── &lt;script&gt;\n│   ├── component imports\n│   ├── export let events = {...}\n│   └── export let styleTokens = {...}\n├── layout markup (Svelte syntax)\n└── &lt;style&gt;\n    └── optional styles\n&#96;&#96;&#96;\n\n### Vue &amp; Svelte Examples\n\n#### Vue SFC 전체 예시\n&#96;&#96;&#96;vue\n&lt;template&gt;\n  &lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n    &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n      &lt;H1&gt;\n        Dashboard\n      &lt;/H1&gt;\n    &lt;/Header&gt;\n    &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n      &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; @click=\&quot;handleCardClick\&quot;&gt;\n        &lt;P&gt;\n          Welcome back!\n        &lt;/P&gt;\n      &lt;/Card&gt;\n    &lt;/Main&gt;\n  &lt;/Div&gt;\n&lt;/template&gt;\n\n&lt;script setup&gt;\nimport Card from \&quot;@/components/Card.vue\&quot;\nimport Button from \&quot;@/components/Button.vue\&quot;\n\nconst events = {\n  handleCardClick: \&quot;handleCardClick\&quot;\n}\n\nconst styleTokens = {\n  \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n  \&quot;spacing.medium\&quot;: 16\n}\n&lt;/script&gt;\n\n&lt;style scoped&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### Svelte 컴포넌트 전체 예시\n&#96;&#96;&#96;svelte\n&lt;script&gt;\n  import Card from \&quot;./Card.svelte\&quot;;\n  import Button from \&quot;./Button.svelte\&quot;;\n\n  export let events = {\n    handleCardClick: \&quot;handleCardClick\&quot;\n  };\n\n  export let styleTokens = {\n    \&quot;color.primary\&quot;: \&quot;#0E5EF7\&quot;,\n    \&quot;spacing.medium\&quot;: 16\n  };\n&lt;/script&gt;\n\n&lt;Div class=\&quot;min-h-screen flex flex-col\&quot;&gt;\n  &lt;Header class=\&quot;p-4 bg-blue-600 text-white\&quot;&gt;\n    &lt;H1&gt;\n      Dashboard\n    &lt;/H1&gt;\n  &lt;/Header&gt;\n  &lt;Main class=\&quot;flex-1 p-6\&quot;&gt;\n    &lt;Card class=\&quot;bg-white shadow-lg rounded-lg p-6\&quot; on:click={handleCardClick}&gt;\n      &lt;P&gt;\n        Welcome back!\n      &lt;/P&gt;\n    &lt;/Card&gt;\n  &lt;/Main&gt;\n&lt;/Div&gt;\n\n&lt;style&gt;\n/* Optional custom styles */\n&lt;/style&gt;\n&#96;&#96;&#96;\n\n#### 이벤트 매핑 비교\n&#96;&#96;&#96;javascript\n// 동일한 IR 이벤트\n{\n  onclick: \&quot;handleClick\&quot;,\n  onchange: \&quot;handleChange\&quot;,\n  onload: \&quot;init\&quot;\n}\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;vue\n&lt;!-- Vue --&gt;\n&lt;Button @click=\&quot;handleClick\&quot; @change=\&quot;handleChange\&quot; @load=\&quot;init\&quot;&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;svelte\n&lt;!-- Svelte --&gt;\n&lt;Button on:click={handleClick} on:change={handleChange} on:load={init}&gt;\n&#96;&#96;&#96;\n\n&#96;&#96;&#96;jsx\n&lt;!-- React --&gt;\n&lt;Button onClick={handleClick} onChange={handleChange} onLoad={init}&gt;\n&#96;&#96;&#96;\n\n&gt; DSL 이벤트 키는 항상 소문자지만 React JSX에서는 &#96;onClick&#96;처럼 프레임워크 규칙에 맞게 자동 변환된다.\n\n### Edge Cases\n\n- Vue에서 컴포넌트 이름이 kebab-case로 변환 필요 시 자동 처리\n- Svelte에서 export let 구문이 예약어와 충돌 시 renaming\n- 이벤트 핸들러가 정의되지 않은 경우 플랫폼별 기본 동작\n- 스타일 토큰에 CSS 변수나 함수 포함 시 escaping\n- 중첩 컴포넌트 깊이가 깊을 경우 플랫폼별 최적화 적용\n- 텍스트 콘텐츠에 플랫폼별 특수문자 포함 시 자동 escape\n\n---\n\n## Examples\n\n### 완전한 UIH DSL 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;User Dashboard\&quot;\n  route: \&quot;/dashboard\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Main user dashboard with analytics\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  color.accent: \&quot;#F59E0B\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n  font.size.h1: 32\n  spacing.small: 8\n  spacing.medium: 16\n  spacing.large: 24\n  border.radius: 6\n  shadow.default: \&quot;0 1px 3px rgba(0,0,0,0.1)\&quot;\n}\n\ncomponents {\n  Card\n  Button\n  Input\n  Modal\n  Sidebar\n  Chart\n}\n\nlayout {\n  Container(class:\&quot;max-w-7xl mx-auto p-6\&quot;) {\n    Header(class:\&quot;mb-8\&quot;) {\n      Div(class:\&quot;flex justify-between items-center\&quot;) {\n        H1(class:\&quot;text-3xl font-bold\&quot;) {\n          \&quot;Dashboard\&quot;\n        }\n        Button(class:\&quot;px-4 py-2 bg-blue-600 text-white rounded\&quot;) {\n          \&quot;New Report\&quot;\n        }\n      }\n    }\n\n    Div(class:\&quot;grid grid-cols-3 gap-6\&quot;) {\n      Card(class:\&quot;col-span-2\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Analytics Overview\&quot;\n        }\n        Chart(class:\&quot;w-full h-64\&quot;)\n      }\n\n      Card(class:\&quot;col-span-1\&quot;) {\n        H2(class:\&quot;text-xl mb-4\&quot;) {\n          \&quot;Quick Stats\&quot;\n        }\n        Div(class:\&quot;space-y-4\&quot;) {\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Total Users\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;1,234\&quot;\n            }\n          }\n          Div(class:\&quot;p-4 bg-gray-50 rounded\&quot;) {\n            P(class:\&quot;text-sm text-gray-600\&quot;) {\n              \&quot;Active Sessions\&quot;\n            }\n            P(class:\&quot;text-2xl font-bold\&quot;) {\n              \&quot;89\&quot;\n            }\n          }\n        }\n      }\n    }\n\n    Sidebar(class:\&quot;mt-8\&quot;) {\n      H3(class:\&quot;text-lg mb-4\&quot;) {\n        \&quot;Recent Activity\&quot;\n      }\n      Div(class:\&quot;space-y-2\&quot;) {\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;User john@example.com logged in\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;New report generated\&quot;\n        }\n        P(class:\&quot;text-sm\&quot;) {\n          \&quot;System backup completed\&quot;\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onLoad: \&quot;initDashboard\&quot;\n  onClick: \&quot;handleButtonClick\&quot;\n  onRefresh: \&quot;refreshData\&quot;\n}\n&#96;&#96;&#96;\n\n### 최소 구조 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Minimal Page\&quot;\n  route: \&quot;/minimal\&quot;\n  theme: \&quot;light\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#0E5EF7\&quot;\n  spacing.unit: 12\n}\n\nlayout {\n  Div(class:\&quot;min-h-screen flex items-center justify-center bg-gray-50\&quot;) {\n    \&quot;Coming soon\&quot;\n  }\n}\n&#96;&#96;&#96;\n\n### Form 중심 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Sign Up\&quot;\n  route: \&quot;/signup\&quot;\n  theme: \&quot;light\&quot;\n  description: \&quot;Create a new account\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#2563EB\&quot;\n  color.secondary: \&quot;#6B7280\&quot;\n  font.family: \&quot;Inter\&quot;\n  font.size.base: 16\n}\n\ncomponents {\n  Form\n  Input\n  Button\n  Alert\n}\n\nlayout {\n  Section(class:\&quot;min-h-screen flex items-center justify-center bg-gray-100\&quot;) {\n    Form(class:\&quot;w-full max-w-md space-y-6 bg-white p-8 rounded-xl shadow-lg\&quot;) {\n      H2(class:\&quot;text-2xl font-semibold text-gray-900\&quot;) {\n        \&quot;Create your account\&quot;\n      }\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;email\&quot;, placeholder:\&quot;Enter email\&quot;)\n      Input(class:\&quot;w-full p-3 border border-gray-200 rounded-lg\&quot;, type:\&quot;password\&quot;, placeholder:\&quot;Enter password\&quot;)\n      Button(class:\&quot;w-full bg-blue-600 text-white py-3 rounded-lg\&quot;) {\n        \&quot;Sign up\&quot;\n      }\n      Alert(class:\&quot;text-sm text-gray-500 text-center\&quot;) {\n        \&quot;By signing up you agree to our terms\&quot;\n      }\n    }\n  }\n}\n\nscript {\n  onSubmit: \&quot;handleSignup\&quot;\n  onLoad: \&quot;prefillFromInvite\&quot;\n}\n&#96;&#96;&#96;\n\n### 콘텐츠 피드 예시\n\n&#96;&#96;&#96;\nmeta {\n  title: \&quot;Creator Feed\&quot;\n  route: \&quot;/feed\&quot;\n  theme: \&quot;dark\&quot;\n  description: \&quot;Realtime creator activity feed\&quot;\n}\n\nstyle {\n  color.primary: \&quot;#22D3EE\&quot;\n  color.background: \&quot;#0F172A\&quot;\n  font.family: \&quot;Space Grotesk\&quot;\n  spacing.medium: 20\n  radius.card: 12\n}\n\ncomponents {\n  Shell\n  Sidebar\n  Feed\n  FeedItem\n  Avatar\n  Badge\n}\n\nlayout {\n  Shell(class:\&quot;min-h-screen bg-slate-950 text-slate-100\&quot;) {\n    Sidebar(class:\&quot;w-64 border-r border-slate-800 p-6 space-y-6\&quot;) {\n      H1(class:\&quot;text-xl font-semibold tracking-tight\&quot;) {\n        \&quot;Creator Hub\&quot;\n      }\n      Badge(class:\&quot;inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 text-slate-200\&quot;) {\n        \&quot;Live updates\&quot;\n      }\n    }\n    Feed(class:\&quot;flex-1 p-8 space-y-6\&quot;) {\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-cyan-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;heymina.studio\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-300\&quot;) {\n              \&quot;New drop\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Dropped a limited neon kit — 120 packs sold out in 3 minutes.\&quot;\n          }\n        }\n      }\n      FeedItem(class:\&quot;bg-slate-900 border border-slate-800 rounded-2xl p-6 flex gap-4\&quot;) {\n        Avatar(class:\&quot;h-12 w-12 rounded-full bg-pink-400/20\&quot;, alt:\&quot;Avatar\&quot;)\n        Div(class:\&quot;space-y-2 flex-1\&quot;) {\n          Div(class:\&quot;flex items-center justify-between\&quot;) {\n            P(class:\&quot;font-medium\&quot;) {\n              \&quot;luvv.wav\&quot;\n            }\n            Badge(class:\&quot;text-xs px-2 py-1 rounded-full bg-cyan-500/10 text-cyan-300\&quot;) {\n              \&quot;Stream recap\&quot;\n            }\n          }\n          P(class:\&quot;text-sm text-slate-300\&quot;) {\n            \&quot;Hit 18,245 live viewers tonight — chat requested a synthwave encore.\&quot;\n          }\n        }\n      }\n    }\n  }\n}\n\nscript {\n  onRefresh: \&quot;fetchLatestFeed\&quot;\n  onClick: \&quot;openCreatorProfile\&quot;\n}\n&#96;&#96;&#96;\n\n---\n\n## Version\n\n- **Version**: 1.0.0\n- **Last Update**: 2025-11-18\n- **Change Summary**: Complete guide consolidating all UIH DSL specifications\n\n---\n\n## 문서 끝\n\n이 문서는 UIH DSL의 모든 스펙을 \&quot;생략 없이\&quot; 하나의 파일로 통합한 완전판입니다. Foundation Layer부터 Codegen까지 전 과정을 포함하며, LLM이 UI를 정확하게 선언할 수 있도록 설계된 모든 규칙이 담겨 있습니다.\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Reviewing event objects in examples**</details></think>

---

Cancelled

---

